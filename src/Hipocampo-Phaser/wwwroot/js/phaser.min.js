/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*
* @overview
*
* Phaser - http://phaser.io
*
* v2.14.0 "2020-01-19" - Built: Sun Jan 19 2020 13:12:03
*
* By Richard Davey http://www.photonstorm.com @photonstorm
*
* Phaser is a fun, free and fast 2D game framework for making HTML5 games
* for desktop and mobile web browsers, supporting Canvas and WebGL rendering.
*
* Phaser uses Pixi.js for rendering, created by Mat Groves http://matgroves.com @Doormat23
* Phaser uses p2.js for full-body physics, created by Stefan Hedman https://github.com/schteppe/p2.js @schteppe
* Phaser contains a port of N+ Physics, converted by Richard Davey, original by http://www.metanetsoftware.com
*
* Many thanks to Adam Saltsman (@ADAMATOMIC) for releasing Flixel, from which both Phaser and my love of framework development originate.
*
* Follow development at http://phaser.io and on our forum
*
* "If you want your children to be intelligent,  read them fairy tales."
* "If you want them to be more intelligent, read them more fairy tales."
*                                                     -- Albert Einstein
*/
!function(n){if(typeof exports=="object")module.exports=n();else if(typeof define=="function"&&!1)define(n);else{var t;typeof window!="undefined"?t=window:typeof global!="undefined"?t=global:typeof self!="undefined"&&(t=self);t.p2=n()}}(function(){return function n(t,i,r){function u(f,o){var h,s;if(!i[f]){if(!t[f]){if(h=typeof require=="function"&&require,!o&&h)return h(f,!0);if(e)return e(f,!0);throw new Error("Cannot find module '"+f+"'");}s=i[f]={exports:{}};t[f][0].call(s.exports,function(n){var i=t[f][1][n];return u(i?i:n)},s,s.exports,n,t,i,r)}return i[f].exports}for(var e=typeof require=="function"&&require,f=0;f<r.length;f++)u(r[f]);return u}({1:[function(n,t){function i(){}var r=n("./Scalar");t.exports=i;i.lineInt=function(n,t,i){i=i||0;var h=[0,0],u,f,c,e,o,l,s;return u=n[1][1]-n[0][1],f=n[0][0]-n[1][0],c=u*n[0][0]+f*n[0][1],e=t[1][1]-t[0][1],o=t[0][0]-t[1][0],l=e*t[0][0]+o*t[0][1],s=u*o-e*f,r.eq(s,0,i)||(h[0]=(o*c-f*l)/s,h[1]=(u*l-e*c)/s),h};i.segmentsIntersect=function(n,t,i,r){var u=t[0]-n[0],f=t[1]-n[1],e=r[0]-i[0],o=r[1]-i[1],s,h;return e*f-o*u==0?!1:(s=(u*(i[1]-n[1])+f*(n[0]-i[0]))/(e*f-o*u),h=(e*(n[1]-i[1])+o*(i[0]-n[0]))/(o*u-e*f),s>=0&&s<=1&&h>=0&&h<=1)}},{"./Scalar":4}],2:[function(n,t){function i(){}t.exports=i;i.area=function(n,t,i){return(t[0]-n[0])*(i[1]-n[1])-(i[0]-n[0])*(t[1]-n[1])};i.left=function(n,t,r){return i.area(n,t,r)>0};i.leftOn=function(n,t,r){return i.area(n,t,r)>=0};i.right=function(n,t,r){return i.area(n,t,r)<0};i.rightOn=function(n,t,r){return i.area(n,t,r)<=0};var r=[],u=[];i.collinear=function(n,t,f,e){var o,s;if(e){o=r;s=u;o[0]=t[0]-n[0];o[1]=t[1]-n[1];s[0]=f[0]-t[0];s[1]=f[1]-t[1];var h=o[0]*s[0]+o[1]*s[1],c=Math.sqrt(o[0]*o[0]+o[1]*o[1]),l=Math.sqrt(s[0]*s[0]+s[1]*s[1]),a=Math.acos(h/(c*l));return a<e}return i.area(n,t,f)==0};i.sqdist=function(n,t){var i=t[0]-n[0],r=t[1]-n[1];return i*i+r*r}},{}],3:[function(n,t){function i(){this.vertices=[]}function o(n,t,i,r,u){u=u||0;var f=t[1]-n[1],e=n[0]-t[0],l=f*n[0]+e*n[1],o=r[1]-i[1],h=i[0]-r[0],a=o*i[0]+h*i[1],c=f*h-o*e;return s.eq(c,0,u)?[0,0]:[(h*l-e*a)/c,(f*a-o*l)/c]}var u=n("./Line"),r=n("./Point"),s=n("./Scalar"),f,e;t.exports=i;i.prototype.at=function(n){var i=this.vertices,t=i.length;return i[n<0?n%t+t:n%t]};i.prototype.first=function(){return this.vertices[0]};i.prototype.last=function(){return this.vertices[this.vertices.length-1]};i.prototype.clear=function(){this.vertices.length=0};i.prototype.append=function(n,t,i){if(typeof t=="undefined")throw new Error("From is not given!");if(typeof i=="undefined")throw new Error("To is not given!");if(i-1<t)throw new Error("lol1");if(i>n.vertices.length)throw new Error("lol2");if(t<0)throw new Error("lol3");for(var r=t;r<i;r++)this.vertices.push(n.vertices[r])};i.prototype.makeCCW=function(){for(var n=0,t=this.vertices,i=1;i<this.vertices.length;++i)(t[i][1]<t[n][1]||t[i][1]==t[n][1]&&t[i][0]>t[n][0])&&(n=i);r.left(this.at(n-1),this.at(n),this.at(n+1))||this.reverse()};i.prototype.reverse=function(){for(var n=[],t=0,i=this.vertices.length;t!==i;t++)n.push(this.vertices.pop());this.vertices=n};i.prototype.isReflex=function(n){return r.right(this.at(n-1),this.at(n),this.at(n+1))};f=[];e=[];i.prototype.canSee=function(n,t){var h,c,o=f,s=e,i;if(r.leftOn(this.at(n+1),this.at(n),this.at(t))&&r.rightOn(this.at(n-1),this.at(n),this.at(t)))return!1;for(c=r.sqdist(this.at(n),this.at(t)),i=0;i!==this.vertices.length;++i)if((i+1)%this.vertices.length!==n&&i!==n&&r.leftOn(this.at(n),this.at(t),this.at(i+1))&&r.rightOn(this.at(n),this.at(t),this.at(i))&&(o[0]=this.at(n),o[1]=this.at(t),s[0]=this.at(i),s[1]=this.at(i+1),h=u.lineInt(o,s),r.sqdist(this.at(n),h)<c))return!1;return!0};i.prototype.copy=function(n,t,r){var f=r||new i,u;if(f.clear(),n<t)for(u=n;u<=t;u++)f.vertices.push(this.vertices[u]);else{for(u=0;u<=t;u++)f.vertices.push(this.vertices[u]);for(u=n;u<this.vertices.length;u++)f.vertices.push(this.vertices[u])}return f};i.prototype.getCutEdges=function(){for(var t,u,f=[],r=[],e=[],o=new i,s=Number.MAX_VALUE,n=0;n<this.vertices.length;++n)if(this.isReflex(n))for(t=0;t<this.vertices.length;++t)if(this.canSee(n,t)){for(r=this.copy(n,t,o).getCutEdges(),e=this.copy(t,n,o).getCutEdges(),u=0;u<e.length;u++)r.push(e[u]);r.length<s&&(f=r,s=r.length,f.push([this.at(n),this.at(t)]))}return f};i.prototype.decomp=function(){var n=this.getCutEdges();return n.length>0?this.slice(n):[this]};i.prototype.slice=function(n){var r,i,u,t,e,f;if(n.length==0)return[this];if(n instanceof Array&&n.length&&n[0]instanceof Array&&n[0].length==2&&n[0][0]instanceof Array){for(r=[this],i=0;i<n.length;i++)for(u=n[i],t=0;t<r.length;t++)if(e=r[t],f=e.slice(u),f){r.splice(t,1);r.push(f[0],f[1]);break}return r}var u=n,i=this.vertices.indexOf(u[0]),t=this.vertices.indexOf(u[1]);return i!=-1&&t!=-1?[this.copy(i,t),this.copy(t,i)]:!1};i.prototype.isSimple=function(){for(var i,n=this.vertices,t=0;t<n.length-1;t++)for(i=0;i<t-1;i++)if(u.segmentsIntersect(n[t],n[t+1],n[i],n[i+1]))return!1;for(t=1;t<n.length-2;t++)if(u.segmentsIntersect(n[0],n[n.length-1],n[t],n[t+1]))return!1;return!0};i.prototype.quickDecomp=function(n,t,u,f,e,s){var c,l;e=e||100;s=s||0;f=f||25;n=typeof n!="undefined"?n:[];t=t||[];u=u||[];var d=[0,0],g=[0,0],a=[0,0],nt=0,tt=0,p=0,it=0,w=0,b=0,k=0,v=new i,y=new i,h=this,rt=this.vertices;if(rt.length<3)return n;if(s++,s>e)return console.warn("quickDecomp: max level ("+e+") reached."),n;for(c=0;c<this.vertices.length;++c)if(h.isReflex(c)){for(t.push(h.vertices[c]),nt=tt=Number.MAX_VALUE,l=0;l<this.vertices.length;++l)r.left(h.at(c-1),h.at(c),h.at(l))&&r.rightOn(h.at(c-1),h.at(c),h.at(l-1))&&(a=o(h.at(c-1),h.at(c),h.at(l),h.at(l-1)),r.right(h.at(c+1),h.at(c),a)&&(p=r.sqdist(h.vertices[c],a),p<tt&&(tt=p,g=a,b=l))),r.left(h.at(c+1),h.at(c),h.at(l+1))&&r.rightOn(h.at(c+1),h.at(c),h.at(l))&&(a=o(h.at(c+1),h.at(c),h.at(l),h.at(l+1)),r.left(h.at(c-1),h.at(c),a)&&(p=r.sqdist(h.vertices[c],a),p<nt&&(nt=p,d=a,w=l)));if(b==(w+1)%this.vertices.length)a[0]=(g[0]+d[0])/2,a[1]=(g[1]+d[1])/2,u.push(a),c<w?(v.append(h,c,w+1),v.vertices.push(a),y.vertices.push(a),b!=0&&y.append(h,b,h.vertices.length),y.append(h,0,c+1)):(c!=0&&v.append(h,c,h.vertices.length),v.append(h,0,w+1),v.vertices.push(a),y.vertices.push(a),y.append(h,b,c+1));else{if(b>w&&(w+=this.vertices.length),it=Number.MAX_VALUE,w<b)return n;for(l=b;l<=w;++l)r.leftOn(h.at(c-1),h.at(c),h.at(l))&&r.rightOn(h.at(c+1),h.at(c),h.at(l))&&(p=r.sqdist(h.at(c),h.at(l)),p<it&&(it=p,k=l%this.vertices.length));c<k?(v.append(h,c,k+1),k!=0&&y.append(h,k,rt.length),y.append(h,0,c+1)):(c!=0&&v.append(h,c,rt.length),v.append(h,0,k+1),y.append(h,k,c+1))}return v.vertices.length<y.vertices.length?(v.quickDecomp(n,t,u,f,e,s),y.quickDecomp(n,t,u,f,e,s)):(y.quickDecomp(n,t,u,f,e,s),v.quickDecomp(n,t,u,f,e,s)),n}return n.push(this),n};i.prototype.removeCollinearPoints=function(n){for(var i=0,t=this.vertices.length-1;this.vertices.length>3&&t>=0;--t)r.collinear(this.at(t-1),this.at(t),this.at(t+1),n)&&(this.vertices.splice(t%this.vertices.length,1),t--,i++);return i}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(n,t){function i(){}t.exports=i;i.eq=function(n,t,i){return i=i||0,Math.abs(n-t)<i}},{}],5:[function(n,t){t.exports={Polygon:n("./Polygon"),Point:n("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(n,t){t.exports={name:"p2",version:"0.7.1",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.1"}}},{}],7:[function(n,t){function r(n){this.lowerBound=i.create();n&&n.lowerBound&&i.copy(this.lowerBound,n.lowerBound);this.upperBound=i.create();n&&n.upperBound&&i.copy(this.upperBound,n.upperBound)}var i=n("../math/vec2"),f=n("../utils/Utils"),u;t.exports=r;u=i.create();r.prototype.setFromPoints=function(n,t,r,f){var s=this.lowerBound,c=this.upperBound,l,a,h,o,v,y,e;for(typeof r!="number"&&(r=0),r!==0?i.rotate(s,n[0],r):i.copy(s,n[0]),i.copy(c,s),l=Math.cos(r),a=Math.sin(r),h=1;h<n.length;h++)for(o=n[h],r!==0&&(v=o[0],y=o[1],u[0]=l*v-a*y,u[1]=a*v+l*y,o=u),e=0;e<2;e++)o[e]>c[e]&&(c[e]=o[e]),o[e]<s[e]&&(s[e]=o[e]);t&&(i.add(this.lowerBound,this.lowerBound,t),i.add(this.upperBound,this.upperBound,t));f&&(this.lowerBound[0]-=f,this.lowerBound[1]-=f,this.upperBound[0]+=f,this.upperBound[1]+=f)};r.prototype.copy=function(n){i.copy(this.lowerBound,n.lowerBound);i.copy(this.upperBound,n.upperBound)};r.prototype.extend=function(n){for(var t=2,i,r;t--;)i=n.lowerBound[t],this.lowerBound[t]>i&&(this.lowerBound[t]=i),r=n.upperBound[t],this.upperBound[t]<r&&(this.upperBound[t]=r)};r.prototype.overlaps=function(n){var r=this.lowerBound,t=this.upperBound,u=n.lowerBound,i=n.upperBound;return(u[0]<=t[0]&&t[0]<=i[0]||r[0]<=i[0]&&i[0]<=t[0])&&(u[1]<=t[1]&&t[1]<=i[1]||r[1]<=i[1]&&i[1]<=t[1])};r.prototype.containsPoint=function(n){var t=this.lowerBound,i=this.upperBound;return t[0]<=n[0]&&n[0]<=i[0]&&t[1]<=n[1]&&n[1]<=i[1]};r.prototype.overlapsRay=function(n){var t=1/n.direction[0],i=1/n.direction[1],r=(this.lowerBound[0]-n.from[0])*t,u=(this.upperBound[0]-n.from[0])*t,f=(this.lowerBound[1]-n.from[1])*i,e=(this.upperBound[1]-n.from[1])*i,o=Math.max(Math.max(Math.min(r,u),Math.min(f,e))),s=Math.min(Math.min(Math.max(r,u),Math.max(f,e)));return s<0?-1:o>s?-1:o}},{"../math/vec2":30,"../utils/Utils":57}],8:[function(n,t){function i(n){this.type=n;this.result=[];this.world=null;this.boundingVolumeType=i.AABB}var u=n("../math/vec2"),r=n("../objects/Body"),f;t.exports=i;i.AABB=1;i.BOUNDING_CIRCLE=2;i.prototype.setWorld=function(n){this.world=n};i.prototype.getCollisionPairs=function(){};f=u.create();i.boundingRadiusCheck=function(n,t){u.sub(f,n.position,t.position);var r=u.squaredLength(f),i=n.boundingRadius+t.boundingRadius;return r<=i*i};i.aabbCheck=function(n,t){return n.getAABB().overlaps(t.getAABB())};i.prototype.boundingVolumeCheck=function(n,t){var r;switch(this.boundingVolumeType){case i.BOUNDING_CIRCLE:r=i.boundingRadiusCheck(n,t);break;case i.AABB:r=i.aabbCheck(n,t);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType);}return r};i.canCollide=function(n,t){var u=r.KINEMATIC,i=r.STATIC;return n.type===i&&t.type===i?!1:n.type===u&&t.type===i||n.type===i&&t.type===u?!1:n.type===u&&t.type===u?!1:n.sleepState===r.SLEEPING&&t.sleepState===r.SLEEPING?!1:n.sleepState===r.SLEEPING&&t.type===i||t.sleepState===r.SLEEPING&&n.type===i?!1:!0};i.NAIVE=1;i.SAP=2},{"../math/vec2":30,"../objects/Body":31}],9:[function(n,t){function i(){r.call(this,r.NAIVE)}var u=n("../shapes/Circle"),f=n("../shapes/Plane"),e=n("../shapes/Shape"),o=n("../shapes/Particle"),r=n("../collision/Broadphase"),s=n("../math/vec2");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.getCollisionPairs=function(n){var e=n.bodies,o=this.result,t,s,i,u,f;for(o.length=0,t=0,s=e.length;t!==s;t++)for(i=e[t],u=0;u<t;u++)f=e[u],r.canCollide(i,f)&&this.boundingVolumeCheck(i,f)&&o.push(i,f);return o};i.prototype.aabbQuery=function(n,t,i){var f,u,r;for(i=i||[],f=n.bodies,u=0;u<f.length;u++)r=f[u],r.aabbNeedsUpdate&&r.updateAABB(),r.aabb.overlaps(t)&&i.push(r);return i}},{"../collision/Broadphase":8,"../math/vec2":30,"../shapes/Circle":39,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45}],10:[function(n,t){function u(){this.contactEquations=[];this.frictionEquations=[];this.enableFriction=!0;this.enabledEquations=!0;this.slipForce=10;this.frictionCoefficient=.3;this.surfaceVelocity=0;this.contactEquationPool=new yt({size:32});this.frictionEquationPool=new pt({size:64});this.restitution=0;this.stiffness=b.DEFAULT_STIFFNESS;this.relaxation=b.DEFAULT_RELAXATION;this.frictionStiffness=b.DEFAULT_STIFFNESS;this.frictionRelaxation=b.DEFAULT_RELAXATION;this.enableFrictionReduction=!0;this.collidingBodiesLastStep=new wt;this.contactSkinSize=.01}function ut(n,t){i.set(n.vertices[0],-t.length*.5,-t.radius);i.set(n.vertices[1],t.length*.5,-t.radius);i.set(n.vertices[2],t.length*.5,t.radius);i.set(n.vertices[3],-t.length*.5,t.radius)}function at(n,t,u,f){for(var w,b,a,s=ri,h=ui,v=fi,y=ei,p=n,o=t.vertices,c=null,l=0;l!==o.length+1;l++){if(w=o[l%o.length],b=o[(l+1)%o.length],i.rotate(s,w,f),i.rotate(h,b,f),e(s,s,u),e(h,h,u),r(v,s,p),r(y,h,p),a=i.crossLength(v,y),c===null&&(c=a),a*c<=0)return!1;c=a}return!0}var i=n("../math/vec2"),r=i.sub,e=i.add,o=i.dot,cr=n("../utils/Utils"),yt=n("../utils/ContactEquationPool"),pt=n("../utils/FrictionEquationPool"),wt=n("../utils/TupleDictionary"),b=n("../equations/Equation"),lr=n("../equations/ContactEquation"),ar=n("../equations/FrictionEquation"),bt=n("../shapes/Circle"),kt=n("../shapes/Convex"),f=n("../shapes/Shape"),vr=n("../objects/Body"),k=n("../shapes/Box"),st,ht,ct,lt,vt;t.exports=u;var d=i.fromValues(0,1),s=i.fromValues(0,0),h=i.fromValues(0,0),c=i.fromValues(0,0),l=i.fromValues(0,0),a=i.fromValues(0,0),v=i.fromValues(0,0),y=i.fromValues(0,0),p=i.fromValues(0,0),w=i.fromValues(0,0),g=i.fromValues(0,0),nt=i.fromValues(0,0),tt=i.fromValues(0,0),it=i.fromValues(0,0),rt=i.fromValues(0,0),ft=i.fromValues(0,0),et=i.fromValues(0,0),dt=i.fromValues(0,0),gt=i.fromValues(0,0),ot=[];st=i.create();ht=i.create();u.prototype.bodiesOverlap=function(n,t){for(var i,u,s,r,e=st,o=ht,f=0,h=n.shapes.length;f!==h;f++)for(i=n.shapes[f],n.toWorldFrame(e,i.position),u=0,s=t.shapes.length;u!==s;u++)if(r=t.shapes[u],t.toWorldFrame(o,r.position),this[i.type|r.type](n,i,e,i.angle+n.angle,t,r,o,r.angle+t.angle,!0))return!0;return!1};u.prototype.collidedLastStep=function(n,t){var i=n.id|0,r=t.id|0;return!!this.collidingBodiesLastStep.get(i,r)};u.prototype.reset=function(){var t,i,r,u,n;for(this.collidingBodiesLastStep.reset(),t=this.contactEquations,i=t.length;i--;){var f=t[i],e=f.bodyA.id,o=f.bodyB.id;this.collidingBodiesLastStep.set(e,o,!0)}for(r=this.contactEquations,u=this.frictionEquations,n=0;n<r.length;n++)this.contactEquationPool.release(r[n]);for(n=0;n<u.length;n++)this.frictionEquationPool.release(u[n]);this.contactEquations.length=this.frictionEquations.length=0};u.prototype.createContactEquation=function(n,t,i,r){var u=this.contactEquationPool.get();return u.bodyA=n,u.bodyB=t,u.shapeA=i,u.shapeB=r,u.restitution=this.restitution,u.firstImpact=!this.collidedLastStep(n,t),u.stiffness=this.stiffness,u.relaxation=this.relaxation,u.needsUpdate=!0,u.enabled=this.enabledEquations,u.offset=this.contactSkinSize,u};u.prototype.createFrictionEquation=function(n,t,i,r){var u=this.frictionEquationPool.get();return u.bodyA=n,u.bodyB=t,u.shapeA=i,u.shapeB=r,u.setSlipForce(this.slipForce),u.frictionCoefficient=this.frictionCoefficient,u.relativeVelocity=this.surfaceVelocity,u.enabled=this.enabledEquations,u.needsUpdate=!0,u.stiffness=this.frictionStiffness,u.relaxation=this.frictionRelaxation,u.contactEquations.length=0,u};u.prototype.createFrictionFromContact=function(n){var t=this.createFrictionEquation(n.bodyA,n.bodyB,n.shapeA,n.shapeB);return i.copy(t.contactPointA,n.contactPointA),i.copy(t.contactPointB,n.contactPointB),i.rotate90cw(t.t,n.normalA),t.contactEquations.push(n),t};u.prototype.createFrictionFromAverage=function(n){var r=this.contactEquations[this.contactEquations.length-1],t=this.createFrictionEquation(r.bodyA,r.bodyB,r.shapeA,r.shapeB),e=r.bodyA,o=r.bodyB,u,f;for(i.set(t.contactPointA,0,0),i.set(t.contactPointB,0,0),i.set(t.t,0,0),u=0;u!==n;u++)r=this.contactEquations[this.contactEquations.length-1-u],r.bodyA===e?(i.add(t.t,t.t,r.normalA),i.add(t.contactPointA,t.contactPointA,r.contactPointA),i.add(t.contactPointB,t.contactPointB,r.contactPointB)):(i.sub(t.t,t.t,r.normalA),i.add(t.contactPointA,t.contactPointA,r.contactPointB),i.add(t.contactPointB,t.contactPointB,r.contactPointA)),t.contactEquations.push(r);return f=1/n,i.scale(t.contactPointA,t.contactPointA,f),i.scale(t.contactPointB,t.contactPointB,f),i.normalize(t.t,t.t),i.rotate90cw(t.t,t.t),t};u.prototype[f.LINE|f.CONVEX]=u.prototype.convexLine=function(n,t,i,r,u,f,e,o,s){return s?!1:0};u.prototype[f.LINE|f.BOX]=u.prototype.lineBox=function(n,t,i,r,u,f,e,o,s){return s?!1:0};ct=new k({width:1,height:1});lt=i.create();u.prototype[f.CAPSULE|f.CONVEX]=u.prototype[f.CAPSULE|f.BOX]=u.prototype.convexCapsule=function(n,t,r,u,f,e,o,s,h){var c=lt,l,a,v,y;return(i.set(c,e.length/2,0),i.rotate(c,c,s),i.add(c,c,o),l=this.circleConvex(f,e,c,s,n,t,r,u,h,e.radius),i.set(c,-e.length/2,0),i.rotate(c,c,s),i.add(c,c,o),a=this.circleConvex(f,e,c,s,n,t,r,u,h,e.radius),h&&(l||a))?!0:(v=ct,ut(v,e),y=this.convexConvex(n,t,r,u,f,v,o,s,h),y+l+a)};u.prototype[f.CAPSULE|f.LINE]=u.prototype.lineCapsule=function(n,t,i,r,u,f,e,o,s){return s?!1:0};var ni=i.create(),ti=i.create(),ii=new k({width:1,height:1});u.prototype[f.CAPSULE|f.CAPSULE]=u.prototype.capsuleCapsule=function(n,t,r,u,f,e,o,s,h){for(var p,b,y,k,c,d,l=ni,a=ti,v=0,w=0;w<2;w++)for(i.set(l,(w===0?-1:1)*t.length/2,0),i.rotate(l,l,u),i.add(l,l,r),p=0;p<2;p++){if(i.set(a,(p===0?-1:1)*e.length/2,0),i.rotate(a,a,s),i.add(a,a,o),this.enableFrictionReduction&&(c=this.enableFriction,this.enableFriction=!1),b=this.circleCircle(n,t,l,u,f,e,a,s,h,t.radius,e.radius),this.enableFrictionReduction&&(this.enableFriction=c),h&&b)return!0;v+=b}return(this.enableFrictionReduction&&(c=this.enableFriction,this.enableFriction=!1),y=ii,ut(y,t),k=this.convexCapsule(n,y,r,u,f,e,o,s,h),this.enableFrictionReduction&&(this.enableFriction=c),h&&k)?!0:(v+=k,this.enableFrictionReduction&&(c=this.enableFriction,this.enableFriction=!1),ut(y,e),d=this.convexCapsule(f,y,o,s,n,t,r,u,h),this.enableFrictionReduction&&(this.enableFriction=c),h&&d)?!0:(v+=d,this.enableFrictionReduction&&v&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(v)),v)};u.prototype[f.LINE|f.LINE]=u.prototype.lineLine=function(n,t,i,r,u,f,e,o,s){return s?!1:0};u.prototype[f.PLANE|f.LINE]=u.prototype.planeLine=function(n,t,u,f,b,k,g,nt,tt){var rt=s,ut=h,ft=c,et=l,pt=a,wt=v,st=y,ht=p,bt=w,ct=ot,lt=0,at,vt,yt,it;for(i.set(rt,-k.length/2,0),i.set(ut,k.length/2,0),i.rotate(ft,rt,nt),i.rotate(et,ut,nt),e(ft,ft,g),e(et,et,g),i.copy(rt,ft),i.copy(ut,et),r(pt,ut,rt),i.normalize(wt,pt),i.rotate90cw(bt,wt),i.rotate(ht,d,f),ct[0]=rt,ct[1]=ut,at=0;at<ct.length;at++)if(vt=ct[at],r(st,vt,u),yt=o(st,ht),yt<0){if(tt)return!0;it=this.createContactEquation(n,b,t,k);lt++;i.copy(it.normalA,ht);i.normalize(it.normalA,it.normalA);i.scale(st,ht,yt);r(it.contactPointA,vt,st);r(it.contactPointA,it.contactPointA,n.position);r(it.contactPointB,vt,g);e(it.contactPointB,it.contactPointB,g);r(it.contactPointB,it.contactPointB,b.position);this.contactEquations.push(it);this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(it))}return tt?!1:(this.enableFrictionReduction||lt&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(lt)),lt)};u.prototype[f.PARTICLE|f.CAPSULE]=u.prototype.particleCapsule=function(n,t,i,r,u,f,e,o,s){return this.circleLine(n,t,i,r,u,f,e,o,s,f.radius,0)};u.prototype[f.CIRCLE|f.LINE]=u.prototype.circleLine=function(n,t,u,f,b,k,d,ut,ft,et,st){var et=et||0,st=typeof st!="undefined"?st:t.radius,ni=s,lt=h,vt=c,si=l,yt=a,ui=v,pt=y,ct=p,at=w,bt=g,kt=nt,wt=tt,fi=it,ei=rt,dt=ot,ti,ii,gt,ri,ht;if(i.set(ct,-k.length/2,0),i.set(at,k.length/2,0),i.rotate(bt,ct,ut),i.rotate(kt,at,ut),e(bt,bt,d),e(kt,kt,d),i.copy(ct,bt),i.copy(at,kt),r(ui,at,ct),i.normalize(pt,ui),i.rotate90cw(yt,pt),r(wt,u,ct),ti=o(wt,yt),r(si,ct,d),r(fi,u,d),ii=st+et,Math.abs(ti)<ii){i.scale(ni,yt,ti);r(vt,u,ni);i.scale(lt,yt,o(yt,fi));i.normalize(lt,lt);i.scale(lt,lt,et);e(vt,vt,lt);var oi=o(pt,vt),hi=o(pt,ct),ci=o(pt,at);if(oi>hi&&oi<ci)return ft?!0:(ht=this.createContactEquation(n,b,t,k),i.scale(ht.normalA,ni,-1),i.normalize(ht.normalA,ht.normalA),i.scale(ht.contactPointA,ht.normalA,st),e(ht.contactPointA,ht.contactPointA,u),r(ht.contactPointA,ht.contactPointA,n.position),r(ht.contactPointB,vt,d),e(ht.contactPointB,ht.contactPointB,d),r(ht.contactPointB,ht.contactPointB,b.position),this.contactEquations.push(ht),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(ht)),1)}for(dt[0]=ct,dt[1]=at,gt=0;gt<dt.length;gt++)if(ri=dt[gt],r(wt,ri,u),i.squaredLength(wt)<Math.pow(ii,2))return ft?!0:(ht=this.createContactEquation(n,b,t,k),i.copy(ht.normalA,wt),i.normalize(ht.normalA,ht.normalA),i.scale(ht.contactPointA,ht.normalA,st),e(ht.contactPointA,ht.contactPointA,u),r(ht.contactPointA,ht.contactPointA,n.position),r(ht.contactPointB,ri,d),i.scale(ei,ht.normalA,-et),e(ht.contactPointB,ht.contactPointB,ei),e(ht.contactPointB,ht.contactPointB,d),r(ht.contactPointB,ht.contactPointB,b.position),this.contactEquations.push(ht),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(ht)),1);return 0};u.prototype[f.CIRCLE|f.CAPSULE]=u.prototype.circleCapsule=function(n,t,i,r,u,f,e,o,s){return this.circleLine(n,t,i,r,u,f,e,o,s,f.radius)};u.prototype[f.CIRCLE|f.CONVEX]=u.prototype[f.CIRCLE|f.BOX]=u.prototype.circleConvex=function(n,t,u,f,o,b,k,d,ut,ot){for(var fi,ei,kt,oi,st,ot=typeof ot=="number"?ot:t.radius,vt=s,pt=h,gt=c,ni=l,wt=a,si=v,hi=y,ci=p,li=w,dt=g,yt=nt,ai=tt,bt=it,ct=rt,ti=ft,ii=et,ri=!1,ui=Number.MAX_VALUE,lt=b.vertices,ht=0;ht!==lt.length+1;ht++)fi=lt[ht%lt.length],ei=lt[(ht+1)%lt.length],i.rotate(vt,fi,d),i.rotate(pt,ei,d),e(vt,vt,k),e(pt,pt,k),r(gt,pt,vt),i.normalize(ni,gt),i.rotate90cw(wt,ni),i.scale(ct,wt,-t.radius),e(ct,ct,u),at(ct,b,k,d)&&(i.sub(ti,vt,ct),kt=Math.abs(i.dot(ti,wt)),kt<ui&&(i.copy(ii,ct),ui=kt,i.scale(bt,wt,kt),i.add(bt,bt,ct),ri=!0));if(ri)return ut?!0:(st=this.createContactEquation(n,o,t,b),i.sub(st.normalA,ii,u),i.normalize(st.normalA,st.normalA),i.scale(st.contactPointA,st.normalA,ot),e(st.contactPointA,st.contactPointA,u),r(st.contactPointA,st.contactPointA,n.position),r(st.contactPointB,bt,k),e(st.contactPointB,st.contactPointB,k),r(st.contactPointB,st.contactPointB,o.position),this.contactEquations.push(st),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(st)),1);if(ot>0)for(ht=0;ht<lt.length;ht++)if(oi=lt[ht],i.rotate(yt,oi,d),e(yt,yt,k),r(dt,yt,u),i.squaredLength(dt)<Math.pow(ot,2))return ut?!0:(st=this.createContactEquation(n,o,t,b),i.copy(st.normalA,dt),i.normalize(st.normalA,st.normalA),i.scale(st.contactPointA,st.normalA,ot),e(st.contactPointA,st.contactPointA,u),r(st.contactPointA,st.contactPointA,n.position),r(st.contactPointB,yt,k),e(st.contactPointB,st.contactPointB,k),r(st.contactPointB,st.contactPointB,o.position),this.contactEquations.push(st),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(st)),1);return 0};var ri=i.create(),ui=i.create(),fi=i.create(),ei=i.create();u.prototype[f.PARTICLE|f.CONVEX]=u.prototype[f.PARTICLE|f.BOX]=u.prototype.particleConvex=function(n,t,u,f,b,k,d,ut,ot){var ht=s,yt=h,bt=c,kt=l,ct=a,oi=v,si=y,li=p,ai=w,ni=g,vi=nt,yi=tt,pt=it,pi=rt,wi=ft,bi=et,ti=dt,ii=gt,ri=Number.MAX_VALUE,ui=!1,lt=k.vertices,hi,vt,fi,ei,ci,wt,st;if(!at(u,k,d,ut))return 0;if(ot)return!0;for(hi=null,vt=0;vt!==lt.length+1;vt++)fi=lt[vt%lt.length],ei=lt[(vt+1)%lt.length],i.rotate(ht,fi,ut),i.rotate(yt,ei,ut),e(ht,ht,d),e(yt,yt,d),r(bt,yt,ht),i.normalize(kt,bt),i.rotate90cw(ct,kt),r(ni,u,ht),ci=o(ni,ct),r(oi,ht,d),r(si,u,d),i.sub(ti,ht,u),wt=Math.abs(i.dot(ti,ct)),wt<ri&&(ri=wt,i.scale(pt,ct,wt),i.add(pt,pt,u),i.copy(ii,ct),ui=!0);return ui?(st=this.createContactEquation(n,b,t,k),i.scale(st.normalA,ii,-1),i.normalize(st.normalA,st.normalA),i.set(st.contactPointA,0,0),e(st.contactPointA,st.contactPointA,u),r(st.contactPointA,st.contactPointA,n.position),r(st.contactPointB,pt,d),e(st.contactPointB,st.contactPointB,d),r(st.contactPointB,st.contactPointB,b.position),this.contactEquations.push(st),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(st)),1):0};u.prototype[f.CIRCLE]=u.prototype.circleCircle=function(n,t,u,f,o,h,c,l,a,v,y){var w=s,v=v||t.radius,y=y||h.radius,b,p;return(r(w,u,c),b=v+y,i.squaredLength(w)>Math.pow(b,2))?0:a?!0:(p=this.createContactEquation(n,o,t,h),r(p.normalA,c,u),i.normalize(p.normalA,p.normalA),i.scale(p.contactPointA,p.normalA,v),i.scale(p.contactPointB,p.normalA,-y),e(p.contactPointA,p.contactPointA,u),r(p.contactPointA,p.contactPointA,n.position),e(p.contactPointB,p.contactPointB,c),r(p.contactPointB,p.contactPointB,o.position),this.contactEquations.push(p),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(p)),1)};u.prototype[f.PLANE|f.CONVEX]=u.prototype[f.PLANE|f.BOX]=u.prototype.planeConvex=function(n,t,u,f,l,a,v,y,p){var b=s,tt=h,k=c,g=0,nt,it,w,rt;for(i.rotate(tt,d,f),nt=0;nt!==a.vertices.length;nt++)if(it=a.vertices[nt],i.rotate(b,it,y),e(b,b,v),r(k,b,u),o(k,tt)<=0){if(p)return!0;g++;w=this.createContactEquation(n,l,t,a);r(k,b,u);i.copy(w.normalA,tt);rt=o(k,w.normalA);i.scale(k,w.normalA,rt);r(w.contactPointB,b,l.position);r(w.contactPointA,b,k);r(w.contactPointA,w.contactPointA,n.position);this.contactEquations.push(w);this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(w))}return this.enableFrictionReduction&&this.enableFriction&&g&&this.frictionEquations.push(this.createFrictionFromAverage(g)),g};u.prototype[f.PARTICLE|f.PLANE]=u.prototype.particlePlane=function(n,t,u,f,e,c,l,a,v){var p=s,w=h,b,y;return(a=a||0,r(p,u,l),i.rotate(w,d,a),b=o(p,w),b>0)?0:v?!0:(y=this.createContactEquation(e,n,c,t),i.copy(y.normalA,w),i.scale(p,y.normalA,b),r(y.contactPointA,u,p),r(y.contactPointA,y.contactPointA,e.position),r(y.contactPointB,u,n.position),this.contactEquations.push(y),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(y)),1)};u.prototype[f.CIRCLE|f.PARTICLE]=u.prototype.circleParticle=function(n,t,u,f,o,h,c,l,a){var y=s,v;return(r(y,c,u),i.squaredLength(y)>Math.pow(t.radius,2))?0:a?!0:(v=this.createContactEquation(n,o,t,h),i.copy(v.normalA,y),i.normalize(v.normalA,v.normalA),i.scale(v.contactPointA,v.normalA,t.radius),e(v.contactPointA,v.contactPointA,u),r(v.contactPointA,v.contactPointA,n.position),r(v.contactPointB,c,o.position),this.contactEquations.push(v),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(v)),1)};var oi=new bt({radius:1}),si=i.create(),hi=i.create(),ci=i.create();u.prototype[f.PLANE|f.CAPSULE]=u.prototype.planeCapsule=function(n,t,r,u,f,o,s,h,c){var l=si,a=hi,y=oi,k=ci,b,p,w,v;return i.set(l,-o.length/2,0),i.rotate(l,l,h),e(l,l,s),i.set(a,o.length/2,0),i.rotate(a,a,h),e(a,a,s),y.radius=o.radius,this.enableFrictionReduction&&(b=this.enableFriction,this.enableFriction=!1),p=this.circlePlane(f,y,l,0,n,t,r,u,c),w=this.circlePlane(f,y,a,0,n,t,r,u,c),this.enableFrictionReduction&&(this.enableFriction=b),c?p||w:(v=p+w,this.enableFrictionReduction&&v&&this.frictionEquations.push(this.createFrictionFromAverage(v)),v)};u.prototype[f.CIRCLE|f.PLANE]=u.prototype.circlePlane=function(n,t,u,f,l,a,v,y,p){var tt=n,it=t,rt=u,ut=l,ot=a,ft=v,b=y,nt,w;b=b||0;var k=s,g=h,et=c;return(r(k,rt,ft),i.rotate(g,d,b),nt=o(g,k),nt>it.radius)?0:p?!0:(w=this.createContactEquation(ut,tt,a,t),i.copy(w.normalA,g),i.scale(w.contactPointB,w.normalA,-it.radius),e(w.contactPointB,w.contactPointB,rt),r(w.contactPointB,w.contactPointB,tt.position),i.scale(et,w.normalA,nt),r(w.contactPointA,k,et),e(w.contactPointA,w.contactPointA,ft),r(w.contactPointA,w.contactPointA,ut.position),this.contactEquations.push(w),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(w)),1)};u.prototype[f.CONVEX]=u.prototype[f.CONVEX|f.BOX]=u.prototype[f.BOX]=u.prototype.convexConvex=function(n,t,f,b,k,d,g,nt,tt,it){var at=s,ct=h,ft=c,ot=l,kt=a,yi=v,li=y,vt=p,dt=w,gt=0,it=typeof it=="number"?it:0,vi=u.findSeparatingAxis(t,f,b,d,g,nt,at),oi,si,ni,et,ui,ai,ci,lt,rt,fi,ei,bt;if(!vi||(r(vt,g,f),o(at,vt)>0&&i.scale(at,at,-1),oi=u.getClosestEdge(t,b,at,!0),si=u.getClosestEdge(d,nt,at),oi===-1||si===-1))return 0;for(ni=0;ni<2;ni++){var st=oi,ti=si,ut=t,yt=d,ht=f,wt=g,pt=b,hi=nt,ii=n,ri=k;for(ni===0&&(et=st,st=ti,ti=et,et=ut,ut=yt,yt=et,et=ht,ht=wt,wt=et,et=pt,pt=hi,hi=et,et=ii,ii=ri,ri=et),ui=ti;ui<ti+2;ui++){for(ai=yt.vertices[(ui+yt.vertices.length)%yt.vertices.length],i.rotate(ct,ai,hi),e(ct,ct,wt),ci=0,lt=st-1;lt<st+2;lt++)fi=ut.vertices[(lt+ut.vertices.length)%ut.vertices.length],ei=ut.vertices[(lt+1+ut.vertices.length)%ut.vertices.length],i.rotate(ft,fi,pt),i.rotate(ot,ei,pt),e(ft,ft,ht),e(ot,ot,ht),r(kt,ot,ft),i.rotate90cw(dt,kt),i.normalize(dt,dt),r(vt,ct,ft),bt=o(dt,vt),(lt===st&&bt<=it||lt!==st&&bt<=0)&&ci++;if(ci>=3){if(tt)return!0;rt=this.createContactEquation(ii,ri,ut,yt);gt++;fi=ut.vertices[st%ut.vertices.length];ei=ut.vertices[(st+1)%ut.vertices.length];i.rotate(ft,fi,pt);i.rotate(ot,ei,pt);e(ft,ft,ht);e(ot,ot,ht);r(kt,ot,ft);i.rotate90cw(rt.normalA,kt);i.normalize(rt.normalA,rt.normalA);r(vt,ct,ft);bt=o(rt.normalA,vt);i.scale(li,rt.normalA,bt);r(rt.contactPointA,ct,ht);r(rt.contactPointA,rt.contactPointA,li);e(rt.contactPointA,rt.contactPointA,ht);r(rt.contactPointA,rt.contactPointA,ii.position);r(rt.contactPointB,ct,wt);e(rt.contactPointB,rt.contactPointB,wt);r(rt.contactPointB,rt.contactPointB,ri.position);this.contactEquations.push(rt);this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(rt))}}}return this.enableFrictionReduction&&this.enableFriction&&gt&&this.frictionEquations.push(this.createFrictionFromAverage(gt)),gt};vt=i.fromValues(0,0);u.projectConvexOntoAxis=function(n,t,r,u,f){var e=null,s=null,a,h,v=vt,c,y,l;for(i.rotate(v,u,-r),c=0;c<n.vertices.length;c++)a=n.vertices[c],h=o(a,v),(e===null||h>e)&&(e=h),(s===null||h<s)&&(s=h);s>e&&(y=s,s=e,e=y);l=o(t,u);i.set(f,s+l,e+l)};var li=i.fromValues(0,0),ai=i.fromValues(0,0),vi=i.fromValues(0,0),yi=i.fromValues(0,0),pi=i.fromValues(0,0),wi=i.fromValues(0,0);u.findSeparatingAxis=function(n,t,f,e,o,s,h){var d=null,g=!1,it=!1,rt=li,ut=ai,ft=vi,c=yi,a=pi,v=wi,y,p,w,l,b;if(n instanceof k&&e instanceof k)for(y=0;y!==2;y++)for(p=n,w=f,y===1&&(p=e,w=s),l=0;l!==2;l++){l===0?i.set(c,0,1):l===1&&i.set(c,1,0);w!==0&&i.rotate(c,c,w);u.projectConvexOntoAxis(n,t,f,c,a);u.projectConvexOntoAxis(e,o,s,c,v);var nt=a,tt=v,et=!1;a[0]>v[0]&&(tt=a,nt=v,et=!0);b=tt[0]-nt[1];g=b<=0;(d===null||b>d)&&(i.copy(h,c),d=b,it=g)}else for(y=0;y!==2;y++)for(p=n,w=f,y===1&&(p=e,w=s),l=0;l!==p.vertices.length;l++){i.rotate(ut,p.vertices[l],w);i.rotate(ft,p.vertices[(l+1)%p.vertices.length],w);r(rt,ft,ut);i.rotate90cw(c,rt);i.normalize(c,c);u.projectConvexOntoAxis(n,t,f,c,a);u.projectConvexOntoAxis(e,o,s,c,v);var nt=a,tt=v,et=!1;a[0]>v[0]&&(tt=a,nt=v,et=!0);b=tt[0]-nt[1];g=b<=0;(d===null||b>d)&&(i.copy(h,c),d=b,it=g)}return it};var bi=i.fromValues(0,0),ki=i.fromValues(0,0),di=i.fromValues(0,0);u.getClosestEdge=function(n,t,u,f){var s=bi,v=ki,h=di,e,a;i.rotate(s,u,-t);f&&i.scale(s,s,-1);var l=-1,c=n.vertices.length,y=-1;for(e=0;e!==c;e++)r(v,n.vertices[(e+1)%c],n.vertices[e%c]),i.rotate90cw(h,v),i.normalize(h,h),a=o(h,s),(l===-1||a>y)&&(l=e%c,y=a);return l};var gi=i.create(),nr=i.create(),tr=i.create(),ir=i.create(),rr=i.create(),ur=i.create(),fr=i.create();u.prototype[f.CIRCLE|f.HEIGHTFIELD]=u.prototype.circleHeightfield=function(n,t,u,f,o,s,h,c,l,a){var p=s.heights,a=a||t.radius,tt=s.elementWidth,k=nr,d=gi,ot=rr,st=fr,b=ur,w=tr,it=ir,g=Math.floor((u[0]-a-h[0])/tt),nt=Math.ceil((u[0]+a-h[0])/tt),ut,ft,rt,et,y,v;for(g<0&&(g=0),nt>=p.length&&(nt=p.length-1),ut=p[g],ft=p[nt],y=g;y<nt;y++)p[y]<ft&&(ft=p[y]),p[y]>ut&&(ut=p[y]);if(u[1]-a>ut)return l?!1:0;for(rt=!1,y=g;y<nt;y++)if(i.set(w,y*tt,p[y]),i.set(it,(y+1)*tt,p[y+1]),i.add(w,w,h),i.add(it,it,h),i.sub(b,it,w),i.rotate(b,b,Math.PI/2),i.normalize(b,b),i.scale(d,b,-a),i.add(d,d,u),i.sub(k,d,w),et=i.dot(k,b),d[0]>=w[0]&&d[0]<it[0]&&et<=0){if(l)return!0;rt=!0;i.scale(k,b,-et);i.add(ot,d,k);i.copy(st,b);v=this.createContactEquation(o,n,s,t);i.copy(v.normalA,st);i.scale(v.contactPointB,v.normalA,-a);e(v.contactPointB,v.contactPointB,u);r(v.contactPointB,v.contactPointB,n.position);i.copy(v.contactPointA,ot);i.sub(v.contactPointA,v.contactPointA,o.position);this.contactEquations.push(v);this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(v))}if(rt=!1,a>0)for(y=g;y<=nt;y++)if(i.set(w,y*tt,p[y]),i.add(w,w,h),i.sub(k,u,w),i.squaredLength(k)<Math.pow(a,2)){if(l)return!0;rt=!0;v=this.createContactEquation(o,n,s,t);i.copy(v.normalA,k);i.normalize(v.normalA,v.normalA);i.scale(v.contactPointB,v.normalA,-a);e(v.contactPointB,v.contactPointB,u);r(v.contactPointB,v.contactPointB,n.position);r(v.contactPointA,w,h);e(v.contactPointA,v.contactPointA,h);r(v.contactPointA,v.contactPointA,o.position);this.contactEquations.push(v);this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(v))}return rt?1:0};var er=i.create(),or=i.create(),sr=i.create(),hr=new kt({vertices:[i.create(),i.create(),i.create(),i.create()]});u.prototype[f.BOX|f.HEIGHTFIELD]=u.prototype[f.CONVEX|f.HEIGHTFIELD]=u.prototype.convexHeightfield=function(n,t,r,u,f,e,o,s,h){var l=e.heights,b=e.elementWidth,v=er,y=or,k=sr,a=hr,p=Math.floor((n.aabb.lowerBound[0]-o[0])/b),w=Math.ceil((n.aabb.upperBound[0]-o[0])/b),d,nt,it,tt,c,g;for(p<0&&(p=0),w>=l.length&&(w=l.length-1),d=l[p],nt=l[w],c=p;c<w;c++)l[c]<nt&&(nt=l[c]),l[c]>d&&(d=l[c]);if(n.aabb.lowerBound[1]>d)return h?!1:0;for(it=!1,tt=0,c=p;c<w;c++)i.set(v,c*b,l[c]),i.set(y,(c+1)*b,l[c+1]),i.add(v,v,o),i.add(y,y,o),g=100,i.set(k,(y[0]+v[0])*.5,(y[1]+v[1]-g)*.5),i.sub(a.vertices[0],y,k),i.sub(a.vertices[1],v,k),i.copy(a.vertices[2],a.vertices[1]),i.copy(a.vertices[3],a.vertices[0]),a.vertices[2][1]-=g,a.vertices[3][1]-=g,tt+=this.convexConvex(n,t,r,u,f,a,k,0,h);return tt}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Box":37,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Shape":45,"../utils/ContactEquationPool":48,"../utils/FrictionEquationPool":49,"../utils/TupleDictionary":56,"../utils/Utils":57}],11:[function(n,t){function r(n){n=n||{};this.from=n.from?i.fromValues(n.from[0],n.from[1]):i.create();this.to=n.to?i.fromValues(n.to[0],n.to[1]):i.create();this.checkCollisionResponse=n.checkCollisionResponse!==undefined?n.checkCollisionResponse:!0;this.skipBackfaces=!!n.skipBackfaces;this.collisionMask=n.collisionMask!==undefined?n.collisionMask:-1;this.collisionGroup=n.collisionGroup!==undefined?n.collisionGroup:-1;this.mode=n.mode!==undefined?n.mode:r.ANY;this.callback=n.callback||function(){};this.direction=i.create();this.length=1;this.update()}function s(n,t,r){i.sub(f,r,n);var e=i.dot(f,t);return i.scale(u,t,e),i.add(u,u,n),i.squaredDistance(r,u)}var e,o,f,u;t.exports=r;var i=n("../math/vec2"),h=n("../collision/RaycastResult"),c=n("../shapes/Shape"),l=n("../collision/AABB");r.prototype.constructor=r;r.CLOSEST=1;r.ANY=2;r.ALL=4;r.prototype.update=function(){var n=this.direction;i.sub(n,this.to,this.from);this.length=i.length(n);i.normalize(n,n)};r.prototype.intersectBodies=function(n,t){for(var r,u,i=0,f=t.length;!n.shouldStop(this)&&i<f;i++)r=t[i],u=r.getAABB(),(u.overlapsRay(this)>=0||u.containsPoint(this.from))&&this.intersectBody(n,r)};e=i.create();r.prototype.intersectBody=function(n,t){var o=this.checkCollisionResponse,u,f,s,r,h;if(!o||t.collisionResponse)for(u=e,f=0,s=t.shapes.length;f<s;f++)if((r=t.shapes[f],!o||r.collisionResponse)&&(this.collisionGroup&r.collisionMask)!=0&&(r.collisionGroup&this.collisionMask)!=0&&(i.rotate(u,r.position,t.angle),i.add(u,u,t.position),h=r.angle+t.angle,this.intersectShape(n,r,h,u,t),n.shouldStop(this)))break};r.prototype.intersectShape=function(n,t,i,r,u){var f=this.from,e=s(f,this.direction,r);e>t.boundingRadius*t.boundingRadius||(this._currentBody=u,this._currentShape=t,t.raycast(n,this,r,i),this._currentBody=this._currentShape=null)};r.prototype.getAABB=function(n){var t=this.to,r=this.from;i.set(n.lowerBound,Math.min(t[0],r[0]),Math.min(t[1],r[1]));i.set(n.upperBound,Math.max(t[0],r[0]),Math.max(t[1],r[1]))};o=i.create();r.prototype.reportIntersection=function(n,t,u,f){var s=this.from,h=this.to,e=this._currentShape,o=this._currentBody;if(!this.skipBackfaces||!(i.dot(u,this.direction)>0))switch(this.mode){case r.ALL:n.set(u,e,o,t,f);this.callback(n);break;case r.CLOSEST:(t<n.fraction||!n.hasHit())&&n.set(u,e,o,t,f);break;case r.ANY:n.set(u,e,o,t,f)}};f=i.create();u=i.create()},{"../collision/AABB":7,"../collision/RaycastResult":12,"../math/vec2":30,"../shapes/Shape":45}],12:[function(n,t){function i(){this.normal=r.create();this.shape=null;this.body=null;this.faceIndex=-1;this.fraction=-1;this.isStopped=!1}var r=n("../math/vec2"),u=n("../collision/Ray");t.exports=i;i.prototype.reset=function(){r.set(this.normal,0,0);this.shape=null;this.body=null;this.faceIndex=-1;this.fraction=-1;this.isStopped=!1};i.prototype.getHitDistance=function(n){return r.distance(n.from,n.to)*this.fraction};i.prototype.hasHit=function(){return this.fraction!==-1};i.prototype.getHitPoint=function(n,t){r.lerp(n,t.from,t.to,this.fraction)};i.prototype.stop=function(){this.isStopped=!0};i.prototype.shouldStop=function(n){return this.isStopped||this.fraction!==-1&&n.mode===u.ANY};i.prototype.set=function(n,t,i,u,f){r.copy(this.normal,n);this.shape=t;this.body=i;this.fraction=u;this.faceIndex=f}},{"../collision/Ray":11,"../math/vec2":30}],13:[function(n,t){function i(){r.call(this,r.SAP);this.axisList=[];this.axisIndex=0;var n=this;this._addBodyHandler=function(t){n.axisList.push(t.body)};this._removeBodyHandler=function(t){var i=n.axisList.indexOf(t.body);i!==-1&&n.axisList.splice(i,1)}}var u=n("../utils/Utils"),r=n("../collision/Broadphase");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.setWorld=function(n){this.axisList.length=0;u.appendArray(this.axisList,n.bodies);n.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler);n.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler);this.world=n};i.sortAxisList=function(n,t){var r,f,u,i;for(t=t|0,r=1,f=n.length;r<f;r++){for(u=n[r],i=r-1;i>=0;i--){if(n[i].aabb.lowerBound[t]<=u.aabb.lowerBound[t])break;n[i+1]=n[i]}n[i+1]=u}return n};i.prototype.sortList=function(){var n=this.axisList,t=this.axisIndex;i.sortAxisList(n,t)};i.prototype.getCollisionPairs=function(){var n=this.axisList,e=this.result,c=this.axisIndex,o,s,t,h,i,f,u,l;for(e.length=0,o=n.length;o--;)s=n[o],s.aabbNeedsUpdate&&s.updateAABB();for(this.sortList(),t=0,h=n.length|0;t!==h;t++)for(i=n[t],f=t+1;f<h;f++){if(u=n[f],l=u.aabb.lowerBound[c]<=i.aabb.upperBound[c],!l)break;r.canCollide(i,u)&&this.boundingVolumeCheck(i,u)&&e.push(i,u)}return e};i.prototype.aabbQuery=function(n,t,i){var e,r,f,u;i=i||[];this.sortList();e=this.axisIndex;r="x";e===1&&(r="y");e===2&&(r="z");var o=this.axisList,s=t.lowerBound[r],h=t.upperBound[r];for(f=0;f<o.length;f++)u=o[f],u.aabbNeedsUpdate&&u.updateAABB(),u.aabb.overlaps(t)&&i.push(u);return i}},{"../collision/Broadphase":8,"../utils/Utils":57}],14:[function(n,t){function i(n,t,i,u){this.type=i;u=r.defaults(u,{collideConnected:!0,wakeUpBodies:!0});this.equations=[];this.bodyA=n;this.bodyB=t;this.collideConnected=u.collideConnected;u.wakeUpBodies&&(n&&n.wakeUp(),t&&t.wakeUp())}t.exports=i;var r=n("../utils/Utils");i.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!");};i.DISTANCE=1;i.GEAR=2;i.LOCK=3;i.PRISMATIC=4;i.REVOLUTE=5;i.prototype.setStiffness=function(n){for(var i,r=this.equations,t=0;t!==r.length;t++)i=r[t],i.stiffness=n,i.needsUpdate=!0};i.prototype.setRelaxation=function(n){for(var i,r=this.equations,t=0;t!==r.length;t++)i=r[t],i.relaxation=n,i.needsUpdate=!0}},{"../utils/Utils":57}],15:[function(n,t){function u(n,t,r){var o,c,e,l;if(r=h.defaults(r,{localAnchorA:[0,0],localAnchorB:[0,0]}),f.call(this,n,t,f.DISTANCE,r),this.localAnchorA=i.fromValues(r.localAnchorA[0],r.localAnchorA[1]),this.localAnchorB=i.fromValues(r.localAnchorB[0],r.localAnchorB[1]),o=this.localAnchorA,c=this.localAnchorB,this.distance=0,typeof r.distance=="number")this.distance=r.distance;else{var a=i.create(),v=i.create(),u=i.create();i.rotate(a,o,n.angle);i.rotate(v,c,t.angle);i.add(u,t.position,v);i.sub(u,u,a);i.sub(u,u,n.position);this.distance=i.length(u)}e=typeof r.maxForce=="undefined"?Number.MAX_VALUE:r.maxForce;l=new s(n,t,-e,e);this.equations=[l];this.maxForce=e;var u=i.create(),y=i.create(),p=i.create(),w=this;l.computeGq=function(){var n=this.bodyA,t=this.bodyB,r=n.position,f=t.position;return i.rotate(y,o,n.angle),i.rotate(p,c,t.angle),i.add(u,f,p),i.sub(u,u,y),i.sub(u,u,r),i.length(u)-w.distance};this.setMaxForce(e);this.upperLimitEnabled=!1;this.upperLimit=1;this.lowerLimitEnabled=!1;this.lowerLimit=0;this.position=0}var f=n("./Constraint"),s=n("../equations/Equation"),i=n("../math/vec2"),h=n("../utils/Utils");t.exports=u;u.prototype=new f;u.prototype.constructor=u;var r=i.create(),e=i.create(),o=i.create();u.prototype.update=function(){var l=this.equations[0],f=this.bodyA,s=this.bodyB,y=this.distance,a=f.position,v=s.position,n=this.equations[0],t=l.G,u,h,c;if(i.rotate(e,this.localAnchorA,f.angle),i.rotate(o,this.localAnchorB,s.angle),i.add(r,v,o),i.sub(r,r,e),i.sub(r,r,a),this.position=i.length(r),u=!1,this.upperLimitEnabled&&this.position>this.upperLimit&&(n.maxForce=0,n.minForce=-this.maxForce,this.distance=this.upperLimit,u=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(n.maxForce=this.maxForce,n.minForce=0,this.distance=this.lowerLimit,u=!0),(this.lowerLimitEnabled||this.upperLimitEnabled)&&!u){n.enabled=!1;return}n.enabled=!0;i.normalize(r,r);h=i.crossLength(e,r);c=i.crossLength(o,r);t[0]=-r[0];t[1]=-r[1];t[2]=-h;t[3]=r[0];t[4]=r[1];t[5]=c};u.prototype.setMaxForce=function(n){var t=this.equations[0];t.minForce=-n;t.maxForce=n};u.prototype.getMaxForce=function(){var n=this.equations[0];return n.maxForce}},{"../equations/Equation":22,"../math/vec2":30,"../utils/Utils":57,"./Constraint":14}],16:[function(n,t){function i(n,t,i){i=i||{};r.call(this,n,t,r.GEAR,i);this.ratio=i.ratio!==undefined?i.ratio:1;this.angle=i.angle!==undefined?i.angle:t.angle-this.ratio*n.angle;i.angle=this.angle;i.ratio=this.ratio;this.equations=[new u(n,t,i)];i.maxTorque!==undefined&&this.setMaxTorque(i.maxTorque)}var r=n("./Constraint"),f=n("../equations/Equation"),u=n("../equations/AngleLockEquation"),e=n("../math/vec2");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.update=function(){var n=this.equations[0];n.ratio!==this.ratio&&n.setRatio(this.ratio);n.angle=this.angle};i.prototype.setMaxTorque=function(n){this.equations[0].setMaxTorque(n)};i.prototype.getMaxTorque=function(){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(n,t){function u(n,t,r){var s,h;r=r||{};e.call(this,n,t,e.LOCK,r);var f=typeof r.maxForce=="undefined"?Number.MAX_VALUE:r.maxForce,p=r.localAngleB||0,a=new o(n,t,-f,f),v=new o(n,t,-f,f),y=new o(n,t,-f,f),c=i.create(),u=i.create(),l=this;a.computeGq=function(){return i.rotate(c,l.localOffsetB,n.angle),i.sub(u,t.position,n.position),i.sub(u,u,c),u[0]};v.computeGq=function(){return i.rotate(c,l.localOffsetB,n.angle),i.sub(u,t.position,n.position),i.sub(u,u,c),u[1]};s=i.create();h=i.create();y.computeGq=function(){return i.rotate(s,l.localOffsetB,t.angle-l.localAngleB),i.scale(s,s,-1),i.sub(u,n.position,t.position),i.add(u,u,s),i.rotate(h,s,-Math.PI/2),i.normalize(h,h),i.dot(u,h)};this.localOffsetB=i.create();r.localOffsetB?i.copy(this.localOffsetB,r.localOffsetB):(i.sub(this.localOffsetB,t.position,n.position),i.rotate(this.localOffsetB,this.localOffsetB,-n.angle));this.localAngleB=0;this.localAngleB=typeof r.localAngleB=="number"?r.localAngleB:t.angle-n.angle;this.equations.push(a,v,y);this.setMaxForce(f)}var e=n("./Constraint"),i=n("../math/vec2"),o=n("../equations/Equation");t.exports=u;u.prototype=new e;u.prototype.constructor=u;u.prototype.setMaxForce=function(n){for(var i=this.equations,t=0;t<this.equations.length;t++)i[t].maxForce=n,i[t].minForce=-n};u.prototype.getMaxForce=function(){return this.equations[0].maxForce};var s=i.create(),f=i.create(),r=i.create(),h=i.fromValues(1,0),c=i.fromValues(0,1);u.prototype.update=function(){var t=this.equations[0],u=this.equations[1],n=this.equations[2],e=this.bodyA,o=this.bodyB;i.rotate(s,this.localOffsetB,e.angle);i.rotate(f,this.localOffsetB,o.angle-this.localAngleB);i.scale(f,f,-1);i.rotate(r,f,Math.PI/2);i.normalize(r,r);t.G[0]=-1;t.G[1]=0;t.G[2]=-i.crossLength(s,h);t.G[3]=1;u.G[0]=0;u.G[1]=-1;u.G[2]=-i.crossLength(s,c);u.G[4]=1;n.G[0]=-r[0];n.G[1]=-r[1];n.G[3]=r[0];n.G[4]=r[1];n.G[5]=i.crossLength(f,r)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(n,t){function u(n,t,r){var k;r=r||{};s.call(this,n,t,s.PRISMATIC,r);var o=i.fromValues(0,0),h=i.fromValues(1,0),c=i.fromValues(0,0);r.localAnchorA&&i.copy(o,r.localAnchorA);r.localAxisA&&i.copy(h,r.localAxisA);r.localAnchorB&&i.copy(c,r.localAnchorB);this.localAnchorA=o;this.localAnchorB=c;this.localAxisA=h;var e=this.maxForce=typeof r.maxForce!="undefined"?r.maxForce:Number.MAX_VALUE,y=new a(n,t,-e,e),p=new i.create,w=new i.create,f=new i.create,u=new i.create;y.computeGq=function(){return i.dot(f,u)};y.updateJacobian=function(){var r=this.G,e=n.position,s=t.position;i.rotate(p,o,n.angle);i.rotate(w,c,t.angle);i.add(f,s,w);i.sub(f,f,e);i.sub(f,f,p);i.rotate(u,h,n.angle+Math.PI/2);r[0]=-u[0];r[1]=-u[1];r[2]=-i.crossLength(p,u)+i.crossLength(u,f);r[3]=u[0];r[4]=u[1];r[5]=i.crossLength(w,u)};this.equations.push(y);r.disableRotationalLock||(k=new v(n,t,-e,e),this.equations.push(k));this.position=0;this.velocity=0;this.lowerLimitEnabled=typeof r.lowerLimit!="undefined"?!0:!1;this.upperLimitEnabled=typeof r.upperLimit!="undefined"?!0:!1;this.lowerLimit=typeof r.lowerLimit!="undefined"?r.lowerLimit:0;this.upperLimit=typeof r.upperLimit!="undefined"?r.upperLimit:1;this.upperLimitEquation=new l(n,t);this.lowerLimitEquation=new l(n,t);this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0;this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=e;this.motorEquation=new a(n,t);this.motorEnabled=!1;this.motorSpeed=0;var d=this,b=this.motorEquation,g=b.computeGW;b.computeGq=function(){return 0};b.computeGW=function(){var i=this.G,n=this.bodyA,t=this.bodyB,r=n.velocity,u=t.velocity,f=n.angularVelocity,e=t.angularVelocity;return this.gmult(i,r,f,u,e)+d.motorSpeed}}var s=n("./Constraint"),l=n("../equations/ContactEquation"),a=n("../equations/Equation"),i=n("../math/vec2"),v=n("../equations/RotationalLockEquation");t.exports=u;u.prototype=new s;u.prototype.constructor=u;var r=i.create(),f=i.create(),e=i.create(),h=i.create(),c=i.create(),o=i.create();u.prototype.update=function(){var n=this.equations,b=n[0],p=this.upperLimit,w=this.lowerLimit,t=this.upperLimitEquation,u=this.lowerLimitEquation,a=this.bodyA,v=this.bodyB,k=this.localAxisA,d=this.localAnchorA,g=this.localAnchorB,y,s,l;b.updateJacobian();i.rotate(r,k,a.angle);i.rotate(h,d,a.angle);i.add(f,h,a.position);i.rotate(c,g,v.angle);i.add(e,c,v.position);y=this.position=i.dot(e,r)-i.dot(f,r);this.motorEnabled&&(s=this.motorEquation.G,s[0]=r[0],s[1]=r[1],s[2]=i.crossLength(r,c),s[3]=-r[0],s[4]=-r[1],s[5]=-i.crossLength(r,h));this.upperLimitEnabled&&y>p?(i.scale(t.normalA,r,-1),i.sub(t.contactPointA,f,a.position),i.sub(t.contactPointB,e,v.position),i.scale(o,r,p),i.add(t.contactPointA,t.contactPointA,o),n.indexOf(t)===-1&&n.push(t)):(l=n.indexOf(t),l!==-1&&n.splice(l,1));this.lowerLimitEnabled&&y<w?(i.scale(u.normalA,r,1),i.sub(u.contactPointA,f,a.position),i.sub(u.contactPointB,e,v.position),i.scale(o,r,w),i.sub(u.contactPointB,u.contactPointB,o),n.indexOf(u)===-1&&n.push(u)):(l=n.indexOf(u),l!==-1&&n.splice(l,1))};u.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)};u.prototype.disableMotor=function(){if(this.motorEnabled){var n=this.equations.indexOf(this.motorEquation);this.equations.splice(n,1);this.motorEnabled=!1}};u.prototype.setLimits=function(n,t){typeof n=="number"?(this.lowerLimit=n,this.lowerLimitEnabled=!0):(this.lowerLimit=n,this.lowerLimitEnabled=!1);typeof t=="number"?(this.upperLimit=t,this.upperLimitEnabled=!0):(this.upperLimit=t,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(n,t){function u(n,t,u){var v;u=u||{};o.call(this,n,t,o.REVOLUTE,u);v=this.maxForce=typeof u.maxForce!="undefined"?u.maxForce:Number.MAX_VALUE;this.pivotA=i.create();this.pivotB=i.create();u.worldPivot?(i.sub(this.pivotA,u.worldPivot,n.position),i.sub(this.pivotB,u.worldPivot,t.position),i.rotate(this.pivotA,this.pivotA,-n.angle),i.rotate(this.pivotB,this.pivotB,-t.angle)):(i.copy(this.pivotA,u.localPivotA),i.copy(this.pivotB,u.localPivotB));var b=this.equations=[new c(n,t,-v,v),new c(n,t,-v,v)],p=b[0],w=b[1],y=this;p.computeGq=function(){return i.rotate(f,y.pivotA,n.angle),i.rotate(e,y.pivotB,t.angle),i.add(r,t.position,e),i.sub(r,r,n.position),i.sub(r,r,f),i.dot(r,s)};w.computeGq=function(){return i.rotate(f,y.pivotA,n.angle),i.rotate(e,y.pivotB,t.angle),i.add(r,t.position,e),i.sub(r,r,n.position),i.sub(r,r,f),i.dot(r,h)};w.minForce=p.minForce=-v;w.maxForce=p.maxForce=v;this.motorEquation=new a(n,t);this.motorEnabled=!1;this.angle=0;this.lowerLimitEnabled=!1;this.upperLimitEnabled=!1;this.lowerLimit=0;this.upperLimit=0;this.upperLimitEquation=new l(n,t);this.lowerLimitEquation=new l(n,t);this.upperLimitEquation.minForce=0;this.lowerLimitEquation.maxForce=0}var o=n("./Constraint"),c=n("../equations/Equation"),a=n("../equations/RotationalVelocityEquation"),l=n("../equations/RotationalLockEquation"),i=n("../math/vec2");t.exports=u;var f=i.create(),e=i.create(),s=i.fromValues(1,0),h=i.fromValues(0,1),r=i.create();u.prototype=new o;u.prototype.constructor=u;u.prototype.setLimits=function(n,t){typeof n=="number"?(this.lowerLimit=n,this.lowerLimitEnabled=!0):(this.lowerLimit=n,this.lowerLimitEnabled=!1);typeof t=="number"?(this.upperLimit=t,this.upperLimitEnabled=!0):(this.upperLimit=t,this.upperLimitEnabled=!1)};u.prototype.update=function(){var l=this.bodyA,a=this.bodyB,w=this.pivotA,b=this.pivotB,n=this.equations,k=n[0],d=n[1],t=n[0],r=n[1],v=this.upperLimit,y=this.lowerLimit,o=this.upperLimitEquation,c=this.lowerLimitEquation,p=this.angle=a.angle-l.angle,u;this.upperLimitEnabled&&p>v?(o.angle=v,n.indexOf(o)===-1&&n.push(o)):(u=n.indexOf(o),u!==-1&&n.splice(u,1));this.lowerLimitEnabled&&p<y?(c.angle=y,n.indexOf(c)===-1&&n.push(c)):(u=n.indexOf(c),u!==-1&&n.splice(u,1));i.rotate(f,w,l.angle);i.rotate(e,b,a.angle);t.G[0]=-1;t.G[1]=0;t.G[2]=-i.crossLength(f,s);t.G[3]=1;t.G[4]=0;t.G[5]=i.crossLength(e,s);r.G[0]=0;r.G[1]=-1;r.G[2]=-i.crossLength(f,h);r.G[3]=0;r.G[4]=1;r.G[5]=i.crossLength(e,h)};u.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)};u.prototype.disableMotor=function(){if(this.motorEnabled){var n=this.equations.indexOf(this.motorEquation);this.equations.splice(n,1);this.motorEnabled=!1}};u.prototype.setMotorSpeed=function(n){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations[t].relativeVelocity=n}};u.prototype.getMotorSpeed=function(){return this.motorEnabled?this.motorEquation.relativeVelocity:!1}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(n,t){function i(n,t,i){i=i||{};r.call(this,n,t,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=i.angle||0;this.ratio=typeof i.ratio=="number"?i.ratio:1;this.setRatio(this.ratio)}var r=n("./Equation"),u=n("../math/vec2");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle};i.prototype.setRatio=function(n){var t=this.G;t[2]=n;t[5]=-1;this.ratio=n};i.prototype.setMaxTorque=function(n){this.maxForce=n;this.minForce=-n}},{"../math/vec2":30,"./Equation":22}],21:[function(n,t){function r(n,t){u.call(this,n,t,0,Number.MAX_VALUE);this.contactPointA=i.create();this.penetrationVec=i.create();this.contactPointB=i.create();this.normalA=i.create();this.restitution=0;this.firstImpact=!1;this.shapeA=null;this.shapeB=null}var u=n("./Equation"),i=n("../math/vec2");t.exports=r;r.prototype=new u;r.prototype.constructor=r;r.prototype.computeB=function(n,t,r){var v=this.bodyA,y=this.bodyB,h=this.contactPointA,c=this.contactPointB,p=v.position,w=y.position,f=this.penetrationVec,u=this.normalA,e=this.G,b=i.crossLength(h,u),k=i.crossLength(c,u),o,s,l,a;return e[0]=-u[0],e[1]=-u[1],e[2]=-b,e[3]=u[0],e[4]=u[1],e[5]=k,i.add(f,w,c),i.sub(f,f,p),i.sub(f,f,h),this.firstImpact&&this.restitution!==0?(s=0,o=1/t*(1+this.restitution)*this.computeGW()):(s=i.dot(u,f)+this.offset,o=this.computeGW()),l=this.computeGiMf(),a=-s*n-o*t-r*l,a};var f=i.create(),e=i.create(),o=i.create();r.prototype.getVelocityAlongNormal=function(){return this.bodyA.getVelocityAtPoint(f,this.contactPointA),this.bodyB.getVelocityAtPoint(e,this.contactPointB),i.subtract(o,f,e),i.dot(this.normalA,o)}},{"../math/vec2":30,"./Equation":22}],22:[function(n,t){function r(n,t,i,u){this.minForce=typeof i=="undefined"?-Number.MAX_VALUE:i;this.maxForce=typeof u=="undefined"?Number.MAX_VALUE:u;this.bodyA=n;this.bodyB=t;this.stiffness=r.DEFAULT_STIFFNESS;this.relaxation=r.DEFAULT_RELAXATION;this.G=new s.ARRAY_TYPE(6);for(var f=0;f<6;f++)this.G[f]=0;this.offset=0;this.a=0;this.b=0;this.epsilon=0;this.timeStep=1/60;this.needsUpdate=!0;this.multiplier=0;this.relativeVelocity=0;this.enabled=!0}var e,o,u,f;t.exports=r;var i=n("../math/vec2"),s=n("../utils/Utils"),p=n("../objects/Body");r.prototype.constructor=r;r.DEFAULT_STIFFNESS=1e6;r.DEFAULT_RELAXATION=4;r.prototype.update=function(){var i=this.stiffness,n=this.relaxation,t=this.timeStep;this.a=4/(t*(1+4*n));this.b=4*n/(1+4*n);this.epsilon=4/(t*t*i*(1+4*n));this.needsUpdate=!1};r.prototype.gmult=function(n,t,i,r,u){return n[0]*t[0]+n[1]*t[1]+n[2]*i+n[3]*r[0]+n[4]*r[1]+n[5]*u};r.prototype.computeB=function(n,t,i){var r=this.computeGW(),u=this.computeGq(),f=this.computeGiMf();return-u*n-r*t-f*i};e=i.create();o=i.create();r.prototype.computeGq=function(){var i=this.G,n=this.bodyA,t=this.bodyB,f=n.position,s=t.position,r=n.angle,u=t.angle;return this.gmult(i,e,r,o,u)+this.offset};r.prototype.computeGW=function(){var i=this.G,n=this.bodyA,t=this.bodyB,r=n.velocity,u=t.velocity,f=n.angularVelocity,e=t.angularVelocity;return this.gmult(i,r,f,u,e)+this.relativeVelocity};r.prototype.computeGWlambda=function(){var i=this.G,n=this.bodyA,t=this.bodyB,r=n.vlambda,u=t.vlambda,f=n.wlambda,e=t.wlambda;return this.gmult(i,r,f,u,e)};u=i.create();f=i.create();r.prototype.computeGiMf=function(){var n=this.bodyA,t=this.bodyB,r=n.force,e=n.angularForce,o=t.force,s=t.angularForce,h=n.invMassSolve,c=t.invMassSolve,l=n.invInertiaSolve,a=t.invInertiaSolve,v=this.G;return i.scale(u,r,h),i.multiply(u,n.massMultiplier,u),i.scale(f,o,c),i.multiply(f,t.massMultiplier,f),this.gmult(v,u,e*l,f,s*a)};r.prototype.computeGiMGt=function(){var t=this.bodyA,i=this.bodyB,r=t.invMassSolve,u=i.invMassSolve,f=t.invInertiaSolve,e=i.invInertiaSolve,n=this.G;return n[0]*n[0]*r*t.massMultiplier[0]+n[1]*n[1]*r*t.massMultiplier[1]+n[2]*n[2]*f+n[3]*n[3]*u*i.massMultiplier[0]+n[4]*n[4]*u*i.massMultiplier[1]+n[5]*n[5]*e};var h=i.create(),c=i.create(),l=i.create(),a=i.create(),v=i.create(),y=i.create();r.prototype.addToWlambda=function(n){var r=this.bodyA,u=this.bodyB,t=h,e=c,o=l,k=a,d=v,s=r.invMassSolve,p=u.invMassSolve,w=r.invInertiaSolve,b=u.invInertiaSolve,g=y,f=this.G;e[0]=f[0];e[1]=f[1];o[0]=f[3];o[1]=f[4];i.scale(t,e,s*n);i.multiply(t,t,r.massMultiplier);i.add(r.vlambda,r.vlambda,t);r.wlambda+=w*f[2]*n;i.scale(t,o,p*n);i.multiply(t,t,u.massMultiplier);i.add(u.vlambda,u.vlambda,t);u.wlambda+=b*f[5]*n};r.prototype.computeInvC=function(n){return 1/(this.computeGiMGt()+n)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],23:[function(n,t){function i(n,t,i){u.call(this,n,t,-i,i);this.contactPointA=r.create();this.contactPointB=r.create();this.t=r.create();this.contactEquations=[];this.shapeA=null;this.shapeB=null;this.frictionCoefficient=.3}var r=n("../math/vec2"),u=n("./Equation"),f=n("../utils/Utils");t.exports=i;i.prototype=new u;i.prototype.constructor=i;i.prototype.setSlipForce=function(n){this.maxForce=n;this.minForce=-n};i.prototype.getSlipForce=function(){return this.maxForce};i.prototype.computeB=function(n,t,i){var c=this.bodyA,l=this.bodyB,e=this.contactPointA,o=this.contactPointB,u=this.t,f=this.G;f[0]=-u[0];f[1]=-u[1];f[2]=-r.crossLength(e,u);f[3]=u[0];f[4]=u[1];f[5]=r.crossLength(o,u);var s=this.computeGW(),h=this.computeGiMf();return-s*t-i*h}},{"../math/vec2":30,"../utils/Utils":57,"./Equation":22}],24:[function(n,t){function r(n,t,i){i=i||{};u.call(this,n,t,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=i.angle||0;var r=this.G;r[2]=1;r[5]=-1}var u=n("./Equation"),i=n("../math/vec2");t.exports=r;r.prototype=new u;r.prototype.constructor=r;var f=i.create(),e=i.create(),o=i.fromValues(1,0),s=i.fromValues(0,1);r.prototype.computeGq=function(){return i.rotate(f,o,this.bodyA.angle+this.angle),i.rotate(e,s,this.bodyB.angle),i.dot(f,e)}},{"../math/vec2":30,"./Equation":22}],25:[function(n,t){function i(n,t){r.call(this,n,t,-Number.MAX_VALUE,Number.MAX_VALUE);this.relativeVelocity=1;this.ratio=1}var r=n("./Equation"),u=n("../math/vec2");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.computeB=function(n,t,i){var r=this.G;r[2]=-1;r[5]=this.ratio;var u=this.computeGiMf(),f=this.computeGW();return-f*t-i*u}},{"../math/vec2":30,"./Equation":22}],26:[function(n,t){var i=function(){};t.exports=i;i.prototype={constructor:i,on:function(n,t,i){t.context=i||this;this._listeners===undefined&&(this._listeners={});var r=this._listeners;return r[n]===undefined&&(r[n]=[]),r[n].indexOf(t)===-1&&r[n].push(t),this},has:function(n,t){if(this._listeners===undefined)return!1;var i=this._listeners;if(t){if(i[n]!==undefined&&i[n].indexOf(t)!==-1)return!0}else if(i[n]!==undefined)return!0;return!1},off:function(n,t){if(this._listeners===undefined)return this;var i=this._listeners,r=i[n].indexOf(t);return r!==-1&&i[n].splice(r,1),this},emit:function(n){var u,t,i,f,r;if(this._listeners===undefined)return this;if(u=this._listeners,t=u[n.type],t!==undefined)for(n.target=this,i=0,f=t.length;i<f;i++)r=t[i],r.call(r.context,n);return this}}},{}],27:[function(n,t){function r(n,t,f){if(f=f||{},!(n instanceof u)||!(t instanceof u))throw new Error("First two arguments must be Material instances.");this.id=r.idCounter++;this.materialA=n;this.materialB=t;this.friction=typeof f.friction!="undefined"?Number(f.friction):.3;this.restitution=typeof f.restitution!="undefined"?Number(f.restitution):0;this.stiffness=typeof f.stiffness!="undefined"?Number(f.stiffness):i.DEFAULT_STIFFNESS;this.relaxation=typeof f.relaxation!="undefined"?Number(f.relaxation):i.DEFAULT_RELAXATION;this.frictionStiffness=typeof f.frictionStiffness!="undefined"?Number(f.frictionStiffness):i.DEFAULT_STIFFNESS;this.frictionRelaxation=typeof f.frictionRelaxation!="undefined"?Number(f.frictionRelaxation):i.DEFAULT_RELAXATION;this.surfaceVelocity=typeof f.surfaceVelocity!="undefined"?Number(f.surfaceVelocity):0;this.contactSkinSize=.005}var u=n("./Material"),i=n("../equations/Equation");t.exports=r;r.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(n,t){function i(n){this.id=n||i.idCounter++}t.exports=i;i.idCounter=0},{}],29:[function(n,t){var i={};i.GetArea=function(n){var i,r,t;if(n.length<6)return 0;for(i=n.length-2,r=0,t=0;t<i;t+=2)r+=(n[t+2]-n[t])*(n[t+1]+n[t+3]);return r+=(n[0]-n[i])*(n[i+1]+n[1]),-r*.5};i.Triangulate=function(n){var l=n.length>>1,e,r,t,u,c,f;if(l<3)return[];for(e=[],r=[],t=0;t<l;t++)r.push(t);for(t=0,u=l;u>3;){var o=r[(t+0)%u],s=r[(t+1)%u],h=r[(t+2)%u],v=n[2*o],y=n[2*o+1],p=n[2*s],w=n[2*s+1],b=n[2*h],k=n[2*h+1],a=!1;if(i._convex(v,y,p,w,b,k))for(a=!0,c=0;c<u;c++)if((f=r[c],f!=o&&f!=s&&f!=h)&&i._PointInTriangle(n[2*f],n[2*f+1],v,y,p,w,b,k)){a=!1;break}if(a)e.push(o,s,h),r.splice((t+1)%u,1),u--,t=0;else if(t++>3*u)break}return e.push(r[0],r[1],r[2]),e};i._PointInTriangle=function(n,t,i,r,u,f,e,o){var s=e-i,h=o-r,c=u-i,l=f-r,v=n-i,y=t-r,p=s*s+h*h,a=s*c+h*l,w=s*v+h*y,b=c*c+l*l,k=c*v+l*y,d=1/(p*b-a*a),g=(b*w-a*k)*d,nt=(p*k-a*w)*d;return g>=0&&nt>=0&&g+nt<1};i._convex=function(n,t,i,r,u,f){return(t-r)*(u-i)+(i-n)*(f-r)>=0};t.exports=i},{}],30:[function(n,t){var i=t.exports={},r=n("../utils/Utils");i.crossLength=function(n,t){return n[0]*t[1]-n[1]*t[0]};i.crossVZ=function(n,t,r){return i.rotate(n,t,-Math.PI/2),i.scale(n,n,r),n};i.crossZV=function(n,t,r){return i.rotate(n,r,Math.PI/2),i.scale(n,n,t),n};i.rotate=function(n,t,i){if(i!==0){var r=Math.cos(i),u=Math.sin(i),f=t[0],e=t[1];n[0]=r*f-u*e;n[1]=u*f+r*e}else n[0]=t[0],n[1]=t[1]};i.rotate90cw=function(n,t){var i=t[0],r=t[1];n[0]=r;n[1]=-i};i.toLocalFrame=function(n,t,r,u){i.copy(n,t);i.sub(n,n,r);i.rotate(n,n,-u)};i.toGlobalFrame=function(n,t,r,u){i.copy(n,t);i.rotate(n,n,u);i.add(n,n,r)};i.vectorToLocalFrame=function(n,t,r){i.rotate(n,t,-r)};i.vectorToGlobalFrame=function(n,t,r){i.rotate(n,t,r)};i.centroid=function(n,t,r,u){return i.add(n,t,r),i.add(n,n,u),i.scale(n,n,1/3),n};i.create=function(){var n=new r.ARRAY_TYPE(2);return n[0]=0,n[1]=0,n};i.clone=function(n){var t=new r.ARRAY_TYPE(2);return t[0]=n[0],t[1]=n[1],t};i.fromValues=function(n,t){var i=new r.ARRAY_TYPE(2);return i[0]=n,i[1]=t,i};i.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n};i.set=function(n,t,i){return n[0]=t,n[1]=i,n};i.add=function(n,t,i){return n[0]=t[0]+i[0],n[1]=t[1]+i[1],n};i.subtract=function(n,t,i){return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n};i.sub=i.subtract;i.multiply=function(n,t,i){return n[0]=t[0]*i[0],n[1]=t[1]*i[1],n};i.mul=i.multiply;i.divide=function(n,t,i){return n[0]=t[0]/i[0],n[1]=t[1]/i[1],n};i.div=i.divide;i.scale=function(n,t,i){return n[0]=t[0]*i,n[1]=t[1]*i,n};i.distance=function(n,t){var i=t[0]-n[0],r=t[1]-n[1];return Math.sqrt(i*i+r*r)};i.dist=i.distance;i.squaredDistance=function(n,t){var i=t[0]-n[0],r=t[1]-n[1];return i*i+r*r};i.sqrDist=i.squaredDistance;i.length=function(n){var t=n[0],i=n[1];return Math.sqrt(t*t+i*i)};i.len=i.length;i.squaredLength=function(n){var t=n[0],i=n[1];return t*t+i*i};i.sqrLen=i.squaredLength;i.negate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n};i.normalize=function(n,t){var r=t[0],u=t[1],i=r*r+u*u;return i>0&&(i=1/Math.sqrt(i),n[0]=t[0]*i,n[1]=t[1]*i),n};i.dot=function(n,t){return n[0]*t[0]+n[1]*t[1]};i.str=function(n){return"vec2("+n[0]+", "+n[1]+")"};i.lerp=function(n,t,i,r){var u=t[0],f=t[1];return n[0]=u+r*(i[0]-u),n[1]=f+r*(i[1]-f),n};i.reflect=function(n,t,i){var r=t[0]*i[0]+t[1]*i[1];n[0]=t[0]-2*i[0]*r;n[1]=t[1]-2*i[1]*r};i.getLineSegmentsIntersection=function(n,t,r,u,f){var e=i.getLineSegmentsIntersectionFraction(t,r,u,f);return e<0?!1:(n[0]=t[0]+e*(r[0]-t[0]),n[1]=t[1]+e*(r[1]-t[1]),!0)};i.getLineSegmentsIntersectionFraction=function(n,t,i,r){var f=t[0]-n[0],e=t[1]-n[1],o=r[0]-i[0],s=r[1]-i[1],h,u;return(h=(-e*(n[0]-i[0])+f*(n[1]-i[1]))/(-o*e+f*s),u=(o*(n[1]-i[1])-s*(n[0]-i[0]))/(-o*e+f*s),h>=0&&h<=1&&u>=0&&u<=1)?u:-1}},{"../utils/Utils":57}],31:[function(n,t){function r(n){n=n||{};v.call(this);this.id=n.id||++r._idCounter;this.world=null;this.shapes=[];this.mass=n.mass||0;this.invMass=0;this.inertia=0;this.invInertia=0;this.invMassSolve=0;this.invInertiaSolve=0;this.fixedRotation=!!n.fixedRotation;this.fixedX=!!n.fixedX;this.fixedY=!!n.fixedY;this.massMultiplier=i.create();this.position=i.fromValues(0,0);n.position&&i.copy(this.position,n.position);this.interpolatedPosition=i.fromValues(0,0);this.interpolatedAngle=0;this.previousPosition=i.fromValues(0,0);this.previousAngle=0;this.velocity=i.fromValues(0,0);n.velocity&&i.copy(this.velocity,n.velocity);this.vlambda=i.fromValues(0,0);this.wlambda=0;this.angle=n.angle||0;this.angularVelocity=n.angularVelocity||0;this.force=i.create();n.force&&i.copy(this.force,n.force);this.angularForce=n.angularForce||0;this.damping=typeof n.damping=="number"?n.damping:.1;this.angularDamping=typeof n.angularDamping=="number"?n.angularDamping:.1;this.type=r.STATIC;this.type=typeof n.type!="undefined"?n.type:n.mass?r.DYNAMIC:r.STATIC;this.boundingRadius=0;this.aabb=new a;this.aabbNeedsUpdate=!0;this.allowSleep=n.allowSleep!==undefined?n.allowSleep:!0;this.wantsToSleep=!1;this.sleepState=r.AWAKE;this.sleepSpeedLimit=n.sleepSpeedLimit!==undefined?n.sleepSpeedLimit:.2;this.sleepTimeLimit=n.sleepTimeLimit!==undefined?n.sleepTimeLimit:1;this.gravityScale=n.gravityScale!==undefined?n.gravityScale:1;this.collisionResponse=n.collisionResponse!==undefined?n.collisionResponse:!0;this.idleTime=0;this.timeLastSleepy=0;this.ccdSpeedThreshold=n.ccdSpeedThreshold!==undefined?n.ccdSpeedThreshold:-1;this.ccdIterations=n.ccdIterations!==undefined?n.ccdIterations:10;this.concavePath=null;this._wakeUpAfterNarrowphase=!1;this.updateMassProperties()}var i=n("../math/vec2"),b=n("poly-decomp"),k=n("../shapes/Convex"),d=n("../collision/RaycastResult"),l=n("../collision/Ray"),a=n("../collision/AABB"),v=n("../events/EventEmitter"),h,y,g,p,s,u;t.exports=r;r.prototype=new v;r.prototype.constructor=r;r._idCounter=0;r.prototype.updateSolveMassProperties=function(){this.sleepState===r.SLEEPING||this.type===r.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)};r.prototype.setDensity=function(n){var t=this.getArea();this.mass=t*n;this.updateMassProperties()};r.prototype.getArea=function(){for(var t=0,n=0;n<this.shapes.length;n++)t+=this.shapes[n].area;return t};r.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};h=new a;y=i.create();r.prototype.updateAABB=function(){for(var r,e,u=this.shapes,o=u.length,n=y,f=this.angle,t=0;t!==o;t++)r=u[t],e=r.angle+f,i.rotate(n,r.position,f),i.add(n,n,this.position),r.computeAABB(h,n,e),t===0?this.aabb.copy(h):this.aabb.extend(h);this.aabbNeedsUpdate=!1};r.prototype.updateBoundingRadius=function(){for(var r=this.shapes,o=r.length,n=0,t=0;t!==o;t++){var u=r[t],f=i.length(u.position),e=u.boundingRadius;f+e>n&&(n=f+e)}this.boundingRadius=n};r.prototype.addShape=function(n,t,r){if(n.body)throw new Error("A shape can only be added to one body.");n.body=this;t?i.copy(n.position,t):i.set(n.position,0,0);n.angle=r||0;this.shapes.push(n);this.updateMassProperties();this.updateBoundingRadius();this.aabbNeedsUpdate=!0};r.prototype.removeShape=function(n){var t=this.shapes.indexOf(n);return t!==-1?(this.shapes.splice(t,1),this.aabbNeedsUpdate=!0,n.body=null,!0):!1};r.prototype.updateMassProperties=function(){var t;if(this.type===r.STATIC||this.type===r.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var u=this.shapes,f=u.length,e=this.mass/f,n=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(t=0;t<f;t++){var o=u[t],s=i.squaredLength(o.position),h=o.computeMomentOfInertia(e);n+=h+e*s}this.inertia=n;this.invInertia=n>0?1/n:0}this.invMass=1/this.mass;i.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}};g=i.create();r.prototype.applyForce=function(n,t){if(i.add(this.force,this.force,n),t){var r=i.crossLength(t,n);this.angularForce+=r}};var nt=i.create(),tt=i.create(),it=i.create();r.prototype.applyForceLocal=function(n,t){t=t||it;var i=nt,r=tt;this.vectorToWorldFrame(i,n);this.vectorToWorldFrame(r,t);this.applyForce(i,r)};p=i.create();r.prototype.applyImpulse=function(n,t){var u,f;this.type===r.DYNAMIC&&(u=p,i.scale(u,n,this.invMass),i.multiply(u,this.massMultiplier,u),i.add(this.velocity,u,this.velocity),t&&(f=i.crossLength(t,n),f*=this.invInertia,this.angularVelocity+=f))};var rt=i.create(),ut=i.create(),ft=i.create();r.prototype.applyImpulseLocal=function(n,t){t=t||ft;var i=rt,r=ut;this.vectorToWorldFrame(i,n);this.vectorToWorldFrame(r,t);this.applyImpulse(i,r)};r.prototype.toLocalFrame=function(n,t){i.toLocalFrame(n,t,this.position,this.angle)};r.prototype.toWorldFrame=function(n,t){i.toGlobalFrame(n,t,this.position,this.angle)};r.prototype.vectorToLocalFrame=function(n,t){i.vectorToLocalFrame(n,t,this.angle)};r.prototype.vectorToWorldFrame=function(n,t){i.vectorToGlobalFrame(n,t,this.angle)};r.prototype.fromPolygon=function(n,t){var f,s,h,r,u,o,e;for(t=t||{},r=this.shapes.length;r>=0;--r)this.removeShape(this.shapes[r]);if(f=new b.Polygon,f.vertices=n,f.makeCCW(),typeof t.removeCollinearPoints=="number"&&f.removeCollinearPoints(t.removeCollinearPoints),typeof t.skipSimpleCheck=="undefined"&&!f.isSimple())return!1;for(this.concavePath=f.vertices.slice(0),r=0;r<this.concavePath.length;r++)e=[0,0],i.copy(e,this.concavePath[r]),this.concavePath[r]=e;for(s=t.optimalDecomp?f.decomp():f.quickDecomp(),h=i.create(),r=0;r!==s.length;r++){for(u=new k({vertices:s[r].vertices}),o=0;o!==u.vertices.length;o++)e=u.vertices[o],i.sub(e,e,u.centerOfMass);i.scale(h,u.centerOfMass,1);u.updateTriangles();u.updateCenterOfMass();u.updateBoundingRadius();this.addShape(u,h)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var ct=i.fromValues(0,0),et=i.fromValues(0,0),ot=i.fromValues(0,0),st=i.fromValues(0,0);r.prototype.adjustCenterOfMass=function(){var f=et,r=ot,u=st,e=0,t,n;for(i.set(r,0,0),n=0;n!==this.shapes.length;n++)t=this.shapes[n],i.scale(f,t.position,t.area),i.add(r,r,f),e+=t.area;for(i.scale(u,r,1/e),n=0;n!==this.shapes.length;n++)t=this.shapes[n],i.sub(t.position,t.position,u);for(i.add(this.position,this.position,u),n=0;this.concavePath&&n<this.concavePath.length;n++)i.sub(this.concavePath[n],this.concavePath[n],u);this.updateMassProperties();this.updateBoundingRadius()};r.prototype.setZeroForce=function(){i.set(this.force,0,0);this.angularForce=0};r.prototype.resetConstraintVelocity=function(){var n=this,t=n.vlambda;i.set(t,0,0);n.wlambda=0};r.prototype.addConstraintVelocity=function(){var n=this,t=n.velocity;i.add(t,t,n.vlambda);n.angularVelocity+=n.wlambda};r.prototype.applyDamping=function(n){if(this.type===r.DYNAMIC){var t=this.velocity;i.scale(t,t,Math.pow(1-this.damping,n));this.angularVelocity*=Math.pow(1-this.angularDamping,n)}};r.prototype.wakeUp=function(){var n=this.sleepState;this.sleepState=r.AWAKE;this.idleTime=0;n!==r.AWAKE&&this.emit(r.wakeUpEvent)};r.prototype.sleep=function(){this.sleepState=r.SLEEPING;this.angularVelocity=0;this.angularForce=0;i.set(this.velocity,0,0);i.set(this.force,0,0);this.emit(r.sleepEvent)};r.prototype.sleepTick=function(n,t,u){if(this.allowSleep&&this.type!==r.SLEEPING){this.wantsToSleep=!1;var o=this.sleepState,f=i.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2),e=Math.pow(this.sleepSpeedLimit,2);f>=e?(this.idleTime=0,this.sleepState=r.AWAKE):(this.idleTime+=u,this.sleepState=r.SLEEPY);this.idleTime>this.sleepTimeLimit&&(t?this.wantsToSleep=!0:this.sleep())}};r.prototype.overlaps=function(n){return this.world.overlapKeeper.bodiesAreOverlapping(this,n)};s=i.create();u=i.create();r.prototype.integrate=function(n){var f=this.invMass,e=this.force,r=this.position,t=this.velocity;i.copy(this.previousPosition,this.position);this.previousAngle=this.angle;this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*n);i.scale(s,e,n*f);i.multiply(s,this.massMultiplier,s);i.add(t,s,t);this.integrateToTimeOfImpact(n)||(i.scale(u,t,n),i.add(r,r,u),this.fixedRotation||(this.angle+=this.angularVelocity*n));this.aabbNeedsUpdate=!0};var w=new d,e=new l({mode:l.ALL}),ht=i.create(),f=i.create(),o=i.create(),c=i.create();r.prototype.integrateToTimeOfImpact=function(n){var h,b;if(this.ccdSpeedThreshold<0||i.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;i.normalize(ht,this.velocity);i.scale(f,this.velocity,n);i.add(f,f,this.position);i.sub(o,f,this.position);var v=this.angularVelocity*n,k=i.length(o),t=1,r,y=this;if(w.reset(),e.callback=function(n){n.body!==y&&(r=n.body,n.getHitPoint(f,e),i.sub(o,f,y.position),t=i.length(o)/k,n.stop())},i.copy(e.from,this.position),i.copy(e.to,f),e.update(),this.world.raycast(w,e),!r)return!1;h=this.angle;i.copy(c,this.position);for(var p=0,l=0,s=0,a=t;a>=l&&p<this.ccdIterations;)p++,s=(a-l)/2,i.scale(u,o,t),i.add(this.position,c,u),this.angle=h+v*t,this.updateAABB(),b=this.aabb.overlaps(r.aabb)&&this.world.narrowphase.bodiesOverlap(this,r),b?l=s:a=s;return t=s,i.copy(this.position,c),this.angle=h,i.scale(u,o,t),i.add(this.position,this.position,u),this.fixedRotation||(this.angle+=v*t),!0};r.prototype.getVelocityAtPoint=function(n,t){return i.crossVZ(n,t,this.angularVelocity),i.subtract(n,this.velocity,n),n};r.sleepyEvent={type:"sleepy"};r.sleepEvent={type:"sleep"};r.wakeUpEvent={type:"wakeup"};r.DYNAMIC=1;r.STATIC=2;r.KINEMATIC=4;r.AWAKE=0;r.SLEEPY=1;r.SLEEPING=2},{"../collision/AABB":7,"../collision/Ray":11,"../collision/RaycastResult":12,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":40,"poly-decomp":5}],32:[function(n,t){function r(n,t,r){var f,e,o;r=r||{};u.call(this,n,t,r);this.localAnchorA=i.fromValues(0,0);this.localAnchorB=i.fromValues(0,0);r.localAnchorA&&i.copy(this.localAnchorA,r.localAnchorA);r.localAnchorB&&i.copy(this.localAnchorB,r.localAnchorB);r.worldAnchorA&&this.setWorldAnchorA(r.worldAnchorA);r.worldAnchorB&&this.setWorldAnchorB(r.worldAnchorB);f=i.create();e=i.create();this.getWorldAnchorA(f);this.getWorldAnchorB(e);o=i.distance(f,e);this.restLength=typeof r.restLength=="number"?r.restLength:o}var i=n("../math/vec2"),u=n("./Spring"),y=n("../utils/Utils");t.exports=r;r.prototype=new u;r.prototype.constructor=r;r.prototype.setWorldAnchorA=function(n){this.bodyA.toLocalFrame(this.localAnchorA,n)};r.prototype.setWorldAnchorB=function(n){this.bodyB.toLocalFrame(this.localAnchorB,n)};r.prototype.getWorldAnchorA=function(n){this.bodyA.toWorldFrame(n,this.localAnchorA)};r.prototype.getWorldAnchorB=function(n){this.bodyB.toWorldFrame(n,this.localAnchorB)};var f=i.create(),e=i.create(),o=i.create(),s=i.create(),h=i.create(),c=i.create(),l=i.create(),a=i.create(),v=i.create();r.prototype.applyForce=function(){var rt=this.stiffness,ut=this.damping,ft=this.restLength,n=this.bodyA,t=this.bodyB,p=f,w=e,r=o,u=s,y=v,b=h,k=c,d=l,g=a,nt,tt,it;this.getWorldAnchorA(b);this.getWorldAnchorB(k);i.sub(d,b,n.position);i.sub(g,k,t.position);i.sub(p,k,b);nt=i.len(p);i.normalize(w,p);i.sub(r,t.velocity,n.velocity);i.crossZV(y,t.angularVelocity,g);i.add(r,r,y);i.crossZV(y,n.angularVelocity,d);i.sub(r,r,y);i.scale(u,w,-rt*(nt-ft)-ut*i.dot(r,w));i.sub(n.force,n.force,u);i.add(t.force,t.force,u);tt=i.crossLength(d,u);it=i.crossLength(g,u);n.angularForce-=tt;t.angularForce+=it}},{"../math/vec2":30,"../utils/Utils":57,"./Spring":34}],33:[function(n,t){function i(n,t,i){i=i||{};r.call(this,n,t,i);this.restAngle=typeof i.restAngle=="number"?i.restAngle:t.angle-n.angle}var u=n("../math/vec2"),r=n("./Spring");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.applyForce=function(){var r=this.stiffness,u=this.damping,f=this.restAngle,n=this.bodyA,t=this.bodyB,e=t.angle-n.angle,o=t.angularVelocity-n.angularVelocity,i=-r*(e-f)-u*o*0;n.angularForce-=i;t.angularForce+=i}},{"../math/vec2":30,"./Spring":34}],34:[function(n,t){function i(n,t,i){i=r.defaults(i,{stiffness:100,damping:1});this.stiffness=i.stiffness;this.damping=i.damping;this.bodyA=n;this.bodyB=t}var u=n("../math/vec2"),r=n("../utils/Utils");t.exports=i;i.prototype.applyForce=function(){}},{"../math/vec2":30,"../utils/Utils":57}],35:[function(n,t){function u(n,t){t=t||{};this.chassisBody=n;this.wheels=[];this.groundBody=new c({mass:0});this.world=null;var i=this;this.preStepCallback=function(){i.update()}}function r(n,t){t=t||{};this.vehicle=n;this.forwardEquation=new h(n.chassisBody,n.groundBody);this.sideEquation=new h(n.chassisBody,n.groundBody);this.steerValue=0;this.engineForce=0;this.setSideFriction(t.sideFriction!==undefined?t.sideFriction:5);this.localForwardVector=i.fromValues(0,1);t.localForwardVector&&i.copy(this.localForwardVector,t.localForwardVector);this.localPosition=i.fromValues(0,0);t.localPosition&&i.copy(this.localPosition,t.localPosition);s.apply(this,n.chassisBody,n.groundBody);this.equations.push(this.forwardEquation,this.sideEquation);this.setBrakeForce(0)}var i=n("../math/vec2"),l=n("../utils/Utils"),s=n("../constraints/Constraint"),h=n("../equations/FrictionEquation"),c=n("../objects/Body"),o,e,f;t.exports=u;u.prototype.addToWorld=function(n){var t,i;this.world=n;n.addBody(this.groundBody);n.on("preStep",this.preStepCallback);for(t=0;t<this.wheels.length;t++)i=this.wheels[t],n.addConstraint(i)};u.prototype.removeFromWorld=function(){var t=this.world,n,i;for(t.removeBody(this.groundBody),t.off("preStep",this.preStepCallback),n=0;n<this.wheels.length;n++)i=this.wheels[n],t.removeConstraint(i);this.world=null};u.prototype.addWheel=function(n){var t=new r(this,n);return this.wheels.push(t),t};u.prototype.update=function(){for(var n=0;n<this.wheels.length;n++)this.wheels[n].update()};r.prototype=new s;r.prototype.setBrakeForce=function(n){this.forwardEquation.setSlipForce(n)};r.prototype.setSideFriction=function(n){this.sideEquation.setSlipForce(n)};o=i.create();e=i.create();r.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(e,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(o,e),i.dot(o,e)};f=i.create();r.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector);i.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2);this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t);i.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue);i.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue);this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition);i.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB);this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition);i.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA);i.normalize(f,this.forwardEquation.t);i.scale(f,f,this.engineForce);this.vehicle.chassisBody.applyForce(f,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":14,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],36:[function(n,t){var i=t.exports={AABB:n("./collision/AABB"),AngleLockEquation:n("./equations/AngleLockEquation"),Body:n("./objects/Body"),Broadphase:n("./collision/Broadphase"),Capsule:n("./shapes/Capsule"),Circle:n("./shapes/Circle"),Constraint:n("./constraints/Constraint"),ContactEquation:n("./equations/ContactEquation"),ContactEquationPool:n("./utils/ContactEquationPool"),ContactMaterial:n("./material/ContactMaterial"),Convex:n("./shapes/Convex"),DistanceConstraint:n("./constraints/DistanceConstraint"),Equation:n("./equations/Equation"),EventEmitter:n("./events/EventEmitter"),FrictionEquation:n("./equations/FrictionEquation"),FrictionEquationPool:n("./utils/FrictionEquationPool"),GearConstraint:n("./constraints/GearConstraint"),GSSolver:n("./solver/GSSolver"),Heightfield:n("./shapes/Heightfield"),Line:n("./shapes/Line"),LockConstraint:n("./constraints/LockConstraint"),Material:n("./material/Material"),Narrowphase:n("./collision/Narrowphase"),NaiveBroadphase:n("./collision/NaiveBroadphase"),Particle:n("./shapes/Particle"),Plane:n("./shapes/Plane"),Pool:n("./utils/Pool"),RevoluteConstraint:n("./constraints/RevoluteConstraint"),PrismaticConstraint:n("./constraints/PrismaticConstraint"),Ray:n("./collision/Ray"),RaycastResult:n("./collision/RaycastResult"),Box:n("./shapes/Box"),RotationalVelocityEquation:n("./equations/RotationalVelocityEquation"),SAPBroadphase:n("./collision/SAPBroadphase"),Shape:n("./shapes/Shape"),Solver:n("./solver/Solver"),Spring:n("./objects/Spring"),TopDownVehicle:n("./objects/TopDownVehicle"),LinearSpring:n("./objects/LinearSpring"),RotationalSpring:n("./objects/RotationalSpring"),Utils:n("./utils/Utils"),World:n("./world/World"),vec2:n("./math/vec2"),version:n("../package.json").version};Object.defineProperty(i,"Rectangle",{get:function(){return console.warn("The Rectangle class has been renamed to Box."),this.Box}})},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/NaiveBroadphase":9,"./collision/Narrowphase":10,"./collision/Ray":11,"./collision/RaycastResult":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/LinearSpring":32,"./objects/RotationalSpring":33,"./objects/Spring":34,"./objects/TopDownVehicle":35,"./shapes/Box":37,"./shapes/Capsule":38,"./shapes/Circle":39,"./shapes/Convex":40,"./shapes/Heightfield":41,"./shapes/Line":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/ContactEquationPool":48,"./utils/FrictionEquationPool":49,"./utils/Pool":55,"./utils/Utils":57,"./world/World":61}],37:[function(n,t){function r(n){typeof arguments[0]=="number"&&typeof arguments[1]=="number"&&(n={width:arguments[0],height:arguments[1]},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })"));n=n||{};var t=this.width=n.width||1,r=this.height=n.height||1,e=[i.fromValues(-t/2,-r/2),i.fromValues(t/2,-r/2),i.fromValues(t/2,r/2),i.fromValues(-t/2,r/2)],o=[i.fromValues(1,0),i.fromValues(0,1)];n.vertices=e;n.axes=o;n.type=f.BOX;u.call(this,n)}var i=n("../math/vec2"),f=n("./Shape"),u=n("./Convex");t.exports=r;r.prototype=new u;r.prototype.constructor=r;r.prototype.computeMomentOfInertia=function(n){var t=this.width,i=this.height;return n*(i*i+t*t)/12};r.prototype.updateBoundingRadius=function(){var n=this.width,t=this.height;this.boundingRadius=Math.sqrt(n*n+t*t)/2};var e=i.create(),o=i.create(),s=i.create(),h=i.create();r.prototype.computeAABB=function(n,t,i){n.setFromPoints(this.vertices,t,i,0)};r.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":40,"./Shape":45}],38:[function(n,t){function u(n){typeof arguments[0]=="number"&&typeof arguments[1]=="number"&&(n={length:arguments[0],radius:arguments[1]},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })"));n=n||{};this.length=n.length||1;this.radius=n.radius||1;n.type=f.CAPSULE;f.call(this,n)}var f=n("./Shape"),i=n("../math/vec2"),r;t.exports=u;u.prototype=new f;u.prototype.constructor=u;u.prototype.computeMomentOfInertia=function(n){var t=this.radius,i=this.length+t,r=t*2;return n*(r*r+i*i)/12};u.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2};u.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+this.radius*2*this.length};r=i.create();u.prototype.computeAABB=function(n,t,u){var f=this.radius;i.set(r,this.length/2,0);u!==0&&i.rotate(r,r,u);i.set(n.upperBound,Math.max(r[0]+f,-r[0]+f),Math.max(r[1]+f,-r[1]+f));i.set(n.lowerBound,Math.min(r[0]-f,-r[0]-f),Math.min(r[1]-f,-r[1]-f));i.add(n.lowerBound,n.lowerBound,t);i.add(n.upperBound,n.upperBound,t)};var e=i.create(),o=i.create(),s=i.create(),h=i.create(),c=i.fromValues(0,1);u.prototype.raycast=function(n,t,r,u){for(var tt,w,d,a=t.from,y=t.to,ot=t.direction,v=e,f=o,l=s,b=h,k=this.length/2,p=0;p<2;p++)if(tt=this.radius*(p*2-1),i.set(l,-k,tt),i.set(b,k,tt),i.toGlobalFrame(l,l,r,u),i.toGlobalFrame(b,b,r,u),w=i.getLineSegmentsIntersectionFraction(a,y,l,b),w>=0&&(i.rotate(f,c,u),i.scale(f,f,p*2-1),t.reportIntersection(n,w,f,-1),n.shouldStop(t)))return;for(d=Math.pow(this.radius,2)+Math.pow(k,2),p=0;p<2;p++){i.set(l,k*(p*2-1),0);i.toGlobalFrame(l,l,r,u);var rt=Math.pow(y[0]-a[0],2)+Math.pow(y[1]-a[1],2),it=2*((y[0]-a[0])*(a[0]-l[0])+(y[1]-a[1])*(a[1]-l[1])),et=Math.pow(a[0]-l[0],2)+Math.pow(a[1]-l[1],2)-Math.pow(this.radius,2),w=Math.pow(it,2)-4*rt*et;if(w<0)continue;else if(w===0){if(i.lerp(v,a,y,w),i.squaredDistance(v,r)>d&&(i.sub(f,v,l),i.normalize(f,f),t.reportIntersection(n,w,f,-1),n.shouldStop(t)))return}else{var ut=Math.sqrt(w),ft=1/(2*rt),g=(-it-ut)*ft,nt=(-it+ut)*ft;if(g>=0&&g<=1&&(i.lerp(v,a,y,g),i.squaredDistance(v,r)>d&&(i.sub(f,v,l),i.normalize(f,f),t.reportIntersection(n,g,f,-1),n.shouldStop(t))))return;if(nt>=0&&nt<=1&&(i.lerp(v,a,y,nt),i.squaredDistance(v,r)>d&&(i.sub(f,v,l),i.normalize(f,f),t.reportIntersection(n,nt,f,-1),n.shouldStop(t))))return}}}},{"../math/vec2":30,"./Shape":45}],39:[function(n,t){function r(n){typeof arguments[0]=="number"&&(n={radius:arguments[0]},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })"));n=n||{};this.radius=n.radius||1;n.type=u.CIRCLE;u.call(this,n)}var u=n("./Shape"),i=n("../math/vec2"),f,e;t.exports=r;r.prototype=new u;r.prototype.constructor=r;r.prototype.computeMomentOfInertia=function(n){var t=this.radius;return n*t*t/2};r.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius};r.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius};r.prototype.computeAABB=function(n,t){var r=this.radius;i.set(n.upperBound,r,r);i.set(n.lowerBound,-r,-r);t&&(i.add(n.lowerBound,n.lowerBound,t),i.add(n.upperBound,n.upperBound,t))};f=i.create();e=i.create();r.prototype.raycast=function(n,t,r){var o=t.from,s=t.to,b=this.radius,y=Math.pow(s[0]-o[0],2)+Math.pow(s[1]-o[1],2),v=2*((s[0]-o[0])*(o[0]-r[0])+(s[1]-o[1])*(o[1]-r[1])),k=Math.pow(o[0]-r[0],2)+Math.pow(o[1]-r[1],2)-Math.pow(b,2),c=Math.pow(v,2)-4*y*k,h=f,u=e;if(!(c<0))if(c===0)i.lerp(h,o,s,c),i.sub(u,h,r),i.normalize(u,u),t.reportIntersection(n,c,u,-1);else{var p=Math.sqrt(c),w=1/(2*y),l=(-v-p)*w,a=(-v+p)*w;if(l>=0&&l<=1&&(i.lerp(h,o,s,l),i.sub(u,h,r),i.normalize(u,u),t.reportIntersection(n,l,u,-1),n.shouldStop(t)))return;a>=0&&a<=1&&(i.lerp(h,o,s,a),i.sub(u,h,r),i.normalize(u,u),t.reportIntersection(n,a,u,-1))}}},{"../math/vec2":30,"./Shape":45}],40:[function(n,t){function r(n){var f,e,o,t;for(Array.isArray(arguments[0])&&(n={vertices:arguments[0],axes:arguments[1]},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")),n=n||{},this.vertices=[],f=n.vertices!==undefined?n.vertices:[],t=0;t<f.length;t++)e=i.create(),i.copy(e,f[t]),this.vertices.push(e);if(this.axes=[],n.axes)for(t=0;t<n.axes.length;t++)o=i.create(),i.copy(o,n.axes[t]),this.axes.push(o);else for(t=0;t<this.vertices.length;t++){var s=this.vertices[t],h=this.vertices[(t+1)%this.vertices.length],r=i.create();i.sub(r,h,s);i.rotate90cw(r,r);i.normalize(r,r);this.axes.push(r)}if(this.centerOfMass=i.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,n.type=u.CONVEX,u.call(this,n),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.");}var u=n("./Shape"),i=n("../math/vec2"),o=n("../math/polyk"),g=n("poly-decomp"),f,e;t.exports=r;r.prototype=new u;r.prototype.constructor=r;f=i.create();e=i.create();r.prototype.projectOntoLocalAxis=function(n,t){for(var h,r=null,u=null,s,e,n=f,o=0;o<this.vertices.length;o++)s=this.vertices[o],e=i.dot(s,n),(r===null||e>r)&&(r=e),(u===null||e<u)&&(u=e);u>r&&(h=u,u=r,r=h);i.set(t,u,r)};r.prototype.projectOntoWorldAxis=function(n,t,r,u){var f=e,o;this.projectOntoLocalAxis(n,u);r!==0?i.rotate(f,n,r):f=n;o=i.dot(t,f);i.set(u,u[0]+o,u[1]+o)};r.prototype.updateTriangles=function(){var i,r,t,n;for(this.triangles.length=0,i=[],n=0;n<this.vertices.length;n++)r=this.vertices[n],i.push(r[0],r[1]);for(t=o.Triangulate(i),n=0;n<t.length;n+=3){var u=t[n],f=t[n+1],e=t[n+2];this.triangles.push([u,f,e])}};var s=i.create(),h=i.create(),c=i.create(),l=i.create(),a=i.create(),v=i.create(),y=i.create(),p=i.create(),w=i.create();r.prototype.updateCenterOfMass=function(){var b=this.triangles,u=this.vertices,n=this.centerOfMass,k=s,it=w,d=c,g=l,nt=a,rt=v,ut=y,ft=p,tt=h,f,t,o;for(i.set(n,0,0),f=0,t=0;t!==b.length;t++){var e=b[t],d=u[e[0]],g=u[e[1]],nt=u[e[2]];i.centroid(k,d,g,nt);o=r.triangleArea(d,g,nt);f+=o;i.scale(tt,k,o);i.add(n,n,tt)}i.scale(n,n,1/f)};r.prototype.computeMomentOfInertia=function(n){for(var f=0,e=0,o=this.vertices.length,s=o-1,t=0;t<o;s=t,t++){var r=this.vertices[s],u=this.vertices[t],h=Math.abs(i.crossLength(r,u)),c=i.dot(u,u)+i.dot(u,r)+i.dot(r,r);f+=h*c;e+=h}return n/6*(f/e)};r.prototype.updateBoundingRadius=function(){for(var r,u=this.vertices,n=0,t=0;t!==u.length;t++)r=i.squaredLength(u[t]),r>n&&(n=r);this.boundingRadius=Math.sqrt(n)};r.triangleArea=function(n,t,i){return((t[0]-n[0])*(i[1]-n[1])-(i[0]-n[0])*(t[1]-n[1]))*.5};r.prototype.updateArea=function(){var i,n,t;for(this.updateTriangles(),this.area=0,i=this.triangles,n=this.vertices,t=0;t!==i.length;t++){var u=i[t],f=n[u[0]],e=n[u[1]],o=n[u[2]],s=r.triangleArea(f,e,o);this.area+=s}};r.prototype.computeAABB=function(n,t,i){n.setFromPoints(this.vertices,t,i,0)};var b=i.create(),k=i.create(),d=i.create();r.prototype.raycast=function(n,t,r,u){var h=b,c=k,f=d,o=this.vertices,s,e;for(i.toLocalFrame(h,t.from,r,u),i.toLocalFrame(c,t.to,r,u),s=o.length,e=0;e<s&&!n.shouldStop(t);e++){var l=o[e],a=o[(e+1)%s],v=i.getLineSegmentsIntersectionFraction(h,c,l,a);v>=0&&(i.sub(f,a,l),i.rotate(f,f,-Math.PI/2+u),i.normalize(f,f),t.reportIntersection(n,v,f,e))}}},{"../math/polyk":29,"../math/vec2":30,"./Shape":45,"poly-decomp":5}],41:[function(n,t){function r(n){if(Array.isArray(arguments[0])){if(n={heights:arguments[0]},typeof arguments[1]=="object")for(var t in arguments[1])n[t]=arguments[1][t];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}n=n||{};this.heights=n.heights?n.heights.slice(0):[];this.maxValue=n.maxValue||null;this.minValue=n.minValue||null;this.elementWidth=n.elementWidth||.1;(n.maxValue===undefined||n.minValue===undefined)&&this.updateMaxMinValues();n.type=f.HEIGHTFIELD;f.call(this,n)}var f=n("./Shape"),i=n("../math/vec2"),a=n("../utils/Utils"),u;t.exports=r;r.prototype=new f;r.prototype.constructor=r;r.prototype.updateMaxMinValues=function(){for(var n,t=this.heights,i=t[0],r=t[0],u=0;u!==t.length;u++)n=t[u],n>i&&(i=n),n<r&&(r=n);this.maxValue=i;this.minValue=r};r.prototype.computeMomentOfInertia=function(){return Number.MAX_VALUE};r.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};r.prototype.updateArea=function(){for(var t=this.heights,i=0,n=0;n<t.length-1;n++)i+=(t[n]+t[n+1])/2*this.elementWidth;this.area=i};u=[i.create(),i.create(),i.create(),i.create()];r.prototype.computeAABB=function(n,t,r){i.set(u[0],0,this.maxValue);i.set(u[1],this.elementWidth*this.heights.length,this.maxValue);i.set(u[2],this.elementWidth*this.heights.length,this.minValue);i.set(u[3],0,this.minValue);n.setFromPoints(u,t,r)};r.prototype.getLineSegment=function(n,t,r){var u=this.heights,f=this.elementWidth;i.set(n,r*f,u[r]);i.set(t,(r+1)*f,u[r+1])};r.prototype.getSegmentIndex=function(n){return Math.floor(n[0]/this.elementWidth)};r.prototype.getClampedSegmentIndex=function(n){var t=this.getSegmentIndex(n);return Math.min(this.heights.length,Math.max(t,0))};var e=i.create(),o=i.create(),s=i.create(),h=i.create(),c=i.create(),l=i.create(),v=i.fromValues(0,1);r.prototype.raycast=function(n,t,r,u){var nt=t.from,tt=t.to,it=t.direction,rt=e,f=o,p=s,w=h,b=c,k=l,a,v,g,y,d;for(i.toLocalFrame(b,nt,r,u),i.toLocalFrame(k,tt,r,u),a=this.getClampedSegmentIndex(b),v=this.getClampedSegmentIndex(k),a>v&&(g=a,a=v,v=g),y=0;y<this.heights.length-1;y++)if(this.getLineSegment(p,w,y),d=i.getLineSegmentsIntersectionFraction(b,k,p,w),d>=0&&(i.sub(f,w,p),i.rotate(f,f,u+Math.PI/2),i.normalize(f,f),t.reportIntersection(n,d,f,-1),n.shouldStop(t)))return}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],42:[function(n,t){function r(n){typeof arguments[0]=="number"&&(n={length:arguments[0]},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })"));n=n||{};this.length=n.length||1;n.type=f.LINE;f.call(this,n)}var f=n("./Shape"),i=n("../math/vec2"),u;t.exports=r;r.prototype=new f;r.prototype.constructor=r;r.prototype.computeMomentOfInertia=function(n){return n*Math.pow(this.length,2)/12};r.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};u=[i.create(),i.create()];r.prototype.computeAABB=function(n,t,r){var f=this.length/2;i.set(u[0],-f,0);i.set(u[1],f,0);n.setFromPoints(u,t,r,0)};var c=i.create(),e=i.create(),o=i.create(),s=i.create(),h=i.fromValues(0,1);r.prototype.raycast=function(n,t,r,u){var y=t.from,p=t.to,f=o,c=s,v=this.length/2,l,a;i.set(f,-v,0);i.set(c,v,0);i.toGlobalFrame(f,f,r,u);i.toGlobalFrame(c,c,r,u);l=i.getLineSegmentsIntersectionFraction(f,c,y,p);l>=0&&(a=e,i.rotate(a,h,u),t.reportIntersection(n,l,a,-1))}},{"../math/vec2":30,"./Shape":45}],43:[function(n,t){function i(n){n=n||{};n.type=r.PARTICLE;r.call(this,n)}var r=n("./Shape"),u=n("../math/vec2");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.computeMomentOfInertia=function(){return 0};i.prototype.updateBoundingRadius=function(){this.boundingRadius=0};i.prototype.computeAABB=function(n,t){u.copy(n.lowerBound,t);u.copy(n.upperBound,t)}},{"../math/vec2":30,"./Shape":45}],44:[function(n,t){function r(n){n=n||{};n.type=u.PLANE;u.call(this,n)}var u=n("./Shape"),i=n("../math/vec2"),c=n("../utils/Utils");t.exports=r;r.prototype=new u;r.prototype.constructor=r;r.prototype.computeMomentOfInertia=function(){return 0};r.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};r.prototype.computeAABB=function(n,t,r){var u=r%(2*Math.PI),s=i.set,f=1e7,e=n.lowerBound,o=n.upperBound;s(e,-f,-f);s(o,f,f);u===0?o[1]=0:u===Math.PI/2?e[0]=0:u===Math.PI?e[1]=0:u===3*Math.PI/2&&(o[0]=0)};r.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var f=i.create(),e=i.create(),o=i.create(),s=i.create(),h=i.create();r.prototype.raycast=function(n,t,r,u){var v=t.from,y=t.to,d=t.direction,p=f,g=e,nt=o,c=s,l=h,a,w,b,k;(i.set(c,0,1),i.rotate(c,c,u),i.sub(l,v,r),a=i.dot(l,c),i.sub(l,y,r),w=i.dot(l,c),a*w>0)||i.squaredDistance(v,y)<a*a||(b=i.dot(c,d),i.sub(p,v,r),k=-i.dot(c,p)/b/t.length,t.reportIntersection(n,k,c,-1))}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],45:[function(n,t){function i(n){n=n||{};this.body=null;this.position=r.fromValues(0,0);n.position&&r.copy(this.position,n.position);this.angle=n.angle||0;this.type=n.type||0;this.id=i.idCounter++;this.boundingRadius=0;this.collisionGroup=n.collisionGroup!==undefined?n.collisionGroup:1;this.collisionResponse=n.collisionResponse!==undefined?n.collisionResponse:!0;this.collisionMask=n.collisionMask!==undefined?n.collisionMask:1;this.material=n.material||null;this.area=0;this.sensor=n.sensor!==undefined?n.sensor:!1;this.type&&this.updateBoundingRadius();this.updateArea()}t.exports=i;var r=n("../math/vec2");i.idCounter=0;i.CIRCLE=1;i.PARTICLE=2;i.PLANE=4;i.CONVEX=8;i.LINE=16;i.BOX=32;i.CAPSULE=64;i.HEIGHTFIELD=128;i.prototype.computeMomentOfInertia=function(){};i.prototype.updateBoundingRadius=function(){};i.prototype.updateArea=function(){};i.prototype.computeAABB=function(){};i.prototype.raycast=function(){}},{"../math/vec2":30}],46:[function(n,t){function i(n){u.call(this,n,u.GS);n=n||{};this.iterations=n.iterations||10;this.tolerance=n.tolerance||1e-7;this.arrayStep=30;this.lambda=new r.ARRAY_TYPE(this.arrayStep);this.Bs=new r.ARRAY_TYPE(this.arrayStep);this.invCs=new r.ARRAY_TYPE(this.arrayStep);this.useZeroRHS=!1;this.frictionIterations=n.frictionIterations!==undefined?0:n.frictionIterations;this.usedIterations=0}function o(n){for(var t=n.length;t--;)n[t]=0}var f=n("../math/vec2"),u=n("./Solver"),r=n("../utils/Utils"),e=n("../equations/FrictionEquation");t.exports=i;i.prototype=new u;i.prototype.constructor=i;i.prototype.solve=function(n,t){var s,v,u,h,b,y,w,d,k;this.sortEquations();var l=0,et=this.iterations,rt=this.frictionIterations,a=this.equations,c=a.length,ut=Math.pow(this.tolerance*c,2),g=t.bodies,nt=t.bodies.length,ot=f.add,st=f.set,ft=this.useZeroRHS,p=this.lambda;if(this.usedIterations=0,c)for(u=0;u!==nt;u++)b=g[u],b.updateSolveMassProperties();p.length<c&&(p=this.lambda=new r.ARRAY_TYPE(c+this.arrayStep),this.Bs=new r.ARRAY_TYPE(c+this.arrayStep),this.invCs=new r.ARRAY_TYPE(c+this.arrayStep));o(p);var tt=this.invCs,it=this.Bs,p=this.lambda;for(u=0;u!==a.length;u++)s=a[u],(s.timeStep!==n||s.needsUpdate)&&(s.timeStep=n,s.update()),it[u]=s.computeB(s.a,s.b,n),tt[u]=s.computeInvC(s.epsilon);if(c!==0){for(u=0;u!==nt;u++)b=g[u],b.resetConstraintVelocity();if(rt){for(l=0;l!==rt;l++){for(v=0,h=0;h!==c;h++)s=a[h],k=i.iterateEquation(h,s,s.epsilon,it,tt,p,ft,n,l),v+=Math.abs(k);if(this.usedIterations++,v*v<=ut)break}for(i.updateMultipliers(a,p,1/n),h=0;h!==c;h++)if(y=a[h],y instanceof e){for(w=0,d=0;d!==y.contactEquations.length;d++)w+=y.contactEquations[d].multiplier;w*=y.frictionCoefficient/y.contactEquations.length;y.maxForce=w;y.minForce=-w}}for(l=0;l!==et;l++){for(v=0,h=0;h!==c;h++)s=a[h],k=i.iterateEquation(h,s,s.epsilon,it,tt,p,ft,n,l),v+=Math.abs(k);if(this.usedIterations++,v*v<=ut)break}for(u=0;u!==nt;u++)g[u].addConstraintVelocity();i.updateMultipliers(a,p,1/n)}};i.updateMultipliers=function(n,t,i){for(var r=n.length;r--;)n[r].multiplier=t[r]*i};i.iterateEquation=function(n,t,i,r,u,f,e,o){var l=r[n],y=u[n],h=f[n],p=t.computeGWlambda(),a=t.maxForce,v=t.minForce,s,c;return e&&(l=0),s=y*(l-p-i*h),c=h+s,c<v*o?s=v*o-h:c>a*o&&(s=a*o-h),f[n]+=s,t.addToWlambda(s),s}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":57,"./Solver":47}],47:[function(n,t){function i(n,t){n=n||{};u.call(this);this.type=t;this.equations=[];this.equationSortFunction=n.equationSortFunction||!1}var f=n("../utils/Utils"),u=n("../events/EventEmitter"),r;t.exports=i;i.prototype=new u;i.prototype.constructor=i;i.prototype.solve=function(){throw new Error("Solver.solve should be implemented by subclasses!");};r={bodies:[]};i.prototype.solveIsland=function(n,t){this.removeAllEquations();t.equations.length&&(this.addEquations(t.equations),r.bodies.length=0,t.getBodies(r.bodies),r.bodies.length&&this.solve(n,r))};i.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)};i.prototype.addEquation=function(n){n.enabled&&this.equations.push(n)};i.prototype.addEquations=function(n){for(var i,t=0,r=n.length;t!==r;t++)i=n[t],i.enabled&&this.equations.push(i)};i.prototype.removeEquation=function(n){var t=this.equations.indexOf(n);t!==-1&&this.equations.splice(t,1)};i.prototype.removeAllEquations=function(){this.equations.length=0};i.GS=1;i.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":57}],48:[function(n,t){function i(){r.apply(this,arguments)}var u=n("../equations/ContactEquation"),r=n("./Pool");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.create=function(){return new u};i.prototype.destroy=function(n){return n.bodyA=n.bodyB=null,this}},{"../equations/ContactEquation":21,"./Pool":55}],49:[function(n,t){function i(){r.apply(this,arguments)}var u=n("../equations/FrictionEquation"),r=n("./Pool");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.create=function(){return new u};i.prototype.destroy=function(n){return n.bodyA=n.bodyB=null,this}},{"../equations/FrictionEquation":23,"./Pool":55}],50:[function(n,t){function i(){r.apply(this,arguments)}var u=n("../world/IslandNode"),r=n("./Pool");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.create=function(){return new u};i.prototype.destroy=function(n){return n.reset(),this}},{"../world/IslandNode":60,"./Pool":55}],51:[function(n,t){function i(){r.apply(this,arguments)}var u=n("../world/Island"),r=n("./Pool");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.create=function(){return new u};i.prototype.destroy=function(n){return n.reset(),this}},{"../world/Island":58,"./Pool":55}],52:[function(n,t){function i(){this.overlappingShapesLastState=new r;this.overlappingShapesCurrentState=new r;this.recordPool=new u({size:16});this.tmpDict=new r;this.tmpArray1=[]}var r=n("./TupleDictionary"),f=n("./OverlapKeeperRecord"),u=n("./OverlapKeeperRecordPool"),e=n("./Utils");t.exports=i;i.prototype.tick=function(){for(var n=this.overlappingShapesLastState,t=this.overlappingShapesCurrentState,i=n.keys.length;i--;){var r=n.keys[i],u=n.getByKey(r),f=t.getByKey(r);u&&this.recordPool.release(u)}n.reset();n.copy(t);t.reset()};i.prototype.setOverlapping=function(n,t,i,r){var e=this.overlappingShapesLastState,f=this.overlappingShapesCurrentState,u;f.get(t.id,r.id)||(u=this.recordPool.get(),u.set(n,t,i,r),f.set(t.id,r.id,u))};i.prototype.getNewOverlaps=function(n){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,n)};i.prototype.getEndOverlaps=function(n){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,n)};i.prototype.bodiesAreOverlapping=function(n,t){for(var r=this.overlappingShapesCurrentState,u=r.keys.length,f,i;u--;)if(f=r.keys[u],i=r.data[f],i.bodyA===n&&i.bodyB===t||i.bodyA===t&&i.bodyB===n)return!0;return!1};i.prototype.getDiff=function(n,t,i){var i=i||[],s=n,u=t,f,r,e,o;for(i.length=0,f=u.keys.length;f--;){if(r=u.keys[f],e=u.data[r],!e)throw new Error("Key "+r+" had no data!");o=s.data[r];o||i.push(e)}return i};i.prototype.isNewOverlap=function(n,t){var i=n.id|0,r=t.id|0,u=this.overlappingShapesLastState,f=this.overlappingShapesCurrentState;return!u.get(i,r)&&!!f.get(i,r)};i.prototype.getNewBodyOverlaps=function(n){this.tmpArray1.length=0;var t=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(t,n)};i.prototype.getEndBodyOverlaps=function(n){this.tmpArray1.length=0;var t=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(t,n)};i.prototype.getBodyDiff=function(n,t){var r,u,i;for(t=t||[],r=this.tmpDict,u=n.length;u--;)i=n[u],r.set(i.bodyA.id|0,i.bodyB.id|0,i);for(u=r.keys.length;u--;)i=r.getByKey(r.keys[u]),i&&t.push(i.bodyA,i.bodyB);return r.reset(),t}},{"./OverlapKeeperRecord":53,"./OverlapKeeperRecordPool":54,"./TupleDictionary":56,"./Utils":57}],53:[function(n,t){function i(n,t,i,r){this.shapeA=t;this.shapeB=r;this.bodyA=n;this.bodyB=i}t.exports=i;i.prototype.set=function(n,t,r,u){i.call(this,n,t,r,u)}},{}],54:[function(n,t){function i(){r.apply(this,arguments)}var u=n("./OverlapKeeperRecord"),r=n("./Pool");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.create=function(){return new u};i.prototype.destroy=function(n){return n.bodyA=n.bodyB=n.shapeA=n.shapeB=null,this}},{"./OverlapKeeperRecord":53,"./Pool":55}],55:[function(n,t){function i(n){n=n||{};this.objects=[];n.size!==undefined&&this.resize(n.size)}t.exports=i;i.prototype.resize=function(n){for(var t=this.objects;t.length>n;)t.pop();while(t.length<n)t.push(this.create());return this};i.prototype.get=function(){var n=this.objects;return n.length?n.pop():this.create()};i.prototype.release=function(n){return this.destroy(n),this.objects.push(n),this}},{}],56:[function(n,t){function i(){this.data={};this.keys=[]}var r=n("./Utils");t.exports=i;i.prototype.getKey=function(n,t){return(n=n|0,t=t|0,(n|0)==(t|0))?-1:((n|0)>(t|0)?n<<16|t&65535:t<<16|n&65535)|0};i.prototype.getByKey=function(n){return n=n|0,this.data[n]};i.prototype.get=function(n,t){return this.data[this.getKey(n,t)]};i.prototype.set=function(n,t,i){if(!i)throw new Error("No data!");var r=this.getKey(n,t);return this.data[r]||this.keys.push(r),this.data[r]=i,r};i.prototype.reset=function(){for(var i=this.data,n=this.keys,t=n.length;t--;)delete i[n[t]];n.length=0};i.prototype.copy=function(n){var t,i;for(this.reset(),r.appendArray(this.keys,n.keys),t=n.keys.length;t--;)i=n.keys[t],this.data[i]=n.data[i]}},{"./Utils":57}],57:[function(n,t){function i(){}t.exports=i;i.appendArray=function(n,t){if(t.length<15e4)n.push.apply(n,t);else for(var i=0,r=t.length;i!==r;++i)n.push(t[i])};i.splice=function(n,t,i){i=i||1;for(var r=t,u=n.length-i;r<u;r++)n[r]=n[r+i];n.length=u};i.ARRAY_TYPE=typeof P2_ARRAY_TYPE!="undefined"?P2_ARRAY_TYPE:typeof Float32Array!="undefined"?Float32Array:Array;i.extend=function(n,t){for(var i in t)n[i]=t[i]};i.defaults=function(n,t){n=n||{};for(var i in t)i in n||(n[i]=t[i]);return n}},{}],58:[function(n,t){function r(){this.equations=[];this.bodies=[]}var u=n("../objects/Body"),i;t.exports=r;r.prototype.reset=function(){this.equations.length=this.bodies.length=0};i=[];r.prototype.getBodies=function(n){var u=n||[],f=this.equations,r,t;for(i.length=0,r=0;r!==f.length;r++)t=f[r],i.indexOf(t.bodyA.id)===-1&&(u.push(t.bodyA),i.push(t.bodyA.id)),i.indexOf(t.bodyB.id)===-1&&(u.push(t.bodyB),i.push(t.bodyB.id));return u};r.prototype.wantsToSleep=function(){for(var t,n=0;n<this.bodies.length;n++)if(t=this.bodies[n],t.type===u.DYNAMIC&&!t.wantsToSleep)return!1;return!0};r.prototype.sleep=function(){for(var t,n=0;n<this.bodies.length;n++)t=this.bodies[n],t.sleep();return!0}},{"../objects/Body":31}],59:[function(n,t){function i(){this.nodePool=new u({size:16});this.islandPool=new f({size:8});this.equations=[];this.islands=[];this.nodes=[];this.queue=[]}var e=n("../math/vec2"),o=n("./Island"),s=n("./IslandNode"),u=n("./../utils/IslandNodePool"),f=n("./../utils/IslandPool"),r=n("../objects/Body");t.exports=i;i.getUnvisitedNode=function(n){for(var t,u=n.length,i=0;i!==u;i++)if(t=n[i],!t.visited&&t.body.type===r.DYNAMIC)return t;return!1};i.prototype.visit=function(n,t,i){var f,r,u;for(t.push(n.body),f=n.equations.length,r=0;r!==f;r++)u=n.equations[r],i.indexOf(u)===-1&&i.push(u)};i.prototype.bfs=function(n,t,u){var f=this.queue,o,e;for(f.length=0,f.push(n),n.visited=!0,this.visit(n,t,u);f.length;)for(o=f.pop();e=i.getUnvisitedNode(o.neighbors);)e.visited=!0,this.visit(e,t,u),e.body.type===r.DYNAMIC&&f.push(e)};i.prototype.split=function(n){for(var f=n.bodies,r=this.nodes,a=this.equations,h,e,u,t,v,s;r.length;)this.nodePool.release(r.pop());for(t=0;t!==f.length;t++)h=this.nodePool.get(),h.body=f[t],r.push(h);for(e=0;e!==a.length;e++){var o=a[e],t=f.indexOf(o.bodyA),y=f.indexOf(o.bodyB),c=r[t],l=r[y];c.neighbors.push(l);l.neighbors.push(c);c.equations.push(o);l.equations.push(o)}for(u=this.islands,t=0;t<u.length;t++)this.islandPool.release(u[t]);for(u.length=0;v=i.getUnvisitedNode(r);)s=this.islandPool.get(),this.bfs(v,s.bodies,s.equations),u.push(s);return u}},{"../math/vec2":30,"../objects/Body":31,"./../utils/IslandNodePool":50,"./../utils/IslandPool":51,"./Island":58,"./IslandNode":60}],60:[function(n,t){function i(n){this.body=n;this.neighbors=[];this.equations=[];this.visited=!1}t.exports=i;i.prototype.reset=function(){this.equations.length=0;this.neighbors.length=0;this.visited=!1;this.body=null}},{}],61:[function(n,t){function r(n){a.apply(this);n=n||{};this.springs=[];this.bodies=[];this.disabledBodyCollisionPairs=[];this.solver=n.solver||new v;this.narrowphase=new tt(this);this.islandManager=new rt;this.gravity=i.fromValues(0,-9.78);n.gravity&&i.copy(this.gravity,n.gravity);this.frictionGravity=i.length(this.gravity)||10;this.useWorldGravityAsFrictionGravity=!0;this.useFrictionGravityOnZeroGravity=!0;this.broadphase=n.broadphase||new nt;this.broadphase.setWorld(this);this.constraints=[];this.defaultMaterial=new k;this.defaultContactMaterial=new d(this.defaultMaterial,this.defaultMaterial);this.lastTimeStep=1/60;this.applySpringForces=!0;this.applyDamping=!0;this.applyGravity=!0;this.solveConstraints=!0;this.contactMaterials=[];this.time=0;this.accumulator=0;this.stepping=!1;this.bodiesToBeRemoved=[];this.islandSplit=typeof n.islandSplit!="undefined"?!!n.islandSplit:!0;this.emitImpactEvent=!0;this._constraintIdCounter=0;this._bodyIdCounter=0;this.postStepEvent={type:"postStep"};this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",body:null};this.addSpringEvent={type:"addSpring",spring:null};this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null};this.postBroadphaseEvent={type:"postBroadphase",pairs:null};this.sleepMode=r.NO_SLEEPING;this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]};this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null};this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null};this.overlappingShapesLastState={keys:[]};this.overlappingShapesCurrentState={keys:[]};this.overlapKeeper=new it}var v=n("../solver/GSSolver"),ct=n("../solver/Solver"),lt=n("../collision/Ray"),i=n("../math/vec2"),y=n("../shapes/Circle"),p=n("../shapes/Convex"),at=n("../shapes/Line"),w=n("../shapes/Plane"),b=n("../shapes/Capsule"),l=n("../shapes/Particle"),a=n("../events/EventEmitter"),u=n("../objects/Body"),vt=n("../shapes/Shape"),yt=n("../objects/LinearSpring"),k=n("../material/Material"),d=n("../material/ContactMaterial"),pt=n("../constraints/DistanceConstraint"),wt=n("../constraints/Constraint"),bt=n("../constraints/LockConstraint"),kt=n("../constraints/RevoluteConstraint"),dt=n("../constraints/PrismaticConstraint"),gt=n("../constraints/GearConstraint"),ni=n("../../package.json"),ti=n("../collision/Broadphase"),g=n("../collision/AABB"),nt=n("../collision/SAPBroadphase"),tt=n("../collision/Narrowphase"),f=n("../utils/Utils"),it=n("../utils/OverlapKeeper"),rt=n("./IslandManager"),ii=n("../objects/RotationalSpring"),s,c,h;t.exports=r;r.prototype=new Object(a.prototype);r.prototype.constructor=r;r.NO_SLEEPING=1;r.BODY_SLEEPING=2;r.ISLAND_SLEEPING=4;r.prototype.addConstraint=function(n){this.constraints.push(n)};r.prototype.addContactMaterial=function(n){this.contactMaterials.push(n)};r.prototype.removeContactMaterial=function(n){var t=this.contactMaterials.indexOf(n);t!==-1&&f.splice(this.contactMaterials,t,1)};r.prototype.getContactMaterial=function(n,t){for(var i,u=this.contactMaterials,r=0,f=u.length;r!==f;r++)if(i=u[r],i.materialA.id===n.id&&i.materialB.id===t.id||i.materialA.id===t.id&&i.materialB.id===n.id)return i;return!1};r.prototype.removeConstraint=function(n){var t=this.constraints.indexOf(n);t!==-1&&f.splice(this.constraints,t,1)};var ri=i.create(),ui=i.create(),fi=i.create(),ei=i.create(),ut=i.create(),ft=i.create(),et=i.create(),e=i.fromValues(0,0),o=i.fromValues(0,0),oi=i.fromValues(0,0),si=i.fromValues(0,0);r.prototype.step=function(n,t,r){var e,o,f,u;if(r=r||10,t=t||0,t===0)this.internalStep(n),this.time+=n;else{for(this.accumulator+=t,e=0;this.accumulator>=n&&e<r;)this.internalStep(n),this.time+=n,this.accumulator-=n,e++;for(o=this.accumulator%n/n,f=0;f!==this.bodies.length;f++)u=this.bodies[f],i.lerp(u.interpolatedPosition,u.previousPosition,u.position,o),u.interpolatedAngle=u.previousAngle+o*(u.angle-u.previousAngle)}};s=[];r.prototype.internalStep=function(n){var pt,wt,dt,c,e,g,nt,o,gt,lt,at,vt,ni,ti,bt,it,p,ct,rt,y,tt,w,b,ot,yt,t;this.stepping=!0;var ai=this,ri=this.springs.length,ui=this.springs,l=this.bodies,fi=this.gravity,k=this.solver,a=this.bodies.length,ei=this.broadphase,h=this.narrowphase,d=this.constraints,vi=ut,yi=ft,kt=et,pi=i.scale,oi=i.add,wi=i.rotate,v=this.islandManager;if(this.overlapKeeper.tick(),this.lastTimeStep=n,this.useWorldGravityAsFrictionGravity&&(pt=i.length(this.gravity),pt===0&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=pt)),this.applyGravity)for(t=0;t!==a;t++)(c=l[t],wt=c.force,c.type===u.DYNAMIC&&c.sleepState!==u.SLEEPING)&&(i.scale(kt,fi,c.mass*c.gravityScale),oi(wt,wt,kt));if(this.applySpringForces)for(t=0;t!==ri;t++)dt=ui[t],dt.applyForce();if(this.applyDamping)for(t=0;t!==a;t++)c=l[t],c.type===u.DYNAMIC&&c.applyDamping(n);for(e=ei.getCollisionPairs(this),g=this.disabledBodyCollisionPairs,t=g.length-2;t>=0;t-=2)for(o=e.length-2;o>=0;o-=2)(g[t]===e[o]&&g[t+1]===e[o+1]||g[t+1]===e[o]&&g[t]===e[o+1])&&e.splice(o,2);for(y=d.length,t=0;t!==y;t++)if(nt=d[t],!nt.collideConnected)for(o=e.length-2;o>=0;o-=2)(nt.bodyA===e[o]&&nt.bodyB===e[o+1]||nt.bodyB===e[o]&&nt.bodyA===e[o+1])&&e.splice(o,2);for(this.postBroadphaseEvent.pairs=e,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,h.reset(this),t=0,gt=e.length;t!==gt;t+=2)for(lt=e[t],at=e[t+1],vt=0,ni=lt.shapes.length;vt!==ni;vt++){var st=lt.shapes[vt],si=st.position,hi=st.angle;for(p=0,ti=at.shapes.length;p!==ti;p++){var ht=at.shapes[p],ci=ht.position,li=ht.angle,ii=this.defaultContactMaterial;st.material&&ht.material&&(bt=this.getContactMaterial(st.material,ht.material),bt&&(ii=bt));this.runNarrowphase(h,lt,st,si,hi,at,ht,ci,li,ii,this.frictionGravity)}}for(t=0;t!==a;t++)tt=l[t],tt._wakeUpAfterNarrowphase&&(tt.wakeUp(),tt._wakeUpAfterNarrowphase=!1);if(this.has("endContact")){for(this.overlapKeeper.getEndOverlaps(s),it=this.endContactEvent,p=s.length;p--;)ct=s[p],it.shapeA=ct.shapeA,it.shapeB=ct.shapeB,it.bodyA=ct.bodyA,it.bodyB=ct.bodyB,this.emit(it);s.length=0}for(rt=this.preSolveEvent,rt.contactEquations=h.contactEquations,rt.frictionEquations=h.frictionEquations,this.emit(rt),rt.contactEquations=rt.frictionEquations=null,y=d.length,t=0;t!==y;t++)d[t].update();if(h.contactEquations.length||h.frictionEquations.length||y)if(this.islandSplit){for(v.equations.length=0,f.appendArray(v.equations,h.contactEquations),f.appendArray(v.equations,h.frictionEquations),t=0;t!==y;t++)f.appendArray(v.equations,d[t].equations);for(v.split(this),t=0;t!==v.islands.length;t++)ot=v.islands[t],ot.equations.length&&k.solveIsland(n,ot)}else{for(k.addEquations(h.contactEquations),k.addEquations(h.frictionEquations),t=0;t!==y;t++)k.addEquations(d[t].equations);this.solveConstraints&&k.solve(n,this);k.removeAllEquations()}for(t=0;t!==a;t++)tt=l[t],tt.integrate(n);for(t=0;t!==a;t++)l[t].setZeroForce();if(this.emitImpactEvent&&this.has("impact"))for(w=this.impactEvent,t=0;t!==h.contactEquations.length;t++)b=h.contactEquations[t],b.firstImpact&&(w.bodyA=b.bodyA,w.bodyB=b.bodyB,w.shapeA=b.shapeA,w.shapeB=b.shapeB,w.contactEquation=b,this.emit(w));if(this.sleepMode===r.BODY_SLEEPING)for(t=0;t!==a;t++)l[t].sleepTick(this.time,!1,n);else if(this.sleepMode===r.ISLAND_SLEEPING&&this.islandSplit){for(t=0;t!==a;t++)l[t].sleepTick(this.time,!0,n);for(t=0;t<this.islandManager.islands.length;t++)ot=this.islandManager.islands[t],ot.wantsToSleep()&&ot.sleep()}for(this.stepping=!1,yt=this.bodiesToBeRemoved,t=0;t!==yt.length;t++)this.removeBody(yt[t]);yt.length=0;this.emit(this.postStepEvent)};r.prototype.runNarrowphase=function(n,t,r,f,s,h,c,l,a,v,y){var g,nt,rt,k,b,tt,ut,d,ft,et,ot,st,p,w,it;if((r.collisionGroup&c.collisionMask)!=0&&(c.collisionGroup&r.collisionMask)!=0&&(i.rotate(e,f,t.angle),i.rotate(o,l,h.angle),i.add(e,e,t.position),i.add(o,o,h.position),g=s+t.angle,nt=a+h.angle,n.enableFriction=v.friction>0,n.frictionCoefficient=v.friction,rt=t.type===u.STATIC||t.type===u.KINEMATIC?h.mass:h.type===u.STATIC||h.type===u.KINEMATIC?t.mass:t.mass*h.mass/(t.mass+h.mass),n.slipForce=v.friction*y*rt,n.restitution=v.restitution,n.surfaceVelocity=v.surfaceVelocity,n.frictionStiffness=v.frictionStiffness,n.frictionRelaxation=v.frictionRelaxation,n.stiffness=v.stiffness,n.relaxation=v.relaxation,n.contactSkinSize=v.contactSkinSize,n.enabledEquations=t.collisionResponse&&h.collisionResponse&&r.collisionResponse&&c.collisionResponse,k=n[r.type|c.type],b=0,k&&(tt=r.sensor||c.sensor,ut=n.frictionEquations.length,b=r.type<c.type?k.call(n,t,r,e,g,h,c,o,nt,tt):k.call(n,h,c,o,nt,t,r,e,g,tt),d=n.frictionEquations.length-ut,b))){if(t.allowSleep&&t.type===u.DYNAMIC&&t.sleepState===u.SLEEPING&&h.sleepState===u.AWAKE&&h.type!==u.STATIC&&(ft=i.squaredLength(h.velocity)+Math.pow(h.angularVelocity,2),et=Math.pow(h.sleepSpeedLimit,2),ft>=et*2&&(t._wakeUpAfterNarrowphase=!0)),h.allowSleep&&h.type===u.DYNAMIC&&h.sleepState===u.SLEEPING&&t.sleepState===u.AWAKE&&t.type!==u.STATIC&&(ot=i.squaredLength(t.velocity)+Math.pow(t.angularVelocity,2),st=Math.pow(t.sleepSpeedLimit,2),ot>=st*2&&(h._wakeUpAfterNarrowphase=!0)),this.overlapKeeper.setOverlapping(t,r,h,c),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(r,c)){if(p=this.beginContactEvent,p.shapeA=r,p.shapeB=c,p.bodyA=t,p.bodyB=h,p.contactEquations.length=0,typeof b=="number")for(w=n.contactEquations.length-b;w<n.contactEquations.length;w++)p.contactEquations.push(n.contactEquations[w]);this.emit(p)}if(typeof b=="number"&&d>1)for(w=n.frictionEquations.length-d;w<n.frictionEquations.length;w++)it=n.frictionEquations[w],it.setSlipForce(it.getSlipForce()/d)}};r.prototype.addSpring=function(n){this.springs.push(n);var t=this.addSpringEvent;t.spring=n;this.emit(t);t.spring=null};r.prototype.removeSpring=function(n){var t=this.springs.indexOf(n);t!==-1&&f.splice(this.springs,t,1)};r.prototype.addBody=function(n){if(this.bodies.indexOf(n)===-1){this.bodies.push(n);n.world=this;var t=this.addBodyEvent;t.body=n;this.emit(t);t.body=null}};r.prototype.removeBody=function(n){if(this.stepping)this.bodiesToBeRemoved.push(n);else{n.world=null;var t=this.bodies.indexOf(n);t!==-1&&(f.splice(this.bodies,t,1),this.removeBodyEvent.body=n,n.resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null)}};r.prototype.getBodyById=function(n){for(var i,r=this.bodies,t=0;t<r.length;t++)if(i=r[t],i.id===n)return i;return!1};r.prototype.disableBodyCollision=function(n,t){this.disabledBodyCollisionPairs.push(n,t)};r.prototype.enableBodyCollision=function(n,t){for(var r=this.disabledBodyCollisionPairs,i=0;i<r.length;i+=2)if(r[i]===n&&r[i+1]===t||r[i+1]===n&&r[i]===t){r.splice(i,2);return}};r.prototype.clear=function(){var t,i,u,f,n;for(this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations(),t=this.constraints,n=t.length-1;n>=0;n--)this.removeConstraint(t[n]);for(i=this.bodies,n=i.length-1;n>=0;n--)this.removeBody(i[n]);for(u=this.springs,n=u.length-1;n>=0;n--)this.removeSpring(u[n]);for(f=this.contactMaterials,n=f.length-1;n>=0;n--)this.removeContactMaterial(f[n]);r.apply(this)};var ot=i.create(),st=i.fromValues(0,0),ht=i.fromValues(0,0);r.prototype.hitTest=function(n,t,r){var c,nt,d,tt,e,g,it,f,a;r=r||0;var s=new u({position:n}),h=new l,v=n,k=0,o=ot,ut=st,rt=ht;for(s.addShape(h),c=this.narrowphase,nt=[],d=0,tt=t.length;d!==tt;d++)for(e=t[d],g=0,it=e.shapes.length;g!==it;g++)f=e.shapes[g],i.rotate(o,f.position,e.angle),i.add(o,o,e.position),a=f.angle+e.angle,(f instanceof y&&c.circleParticle(e,f,o,a,s,h,v,k,!0)||f instanceof p&&c.particleConvex(s,h,v,k,e,f,o,a,!0)||f instanceof w&&c.particlePlane(s,h,v,k,e,f,o,a,!0)||f instanceof b&&c.particleCapsule(s,h,v,k,e,f,o,a,!0)||f instanceof l&&i.squaredLength(i.sub(rt,o,n))<r*r)&&nt.push(e);return nt};r.prototype.setGlobalStiffness=function(n){for(var r,u,f,t,e=this.constraints,i=0;i!==e.length;i++)for(t=e[i],r=0;r!==t.equations.length;r++)u=t.equations[r],u.stiffness=n,u.needsUpdate=!0;for(f=this.contactMaterials,i=0;i!==f.length;i++)t=f[i],t.stiffness=t.frictionStiffness=n;t=this.defaultContactMaterial;t.stiffness=t.frictionStiffness=n};r.prototype.setGlobalRelaxation=function(n){for(var r,u,t,i=0;i!==this.constraints.length;i++)for(t=this.constraints[i],r=0;r!==t.equations.length;r++)u=t.equations[r],u.relaxation=n,u.needsUpdate=!0;for(i=0;i!==this.contactMaterials.length;i++)t=this.contactMaterials[i],t.relaxation=t.frictionRelaxation=n;t=this.defaultContactMaterial;t.relaxation=t.frictionRelaxation=n};c=new g;h=[];r.prototype.raycast=function(n,t){return t.getAABB(c),this.broadphase.aabbQuery(this,c,h),t.intersectBodies(n,h),h.length=0,n.hasHit()}},{"../../package.json":6,"../collision/AABB":7,"../collision/Broadphase":8,"../collision/Narrowphase":10,"../collision/Ray":11,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/LinearSpring":32,"../objects/RotationalSpring":33,"../shapes/Capsule":38,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Line":42,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":52,"../utils/Utils":57,"./IslandManager":59}]},{},[36])(36)}),function(){function r(t,i,r,u){var f=t.createTexture();return t.bindTexture(t.TEXTURE_2D,f),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,u===n.scaleModes.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,u===n.scaleModes.LINEAR?t.LINEAR:t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,i,r,0,t.RGBA,t.UNSIGNED_BYTE,null),f}function u(n,t,u,f,e){var o=n.createFramebuffer(),c=n.createRenderbuffer(),s=null,h=0;return n.activeTexture(n.TEXTURE0+e),n.bindFramebuffer(n.FRAMEBUFFER,o),n.bindRenderbuffer(n.RENDERBUFFER,c),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,this.renderBuffer),s=r(n,t,u,f),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0),h=n.checkFramebufferStatus(n.FRAMEBUFFER),h!==n.FRAMEBUFFER_COMPLETE&&console.error("Incomplete GL framebuffer. ",i[h]),o.width=t,o.height=u,o.targetTexture=s,o.renderBuffer=c,o}var t=this,n=n||{},i;
/**
* @author       Mat Groves http://matgroves.com @Doormat23
* @author       Richard Davey <rich@photonstorm.com>
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
return n.DisplayObject=function(){this.position=new n.Point(0,0);this.scale=new n.Point(1,1);this.pivot=new n.Point(0,0);this.rotation=0;this.alpha=1;this.visible=!0;this.hitArea=null;this.renderable=!1;this.parent=null;this.worldAlpha=1;this.worldTransform=new Phaser.Matrix;this.worldPosition=new n.Point(0,0);this.worldScale=new n.Point(1,1);this.worldRotation=0;this.filterArea=null;this._sr=0;this._cr=1;this._bounds=new n.Rectangle(0,0,0,0);this._currentBounds=null;this._mask=null;this._cacheAsBitmap=!1;this._cacheIsDirty=!1},n.DisplayObject.prototype={constructor:n.DisplayObject,destroy:function(){if(this.children){for(var n=this.children.length;n--;)this.children[n].destroy();this.children=[]}this.hitArea=null;this.parent=null;this.worldTransform=null;this.filterArea=null;this.renderable=!1;this._bounds=null;this._currentBounds=null;this._mask=null;this._destroyCachedSprite();this._destroyTintedTexture()},updateTransform:function(n){var h,t,i,r,e,f,u,o,s,a,c,l;return!n&&!this.parent&&!this.game?this:(h=this.parent,n?h=n:this.parent||(h=this.game.world),t=h.worldTransform,i=this.worldTransform,this.rotation%Phaser.Math.PI2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),r=this._cr*this.scale.x,e=this._sr*this.scale.x,f=-this._sr*this.scale.y,u=this._cr*this.scale.y,o=this.position.x,s=this.position.y,(this.pivot.x||this.pivot.y)&&(o-=this.pivot.x*r+this.pivot.y*f,s-=this.pivot.x*e+this.pivot.y*u),i.a=r*t.a+e*t.c,i.b=r*t.b+e*t.d,i.c=f*t.a+u*t.c,i.d=f*t.b+u*t.d,i.tx=o*t.a+s*t.c+t.tx,i.ty=o*t.b+s*t.d+t.ty):(r=this.scale.x,e=0,f=0,u=this.scale.y,o=this.position.x-this.pivot.x*r,s=this.position.y-this.pivot.y*u,i.a=r*t.a,i.b=r*t.b,i.c=u*t.c,i.d=u*t.d,i.tx=o*t.a+s*t.c+t.tx,i.ty=o*t.b+s*t.d+t.ty),r=i.a,e=i.b,f=i.c,u=i.d,a=r*u-e*f,r||e?(c=Math.sqrt(r*r+e*e),this.worldRotation=e>0?Math.acos(r/c):-Math.acos(r/c),this.worldScale.x=c,this.worldScale.y=a/c):f||u?(l=Math.sqrt(f*f+u*u),this.worldRotation=Phaser.Math.HALF_PI-(u>0?Math.acos(-f/l):-Math.acos(f/l)),this.worldScale.x=a/l,this.worldScale.y=l):(this.worldScale.x=0,this.worldScale.y=0),this.worldAlpha=this.alpha*h.worldAlpha,this.worldPosition.x=i.tx,this.worldPosition.y=i.ty,this._currentBounds=null,this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,i,t),this)},preUpdate:function(){},generateTexture:function(t,i,r){var u=this.getLocalBounds(),f=new Phaser.RenderTexture(this.game,u.width|0,u.height|0,r,i,t);return n.DisplayObject._tempMatrix.tx=-u.x,n.DisplayObject._tempMatrix.ty=-u.y,f.render(this,n.DisplayObject._tempMatrix),f},updateCache:function(){return this._generateCachedSprite(),this},toGlobal:function(n){return this.updateTransform(),this.worldTransform.apply(n)},toLocal:function(n,t){return t&&(n=t.toGlobal(n)),this.updateTransform(),this.worldTransform.applyInverse(n)},_renderCachedSprite:function(t){this._cachedSprite.worldAlpha=this.worldAlpha;t.gl?n.Sprite.prototype._renderWebGL.call(this._cachedSprite,t):n.Sprite.prototype._renderCanvas.call(this._cachedSprite,t)},_generateCachedSprite:function(){var t,i,u,r;this._cacheAsBitmap=!1;t=this.getLocalBounds();t.width=Math.max(1,Math.ceil(t.width));t.height=Math.max(1,Math.ceil(t.height));this.updateTransform();this._cachedSprite?this._cachedSprite.texture.resize(t.width,t.height):(i=0,this.texture&&this.texture.baseTexture&&n._enableMultiTextureToggle&&(i=this.texture.baseTexture.textureIndex),u=new Phaser.RenderTexture(this.game,t.width,t.height,undefined,undefined,undefined,undefined,i),this._cachedSprite=new n.Sprite(u),this._cachedSprite.worldTransform=this.worldTransform);r=this._filters;this._filters=null;this._cachedSprite.filters=r;n.DisplayObject._tempMatrix.tx=-t.x;n.DisplayObject._tempMatrix.ty=-t.y;this._cachedSprite.texture.render(this,n.DisplayObject._tempMatrix,!0);this._cachedSprite.anchor.x=-(t.x/t.width);this._cachedSprite.anchor.y=-(t.y/t.height);this._filters=r;this._cacheAsBitmap=!0},_destroyCachedSprite:function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)},_destroyTintedTexture:function(){this.tintedTexture&&(Phaser.CanvasPool.removeByCanvas(this.tintedTexture),this.tintedTexture=null)}},n.DisplayObject.prototype.displayObjectUpdateTransform=n.DisplayObject.prototype.updateTransform,Object.defineProperties(n.DisplayObject.prototype,{x:{get:function(){return this.position.x},set:function(n){this.position.x=n}},y:{get:function(){return this.position.y},set:function(n){this.position.y=n}},worldVisible:{get:function(){if(this.visible){var n=this.parent;if(n){do{if(!n.visible)return!1;n=n.parent}while(n)}else return this.visible;return!0}return!1}},mask:{get:function(){return this._mask},set:function(n){this._mask&&(this._mask.isMask=!1);this._mask=n;n&&(this._mask.isMask=!0)}},filters:{get:function(){return this._filters},set:function(t){var u,i,f,r;if(Array.isArray(t)){for(u=[],i=0;i<t.length;i++)for(f=t[i].passes,r=0;r<f.length;r++)u.push(f[r]);this._filterBlock={target:this,filterPasses:u}}this._filters=t;this.blendMode&&this.blendMode===n.blendModes.MULTIPLY&&(this.blendMode=n.blendModes.NORMAL)}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(n){this._cacheAsBitmap!==n&&(n?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=n)}}}),n.DisplayObjectContainer=function(){n.DisplayObject.call(this);this.children=[];this.ignoreChildInput=!1},n.DisplayObjectContainer.prototype=Object.create(n.DisplayObject.prototype),n.DisplayObjectContainer.prototype.constructor=n.DisplayObjectContainer,n.DisplayObjectContainer.prototype.addChild=function(n){return this.addChildAt(n,this.children.length)},n.DisplayObjectContainer.prototype.addChildAt=function(n,t){if(t>=0&&t<=this.children.length)return n.parent&&n.parent.removeChild(n),n.parent=this,this.children.splice(t,0,n),n;throw new Error(n+"addChildAt: The index "+t+" supplied is out of bounds "+this.children.length);},n.DisplayObjectContainer.prototype.swapChildren=function(n,t){if(n!==t){var i=this.getChildIndex(n),r=this.getChildIndex(t);if(i<0||r<0)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[i]=t;this.children[r]=n}},n.DisplayObjectContainer.prototype.getChildIndex=function(n){var t=this.children.indexOf(n);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t},n.DisplayObjectContainer.prototype.setChildIndex=function(n,t){if(t<0||t>=this.children.length)throw new Error("The supplied index is out of bounds");var i=this.getChildIndex(n);this.children.splice(i,1);this.children.splice(t,0,n)},n.DisplayObjectContainer.prototype.getChildAt=function(n){if(n<0||n>=this.children.length)throw new Error("getChildAt: Supplied index "+n+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[n]},n.DisplayObjectContainer.prototype.removeChild=function(n){var t=this.children.indexOf(n);if(t!==-1)return this.removeChildAt(t)},n.DisplayObjectContainer.prototype.removeChildAt=function(n){var t=this.getChildAt(n);return t&&(t.parent=undefined,this.children.splice(n,1)),t},n.DisplayObjectContainer.prototype.bringChildToTop=function(n){if(n.parent===this)return this.setChildIndex(n,this.children.length-1)},n.DisplayObjectContainer.prototype.sendChildToBack=function(n){if(n.parent===this)return this.setChildIndex(n,0)},n.DisplayObjectContainer.prototype.removeChildren=function(n,t){var i,r,u,f;if(n===undefined&&(n=0),t===undefined&&(t=this.children.length),i=t-n,i>0&&i<=t){for(r=this.children.splice(n,i),u=0;u<r.length;u++)f=r[u],f.parent=undefined;return r}if(i===0&&this.children.length===0)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range");},n.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var n=0;n<this.children.length;n++)this.children[n].updateTransform()},n.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=n.DisplayObjectContainer.prototype.updateTransform,n.DisplayObjectContainer.prototype.getBounds=function(t){var ft=t&&t instanceof n.DisplayObject,ht=!0,o,ct,at,u,st;if(ft?ht=t instanceof n.DisplayObjectContainer?t.contains(this):!1:t=this,ft)for(ct=t.worldTransform,t.worldTransform=Phaser.identityMatrix,o=0;o<t.children.length;o++)t.children[o].updateTransform();var i=Infinity,r=Infinity,f=-Infinity,e=-Infinity,s,et,ot,lt=!1;for(o=0;o<this.children.length;o++)(at=this.children[o],at.visible)&&(lt=!0,s=this.children[o].getBounds(),i=i<s.x?i:s.x,r=r<s.y?r:s.y,et=s.width+s.x,ot=s.height+s.y,f=f>et?f:et,e=e>ot?e:ot);if(u=this._bounds,!lt){u=new n.Rectangle;var c=u.x,l=u.width+u.x,a=u.y,v=u.height+u.y,h=this.worldTransform,y=h.a,p=h.b,w=h.c,b=h.d,k=h.tx,d=h.ty,vt=y*l+w*v+k,yt=b*v+p*l+d,g=y*c+w*v+k,nt=b*v+p*c+d,tt=y*c+w*a+k,it=b*a+p*c+d,rt=y*l+w*a+k,ut=b*a+p*l+d;f=vt;e=yt;i=vt;r=yt;i=g<i?g:i;i=tt<i?tt:i;i=rt<i?rt:i;r=nt<r?nt:r;r=it<r?it:r;r=ut<r?ut:r;f=g>f?g:f;f=tt>f?tt:f;f=rt>f?rt:f;e=nt>e?nt:e;e=it>e?it:e;e=ut>e?ut:e}if(u.x=i,u.y=r,u.width=f-i,u.height=e-r,ft)for(t.worldTransform=ct,o=0;o<t.children.length;o++)t.children[o].updateTransform();return ht||(st=t.getBounds(),u.x-=st.x,u.y-=st.y),u},n.DisplayObjectContainer.prototype.getLocalBounds=function(){return this.getBounds(this)},n.DisplayObjectContainer.prototype.contains=function(n){return n?n===this?!0:this.contains(n.parent):!1},n.DisplayObjectContainer.prototype._renderWebGL=function(n){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap){this._renderCachedSprite(n);return}var t;if(this._mask||this._filters){for(this._filters&&(n.spriteBatch.flush(),n.filterManager.pushFilter(this._filterBlock)),this._mask&&(n.spriteBatch.stop(),n.maskManager.pushMask(this.mask,n),n.spriteBatch.start()),t=0;t<this.children.length;t++)this.children[t]._renderWebGL(n);n.spriteBatch.stop();this._mask&&n.maskManager.popMask(this._mask,n);this._filters&&n.filterManager.popFilter();n.spriteBatch.start()}else for(t=0;t<this.children.length;t++)this.children[t]._renderWebGL(n)}},n.DisplayObjectContainer.prototype._renderCanvas=function(n){if(this.visible!==!1&&this.alpha!==0){if(this._cacheAsBitmap){this._renderCachedSprite(n);return}this._mask&&n.maskManager.pushMask(this._mask,n);for(var t=0;t<this.children.length;t++)this.children[t]._renderCanvas(n);this._mask&&n.maskManager.popMask(n)}},Object.defineProperty(n.DisplayObjectContainer.prototype,"width",{get:function(){return this.getLocalBounds().width*this.scale.x},set:function(n){var t=this.getLocalBounds().width;this.scale.x=t!==0?n/t:1;this._width=n}}),Object.defineProperty(n.DisplayObjectContainer.prototype,"height",{get:function(){return this.getLocalBounds().height*this.scale.y},set:function(n){var t=this.getLocalBounds().height;this.scale.y=t!==0?n/t:1;this._height=n}}),n.Sprite=function(t){n.DisplayObjectContainer.call(this);this.anchor=new n.Point(n.Sprite.defaultAnchor.x,n.Sprite.defaultAnchor.y);this.texture=t||n.Texture.emptyTexture;this._width=0;this._height=0;this.tint=16777215;this.cachedTint=-1;this.tintedTexture=null;this.blendMode=n.blendModes.NORMAL;this.shader=null;this.exists=!0;this.texture.baseTexture.hasLoaded&&this.onTextureUpdate();this.renderable=!0},n.Sprite.defaultAnchor={x:0,y:0},n.Sprite.prototype=Object.create(n.DisplayObjectContainer.prototype),n.Sprite.prototype.constructor=n.Sprite,Object.defineProperty(n.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(n){this.scale.x=n/this.texture.frame.width;this._width=n}}),Object.defineProperty(n.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(n){this.scale.y=n/this.texture.frame.height;this._height=n}}),n.Sprite.prototype.setTexture=function(n,t){t&&this.texture.baseTexture.destroy();this.texture.baseTexture.skipRender=!1;this.texture=n;this.texture.valid=!0;this.cachedTint=-1},n.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width);this._height&&(this.scale.y=this._height/this.texture.frame.height)},n.Sprite.prototype.getBounds=function(n){var ft=this.texture.frame.width,et=this.texture.frame.height,o=ft*(1-this.anchor.x),s=ft*-this.anchor.x,h=et*(1-this.anchor.y),c=et*-this.anchor.y,a=n||this.worldTransform,f=a.a,p=a.b,w=a.c,e=a.d,v=a.tx,y=a.ty,r=-Infinity,u=-Infinity,t=Infinity,i=Infinity,b,l;if(p===0&&w===0)f<0&&(f*=-1,b=o,o=-s,s=-b),e<0&&(e*=-1,b=h,h=-c,c=-b),t=f*s+v,r=f*o+v,i=e*c+y,u=e*h+y;else{var k=f*s+w*c+v,d=e*c+p*s+y,g=f*o+w*c+v,nt=e*c+p*o+y,tt=f*o+w*h+v,it=e*h+p*o+y,rt=f*s+w*h+v,ut=e*h+p*s+y;t=k<t?k:t;t=g<t?g:t;t=tt<t?tt:t;t=rt<t?rt:t;i=d<i?d:i;i=nt<i?nt:i;i=it<i?it:i;i=ut<i?ut:i;r=k>r?k:r;r=g>r?g:r;r=tt>r?tt:r;r=rt>r?rt:r;u=d>u?d:u;u=nt>u?nt:u;u=it>u?it:u;u=ut>u?ut:u}return l=this._bounds,l.x=t,l.width=r-t,l.y=i,l.height=u-i,this._currentBounds=l,l},n.Sprite.prototype.getLocalBounds=function(){var i=this.worldTransform,n,t;for(this.worldTransform=Phaser.identityMatrix,n=0;n<this.children.length;n++)this.children[n].updateTransform();for(t=this.getBounds(),this.worldTransform=i,n=0;n<this.children.length;n++)this.children[n].updateTransform();return t},n.Sprite.prototype._renderWebGL=function(n,t){var u,r,i;if(this.visible&&!(this.alpha<=0)&&this.renderable)if(u=this.worldTransform,t&&(u=t),this._mask||this._filters){for(r=n.spriteBatch,this._filters&&(r.flush(),n.filterManager.pushFilter(this._filterBlock)),this._mask&&(r.stop(),n.maskManager.pushMask(this.mask,n),r.start()),r.render(this),i=0;i<this.children.length;i++)this.children[i]._renderWebGL(n);r.stop();this._mask&&n.maskManager.popMask(this._mask,n);this._filters&&n.filterManager.popFilter();r.start()}else for(n.spriteBatch.render(this),i=0;i<this.children.length;i++)this.children[i]._renderWebGL(n,u)},n.Sprite.prototype._renderCanvas=function(t,i){var r,o,w,b,f;if(this.visible&&this.alpha!==0&&this.renderable&&!(this.texture.crop.width<1)&&!(this.texture.crop.height<1)){if(r=this.worldTransform,i&&(r=i),this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,t.context.globalCompositeOperation=n.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),!this.texture.valid){for(f=0;f<this.children.length;f++)this.children[f]._renderCanvas(t);this._mask&&t.maskManager.popMask(t);return}o=this.texture.baseTexture.resolution/t.resolution;t.context.globalAlpha=this.worldAlpha;t.smoothProperty&&t.scaleMode!==this.texture.baseTexture.scaleMode&&(t.scaleMode=this.texture.baseTexture.scaleMode,t.context[t.smoothProperty]=t.scaleMode===n.scaleModes.LINEAR);var s=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,h=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height,c=r.tx*t.resolution+t.shakeX,l=r.ty*t.resolution+t.shakeY,e=this.texture.crop.width,u=this.texture.crop.height;if(this.texture.rotated){var a=r.a,v=r.b,y=r.c,p=r.d,k=e;c=r.c*u+c;l=r.d*u+l;r.a=a*6123233995736766e-32+-y;r.b=v*6123233995736766e-32+-p;r.c=a+y*6123233995736766e-32;r.d=v+p*6123233995736766e-32;e=u;u=k}if(t.roundPixels?(t.context.setTransform(r.a,r.b,r.c,r.d,c|0,l|0),s|=0,h|=0):t.context.setTransform(r.a,r.b,r.c,r.d,c,l),s/=o,h/=o,e|=0,u|=0,e&&u){for(this.tint!==16777215?((this.texture.requiresReTint||this.cachedTint!==this.tint)&&(this.tintedTexture=n.CanvasTinter.getTintedTexture(this,this.tint),this.cachedTint=this.tint,this.texture.requiresReTint=!1),t.context.drawImage(this.tintedTexture,0,0,e,u,s,h,e/o,u/o)):(w=this.texture.crop.x,b=this.texture.crop.y,t.context.drawImage(this.texture.baseTexture.source,w,b,e,u,s,h,e/o,u/o)),f=0;f<this.children.length;f++)this.children[f]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}}},n.initDefaultShaders=function(){},n.CompileVertexShader=function(t,i){return n._CompileShader(t,i,t.VERTEX_SHADER)},n.CompileFragmentShader=function(t,i){return n._CompileShader(t,i,t.FRAGMENT_SHADER)},n._CompileShader=function(n,t,i){var u=t,r;return(Array.isArray(t)&&(u=t.join("\n")),r=n.createShader(i),n.shaderSource(r,u),n.compileShader(r),!n.getShaderParameter(r,n.COMPILE_STATUS))?(window.console.log(n.getShaderInfoLog(r)),null):r},n.compileProgram=function(t,i,r){var f=n.CompileFragmentShader(t,r),e=n.CompileVertexShader(t,i),u=t.createProgram();return t.attachShader(u,e),t.attachShader(u,f),t.linkProgram(u),t.getProgramParameter(u,t.LINK_STATUS)||(window.console.log(t.getProgramInfoLog(u)),window.console.log("Could not initialise shaders")),u},n.PixiShader=function(n){this._UID=Phaser._UID++;this.gl=n;this.program=null;this.fragmentSrc=null;this.textureCount=0;this.firstRun=!0;this.dirty=!0;this.attributes=[];this.init()},n.PixiShader.prototype.constructor=n.PixiShader,n.PixiShader.prototype.initMultitexShader=function(){var t=this.gl,f,r,i,e,o,u,s;for(this.MAX_TEXTURES=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),f="\tif (vTextureIndex == 0.0) { gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;return;}\n",r=1;r<this.MAX_TEXTURES;++r)f+="\tif (vTextureIndex == "+r+".0) {gl_FragColor = texture2D(uSamplerArray["+r+"], vTextureCoord) * vColor;return;}\n";for(this.fragmentSrc=["// PixiShader Fragment Shader.","precision lowp float;","bool isnan( float val ) {  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true; }","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","const vec4 BLUE = vec4(1.0, 0.0, 1.0, 1.0);","const vec4 RED = vec4(1.0, 0.0, 0.0, 1.0);","void main(void) {",f,"   if(vTextureIndex >= "+this.MAX_TEXTURES+".0) { gl_FragColor = BLUE;return;}","   if(isnan(vTextureIndex)) { gl_FragColor = RED;return;}","}"],i=n.compileProgram(t,this.vertexSrc||n.PixiShader.defaultVertexSrc,this.fragmentSrc),t.useProgram(i),this.uSamplerArray=t.getUniformLocation(i,"uSamplerArray[0]"),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.dimensions=t.getUniformLocation(i,"dimensions"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(i,"aColor"),this.aTextureIndex=t.getAttribLocation(i,"aTextureIndex"),e=[],o=t.createTexture(),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,t.RGB,1,1,0,t.RGB,t.UNSIGNED_BYTE,null),u=0;u<this.MAX_TEXTURES;++u)t.activeTexture(t.TEXTURE0+u),t.bindTexture(t.TEXTURE_2D,o),e.push(u);t.activeTexture(t.TEXTURE0);t.uniform1iv(this.uSamplerArray,e);this.colorAttribute===-1&&(this.colorAttribute=2);this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute,this.aTextureIndex];for(s in this.uniforms)this.uniforms[s].uniformLocation=t.getUniformLocation(i,s);this.initUniforms();this.program=i},n.PixiShader.prototype.initDefaultShader=function(){var t,i,r;this.fragmentSrc===null&&(this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"]);t=this.gl;i=n.compileProgram(t,this.vertexSrc||n.PixiShader.defaultVertexSrc,this.fragmentSrc);t.useProgram(i);this.uSampler=t.getUniformLocation(i,"uSampler");this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.dimensions=t.getUniformLocation(i,"dimensions");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord");this.colorAttribute=t.getAttribLocation(i,"aColor");this.aTextureIndex=t.getAttribLocation(i,"aTextureIndex");this.colorAttribute===-1&&(this.colorAttribute=2);this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute,this.aTextureIndex];for(r in this.uniforms)this.uniforms[r].uniformLocation=t.getUniformLocation(i,r);this.initUniforms();this.program=i},n.PixiShader.prototype.init=function(t){n._enableMultiTextureToggle&&!t?this.initMultitexShader():this.initDefaultShader()},n.PixiShader.prototype.initUniforms=function(){var i,t,r,n;this.textureCount=1;i=this.gl;for(r in this.uniforms)t=this.uniforms[r],n=t.type,n==="sampler2D"?(t._init=!1,t.value!==null&&this.initSampler2D(t)):n==="mat2"||n==="mat3"||n==="mat4"?(t.glMatrix=!0,t.glValueLength=1,n==="mat2"?t.glFunc=i.uniformMatrix2fv:n==="mat3"?t.glFunc=i.uniformMatrix3fv:n==="mat4"&&(t.glFunc=i.uniformMatrix4fv)):(t.glFunc=i["uniform"+n],t.glValueLength=n==="2f"||n==="2i"?2:n==="3f"||n==="3i"?3:n==="4f"||n==="4i"?4:1)},n.PixiShader.prototype.initSampler2D=function(n){var t;if(n.value&&n.value.baseTexture&&n.value.baseTexture.hasLoaded){if(t=this.gl,t.activeTexture(t.TEXTURE0+this.textureCount),t.bindTexture(t.TEXTURE_2D,n.value.baseTexture._glTextures[t.id]),n.textureData){var i=n.textureData,e=i.magFilter?i.magFilter:t.LINEAR,o=i.minFilter?i.minFilter:t.LINEAR,u=i.wrapS?i.wrapS:t.CLAMP_TO_EDGE,f=i.wrapT?i.wrapT:t.CLAMP_TO_EDGE,r=i.luminance?t.LUMINANCE:t.RGBA;if(i.repeat&&(u=t.REPEAT,f=t.REPEAT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!!i.flipY),i.width){var s=i.width?i.width:512,h=i.height?i.height:2,c=i.border?i.border:0;t.texImage2D(t.TEXTURE_2D,0,r,s,h,c,r,t.UNSIGNED_BYTE,null)}else t.texImage2D(t.TEXTURE_2D,0,r,t.RGBA,t.UNSIGNED_BYTE,n.value.baseTexture.source);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,o);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,u);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,f)}t.uniform1i(n.uniformLocation,this.textureCount);n._init=!0;this.textureCount++}},n.PixiShader.prototype.syncUniforms=function(){var t,i,r;this.textureCount=1;i=this.gl;for(r in this.uniforms)t=this.uniforms[r],t.glValueLength===1?t.glMatrix===!0?t.glFunc.call(i,t.uniformLocation,t.transpose,t.value):t.glFunc.call(i,t.uniformLocation,t.value):t.glValueLength===2?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y):t.glValueLength===3?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z):t.glValueLength===4?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z,t.value.w):t.type==="sampler2D"&&(t._init?(i.activeTexture(i["TEXTURE"+this.textureCount]),t.value.baseTexture._dirty[i.id]?n.instances[i.id].updateTexture(t.value.baseTexture):i.bindTexture(i.TEXTURE_2D,t.value.baseTexture._glTextures[i.id]),i.uniform1i(t.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(t))},n.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null},n.PixiShader.defaultVertexSrc=["// PixiShader Vertex Shader","// With multi-texture rendering","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","attribute float aTextureIndex;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   if (aTextureIndex > 0.0) gl_Position = vec4(0.0);","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","   vTextureIndex = aTextureIndex;","}"],n.PixiFastShader=function(t){var t,r,i;if(this._UID=Phaser._UID++,this.gl=t,this.program=null,n._enableMultiTextureToggle){for(t=this.gl,this.MAX_TEXTURES=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),r="\tif (vTextureIndex == 0.0) { gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;return;}\n",i=1;i<this.MAX_TEXTURES;++i)r+="\tif (vTextureIndex == "+i+".0) { gl_FragColor = texture2D(uSamplerArray["+i+"], vTextureCoord) * vColor;return;}\n";this.fragmentSrc=["// PixiFastShader Fragment Shader.","precision lowp float;","bool isnan( float val ) {  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true; }","varying vec2 vTextureCoord;","varying float vColor;","varying float vTextureIndex;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","const vec4 BLUE = vec4(1.0, 0.0, 1.0, 1.0);","const vec4 RED = vec4(1.0, 0.0, 0.0, 1.0);","void main(void) {",r,"   if(vTextureIndex >= "+this.MAX_TEXTURES+".0) { gl_FragColor = BLUE;return;}","   if(isnan(vTextureIndex)) {gl_FragColor = RED;return;}","}"]}else this.fragmentSrc=["// PixiFastShader Fragment Shader.","precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","varying float vTextureIndex;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;","}"];this.vertexSrc=["// PixiFastShader Vertex Shader.","attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","attribute float aTextureIndex;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","varying float vTextureIndex;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vTextureIndex = aTextureIndex;","   vColor = aColor;","}"];this.textureCount=0;this.init()},n.PixiFastShader.prototype.constructor=n.PixiFastShader,n.PixiFastShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc),u,f,r;if(t.useProgram(i),this.uSampler=n._enableMultiTextureToggle?t.getUniformLocation(i,"uSamplerArray[0]"):t.getUniformLocation(i,"uSampler"),n._enableMultiTextureToggle){for(u=[],f=t.createTexture(),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,f),t.texImage2D(t.TEXTURE_2D,0,t.RGB,1,1,0,t.RGB,t.UNSIGNED_BYTE,null),r=0;r<this.MAX_TEXTURES;++r)t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_2D,f),u.push(r);t.activeTexture(t.TEXTURE0);t.uniform1iv(this.uSampler,u)}this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.dimensions=t.getUniformLocation(i,"dimensions");this.uMatrix=t.getUniformLocation(i,"uMatrix");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.aPositionCoord=t.getAttribLocation(i,"aPositionCoord");this.aScale=t.getAttribLocation(i,"aScale");this.aRotation=t.getAttribLocation(i,"aRotation");this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord");this.colorAttribute=t.getAttribLocation(i,"aColor");this.aTextureIndex=t.getAttribLocation(i,"aTextureIndex");this.colorAttribute===-1&&(this.colorAttribute=2);this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute,this.aTextureIndex];this.program=i},n.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null},n.StripShader=function(t){var t,r,i;if(this._UID=Phaser._UID++,this.gl=t,this.program=null,n._enableMultiTextureToggle){for(t=this.gl,this.MAX_TEXTURES=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),r="\tif (vTextureIndex == 0.0) { gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord);return;}\n",i=1;i<this.MAX_TEXTURES;++i)r+="\tif (vTextureIndex == "+i+".0) { gl_FragColor = texture2D(uSamplerArray["+i+"], vTextureCoord) ;return;}\n";this.fragmentSrc=["//StripShader Fragment Shader.","precision mediump float;","bool isnan( float val ) {  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true; }","varying vec2 vTextureCoord;","varying float vTextureIndex;","uniform float alpha;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","const vec4 BLUE = vec4(1.0, 0.0, 1.0, 1.0);","const vec4 RED = vec4(1.0, 0.0, 0.0, 1.0);","void main(void) {",r,"   if(vTextureIndex >= "+this.MAX_TEXTURES+".0) { gl_FragColor = BLUE;return;}","   if(isnan(vTextureIndex)) {gl_FragColor = RED;return;}","}"]}else this.fragmentSrc=["//StripShader Fragment Shader.","precision mediump float;","varying vec2 vTextureCoord;","varying float vTextureIndex;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","}"];this.vertexSrc=["//StripShader Vertex Shader.","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aTextureIndex;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying float vTextureIndex;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vTextureIndex = aTextureIndex;","}"];this.init()},n.StripShader.prototype.constructor=n.StripShader,n.StripShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc),u,f,r;if(t.useProgram(i),this.uSampler=n._enableMultiTextureToggle?t.getUniformLocation(i,"uSamplerArray[0]"):t.getUniformLocation(i,"uSampler"),n._enableMultiTextureToggle){for(u=[],f=t.createTexture(),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,f),t.texImage2D(t.TEXTURE_2D,0,t.RGB,1,1,0,t.RGB,t.UNSIGNED_BYTE,null),r=0;r<this.MAX_TEXTURES;++r)t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_2D,f),u.push(r);t.activeTexture(t.TEXTURE0);t.uniform1iv(this.uSampler,u)}this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.colorAttribute=t.getAttribLocation(i,"aColor");this.aTextureIndex=t.getAttribLocation(i,"aTextureIndex");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord");this.attributes=[this.aVertexPosition,this.aTextureCoord,this.aTextureIndex];this.translationMatrix=t.getUniformLocation(i,"translationMatrix");this.alpha=t.getUniformLocation(i,"alpha");this.program=i},n.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null},n.PrimitiveShader=function(n){this._UID=Phaser._UID++;this.gl=n;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"];this.init()},n.PrimitiveShader.prototype.constructor=n.PrimitiveShader,n.PrimitiveShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i);this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.tintColor=t.getUniformLocation(i,"tint");this.flipY=t.getUniformLocation(i,"flipY");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.colorAttribute=t.getAttribLocation(i,"aColor");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=t.getUniformLocation(i,"translationMatrix");this.alpha=t.getUniformLocation(i,"alpha");this.program=i},n.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null},n.ComplexPrimitiveShader=function(n){this._UID=Phaser._UID++;this.gl=n;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"];this.init()},n.ComplexPrimitiveShader.prototype.constructor=n.ComplexPrimitiveShader,n.ComplexPrimitiveShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i);this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.tintColor=t.getUniformLocation(i,"tint");this.color=t.getUniformLocation(i,"color");this.flipY=t.getUniformLocation(i,"flipY");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=t.getUniformLocation(i,"translationMatrix");this.alpha=t.getUniformLocation(i,"alpha");this.program=i},n.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null},n.glContexts=[],n.instances=[],n._enableMultiTextureToggle=!1,n.WebGLRenderer=function(t,i){this.game=t;n.defaultRenderer||(n.defaultRenderer=this);this.extensions={};this.type=Phaser.WEBGL;this.resolution=t.resolution;this.transparent=t.transparent;this.autoResize=!1;this.preserveDrawingBuffer=t.preserveDrawingBuffer;this.clearBeforeRender=t.clearBeforeRender;this.powerPreference=t.powerPreference;this.width=t.width;this.height=t.height;this.view=t.canvas;this._contextOptions={alpha:this.transparent,antialias:t.antialias,failIfMajorPerformanceCaveat:i.failIfMajorPerformanceCaveat,premultipliedAlpha:this.transparent&&this.transparent!=="notMultiplied",stencil:!0,preserveDrawingBuffer:this.preserveDrawingBuffer,powerPreference:t.powerPreference};this.projection=new n.Point;this.offset=new n.Point;this.shaderManager=new n.WebGLShaderManager;this.spriteBatch=new n.WebGLSpriteBatch(t);this.maskManager=new n.WebGLMaskManager;this.filterManager=new n.WebGLFilterManager;this.stencilManager=new n.WebGLStencilManager;this.blendModeManager=new n.WebGLBlendModeManager;this.renderSession={};this.currentBatchedTextures=[];this.renderSession.game=this.game;this.renderSession.gl=this.gl;this.renderSession.drawCount=0;this.renderSession.shaderManager=this.shaderManager;this.renderSession.maskManager=this.maskManager;this.renderSession.filterManager=this.filterManager;this.renderSession.blendModeManager=this.blendModeManager;this.renderSession.spriteBatch=this.spriteBatch;this.renderSession.stencilManager=this.stencilManager;this.renderSession.renderer=this;this.renderSession.resolution=this.resolution;this.renderSession.roundPixels=i.roundPixels||!1;this.renderSession.maxTextureAvailableSpace=null;this.initContext();this.mapBlendModes()},n.WebGLRenderer.prototype.constructor=n.WebGLRenderer,n.WebGLRenderer.prototype.initContext=function(){var t=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=t,!t)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.maxTextures=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=this.gl.getParameter(t.MAX_TEXTURE_SIZE);this.glContextId=t.id=n.WebGLRenderer.glContextId++;n.glContexts[this.glContextId]=t;n.instances[this.glContextId]=this;t.disable(t.DEPTH_TEST);t.disable(t.CULL_FACE);t.enable(t.BLEND);this.shaderManager.setContext(t);this.spriteBatch.setContext(t);this.maskManager.setContext(t);this.filterManager.setContext(t);this.blendModeManager.setContext(t);this.stencilManager.setContext(t);this.renderSession.gl=this.gl;this.resize(this.width,this.height);this.extensions.compression={};var i=t.getExtension("WEBGL_compressed_texture_etc1")||t.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),u=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");i&&(this.extensions.compression.ETC1=i);r&&(this.extensions.compression.PVRTC=r);u&&(this.extensions.compression.S3TC=u)},n.WebGLRenderer.prototype.setTexturePriority=function(t){var s,r,u,f;if(!n._enableMultiTextureToggle){console.warn("setTexturePriority error: Multi Texture support hasn't been enabled in the Phaser Game Config.");return}var h=function(n){return--n,n|=n>>1,n|=n>>2,n|=n>>4,n|=n>>8,n|=n>>16,++n},e=this.gl,c=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),l=e.getParameter(e.MAX_TEXTURE_SIZE),o=this.game.cache._cache.image,i=null;for(s=0;s<this.currentBatchedTextures.length;s++){if(i=this.currentBatchedTextures[s],!(i in o)){console.warn('setTexturePriority: There is no image "%s" in the image cache.',i);continue}o[i].base.textureIndex=0}for(r=l-h(Math.max(this.width,this.height)),this.currentBatchedTextures.length=0,u=0;u<t.length;++u){if(i=t[u],!(i in o)){console.warn('setTexturePriority: There is no image "%s" in the image cache.',i);continue}f=o[i].base;r-=h(Math.max(f.width,f.height));r<=0?(f.textureIndex=0,console.warn('setTexturePriority: Image "%s" was given textureIndex=0 because there is no available texture space (%s).',i,r)):f.textureIndex=1+u%(c-1);this.currentBatchedTextures.push(i)}return this.renderSession.maxTextureAvailableSpace=r,this.currentBatchedTextures},n.WebGLRenderer.prototype.render=function(n){if(!this.contextLost){var t=this.gl;t.viewport(0,0,this.width,this.height);t.bindFramebuffer(t.FRAMEBUFFER,null);this.game.clearBeforeRender&&(t.clearColor(n._bgColor.r,n._bgColor.g,n._bgColor.b,n._bgColor.a),t.clear(t.COLOR_BUFFER_BIT));this.offset.x=this.game.camera._shake.x;this.offset.y=this.game.camera._shake.y;this.renderDisplayObject(n,this.projection)}},n.WebGLRenderer.prototype.renderDisplayObject=function(t,i,r,u){this.renderSession.blendModeManager.setBlendMode(n.blendModes.NORMAL);this.renderSession.drawCount=0;this.renderSession.flipY=r?-1:1;this.renderSession.projection=i;this.renderSession.offset=this.offset;this.spriteBatch.begin(this.renderSession);this.filterManager.begin(this.renderSession,r);t._renderWebGL(this.renderSession,u);this.spriteBatch.end()},n.WebGLRenderer.prototype.resize=function(n,t){this.width=n*this.resolution;this.height=t*this.resolution;this.view.width=this.width;this.view.height=this.height;this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px");this.gl.viewport(0,0,this.width,this.height);this.projection.x=this.width/2/this.resolution;this.projection.y=-this.height/2/this.resolution},n.WebGLRenderer.prototype.updateCompressedTexture=function(t){if(!t.hasLoaded)return!1;var i=this.gl,r=t.source;return t._glTextures[i.id]||(t._glTextures[i.id]=i.createTexture()),i.activeTexture(i.TEXTURE0+t.textureIndex),i.bindTexture(i.TEXTURE_2D,t._glTextures[i.id]),i.compressedTexImage2D(i.TEXTURE_2D,0,r.glExtensionFormat,r.width,r.height,0,r.textureData),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t.scaleMode===n.scaleModes.LINEAR?i.LINEAR:i.NEAREST),t.mipmap&&Phaser.Math.isPowerOfTwo(t.width,t.height)?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===n.scaleModes.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST),i.generateMipmap(i.TEXTURE_2D)):i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===n.scaleModes.LINEAR?i.LINEAR:i.NEAREST),t._powerOf2?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)),t._dirty[i.id]=!1,!0},n.WebGLRenderer.prototype.updateTexture=function(t){if(!t.hasLoaded||!t.source)return!1;if(t.source.compressionAlgorithm)return this.updateCompressedTexture(t);var i=this.gl;return t._glTextures[i.id]||(t._glTextures[i.id]=i.createTexture()),i.activeTexture(i.TEXTURE0+t.textureIndex),i.bindTexture(i.TEXTURE_2D,t._glTextures[i.id]),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t.source),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t.scaleMode===n.scaleModes.LINEAR?i.LINEAR:i.NEAREST),t.mipmap&&Phaser.Math.isPowerOfTwo(t.width,t.height)?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===n.scaleModes.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST),i.generateMipmap(i.TEXTURE_2D)):i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===n.scaleModes.LINEAR?i.LINEAR:i.NEAREST),t._powerOf2?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)),t._dirty[i.id]=!1,!0},n.WebGLRenderer.prototype.destroy=function(){n.glContexts[this.glContextId]=null;this.projection=null;this.offset=null;this.shaderManager.destroy();this.spriteBatch.destroy();this.maskManager.destroy();this.filterManager.destroy();this.shaderManager=null;this.spriteBatch=null;this.maskManager=null;this.filterManager=null;this.gl=null;this.renderSession=null;Phaser.CanvasPool.remove(this);n.instances[this.glContextId]=null;n.WebGLRenderer.glContextId--},n.WebGLRenderer.prototype.mapBlendModes=function(){var t=this.gl,i,r;n.blendModesWebGL||(i=[],r=n.blendModes,i[r.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.ADD]=[t.SRC_ALPHA,t.DST_ALPHA],i[r.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA],i[r.SCREEN]=[t.SRC_ALPHA,t.ONE],i[r.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[r.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL=i)},n.WebGLRenderer.prototype.getMaxTextureUnit=function(){var n=this.gl;return n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)},n.enableMultiTexture=function(){n._enableMultiTextureToggle=!0},n.WebGLRenderer.glContextId=0,n.WebGLRenderer.textureArray=[],n.WebGLBlendModeManager=function(){this.currentBlendMode=99999},n.WebGLBlendModeManager.prototype.constructor=n.WebGLBlendModeManager,n.WebGLBlendModeManager.prototype.setContext=function(n){this.gl=n},n.WebGLBlendModeManager.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return!1;this.currentBlendMode=t;var i=n.blendModesWebGL[this.currentBlendMode];return i&&this.gl.blendFunc(i[0],i[1]),!0},n.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},n.WebGLMaskManager=function(){},n.WebGLMaskManager.prototype.constructor=n.WebGLMaskManager,n.WebGLMaskManager.prototype.setContext=function(n){this.gl=n},n.WebGLMaskManager.prototype.pushMask=function(t,i){var r=i.gl;(t.dirty&&n.WebGLGraphics.updateGraphics(t,r),t._webGL[r.id]!==undefined&&t._webGL[r.id].data!==undefined&&t._webGL[r.id].data.length!==0)&&i.stencilManager.pushStencil(t,t._webGL[r.id].data[0],i)},n.WebGLMaskManager.prototype.popMask=function(n,t){var i=this.gl;n._webGL[i.id]!==undefined&&n._webGL[i.id].data!==undefined&&n._webGL[i.id].data.length!==0&&t.stencilManager.popStencil(n,n._webGL[i.id].data[0],t)},n.WebGLMaskManager.prototype.destroy=function(){this.gl=null},n.WebGLStencilManager=function(){this.stencilStack=[];this.reverse=!0;this.count=0},n.WebGLStencilManager.prototype.setContext=function(n){this.gl=n},n.WebGLStencilManager.prototype.pushStencil=function(n,t,i){var r=this.gl,u;this.bindGraphics(n,t,i);this.stencilStack.length===0&&(r.enable(r.STENCIL_TEST),r.clear(r.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0);this.stencilStack.push(t);u=this.count;r.colorMask(!1,!1,!1,!1);r.stencilFunc(r.ALWAYS,0,255);r.stencilOp(r.KEEP,r.KEEP,r.INVERT);t.mode===1?(r.drawElements(r.TRIANGLE_FAN,t.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?(r.stencilFunc(r.EQUAL,255-u,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,u,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,(t.indices.length-4)*2),this.reverse?r.stencilFunc(r.EQUAL,255-(u+1),255):r.stencilFunc(r.EQUAL,u+1,255),this.reverse=!this.reverse):(this.reverse?(r.stencilFunc(r.EQUAL,u,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,255-u,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_STRIP,t.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,u+1,255):r.stencilFunc(r.EQUAL,255-(u+1),255));r.colorMask(!0,!0,!0,!0);r.stencilOp(r.KEEP,r.KEEP,r.KEEP);this.count++},n.WebGLStencilManager.prototype.bindGraphics=function(n,t,i){this._currentGraphics=n;var r=this.gl,f=i.projection,e=i.offset,u;t.mode===1?(u=i.shaderManager.complexPrimitiveShader,i.shaderManager.setShader(u),r.uniform1f(u.flipY,i.flipY),r.uniformMatrix3fv(u.translationMatrix,!1,n.worldTransform.toArray(!0)),r.uniform2f(u.projectionVector,f.x,-f.y),r.uniform2f(u.offsetVector,-e.x,-e.y),r.uniform3fv(u.tintColor,Phaser.Color.hexToRGBArray(n.tint)),r.uniform3fv(u.color,t.color),r.uniform1f(u.alpha,n.worldAlpha*t.alpha),r.bindBuffer(r.ARRAY_BUFFER,t.buffer),r.vertexAttribPointer(u.aVertexPosition,2,r.FLOAT,!1,8,0),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.indexBuffer)):(u=i.shaderManager.primitiveShader,i.shaderManager.setShader(u),r.uniformMatrix3fv(u.translationMatrix,!1,n.worldTransform.toArray(!0)),r.uniform1f(u.flipY,i.flipY),r.uniform2f(u.projectionVector,f.x,-f.y),r.uniform2f(u.offsetVector,-e.x,-e.y),r.uniform3fv(u.tintColor,Phaser.Color.hexToRGBArray(n.tint)),r.uniform1f(u.alpha,n.worldAlpha),r.bindBuffer(r.ARRAY_BUFFER,t.buffer),r.vertexAttribPointer(u.aVertexPosition,2,r.FLOAT,!1,24,0),r.vertexAttribPointer(u.colorAttribute,4,r.FLOAT,!1,24,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.indexBuffer))},n.WebGLStencilManager.prototype.popStencil=function(n,t,i){var r=this.gl,u;this.stencilStack.pop();this.count--;this.stencilStack.length===0?r.disable(r.STENCIL_TEST):(u=this.count,this.bindGraphics(n,t,i),r.colorMask(!1,!1,!1,!1),t.mode===1?(this.reverse=!this.reverse,this.reverse?(r.stencilFunc(r.EQUAL,255-(u+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,u+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,(t.indices.length-4)*2),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),r.drawElements(r.TRIANGLE_FAN,t.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,u,255):r.stencilFunc(r.EQUAL,255-u,255)):(this.reverse?(r.stencilFunc(r.EQUAL,u+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,255-(u+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_STRIP,t.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,u,255):r.stencilFunc(r.EQUAL,255-u,255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP))},n.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null;this.gl=null},n.WebGLShaderManager=function(){this.maxAttibs=10;this.attribState=[];this.tempAttribState=[];for(var n=0;n<this.maxAttibs;n++)this.attribState[n]=!1;this.stack=[]},n.WebGLShaderManager.prototype.constructor=n.WebGLShaderManager,n.WebGLShaderManager.prototype.setContext=function(t){this.gl=t;this.primitiveShader=new n.PrimitiveShader(t);this.complexPrimitiveShader=new n.ComplexPrimitiveShader(t);this.defaultShader=new n.PixiShader(t);this.fastShader=new n.PixiFastShader(t);this.stripShader=new n.StripShader(t);this.creatureShader=n.CreatureShader?new n.CreatureShader(t):null;this.setShader(this.defaultShader)},n.WebGLShaderManager.prototype.setAttribs=function(n){for(var r,i,t=0;t<this.tempAttribState.length;t++)this.tempAttribState[t]=!1;for(t=0;t<n.length;t++)r=n[t],this.tempAttribState[r]=!0;for(i=this.gl,t=0;t<this.attribState.length;t++)this.attribState[t]!==this.tempAttribState[t]&&(this.attribState[t]=this.tempAttribState[t],this.tempAttribState[t]?i.enableVertexAttribArray(t):i.disableVertexAttribArray(t))},n.WebGLShaderManager.prototype.setShader=function(n){return this._currentId===n._UID?!1:(this._currentId=n._UID,this.currentShader=n,this.gl.useProgram(n.program),this.setAttribs(n.attributes),!0)},n.WebGLShaderManager.prototype.destroy=function(){this.attribState=null;this.tempAttribState=null;this.primitiveShader.destroy();this.complexPrimitiveShader.destroy();this.defaultShader.destroy();this.fastShader.destroy();this.stripShader.destroy();this.creatureShader&&this.creatureShader.destroy();this.gl=null},n.WebGLSpriteBatch=function(n){var u,r,t,i;for(this.game=n,this.vertSize=5,this.size=2e3,this.vertexSize=24,u=this.vertexSize*this.size*4,r=this.size*6,this.vertices=new ArrayBuffer(u),this.positions=new Float32Array(this.vertices),this.colors=new Uint32Array(this.vertices),this.indices=new Uint16Array(r),this.lastIndexCount=0,t=0,i=0;t<r;t+=6,i+=4)this.indices[t+0]=i+0,this.indices[t+1]=i+1,this.indices[t+2]=i+2,this.indices[t+3]=i+0,this.indices[t+4]=i+2,this.indices[t+5]=i+3;this.drawing=!1;this.currentBatchSize=0;this.currentBaseTexture=null;this.dirty=!0;this.textures=[];this.blendModes=[];this.shaders=[];this.sprites=[];this.defaultShader=null},n.WebGLSpriteBatch.prototype.setContext=function(t){var u,i,r;if(this.MAX_TEXTURES=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this.gl=t,n._enableMultiTextureToggle){for(u="\tif (vTextureIndex == 0.0) {gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;return;}\n",i=1;i<this.MAX_TEXTURES;++i)u+="\tif (vTextureIndex == "+i+".0) {gl_FragColor = texture2D(uSamplerArray["+i+"], vTextureCoord) * vColor;return;}\n";this.defaultShader=new Phaser.Filter(this.game,undefined,["//WebGLSpriteBatch Fragment Shader.","precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","void main(void) {",u,"\tgl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;","}"])}else this.defaultShader=new Phaser.Filter(this.game,undefined,["//WebGLSpriteBatch Fragment Shader.","precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;","}"]);this.vertexBuffer=t.createBuffer();this.indexBuffer=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW);this.currentBlendMode=99999;r=new n.PixiShader(t);r.fragmentSrc=this.defaultShader.fragmentSrc;r.uniforms={};r.init();this.defaultShader.shaders[t.id]=r},n.WebGLSpriteBatch.prototype.begin=function(n){this.renderSession=n;this.shader=this.renderSession.shaderManager.defaultShader;this.start()},n.WebGLSpriteBatch.prototype.end=function(){this.flush()},n.WebGLSpriteBatch.prototype.render=function(n,t){var f=n.texture,e=n.worldTransform,u,nt,tt,h,o,c,s,g;if(t&&(e=t),this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=f.baseTexture),u=f._uvs,u){nt=n.anchor.x;tt=n.anchor.y;f.trim?(g=f.trim,o=g.x-nt*g.width,h=o+f.crop.width,s=g.y-tt*g.height,c=s+f.crop.height):(h=f.frame.width*(1-nt),o=f.frame.width*-nt,c=f.frame.height*(1-tt),s=f.frame.height*-tt);var i=this.currentBatchSize*this.vertexSize,it=f.baseTexture.resolution,b=f.baseTexture.textureIndex,v=e.a/it,y=e.b/it,p=e.c/it,w=e.d/it,l=e.tx,a=e.ty,ut=f.crop.height;if(f.rotated){var ft=e.a,et=e.b,ot=e.c,st=e.d,ht=o,ct=h;l=e.c*ut+l;a=e.d*ut+a;v=ft*6123233995736766e-32+-ot;y=et*6123233995736766e-32+-st;p=ft+ot*6123233995736766e-32;w=et+st*6123233995736766e-32;f._updateUvsInverted();h=c;o=s;c=ct;s=ht}var k=this.colors,r=this.positions,rt=n.tint,d=(rt>>16)+(rt&65280)+((rt&255)<<16)+(n.worldAlpha*255<<24);this.renderSession.roundPixels?(r[i++]=v*o+p*s+l|0,r[i++]=w*s+y*o+a|0,r[i++]=u.x0,r[i++]=u.y0,k[i++]=d,r[i++]=b,r[i++]=v*h+p*s+l|0,r[i++]=w*s+y*h+a|0,r[i++]=u.x1,r[i++]=u.y1,k[i++]=d,r[i++]=b,r[i++]=v*h+p*c+l|0,r[i++]=w*c+y*h+a|0,r[i++]=u.x2,r[i++]=u.y2,k[i++]=d,r[i++]=b,r[i++]=v*o+p*c+l|0,r[i++]=w*c+y*o+a|0,r[i++]=u.x3,r[i++]=u.y3,k[i++]=d,r[i++]=b):(r[i++]=v*o+p*s+l,r[i++]=w*s+y*o+a,r[i++]=u.x0,r[i++]=u.y0,k[i++]=d,r[i++]=b,r[i++]=v*h+p*s+l,r[i++]=w*s+y*h+a,r[i++]=u.x1,r[i++]=u.y1,k[i++]=d,r[i++]=b,r[i++]=v*h+p*c+l,r[i++]=w*c+y*h+a,r[i++]=u.x2,r[i++]=u.y2,k[i++]=d,r[i++]=b,r[i++]=v*o+p*c+l,r[i++]=w*c+y*o+a,r[i++]=u.x3,r[i++]=u.y3,k[i++]=d,r[i++]=b);this.sprites[this.currentBatchSize++]=n}},n.WebGLSpriteBatch.prototype.renderTilingSprite=function(t){var e=t.tilingTexture,o=t.texture.baseTexture.textureIndex;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=e.baseTexture);t._uvs||(t._uvs=new n.TextureUvs);var u=t._uvs,it=e.baseTexture.width,rt=e.baseTexture.height;t.tilePosition.x%=it*t.tileScaleOffset.x;t.tilePosition.y%=rt*t.tileScaleOffset.y;var s=t.tilePosition.x/(it*t.tileScaleOffset.x),h=t.tilePosition.y/(rt*t.tileScaleOffset.y),ft=t.width/it/(t.tileScale.x*t.tileScaleOffset.x),et=t.height/rt/(t.tileScale.y*t.tileScaleOffset.y);u.x0=0-s;u.y0=0-h;u.x1=1*ft-s;u.y1=0-h;u.x2=1*ft-s;u.y2=1*et-h;u.x3=0-s;u.y3=1*et-h;var ut=t.tint,c=(ut>>16)+(ut&65280)+((ut&255)<<16)+(t.worldAlpha*255<<24),r=this.positions,l=this.colors,ot=t.width,st=t.height,ht=t.anchor.x,ct=t.anchor.y,a=ot*(1-ht),v=ot*-ht,y=st*(1-ct),p=st*-ct,i=this.currentBatchSize*this.vertexSize,w=e.baseTexture.resolution,f=t.worldTransform,b=f.a/w,k=f.b/w,d=f.c/w,g=f.d/w,nt=f.tx,tt=f.ty;r[i++]=b*v+d*p+nt;r[i++]=g*p+k*v+tt;r[i++]=u.x0;r[i++]=u.y0;l[i++]=c;r[i++]=o;r[i++]=b*a+d*p+nt;r[i++]=g*p+k*a+tt;r[i++]=u.x1;r[i++]=u.y1;l[i++]=c;r[i++]=o;r[i++]=b*a+d*y+nt;r[i++]=g*y+k*a+tt;r[i++]=u.x2;r[i++]=u.y2;l[i++]=c;r[i++]=o;r[i++]=b*v+d*y+nt;r[i++]=g*y+k*v+tt;r[i++]=u.x3;r[i++]=u.y3;l[i++]=c;r[i++]=o;this.sprites[this.currentBatchSize++]=t},n.WebGLSpriteBatch.prototype.flush=function(){var t,i,f,d,e,g,c,b,k;if(this.currentBatchSize!==0){t=this.gl;this.dirty&&(this.dirty=!1,i=this.defaultShader.shaders[t.id],t.activeTexture(t.TEXTURE0),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),f=this.vertexSize,t.vertexAttribPointer(i.aVertexPosition,2,t.FLOAT,!1,f,0),t.vertexAttribPointer(i.aTextureCoord,2,t.FLOAT,!1,f,8),t.vertexAttribPointer(i.colorAttribute,4,t.UNSIGNED_BYTE,!0,f,16),t.vertexAttribPointer(i.aTextureIndex,1,t.FLOAT,!1,f,20));this.currentBatchSize>this.size*.5?t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices):(t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),d=this.positions.subarray(0,this.currentBatchSize*this.vertexSize),t.bufferSubData(t.ARRAY_BUFFER,0,d));var o,l,a,s=0,v=0,h=null,y=this.renderSession.blendModeManager.currentBlendMode,u=null,p=!1,w=!1,r;for(e=0,g=this.currentBatchSize;e<g;e++)r=this.sprites[e],o=r.tilingTexture?r.tilingTexture.baseTexture:r.texture.baseTexture,l=r.blendMode,a=r.shader||this.defaultShader,p=y!==l,w=u!==a,c=o.skipRender,c&&r.children.length>0&&(c=!1),(h!==o&&!c||p||w)&&(this.renderBatch(h,s,v),v=e,s=0,h=o,p&&(y=l,this.renderSession.blendModeManager.setBlendMode(y)),w&&(u=a,i=u.shaders[t.id],i||(i=new n.PixiShader(t),i.fragmentSrc=u.fragmentSrc,i.uniforms=u.uniforms,i.init(),u.shaders[t.id]=i),this.renderSession.shaderManager.setShader(i),i.dirty&&i.syncUniforms(),b=this.renderSession.projection,t.uniform2f(i.projectionVector,b.x,b.y),k=this.renderSession.offset,t.uniform2f(i.offsetVector,k.x,k.y))),s++;this.renderBatch(h,s,v);this.currentBatchSize=0}},n.WebGLSpriteBatch.prototype.renderBatch=function(n,t,i){if(t!==0){var r=this.gl;if(n._dirty[r.id]){if(!this.renderSession.renderer.updateTexture(n))return}else r.bindTexture(r.TEXTURE_2D,n._glTextures[r.id]);r.drawElements(r.TRIANGLES,t*6,r.UNSIGNED_SHORT,i*12);this.renderSession.drawCount++}},n.WebGLSpriteBatch.prototype.stop=function(){this.flush();this.dirty=!0},n.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},n.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null;this.indices=null;this.gl.deleteBuffer(this.vertexBuffer);this.gl.deleteBuffer(this.indexBuffer);this.currentBaseTexture=null;this.gl=null},n.WebGLFastSpriteBatch=function(n){var u,r,t,i;for(this.vertSize=11,this.maxSize=6e3,this.size=this.maxSize,u=this.size*4*this.vertSize,r=this.maxSize*6,this.vertices=new Float32Array(u),this.indices=new Uint16Array(r),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0,t=0,i=0;t<r;t+=6,i+=4)this.indices[t+0]=i+0,this.indices[t+1]=i+1,this.indices[t+2]=i+2,this.indices[t+3]=i+0,this.indices[t+4]=i+2,this.indices[t+5]=i+3;this.drawing=!1;this.currentBatchSize=0;this.currentBaseTexture=null;this.currentBlendMode=0;this.renderSession=null;this.shader=null;this.matrix=null;this.setContext(n)},n.WebGLFastSpriteBatch.prototype.constructor=n.WebGLFastSpriteBatch,n.WebGLFastSpriteBatch.prototype.setContext=function(n){this.gl=n;this.vertexBuffer=n.createBuffer();this.indexBuffer=n.createBuffer();n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.indices,n.STATIC_DRAW);n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer);n.bufferData(n.ARRAY_BUFFER,this.vertices,n.DYNAMIC_DRAW)},n.WebGLFastSpriteBatch.prototype.begin=function(n,t){this.renderSession=t;this.shader=this.renderSession.shaderManager.fastShader;this.matrix=n.worldTransform.toArray(!0);this.start()},n.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},n.WebGLFastSpriteBatch.prototype.render=function(t){var f=t.children,r=f[0],e,i,u,o;if(r.texture._uvs){for(this.currentBaseTexture=r.texture.baseTexture,r.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(r.blendMode)),e=this.currentBaseTexture.textureIndex,i=this.gl,i.activeTexture(i.TEXTURE0+e),i.bindTexture(i.TEXTURE_2D,this.currentBaseTexture._glTextures[i.id]),n.WebGLRenderer.textureArray[e]=this.currentBaseTexture,u=0,o=f.length;u<o;u++)this.renderSprite(f[u]);this.flush()}},n.WebGLFastSpriteBatch.prototype.renderSprite=function(t){var p=t.texture,c=p.baseTexture,e=this.gl,f=t.texture.baseTexture.textureIndex,u,i,v,y,l,o,a,s,r,h;(n.WebGLRenderer.textureArray[f]==c||!c._glTextures[e.id]||t.texture.baseTexture.skipRender||(this.flush(),e.activeTexture(e.TEXTURE0+f),e.bindTexture(e.TEXTURE_2D,c._glTextures[e.id]),n.WebGLRenderer.textureArray[f]=c,t.texture._uvs))&&t.visible&&(i=this.vertices,u=t.texture._uvs,v=t.texture.frame.width,y=t.texture.frame.height,t.texture.trim?(h=t.texture.trim,o=h.x-t.anchor.x*h.width,l=o+t.texture.crop.width,s=h.y-t.anchor.y*h.height,a=s+t.texture.crop.height):(l=v*(1-t.anchor.x),o=v*-t.anchor.x,a=y*(1-t.anchor.y),s=y*-t.anchor.y),r=this.currentBatchSize*4*this.vertSize,i[r++]=o,i[r++]=s,i[r++]=t.position.x,i[r++]=t.position.y,i[r++]=t.scale.x,i[r++]=t.scale.y,i[r++]=t.rotation,i[r++]=u.x0,i[r++]=u.y1,i[r++]=t.alpha,i[r++]=f,i[r++]=l,i[r++]=s,i[r++]=t.position.x,i[r++]=t.position.y,i[r++]=t.scale.x,i[r++]=t.scale.y,i[r++]=t.rotation,i[r++]=u.x1,i[r++]=u.y1,i[r++]=t.alpha,i[r++]=f,i[r++]=l,i[r++]=a,i[r++]=t.position.x,i[r++]=t.position.y,i[r++]=t.scale.x,i[r++]=t.scale.y,i[r++]=t.rotation,i[r++]=u.x2,i[r++]=u.y2,i[r++]=t.alpha,i[r++]=f,i[r++]=o,i[r++]=a,i[r++]=t.position.x,i[r++]=t.position.y,i[r++]=t.scale.x,i[r++]=t.scale.y,i[r++]=t.rotation,i[r++]=u.x3,i[r++]=u.y3,i[r++]=t.alpha,i[r++]=f,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush())},n.WebGLFastSpriteBatch.prototype.flush=function(){var n,t;if(this.currentBatchSize!==0){if(n=this.gl,!this.currentBaseTexture._glTextures[n.id]){this.renderSession.renderer.updateTexture(this.currentBaseTexture,n);return}this.currentBatchSize>this.size*.5?n.bufferSubData(n.ARRAY_BUFFER,0,this.vertices):(t=this.vertices.subarray(0,this.currentBatchSize*4*this.vertSize),n.bufferSubData(n.ARRAY_BUFFER,0,t));n.drawElements(n.TRIANGLES,this.currentBatchSize*6,n.UNSIGNED_SHORT,0);this.currentBatchSize=0;this.renderSession.drawCount++}},n.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},n.WebGLFastSpriteBatch.prototype.start=function(){var n=this.gl,i,t;n.activeTexture(n.TEXTURE0);n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);i=this.renderSession.projection;n.uniform2f(this.shader.projectionVector,i.x,i.y);n.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);t=this.vertSize*4;n.vertexAttribPointer(this.shader.aVertexPosition,2,n.FLOAT,!1,t,0);n.vertexAttribPointer(this.shader.aPositionCoord,2,n.FLOAT,!1,t,8);n.vertexAttribPointer(this.shader.aScale,2,n.FLOAT,!1,t,16);n.vertexAttribPointer(this.shader.aRotation,1,n.FLOAT,!1,t,24);n.vertexAttribPointer(this.shader.aTextureCoord,2,n.FLOAT,!1,t,28);n.vertexAttribPointer(this.shader.colorAttribute,1,n.FLOAT,!1,t,36);n.vertexAttribPointer(this.shader.aTextureIndex,1,n.FLOAT,!1,t,40)},n.WebGLFilterManager=function(){this.filterStack=[];this.offsetX=0;this.offsetY=0},n.WebGLFilterManager.prototype.constructor=n.WebGLFilterManager,n.WebGLFilterManager.prototype.setContext=function(n){this.gl=n;this.texturePool=[];this.initShaderBuffers()},n.WebGLFilterManager.prototype.begin=function(n,t){this.renderSession=n;this.defaultShader=n.shaderManager.defaultShader;var i=this.renderSession.projection;this.width=i.x*2;this.height=-i.y*2;this.buffer=t},n.WebGLFilterManager.prototype.pushFilter=function(t){var r=this.gl,e=this.renderSession.projection,o=this.renderSession.offset,s,u,i,f;t._filterArea=t.target.filterArea||t.target.getBounds();t._previous_stencil_mgr=this.renderSession.stencilManager;this.renderSession.stencilManager=new n.WebGLStencilManager;this.renderSession.stencilManager.setContext(r);r.disable(r.STENCIL_TEST);this.filterStack.push(t);s=t.filterPasses[0];this.offsetX+=t._filterArea.x;this.offsetY+=t._filterArea.y;u=this.texturePool.pop();u?u.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution):u=new n.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution);r.bindTexture(r.TEXTURE_2D,u.texture);i=t._filterArea;f=s.padding;i.x-=f;i.y-=f;i.width+=f*2;i.height+=f*2;i.x<0&&(i.x=0);i.width>this.width&&(i.width=this.width);i.y<0&&(i.y=0);i.height>this.height&&(i.height=this.height);r.bindFramebuffer(r.FRAMEBUFFER,u.frameBuffer);r.viewport(0,0,i.width*this.renderSession.resolution,i.height*this.renderSession.resolution);e.x=i.width/2;e.y=-i.height/2;o.x=-i.x;o.y=-i.y;r.colorMask(!0,!0,!0,!0);r.clearColor(0,0,0,0);r.clear(r.COLOR_BUFFER_BIT);t._glFilterTexture=u},n.WebGLFilterManager.prototype.popFilter=function(){var t=this.gl,r=this.filterStack.pop(),i=r._filterArea,s=r._glFilterTexture,p=this.renderSession.projection,w=this.renderSession.offset,f,u,h,b,k,d,y,e,o;if(r.filterPasses.length>1){for(t.viewport(0,0,i.width*this.renderSession.resolution,i.height*this.renderSession.resolution),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=i.height,this.vertexArray[2]=i.width,this.vertexArray[3]=i.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=i.width,this.vertexArray[7]=0,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=i.width/this.width,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray),f=s,u=this.texturePool.pop(),u||(u=new n.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution)),u.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution),t.bindFramebuffer(t.FRAMEBUFFER,u.frameBuffer),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.BLEND),h=0;h<r.filterPasses.length-1;h++)b=r.filterPasses[h],t.bindFramebuffer(t.FRAMEBUFFER,u.frameBuffer),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,f.texture),this.applyFilterPass(b,i,i.width,i.height),k=f,f=u,u=k;t.enable(t.BLEND);s=f;this.texturePool.push(u)}d=r.filterPasses[r.filterPasses.length-1];this.offsetX-=i.x;this.offsetY-=i.y;var c=this.width,l=this.height,a=0,v=0,g=this.buffer;this.filterStack.length===0?t.colorMask(!0,!0,!0,!0):(y=this.filterStack[this.filterStack.length-1],i=y._filterArea,c=i.width,l=i.height,a=i.x,v=i.y,g=y._glFilterTexture.frameBuffer);p.x=c/2;p.y=-l/2;w.x=a;w.y=v;i=r._filterArea;e=i.x-a;o=i.y-v;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=e;this.vertexArray[1]=o+i.height;this.vertexArray[2]=e+i.width;this.vertexArray[3]=o+i.height;this.vertexArray[4]=e;this.vertexArray[5]=o;this.vertexArray[6]=e+i.width;this.vertexArray[7]=o;t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray);t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=i.width/this.width;this.uvArray[5]=i.height/this.height;this.uvArray[6]=i.width/this.width;this.uvArray[7]=i.height/this.height;t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);t.viewport(0,0,c*this.renderSession.resolution,l*this.renderSession.resolution);t.bindFramebuffer(t.FRAMEBUFFER,g);t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_2D,s.texture);this.renderSession.stencilManager&&this.renderSession.stencilManager.destroy();this.renderSession.stencilManager=r._previous_stencil_mgr;r._previous_stencil_mgr=null;this.renderSession.stencilManager.count>0?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST);this.applyFilterPass(d,i,c,l);this.texturePool.push(s);r._glFilterTexture=null},n.WebGLFilterManager.prototype.applyFilterPass=function(t,i,r,u){var f=this.gl,e=t.shaders[f.id];e||(e=new n.PixiShader(f),e.fragmentSrc=t.fragmentSrc,e.uniforms=t.uniforms,e.init(!0),t.shaders[f.id]=e);this.renderSession.shaderManager.setShader(e);f.uniform2f(e.projectionVector,r/2,-u/2);f.uniform2f(e.offsetVector,0,0);t.uniforms.dimensions&&(t.uniforms.dimensions.value[0]=this.width,t.uniforms.dimensions.value[1]=this.height,t.uniforms.dimensions.value[2]=this.vertexArray[0],t.uniforms.dimensions.value[3]=this.vertexArray[5]);e.syncUniforms();f.bindBuffer(f.ARRAY_BUFFER,this.vertexBuffer);f.vertexAttribPointer(e.aVertexPosition,2,f.FLOAT,!1,0,0);f.bindBuffer(f.ARRAY_BUFFER,this.uvBuffer);f.vertexAttribPointer(e.aTextureCoord,2,f.FLOAT,!1,0,0);f.bindBuffer(f.ARRAY_BUFFER,this.colorBuffer);f.vertexAttribPointer(e.colorAttribute,2,f.FLOAT,!1,0,0);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this.indexBuffer);f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0);this.renderSession.drawCount++},n.WebGLFilterManager.prototype.initShaderBuffers=function(){var n=this.gl;this.vertexBuffer=n.createBuffer();this.uvBuffer=n.createBuffer();this.colorBuffer=n.createBuffer();this.indexBuffer=n.createBuffer();this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]);n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer);n.bufferData(n.ARRAY_BUFFER,this.vertexArray,n.STATIC_DRAW);this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]);n.bindBuffer(n.ARRAY_BUFFER,this.uvBuffer);n.bufferData(n.ARRAY_BUFFER,this.uvArray,n.STATIC_DRAW);this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]);n.bindBuffer(n.ARRAY_BUFFER,this.colorBuffer);n.bufferData(n.ARRAY_BUFFER,this.colorArray,n.STATIC_DRAW);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),n.STATIC_DRAW)},n.WebGLFilterManager.prototype.destroy=function(){var n=this.gl,t;for(this.filterStack=null,this.offsetX=0,this.offsetY=0,t=0;t<this.texturePool.length;t++)this.texturePool[t].destroy();this.texturePool=null;n.deleteBuffer(this.vertexBuffer);n.deleteBuffer(this.uvBuffer);n.deleteBuffer(this.colorBuffer);n.deleteBuffer(this.indexBuffer)},i={36054:"Incomplete attachment",36055:"Missing attachment",36057:"Incomplete dimensions",36061:"Framebuffer unsupported"},n.FilterTexture=function(t,i,r,f,e){e=typeof e=="number"?e:0;this.gl=t;this.frameBuffer=u(t,i,r,f||n.scaleModes.DEFAULT,e);this.texture=this.frameBuffer.targetTexture;this.width=i;this.height=r;this.renderBuffer=this.frameBuffer.renderBuffer},n.FilterTexture.prototype.constructor=n.FilterTexture,n.FilterTexture.prototype.clear=function(){var n=this.gl;n.clearColor(0,0,0,0);n.clear(n.COLOR_BUFFER_BIT)},n.FilterTexture.prototype.resize=function(n,t){if(this.width!==n||this.height!==t){this.width=n;this.height=t;var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,n,t,0,i.RGBA,i.UNSIGNED_BYTE,null);i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer);i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,n,t)}},n.FilterTexture.prototype.destroy=function(){var n=this.gl;n.deleteFramebuffer(this.frameBuffer);n.deleteTexture(this.texture);this.frameBuffer=null;this.texture=null},n.CanvasBuffer=function(n,t){this.width=n;this.height=t;this.canvas=Phaser.CanvasPool.create(this,this.width,this.height);this.context=this.canvas.getContext("2d");this.canvas.width=n;this.canvas.height=t},n.CanvasBuffer.prototype.constructor=n.CanvasBuffer,n.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.width,this.height)},n.CanvasBuffer.prototype.resize=function(n,t){this.width=this.canvas.width=n;this.height=this.canvas.height=t},n.CanvasBuffer.prototype.destroy=function(){Phaser.CanvasPool.remove(this)},n.CanvasMaskManager=function(){},n.CanvasMaskManager.prototype.constructor=n.CanvasMaskManager,n.CanvasMaskManager.prototype.pushMask=function(t,i){var f=i.context;f.save();var e=t.alpha,r=t.worldTransform,u=i.resolution;f.setTransform(r.a*u,r.b*u,r.c*u,r.d*u,r.tx*u,r.ty*u);n.CanvasGraphics.renderGraphicsMask(t,f);f.clip();t.worldAlpha=e},n.CanvasMaskManager.prototype.popMask=function(n){n.context.restore()},n.CanvasTinter=function(){},n.CanvasTinter.getTintedTexture=function(t,i){var r=t.tintedTexture||Phaser.CanvasPool.create(this);return n.CanvasTinter.tintMethod(t.texture,i,r),r},n.CanvasTinter.tintWithMultiply=function(n,t,i){var f=i.getContext("2d"),e=n.crop,u=e.width,r=e.height;n.rotated&&(u=r,r=e.width);(i.width!==u||i.height!==r)&&(i.width=u,i.height=r);f.clearRect(0,0,u,r);f.fillStyle="#"+("00000"+(t|0).toString(16)).substr(-6);f.fillRect(0,0,u,r);f.globalCompositeOperation="multiply";f.drawImage(n.baseTexture.source,e.x,e.y,u,r,0,0,u,r);f.globalCompositeOperation="destination-atop";f.drawImage(n.baseTexture.source,e.x,e.y,u,r,0,0,u,r)},n.CanvasTinter.tintWithPerPixel=function(t,i,r){var h=r.getContext("2d"),s=t.crop,o=s.width,e=s.height,u,c;t.rotated&&(o=e,e=s.width);(r.width!==o||r.height!==e)&&(r.width=o,r.height=e);h.globalCompositeOperation="copy";h.drawImage(t.baseTexture.source,s.x,s.y,o,e,0,0,o,e);var l=Phaser.Color.hexToRGBArray(i),v=l[0],y=l[1],p=l[2],a=h.getImageData(0,0,o,e),f=a.data;for(u=0;u<f.length;u+=4)f[u+0]*=v,f[u+1]*=y,f[u+2]*=p,n.CanvasTinter.canHandleAlpha||(c=f[u+3],f[u+0]/=255/c,f[u+1]/=255/c,f[u+2]/=255/c);h.putImageData(a,0,0)},n.CanvasRenderer=function(t,i){if(this.game=t,n.defaultRenderer||(n.defaultRenderer=this),this.type=Phaser.CANVAS,this.resolution=t.resolution,this.clearBeforeRender=t.clearBeforeRender,this.transparent=t.transparent,this.autoResize=!1,this.width=t.width*this.resolution,this.height=t.height*this.resolution,this.view=t.canvas,this.context=this.view.getContext("2d",{alpha:this.transparent}),!this.context)throw new Error("Failed to create a Canvas 2d context.");this.refresh=!0;this.count=0;this.maskManager=new n.CanvasMaskManager;this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:Phaser.Canvas.getSmoothingPrefix(this.context),roundPixels:i.roundPixels||!1};this.mapBlendModes();this.resize(this.width,this.height)},n.CanvasRenderer.prototype.constructor=n.CanvasRenderer,n.CanvasRenderer.prototype.render=function(n){this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;this.renderSession.currentBlendMode=0;this.renderSession.shakeX=this.game.camera._shake.x;this.renderSession.shakeY=this.game.camera._shake.y;this.context.globalCompositeOperation="source-over";navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear());this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):n._bgColor&&(this.context.fillStyle=n._bgColor.rgba,this.context.fillRect(0,0,this.width,this.height)));this.renderDisplayObject(n)},n.CanvasRenderer.prototype.setTexturePriority=function(){},n.CanvasRenderer.prototype.destroy=function(n){n===undefined&&(n=!0);n&&this.view.parent&&this.view.parent.removeChild(this.view);this.view=null;this.context=null;this.maskManager=null;this.renderSession=null},n.CanvasRenderer.prototype.resize=function(t,i){this.width=t*this.resolution;this.height=i*this.resolution;this.view.width=this.width;this.view.height=this.height;this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px");this.renderSession.smoothProperty&&(this.context[this.renderSession.smoothProperty]=this.renderSession.scaleMode===n.scaleModes.LINEAR)},n.CanvasRenderer.prototype.renderDisplayObject=function(n,t,i){this.renderSession.context=t||this.context;this.renderSession.resolution=this.resolution;n._renderCanvas(this.renderSession,i)},n.CanvasRenderer.prototype.mapBlendModes=function(){if(!n.blendModesCanvas){var t=[],i=n.blendModes,r=this.game.device.canUseMultiply;t[i.NORMAL]="source-over";t[i.ADD]="lighter";t[i.MULTIPLY]=r?"multiply":"source-over";t[i.SCREEN]=r?"screen":"source-over";t[i.OVERLAY]=r?"overlay":"source-over";t[i.DARKEN]=r?"darken":"source-over";t[i.LIGHTEN]=r?"lighten":"source-over";t[i.COLOR_DODGE]=r?"color-dodge":"source-over";t[i.COLOR_BURN]=r?"color-burn":"source-over";t[i.HARD_LIGHT]=r?"hard-light":"source-over";t[i.SOFT_LIGHT]=r?"soft-light":"source-over";t[i.DIFFERENCE]=r?"difference":"source-over";t[i.EXCLUSION]=r?"exclusion":"source-over";t[i.HUE]=r?"hue":"source-over";t[i.SATURATION]=r?"saturation":"source-over";t[i.COLOR]=r?"color":"source-over";t[i.LUMINOSITY]=r?"luminosity":"source-over";n.blendModesCanvas=t}},n.BaseTexture=function(t,i,r){(this.resolution=r||1,this.width=100,this.height=100,this.scaleMode=i||n.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=t,this.premultipliedAlpha=!0,this._glTextures=[],this.mipmap=!1,this.textureIndex=0,this._dirty=[!0,!0,!0,!0],t)&&((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height&&(this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty()),this.skipRender=!1,this._powerOf2=!1)},n.BaseTexture.prototype.constructor=n.BaseTexture,n.BaseTexture.prototype.forceLoaded=function(n,t){this.hasLoaded=!0;this.width=n;this.height=t;this.dirty()},n.BaseTexture.prototype.destroy=function(){this.source&&Phaser.CanvasPool.removeByCanvas(this.source);this.source=null;this.unloadFromGPU()},n.BaseTexture.prototype.dirty=function(){for(var n=0;n<this._glTextures.length;n++)this._dirty[n]=!0},n.BaseTexture.prototype.unloadFromGPU=function(){var t,i,r;for(this.dirty(),t=this._glTextures.length-1;t>=0;t--)i=this._glTextures[t],r=n.glContexts[t],r&&i&&r.deleteTexture(i);this._glTextures.length=0;this.dirty()},n.BaseTexture.fromCanvas=function(t,i,r){return t.width===0&&(t.width=1),t.height===0&&(t.height=1),r=r||1,new n.BaseTexture(t,i,r)},n.TextureSilentFail=!1,n.Texture=function(t,i,r,u){this.noFrame=!1;i||(this.noFrame=!0,i=new n.Rectangle(0,0,1,1));t instanceof n.Texture&&(t=t.baseTexture);this.baseTexture=t;this.frame=i;this.trim=u;this.valid=!1;this.isTiling=!1;this.requiresUpdate=!1;this.requiresReTint=!1;this._uvs=null;this.width=0;this.height=0;this.crop=r||new n.Rectangle(0,0,1,1);this.rotated=!1;t.hasLoaded&&(this.noFrame&&(i=new n.Rectangle(0,0,t.width,t.height)),this.setFrame(i))},n.Texture.prototype.constructor=n.Texture,n.Texture.prototype.onBaseTextureLoaded=function(){var t=this.baseTexture;this.noFrame&&(this.frame=new n.Rectangle(0,0,t.width,t.height));this.setFrame(this.frame)},n.Texture.prototype.destroy=function(n){n&&this.baseTexture.destroy();this.valid=!1},n.Texture.prototype.setFrame=function(t){if(this.noFrame=!1,this.frame=t,this.width=t.width,this.height=t.height,this.crop.x=t.x,this.crop.y=t.y,this.crop.width=t.width,this.crop.height=t.height,!this.trim&&(t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height)){if(!n.TextureSilentFail)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=!1;return}this.valid=t&&t.width&&t.height&&this.baseTexture.source&&this.baseTexture.hasLoaded;this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height);this.valid&&this._updateUvs()},n.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new n.TextureUvs);var t=this.crop,i=this.baseTexture.width,r=this.baseTexture.height;this._uvs.x0=t.x/i;this._uvs.y0=t.y/r;this._uvs.x1=(t.x+t.width)/i;this._uvs.y1=t.y/r;this._uvs.x2=(t.x+t.width)/i;this._uvs.y2=(t.y+t.height)/r;this._uvs.x3=t.x/i;this._uvs.y3=(t.y+t.height)/r},n.Texture.prototype._updateUvsInverted=function(){this._uvs||(this._uvs=new n.TextureUvs);var t=this.crop,i=this.baseTexture.width,r=this.baseTexture.height;this._uvs.x0=t.x/i;this._uvs.y0=t.y/r;this._uvs.x1=(t.x+t.height)/i;this._uvs.y1=t.y/r;this._uvs.x2=(t.x+t.height)/i;this._uvs.y2=(t.y+t.width)/r;this._uvs.x3=t.x/i;this._uvs.y3=(t.y+t.width)/r},n.Texture.fromCanvas=function(t,i){var r=n.BaseTexture.fromCanvas(t,i);return new n.Texture(r)},n.TextureUvs=function(){this.x0=0;this.y0=0;this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.x3=0;this.y3=0},typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=n),exports.PIXI=n):typeof define!="undefined"&&define.amd?define("PIXI",function(){return t.PIXI=n}()):t.PIXI=n,n}.call(this);
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
(function(){var s=this,n,i,f,r;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n=n||{VERSION:"2.14.0",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,WEBGL_MULTI:4,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,CIRCLE:21,RECTANGLE:22,LINE:23,MATRIX:24,POINT:25,ROUNDEDRECTANGLE:26,CREATURE:27,VIDEO:28,PENDING_ATLAS:-1,HORIZONTAL:0,VERTICAL:1,LANDSCAPE:0,PORTRAIT:1,ANGLE_UP:270,ANGLE_DOWN:90,ANGLE_LEFT:180,ANGLE_RIGHT:0,ANGLE_NORTH_EAST:315,ANGLE_NORTH_WEST:225,ANGLE_SOUTH_EAST:45,ANGLE_SOUTH_WEST:135,TOP_LEFT:0,TOP_CENTER:1,TOP_RIGHT:2,LEFT_TOP:3,LEFT_CENTER:4,LEFT_BOTTOM:5,CENTER:6,RIGHT_TOP:7,RIGHT_CENTER:8,RIGHT_BOTTOM:9,BOTTOM_LEFT:10,BOTTOM_CENTER:11,BOTTOM_RIGHT:12,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1},PIXI:PIXI||{},_UID:0};
/**
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
typeof AudioBufferSourceNode!="undefined"&&(AudioBufferSourceNode.prototype.start||(AudioBufferSourceNode.prototype.start=AudioBufferSourceNode.prototype.noteGrainOn),AudioBufferSourceNode.prototype.stop||(AudioBufferSourceNode.prototype.stop=AudioBufferSourceNode.prototype.noteOff));Math.trunc||(Math.trunc=function(n){return n<0?Math.ceil(n):Math.floor(n)});Function.prototype.bind||(Function.prototype.bind=function(){var n=Array.prototype.slice;return function(t){function r(){var u=f.concat(n.call(arguments));i.apply(this instanceof r?this:t,u)}var i=this,f=n.call(arguments,1);if(typeof i!="function")throw new TypeError;return r.prototype=function u(n){return n&&(u.prototype=n),(this instanceof u)?void 0:new u}(i.prototype),r}}());Array.isArray||(Array.isArray=function(n){return Object.prototype.toString.call(n)==="[object Array]"});Array.prototype.forEach||(Array.prototype.forEach=function(n){"use strict";var i,r,u,t;if(this===void 0||this===null)throw new TypeError;if(i=Object(this),r=i.length>>>0,typeof n!="function")throw new TypeError;for(u=arguments.length>=2?arguments[1]:void 0,t=0;t<r;t++)t in i&&n.call(u,i[t],t,i)});typeof Uint32Array!="function"&&typeof Uint32Array!="object"&&(i=function(n){window[n]=function(n){var t;if(typeof n=="number")for(Array.call(this,n),this.length=n,t=0;t<this.length;t++)this[t]=0;else for(Array.call(this,n.length),this.length=n.length,t=0;t<this.length;t++)this[t]=n[t]};window[n].prototype=[];window[n].constructor=window[n]},i("Float32Array"),i("Uint32Array"),i("Uint16Array"),i("Int16Array"),i("ArrayBuffer"));window.console||(window.console={},window.console.log=window.console.assert=function(){},window.console.warn=window.console.assert=function(){});Object.assign||(Object.assign=function(n){"use strict";var u,f,i,t,r;if(n==null)throw new TypeError("Cannot convert undefined or null to object");for(u=Object(n),f=Object.prototype.hasOwnProperty,i=1;i<arguments.length;i++)if(t=arguments[i],t!=null)for(r in t)f.call(t,r)&&(u[r]=t[r]);return u});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Utils={defaults:function(n,t){for(var i,u=Object.keys(t),r=0,f=u.length;r<f;r++)i=u[r],n[i]===undefined&&(n[i]=t[i]);return n},reverseString:function(n){return n.split("").reverse().join("")},getProperty:function(n,t){var i=t.split(".");switch(i.length){case 1:return n[t];case 2:return n[i[0]][i[1]];case 3:return n[i[0]][i[1]][i[2]];case 4:return n[i[0]][i[1]][i[2]][i[3]];default:return this._getProperty(n,t)}},setProperties:function(n,t){for(var i in t)this.setProperty(n,i,t[i]);return n},setProperty:function(n,t,i){var r=t.split(".");switch(r.length){case 1:n[t]=i;break;case 2:n[r[0]][r[1]]=i;break;case 3:n[r[0]][r[1]][r[2]]=i;break;case 4:n[r[0]][r[1]][r[2]][r[3]]=i;break;default:this._setProperty(n,t,i)}},_getProperty:function(n,t){for(var u=t.split("."),e=u.length,r=0,i=n,f;r<e;)if(f=u[r],i!=null)i=i[f],r++;else return undefined;return i},_setProperty:function(n,t,i){var r=t.split("."),o=r.length,u=0,f=n,e=r[0];if(o===1)n[t]=i;else{while(u<o-1)f=f[e],u++,e=r[u];f[e]=i}return n},chanceRoll:function(n){return n===undefined&&(n=50),n>0&&Math.random()*100<=n},randomChoice:function(n,t){return Math.random()<.5?n:t},parseDimension:function(n,t){var r=0,i=0;return typeof n=="string"?n.substr(-1)==="%"?(r=parseInt(n,10)/100,i=t===0?window.innerWidth*r:window.innerHeight*r):i=parseInt(n,10):i=n,i},pad:function(n,t,i,r){var t,i,r,u,f,e;if(t===undefined&&(t=0),i===undefined&&(i=" "),r===undefined&&(r=3),n=n.toString(),u=0,t+1>=n.length)switch(r){case 1:n=new Array(t+1-n.length).join(i)+n;break;case 3:f=Math.ceil((u=t-n.length)/2);e=u-f;n=new Array(e+1).join(i)+n+new Array(f+1).join(i);break;default:n=n+new Array(t+1-n.length).join(i)}return n},isPlainObject:function(n){if(typeof n!="object"||n.nodeType||n===n.window)return!1;try{if(n.constructor&&!{}.hasOwnProperty.call(n.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},extend:function(){var e,f,r,i,o,s,t=arguments[0]||{},u=1,c=arguments.length,h=!1;for(typeof t=="boolean"&&(h=t,t=arguments[1]||{},u=2),c===u&&(t=this,--u);u<c;u++)if((e=arguments[u])!=null)for(f in e)(r=t[f],i=e[f],t!==i)&&(h&&i&&(n.Utils.isPlainObject(i)||(o=Array.isArray(i)))?(o?(o=!1,s=r&&Array.isArray(r)?r:[]):s=r&&n.Utils.isPlainObject(r)?r:{},t[f]=n.Utils.extend(h,s,i)):i!==undefined&&(t[f]=i));return t},mixinPrototype:function(n,t,i){var e,f,u,r;for(i===undefined&&(i=!1),e=Object.keys(t),f=0;f<e.length;f++)if(u=e[f],r=t[u],!i&&u in n)continue;else r&&(typeof r.get=="function"||typeof r.set=="function")?typeof r.clone=="function"?n[u]=r.clone():Object.defineProperty(n,u,r):n[u]=r},mixin:function(t,i){var r,u,f;if(!t||typeof t!="object")return i;for(r in t)(u=t[r],u.childNodes||u.cloneNode)||(f=typeof t[r],i[r]=t[r]&&f==="object"?typeof i[r]===f?n.Utils.mixin(t[r],i[r]):n.Utils.mixin(t[r],new u.constructor):t[r]);return i}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Circle=function(t,i,r){t=t||0;i=i||0;r=r||0;this.x=t;this.y=i;this._diameter=r;this._radius=0;r>0&&(this._radius=r*.5);this.type=n.CIRCLE};n.Circle.prototype={circumference:function(){return 2*Math.PI*this._radius},random:function(t){t===undefined&&(t=new n.Point);var r=2*Math.PI*Math.random(),i=Math.random()+Math.random(),u=i>1?2-i:i,f=u*Math.cos(r),e=u*Math.sin(r);return t.x=this.x+f*this.radius,t.y=this.y+e*this.radius,t},getBounds:function(){return new n.Rectangle(this.x-this.radius,this.y-this.radius,this.diameter,this.diameter)},setTo:function(n,t,i){return this.x=n,this.y=t,this._diameter=i,this._radius=i*.5,this},copyFrom:function(n){return this.setTo(n.x,n.y,n.diameter)},copyTo:function(n){return n.x=this.x,n.y=this.y,n.diameter=this._diameter,n},distance:function(t,i){var r=n.Math.distance(this.x,this.y,t.x,t.y);return i?Math.round(r):r},clone:function(t){return t===undefined||t===null?t=new n.Circle(this.x,this.y,this.diameter):t.setTo(this.x,this.y,this.diameter),t},contains:function(t,i){return n.Circle.contains(this,t,i)},circumferencePoint:function(t,i,r){return n.Circle.circumferencePoint(this,t,i,r)},sample:function(t,i,r,u,f){t||(t=60);i==null&&(i=0);r==null&&(r=n.Math.PI2);f||(f=[]);for(var e=0;e<t;)this.circumferencePoint(n.Math.linear(i,r,e/t),u,f[e]||(f[e]=new n.Point)),e+=1;return f},offset:function(n,t){return this.x+=n,this.y+=t,this},offsetPoint:function(n){return this.offset(n.x,n.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}};n.Circle.prototype.constructor=n.Circle;Object.defineProperty(n.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(n){n>0&&(this._diameter=n,this._radius=n*.5)}});Object.defineProperty(n.Circle.prototype,"radius",{get:function(){return this._radius},set:function(n){n>0&&(this._radius=n,this._diameter=n*2)}});Object.defineProperty(n.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(n){n>this.x?(this._radius=0,this._diameter=0):this.radius=this.x-n}});Object.defineProperty(n.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(n){n<this.x?(this._radius=0,this._diameter=0):this.radius=n-this.x}});Object.defineProperty(n.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(n){n>this.y?(this._radius=0,this._diameter=0):this.radius=this.y-n}});Object.defineProperty(n.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(n){n<this.y?(this._radius=0,this._diameter=0):this.radius=n-this.y}});Object.defineProperty(n.Circle.prototype,"area",{get:function(){return this._radius>0?Math.PI*this._radius*this._radius:0}});Object.defineProperty(n.Circle.prototype,"empty",{get:function(){return this._diameter===0},set:function(n){n===!0&&this.setTo(0,0,0)}});n.Circle.contains=function(n,t,i){if(n.radius>0&&t>=n.left&&t<=n.right&&i>=n.top&&i<=n.bottom){var r=(n.x-t)*(n.x-t),u=(n.y-i)*(n.y-i);return r+u<=n.radius*n.radius}return!1};n.Circle.equals=function(n,t){return n.x===t.x&&n.y===t.y&&n.diameter===t.diameter};n.Circle.intersects=function(t,i){return n.Math.distance(t.x,t.y,i.x,i.y)<=t.radius+i.radius};n.Circle.circumferencePoint=function(t,i,r,u){return r===undefined&&(r=!1),u===undefined&&(u=new n.Point),r===!0&&(i=n.Math.degToRad(i)),u.x=t.x+t.radius*Math.cos(i),u.y=t.y+t.radius*Math.sin(i),u};n.Circle.intersectsRectangle=function(n,t){var r=Math.abs(n.x-t.x-t.halfWidth),o=t.halfWidth+n.radius,i,u;if(r>o||(i=Math.abs(n.y-t.y-t.halfHeight),u=t.halfHeight+n.radius,i>u))return!1;if(r<=t.halfWidth||i<=t.halfHeight)return!0;var f=r-t.halfWidth,e=i-t.halfHeight,s=f*f,h=e*e,c=n.radius*n.radius;return s+h<=c};n.Circle.intersectsLine=function(t,i,r){var a=t.x,o=t.y,u=(i.end.y-i.start.y)/(i.end.x-i.start.x),h=i.end.y-u*i.end.x,f=t.radius,e=t.radius,s=h+u*a,v=(a*e*e-u*f*f*(h-o)+f*e*Math.sqrt(f*f*u*u+e*e-s*s-o*o+2*s*o))/(f*f*u*u+e*e),y=(a*e*e-u*f*f*(h-o)-f*e*Math.sqrt(f*f*u*u+e*e-s*s-o*o+2*s*o))/(f*f*u*u+e*e),b=u*v+h,k=u*y+h,c=new n.Point(v,b),l=new n.Point(y,k),p=i.pointOnSegment(c.x,c.y,.01),w=i.pointOnSegment(l.x,l.y,.01);return p&&w?r?[c,l]:!0:p?r?[c]:!0:w?r?[l]:!0:r?[]:!1};PIXI.Circle=n.Circle;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @author       Chad Engler <chad@pantherdev.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Ellipse=function(t,i,r,u){t=t||0;i=i||0;r=r||0;u=u||0;this.x=t;this.y=i;this.width=r;this.height=u;this.type=n.ELLIPSE};n.Ellipse.prototype={setTo:function(n,t,i,r){return this.x=n,this.y=t,this.width=i,this.height=r,this},getBounds:function(){return new n.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},copyFrom:function(n){return this.setTo(n.x,n.y,n.width,n.height)},copyTo:function(n){return n.x=this.x,n.y=this.y,n.width=this.width,n.height=this.height,n},clone:function(t){return t===undefined||t===null?t=new n.Ellipse(this.x,this.y,this.width,this.height):t.setTo(this.x,this.y,this.width,this.height),t},contains:function(t,i){return n.Ellipse.contains(this,t,i)},random:function(t){t===undefined&&(t=new n.Point);var i=Math.random()*Math.PI*2,r=Math.sqrt(Math.random());return t.x=this.centerX+.5*r*Math.cos(i)*this.width,t.y=this.centerY+.5*r*Math.sin(i)*this.height,t},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}};n.Ellipse.prototype.constructor=n.Ellipse;Object.defineProperty(n.Ellipse.prototype,"left",{get:function(){return this.x},set:function(n){this.x=n}});Object.defineProperty(n.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(n){this.width=n<this.x?0:n-this.x}});Object.defineProperty(n.Ellipse.prototype,"top",{get:function(){return this.y},set:function(n){this.y=n}});Object.defineProperty(n.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(n){this.height=n<this.y?0:n-this.y}});Object.defineProperty(n.Ellipse.prototype,"centerX",{get:function(){return this.x+.5*this.width}});Object.defineProperty(n.Ellipse.prototype,"centerY",{get:function(){return this.y+.5*this.height}});Object.defineProperty(n.Ellipse.prototype,"empty",{get:function(){return this.width===0||this.height===0},set:function(n){n===!0&&this.setTo(0,0,0,0)}});n.Ellipse.contains=function(n,t,i){if(n.width<=0||n.height<=0)return!1;var r=(t-n.x)/n.width-.5,u=(i-n.y)/n.height-.5;return r*=r,u*=u,r+u<.25};n.Ellipse.intersectsLine=function(t,i,r){var a=t.x,o=t.y,u=(i.end.y-i.start.y)/(i.end.x-i.start.x),h=i.end.y-u*i.end.x,f=t.width/2,e=t.height/2,s=h+u*a,v=(a*e*e-u*f*f*(h-o)+f*e*Math.sqrt(f*f*u*u+e*e-s*s-o*o+2*s*o))/(f*f*u*u+e*e),y=(a*e*e-u*f*f*(h-o)-f*e*Math.sqrt(f*f*u*u+e*e-s*s-o*o+2*s*o))/(f*f*u*u+e*e),b=u*v+h,k=u*y+h,c=new n.Point(v,b),l=new n.Point(y,k),p=i.pointOnSegment(c.x,c.y,.01),w=i.pointOnSegment(l.x,l.y,.01);return p&&w?r?[c,l]:!0:p?r?[c]:!0:w?r?[l]:!0:r?[]:!1};PIXI.Ellipse=n.Ellipse;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Line=function(t,i,r,u){t=t||0;i=i||0;r=r||0;u=u||0;this.start=new n.Point(t,i);this.end=new n.Point(r,u);this.type=n.LINE};n.Line.prototype={setTo:function(n,t,i,r){return this.start.setTo(n,t),this.end.setTo(i,r),this},fromPoints:function(n,t){return this.setTo(n.x,n.y,t.x,t.y),this},fromSprite:function(n,t,i){return(i===undefined&&(i=!1),i)?this.setTo(n.centerX,n.centerY,t.centerX,t.centerY):this.fromPoints(n,t)},fromAngle:function(n,t,i,r){return this.start.setTo(n,t),this.end.setTo(n+Math.cos(i)*r,t+Math.sin(i)*r),this},rotate:function(n,t){var i=(this.start.x+this.end.x)/2,r=(this.start.y+this.end.y)/2;return this.start.rotate(i,r,n,t),this.end.rotate(i,r,n,t),this},rotateAround:function(n,t,i,r){return this.start.rotate(n,t,i,r),this.end.rotate(n,t,i,r),this},intersects:function(t,i,r){return n.Line.intersectsPoints(this.start,this.end,t.start,t.end,i,r)},reflect:function(t){return n.Line.reflect(this,t)},midPoint:function(t){return t===undefined&&(t=new n.Point),t.x=(this.start.x+this.end.x)/2,t.y=(this.start.y+this.end.y)/2,t},centerOn:function(n,t){var u=(this.start.x+this.end.x)/2,f=(this.start.y+this.end.y)/2,i=n-u,r=t-f;this.start.add(i,r);this.end.add(i,r)},pointOnLine:function(t,i,r){return n.Math.fuzzyEqual((t-this.start.x)*(this.end.y-this.start.y),(this.end.x-this.start.x)*(i-this.start.y),r||0)},pointOnSegment:function(n,t,i){var r=Math.min(this.start.x,this.end.x),u=Math.max(this.start.x,this.end.x),f=Math.min(this.start.y,this.end.y),e=Math.max(this.start.y,this.end.y);return this.pointOnLine(n,t,i)&&n>=r&&n<=u&&t>=f&&t<=e},random:function(t){t===undefined&&(t=new n.Point);var i=Math.random();return t.x=this.start.x+i*(this.end.x-this.start.x),t.y=this.start.y+i*(this.end.y-this.start.y),t},coordinatesOnLine:function(n,t){var h,c;n===undefined&&(n=1);t===undefined&&(t=[]);var i=Math.round(this.start.x),r=Math.round(this.start.y),u=Math.round(this.end.x),f=Math.round(this.end.y),e=Math.abs(u-i),o=Math.abs(f-r),l=i<u?1:-1,a=r<f?1:-1,s=e-o;for(t.push([i,r]),h=1;!(i===u&&r===f);)c=s<<1,c>-o&&(s-=o,i+=l),c<e&&(s+=e,r+=a),h%n==0&&t.push([i,r]),h++;return t},clone:function(t){return t===undefined||t===null?t=new n.Line(this.start.x,this.start.y,this.end.x,this.end.y):t.setTo(this.start.x,this.start.y,this.end.x,this.end.y),t}};Object.defineProperty(n.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}});Object.defineProperty(n.Line.prototype,"angle",{get:function(){return n.Point.angle(this.end,this.start)}});Object.defineProperty(n.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}});Object.defineProperty(n.Line.prototype,"perpSlope",{get:function(){return-((this.end.x-this.start.x)/(this.end.y-this.start.y))}});Object.defineProperty(n.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(n.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(n.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(n.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}});Object.defineProperty(n.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(n.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}});Object.defineProperty(n.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}});Object.defineProperty(n.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}});Object.defineProperty(n.Line.prototype,"normalX",{get:function(){return Math.cos(this.angle-1.5707963267948966)}});Object.defineProperty(n.Line.prototype,"normalY",{get:function(){return Math.sin(this.angle-1.5707963267948966)}});Object.defineProperty(n.Line.prototype,"normalAngle",{get:function(){return n.Math.wrap(this.angle-1.5707963267948966,-Math.PI,Math.PI)}});n.Line.intersectsPoints=function(t,i,r,u,f,e){f===undefined&&(f=!0);e===undefined&&(e=new n.Point);var s=i.y-t.y,h=u.y-r.y,c=t.x-i.x,l=r.x-u.x,a=i.x*t.y-t.x*i.y,v=u.x*r.y-r.x*u.y,o=s*l-h*c;if(o===0)return null;if(e.x=(c*v-l*a)/o,e.y=(h*a-s*v)/o,f){var y=(u.y-r.y)*(i.x-t.x)-(u.x-r.x)*(i.y-t.y),p=((u.x-r.x)*(t.y-r.y)-(u.y-r.y)*(t.x-r.x))/y,w=((i.x-t.x)*(t.y-r.y)-(i.y-t.y)*(t.x-r.x))/y;return p>=0&&p<=1&&w>=0&&w<=1?e:null}return e};n.Line.intersects=function(t,i,r,u){return n.Line.intersectsPoints(t.start,t.end,i.start,i.end,r,u)};n.Line.intersectsRectangle=function(n,t){if(n.length===0||t.empty)return!1;var i=n.start.x,r=n.start.y,f=n.end.x,e=n.end.y,o=t.x,s=t.y,h=t.right,c=t.bottom,u=0;if(i>=o&&i<=h&&r>=s&&r<=c||f>=o&&f<=h&&e>=s&&e<=c)return!0;if(i<o&&f>=o){if(u=r+(e-r)*(o-i)/(f-i),u>s&&u<=c)return!0}else if(i>h&&f<=h&&(u=r+(e-r)*(h-i)/(f-i),u>=s&&u<=c))return!0;if(r<s&&e>=s){if(u=i+(f-i)*(s-r)/(e-r),u>=o&&u<=h)return!0}else if(r>c&&e<=c&&(u=i+(f-i)*(c-r)/(e-r),u>=o&&u<=h))return!0;return!1};n.Line.intersectionWithRectangle=function(t,i,r){var u=n.Line.intersectionWithRectangle,y,a,c;r||(r=new n.Point);u.edges||(u.edges=[new n.Line,new n.Line,new n.Line,new n.Line]);u.edgeIntersection||(u.edgeIntersection=new n.Point);var f=u.edges,l=u.edgeIntersection.set(0),e=i.x,o=i.y,s=i.right,h=i.bottom,v=Infinity;for(f[0].setTo(e,o,s,o),f[1].setTo(e,h,s,h),f[2].setTo(e,o,e,h),f[3].setTo(s,o,s,h),a=0;y=f[a];a++)t.intersects(y,!0,l)&&(c=t.start.distance(l),c<v&&(v=c,r.copyFrom(l)));return c!=null?r:null};n.Line.reflect=function(n,t){return 2*t.normalAngle-3.1415926535897931-n.angle};
/**
* @author       Mat Groves http://matgroves.com/ @Doormat23
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Matrix=function(t,i,r,u,f,e){(t===undefined||t===null)&&(t=1);(i===undefined||i===null)&&(i=0);(r===undefined||r===null)&&(r=0);(u===undefined||u===null)&&(u=1);(f===undefined||f===null)&&(f=0);(e===undefined||e===null)&&(e=0);this.a=t;this.b=i;this.c=r;this.d=u;this.tx=f;this.ty=e;this.type=n.MATRIX};n.Matrix.prototype={fromArray:function(n){return this.setTo(n[0],n[1],n[3],n[4],n[2],n[5])},setTo:function(n,t,i,r,u,f){return this.a=n,this.b=t,this.c=i,this.d=r,this.tx=u,this.ty=f,this},clone:function(t){return t===undefined||t===null?t=new n.Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty):(t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty),t},copyTo:function(n){return n.copyFrom(this),n},copyFrom:function(n){return this.a=n.a,this.b=n.b,this.c=n.c,this.d=n.d,this.tx=n.tx,this.ty=n.ty,this},toArray:function(n,t){return t===undefined&&(t=new Float32Array(9)),n?(t[0]=this.a,t[1]=this.b,t[2]=0,t[3]=this.c,t[4]=this.d,t[5]=0,t[6]=this.tx,t[7]=this.ty,t[8]=1):(t[0]=this.a,t[1]=this.c,t[2]=this.tx,t[3]=this.b,t[4]=this.d,t[5]=this.ty,t[6]=0,t[7]=0,t[8]=1),t},apply:function(t,i){return i===undefined&&(i=new n.Point),i.x=this.a*t.x+this.c*t.y+this.tx,i.y=this.b*t.x+this.d*t.y+this.ty,i},applyInverse:function(t,i){i===undefined&&(i=new n.Point);var r=1/(this.a*this.d+this.c*-this.b),u=t.x,f=t.y;return i.x=this.d*r*u+-this.c*r*f+(this.ty*this.c-this.tx*this.d)*r,i.y=this.a*r*f+-this.b*r*u+(-this.ty*this.a+this.tx*this.b)*r,i},translate:function(n,t){return this.tx+=n,this.ty+=t,this},scale:function(n,t){return this.a*=n,this.d*=t,this.c*=n,this.b*=t,this.tx*=n,this.ty*=t,this},rotate:function(n){var t=Math.cos(n),i=Math.sin(n),r=this.a,u=this.c,f=this.tx;return this.a=r*t-this.b*i,this.b=r*i+this.b*t,this.c=u*t-this.d*i,this.d=u*i+this.d*t,this.tx=f*t-this.ty*i,this.ty=f*i+this.ty*t,this},append:function(n){var t=this.a,i=this.b,r=this.c,u=this.d;return this.a=n.a*t+n.b*r,this.b=n.a*i+n.b*u,this.c=n.c*t+n.d*r,this.d=n.c*i+n.d*u,this.tx=n.tx*t+n.ty*r+this.tx,this.ty=n.tx*i+n.ty*u+this.ty,this},identity:function(){return this.setTo(1,0,0,1,0,0)}};n.identityMatrix=new n.Matrix;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Point=function(t,i){t=t||0;i=i||0;this.x=t;this.y=i;this.type=n.POINT};n.Point.prototype={copyFrom:function(n){return this.setTo(n.x,n.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(t,i){return n.Point.set(this,t,i)},set:function(t,i){return n.Point.set(this,t,i)},setToPolar:function(t,i,r){return i==null&&(i=1),r&&(t=n.Math.degToRad(t)),this.setTo(Math.cos(t)*i,Math.sin(t)*i)},add:function(n,t){return this.x+=n,this.y+=t,this},subtract:function(n,t){return this.x-=n,this.y-=t,this},multiply:function(n,t){return this.x*=n,this.y*=t,this},divide:function(n,t){return this.x/=n,this.y/=t,this},clampX:function(t,i){return this.x=n.Math.clamp(this.x,t,i),this},clampY:function(t,i){return this.y=n.Math.clamp(this.y,t,i),this},clamp:function(t,i){return this.x=n.Math.clamp(this.x,t,i),this.y=n.Math.clamp(this.y,t,i),this},clip:function(n){var t=n.left,i=n.top,r=n.right,u=n.bottom;return this.x<t?this.x=t:this.x>r&&(this.x=r),this.y<i?this.y=i:this.y>u&&(this.y=u),this},clone:function(t){return t===undefined||t===null?t=new n.Point(this.x,this.y):t.setTo(this.x,this.y),t},copyTo:function(n){return n.x=this.x,n.y=this.y,n},distance:function(t,i){return n.Point.distance(this,t,i)},equals:function(n){return n.x===this.x&&n.y===this.y},equalsXY:function(n,t){return this.x===n&&this.y===t},fuzzyEquals:function(t,i){return n.Point.fuzzyEquals(this,t,i)},fuzzyEqualsXY:function(t,i,r){return n.Point.fuzzyEqualsXY(this,t,i,r)},angle:function(n,t){return this.angleXY(n.x,n.y,t)},angleXY:function(t,i,r){var u=Math.atan2(i-this.y,t-this.x);return r?n.Math.radToDeg(u):u},atan:function(t){var i=Math.atan2(this.y,this.x);return t?n.Math.radToDeg(i):i},rotate:function(t,i,r,u,f){return n.Point.rotate(this,t,i,r,u,f)},getMagnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},getMagnitudeSq:function(){return this.x*this.x+this.y*this.y},setMagnitude:function(n){return this.normalize().multiply(n,n)},normalize:function(){if(!this.isZero()){var n=this.getMagnitude();this.x/=n;this.y/=n}return this},limit:function(n){return this.getMagnitudeSq()>n*n&&this.setMagnitude(n),this},expand:function(n){return this.getMagnitudeSq()<n*n&&this.setMagnitude(n),this},isZero:function(){return this.x===0&&this.y===0},dot:function(n){return this.x*n.x+this.y*n.y},cross:function(n){return this.x*n.y-this.y*n.x},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(this.y*-1,this.x)},floor:function(){return this.setTo(Math.floor(this.x),Math.floor(this.y))},ceil:function(){return this.setTo(Math.ceil(this.x),Math.ceil(this.y))},round:function(){return this.setTo(Math.round(this.x),Math.round(this.y))},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}};n.Point.prototype.constructor=n.Point;n.Point.add=function(t,i,r){return r===undefined&&(r=new n.Point),r.x=t.x+i.x,r.y=t.y+i.y,r};n.Point.subtract=function(t,i,r){return r===undefined&&(r=new n.Point),r.x=t.x-i.x,r.y=t.y-i.y,r};n.Point.multiply=function(t,i,r){return r===undefined&&(r=new n.Point),r.x=t.x*i.x,r.y=t.y*i.y,r};n.Point.divide=function(t,i,r){return r===undefined&&(r=new n.Point),r.x=t.x/i.x,r.y=t.y/i.y,r};n.Point.equals=function(n,t){return n.x===t.x&&n.y===t.y};n.Point.equalsXY=function(n,t,i){return n.x===t&&n.y===i};n.Point.fuzzyEquals=function(t,i,r){return n.Math.fuzzyEqual(t.x,i.x,r)&&n.Math.fuzzyEqual(t.y,i.y,r)};n.Point.fuzzyEqualsXY=function(t,i,r,u){return n.Math.fuzzyEqual(t.x,i,u)&&n.Math.fuzzyEqual(t.y,r,u)};n.Point.angle=function(n,t){return Math.atan2(n.y-t.y,n.x-t.x)};n.Point.negative=function(t,i){return i===undefined&&(i=new n.Point),i.setTo(-t.x,-t.y)};n.Point.multiplyAdd=function(t,i,r,u){return u===undefined&&(u=new n.Point),u.setTo(t.x+i.x*r,t.y+i.y*r)};n.Point.interpolate=function(t,i,r,u){return u===undefined&&(u=new n.Point),u.setTo(t.x+(i.x-t.x)*r,t.y+(i.y-t.y)*r)};n.Point.perp=function(t,i){return i===undefined&&(i=new n.Point),i.setTo(-t.y,t.x)};n.Point.rperp=function(t,i){return i===undefined&&(i=new n.Point),i.setTo(t.y,-t.x)};n.Point.distance=function(t,i,r){var u=n.Math.distance(t.x,t.y,i.x,i.y);return r?Math.round(u):u};n.Point.project=function(t,i,r){r===undefined&&(r=new n.Point);var u=t.dot(i)/i.getMagnitudeSq();return u!==0&&r.setTo(u*i.x,u*i.y),r};n.Point.projectUnit=function(t,i,r){r===undefined&&(r=new n.Point);var u=t.dot(i);return u!==0&&r.setTo(u*i.x,u*i.y),r};n.Point.normalRightHand=function(t,i){return i===undefined&&(i=new n.Point),i.setTo(t.y*-1,t.x)};n.Point.normalize=function(t,i){i===undefined&&(i=new n.Point);var r=t.getMagnitude();return r!==0&&i.setTo(t.x/r,t.y/r),i};n.Point.rotate=function(t,i,r,u,f,e){var o;if(f&&(u=n.Math.degToRad(u)),e===undefined){t.subtract(i,r);var s=Math.sin(u),h=Math.cos(u),c=h*t.x-s*t.y,l=s*t.x+h*t.y;t.x=c+i;t.y=l+r}else o=u+Math.atan2(t.y-r,t.x-i),t.x=i+e*Math.cos(o),t.y=r+e*Math.sin(o);return t};n.Point.centroid=function(t,i){var r,u;if(i===undefined&&(i=new n.Point),Object.prototype.toString.call(t)!=="[object Array]")throw new Error("Phaser.Point. Parameter 'points' must be an array");if(r=t.length,r<1)throw new Error("Phaser.Point. Parameter 'points' array must not be empty");if(r===1)return i.copyFrom(t[0]),i;for(u=0;u<r;u++)n.Point.add(i,t[u],i);return i.divide(r,r),i};n.Point.parse=function(t,i,r){i=i||"x";r=r||"y";var u=new n.Point;return t[i]&&(u.x=parseFloat(t[i])),t[r]&&(u.y=parseFloat(t[r])),u};n.Point.trunc=function(t){return t.x=n.Math.trunc(t.x),t.y=n.Math.trunc(t.y),t};n.Point.isPoint=function(n){return n!=null&&typeof n.x=="number"&&typeof n.y=="number"};n.Point.set=function(n,t,i){return n.x=t||0,n.y=i||(i!==0?n.x:0),n};n.Point.sortClockwise=function(n,t){t||(t=this.centroid(n));var i=t.x,r=t.y,u=function(n,t){var u,f,e;return n.x-i>=0&&t.x-i<0?-1:n.x-i<0&&t.x-i>=0?1:n.x-i==0&&t.x-i==0?n.y-r>=0||t.y-r>=0?n.y>t.y?1:-1:t.y>n.y?1:-1:(u=(n.x-i)*-(t.y-r)-(t.x-i)*-(n.y-r),u<0)?-1:u>0?1:(f=(n.x-i)*(n.x-i)+(n.y-r)*(n.y-r),e=(t.x-i)*(t.x-i)+(t.y-r)*(t.y-r),f>e?-1:1)};return n.sort(u)};PIXI.Point=n.Point;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @author       Adrien Brault <adrien.brault@gmail.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Polygon=function(){this.area=0;this._points=[];arguments.length>0&&this.setTo.apply(this,arguments);this.closed=!0;this.flattened=!1;this.type=n.POLYGON};n.Polygon.prototype={toNumberArray:function(n){n===undefined&&(n=[]);for(var t=0;t<this._points.length;t++)typeof this._points[t]=="number"?(n.push(this._points[t]),n.push(this._points[t+1]),t++):(n.push(this._points[t].x),n.push(this._points[t].y));return n},flatten:function(){return this._points=this.toNumberArray(),this.flattened=!0,this},clone:function(t){var i=this._points.slice();return t===undefined||t===null?t=new n.Polygon(i):t.setTo(i),t},contains:function(n,t){var e=!1,i,r;if(this.flattened)for(i=-2,r=this._points.length-2;(i+=2)<this._points.length;r=i){var o=this._points[i],u=this._points[i+1],s=this._points[r],f=this._points[r+1];(u<=t&&t<f||f<=t&&t<u)&&n<(s-o)*(t-u)/(f-u)+o&&(e=!e)}else for(i=-1,r=this._points.length-1;++i<this._points.length;r=i){var o=this._points[i].x,u=this._points[i].y,s=this._points[r].x,f=this._points[r].y;(u<=t&&t<f||f<=t&&t<u)&&n<(s-o)*(t-u)/(f-u)+o&&(e=!e)}return e},setTo:function(n){var r,t,u,i;if(this.area=0,this._points=[],arguments.length>0){for(Array.isArray(n)||(n=Array.prototype.slice.call(arguments)),r=Number.MAX_VALUE,t=0,u=n.length;t<u;t++)typeof n[t]=="number"?(i=new PIXI.Point(n[t],n[t+1]),t++):i=Array.isArray(n[t])?new PIXI.Point(n[t][0],n[t][1]):new PIXI.Point(n[t].x,n[t].y),this._points.push(i),i.y<r&&(r=i.y);this.calculateArea(r)}return this},calculateArea:function(n){for(var i,r,u,f,t=0,e=this._points.length;t<e;t++)i=this._points[t],r=t===e-1?this._points[0]:this._points[t+1],u=(i.y-n+(r.y-n))/2,f=i.x-r.x,this.area+=u*f;return this.area}};n.Polygon.prototype.constructor=n.Polygon;Object.defineProperty(n.Polygon.prototype,"points",{get:function(){return this._points}});PIXI.Polygon=n.Polygon;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Rectangle=function(t,i,r,u){t=t||0;i=i||0;r=r||0;u=u||0;this.x=t;this.y=i;this.width=r;this.height=u;this.type=n.RECTANGLE};n.Rectangle.prototype={offset:function(n,t){return this.x+=n,this.y+=t,this},offsetPoint:function(n){return this.offset(n.x,n.y)},setTo:function(n,t,i,r){return this.x=n,this.y=t,this.width=i,this.height=r,this},scale:function(n,t){return t===undefined&&(t=n),this.width*=n,this.height*=t,this},centerOn:function(n,t){return this.centerX=n,this.centerY=t,this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.width=Math.floor(this.width);this.height=Math.floor(this.height)},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y)},ceilAll:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.width=Math.ceil(this.width);this.height=Math.ceil(this.height)},copyFrom:function(n){return this.setTo(n.x,n.y,n.width,n.height)},copyFromBounds:function(n){return this.setTo(n.left,n.top,n.width,n.height)},copyTo:function(n){return n.x=this.x,n.y=this.y,n.width=this.width,n.height=this.height,n},inflate:function(t,i){return n.Rectangle.inflate(this,t,i)},size:function(t){return n.Rectangle.size(this,t)},resize:function(n,t){return this.width=n,this.height=t,this},clone:function(t){return n.Rectangle.clone(this,t)},contains:function(t,i){return n.Rectangle.contains(this,t,i)},containsRect:function(t){return n.Rectangle.containsRect(t,this)},equals:function(t){return n.Rectangle.equals(this,t)},intersection:function(t,i){return n.Rectangle.intersection(this,t,i)},intersects:function(t){return n.Rectangle.intersects(this,t)},intersectsRaw:function(t,i,r,u,f){return n.Rectangle.intersectsRaw(this,t,i,r,u,f)},union:function(t,i){return n.Rectangle.union(this,t,i)},random:function(t){return t===undefined&&(t=new n.Point),t.x=this.randomX,t.y=this.randomY,t},getPoint:function(t,i){i===undefined&&(i=new n.Point);switch(t){default:case n.TOP_LEFT:return i.set(this.x,this.y);case n.TOP_CENTER:return i.set(this.centerX,this.y);case n.TOP_RIGHT:return i.set(this.right,this.y);case n.LEFT_CENTER:return i.set(this.x,this.centerY);case n.CENTER:return i.set(this.centerX,this.centerY);case n.RIGHT_CENTER:return i.set(this.right,this.centerY);case n.BOTTOM_LEFT:return i.set(this.x,this.bottom);case n.BOTTOM_CENTER:return i.set(this.centerX,this.bottom);case n.BOTTOM_RIGHT:return i.set(this.right,this.bottom)}},sides:function(t,i,r,u){arguments.length||(t=new n.Line,i=new n.Line,r=new n.Line,u=new n.Line);var f=this.x,e=this.y,o=this.right,s=this.bottom;return(t.setTo(f,e,o,e),i.setTo(o,e,o,s),r.setTo(f,s,o,s),u.setTo(f,e,f,s),!arguments.length)?[t,i,r,u]:null},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}};Object.defineProperty(n.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}});Object.defineProperty(n.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}});Object.defineProperty(n.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(n){this.height=n<=this.y?0:n-this.y}});Object.defineProperty(n.Rectangle.prototype,"bottomLeft",{get:function(){return new n.Point(this.x,this.bottom)},set:function(n){this.x=n.x;this.bottom=n.y}});Object.defineProperty(n.Rectangle.prototype,"bottomRight",{get:function(){return new n.Point(this.right,this.bottom)},set:function(n){this.right=n.x;this.bottom=n.y}});Object.defineProperty(n.Rectangle.prototype,"left",{get:function(){return this.x},set:function(n){this.width=n>=this.right?0:this.right-n;this.x=n}});Object.defineProperty(n.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(n){this.width=n<=this.x?0:n-this.x}});Object.defineProperty(n.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}});Object.defineProperty(n.Rectangle.prototype,"perimeter",{get:function(){return this.width*2+this.height*2}});Object.defineProperty(n.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(n){this.x=n-this.halfWidth}});Object.defineProperty(n.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(n){this.y=n-this.halfHeight}});Object.defineProperty(n.Rectangle.prototype,"randomX",{get:function(){return this.x+Math.random()*this.width}});Object.defineProperty(n.Rectangle.prototype,"randomY",{get:function(){return this.y+Math.random()*this.height}});Object.defineProperty(n.Rectangle.prototype,"top",{get:function(){return this.y},set:function(n){n>=this.bottom?(this.height=0,this.y=n):this.height=this.bottom-n}});Object.defineProperty(n.Rectangle.prototype,"topLeft",{get:function(){return new n.Point(this.x,this.y)},set:function(n){this.x=n.x;this.y=n.y}});Object.defineProperty(n.Rectangle.prototype,"topRight",{get:function(){return new n.Point(this.x+this.width,this.y)},set:function(n){this.right=n.x;this.y=n.y}});Object.defineProperty(n.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(n){n===!0&&this.setTo(0,0,0,0)}});n.Rectangle.prototype.constructor=n.Rectangle;n.Rectangle.inflate=function(n,t,i){return n.x-=t,n.width+=2*t,n.y-=i,n.height+=2*i,n};n.Rectangle.inflatePoint=function(t,i){return n.Rectangle.inflate(t,i.x,i.y)};n.Rectangle.size=function(t,i){return i===undefined||i===null?i=new n.Point(t.width,t.height):i.setTo(t.width,t.height),i};n.Rectangle.clone=function(t,i){return i===undefined||i===null?i=new n.Rectangle(t.x,t.y,t.width,t.height):i.setTo(t.x,t.y,t.width,t.height),i};n.Rectangle.createFromBounds=function(t,i){return(i===undefined||i===null)&&(i=new n.Rectangle(t.x,t.y,t.width,t.height)),i.copyFromBounds(t)};n.Rectangle.contains=function(n,t,i){return n.width<=0||n.height<=0?!1:t>=n.x&&t<n.right&&i>=n.y&&i<n.bottom};n.Rectangle.containsRaw=function(n,t,i,r,u,f){return u>=n&&u<n+i&&f>=t&&f<t+r};n.Rectangle.containsPoint=function(t,i){return n.Rectangle.contains(t,i.x,i.y)};n.Rectangle.containsRect=function(n,t){return n.volume>t.volume?!1:n.x>=t.x&&n.y>=t.y&&n.right<t.right&&n.bottom<t.bottom};n.Rectangle.equals=function(n,t){return n.x===t.x&&n.y===t.y&&n.width===t.width&&n.height===t.height};n.Rectangle.sameDimensions=function(n,t){return n.width===t.width&&n.height===t.height};n.Rectangle.intersection=function(t,i,r){return r===undefined&&(r=new n.Rectangle),n.Rectangle.intersects(t,i)&&(r.x=Math.max(t.x,i.x),r.y=Math.max(t.y,i.y),r.width=Math.min(t.right,i.right)-r.x,r.height=Math.min(t.bottom,i.bottom)-r.y),r};n.Rectangle.intersects=function(n,t){return n.width<=0||n.height<=0||t.width<=0||t.height<=0?!1:!(n.right<t.x||n.bottom<t.y||n.x>t.right||n.y>t.bottom)};n.Rectangle.intersectsRaw=function(n,t,i,r,u,f){return f===undefined&&(f=0),!(t>n.right+f||i<n.left-f||r>n.bottom+f||u<n.top-f)};n.Rectangle.union=function(t,i,r){return r===undefined&&(r=new n.Rectangle),r.setTo(Math.min(t.x,i.x),Math.min(t.y,i.y),Math.max(t.right,i.right)-Math.min(t.left,i.left),Math.max(t.bottom,i.bottom)-Math.min(t.top,i.top))};n.Rectangle.aabb=function(t,i){i===undefined&&(i=new n.Rectangle);var f=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY;return t.forEach(function(n){n.x>f&&(f=n.x);n.x<r&&(r=n.x);n.y>e&&(e=n.y);n.y<u&&(u=n.y)}),i.setTo(r,u,f-r,e-u),i};PIXI.Rectangle=n.Rectangle;n.EmptyRectangle=new n.Rectangle(0,0,0,0);
/**
* @author       Mat Groves http://matgroves.com/
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.RoundedRectangle=function(t,i,r,u,f){t===undefined&&(t=0);i===undefined&&(i=0);r===undefined&&(r=0);u===undefined&&(u=0);f===undefined&&(f=20);this.x=t;this.y=i;this.width=r;this.height=u;this.radius=f||20;this.type=n.ROUNDEDRECTANGLE};n.RoundedRectangle.prototype={clone:function(){return new n.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},contains:function(n,t){var i,r;return this.width<=0||this.height<=0?!1:(i=this.x,n>=i&&n<=i+this.width&&(r=this.y,t>=r&&t<=r+this.height))?!0:!1}};n.RoundedRectangle.prototype.constructor=n.RoundedRectangle;PIXI.RoundedRectangle=n.RoundedRectangle;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Camera=function(t,i,r,u,f,e){this.game=t;this.world=t.world;this.id=0;this.view=new n.Rectangle(r,u,f,e);this.bounds=new n.Rectangle(r,u,f,e);this.deadzone=null;this.visible=!0;this.roundPx=!0;this.atLimit={x:!1,y:!1};this.target=null;this.displayObject=null;this.scale=null;this.totalInView=0;this.lerp=new n.Point(1,1);this.onShakeComplete=new n.Signal;this.onFlashComplete=new n.Signal;this.onFadeComplete=new n.Signal;this.fx=null;this._targetPosition=new n.Point;this._edge=0;this._position=new n.Point;this._shake={intensity:0,duration:0,horizontal:!1,vertical:!1,shakeBounds:!0,x:0,y:0};this._fxDuration=0;this._fxType=0;this._fixedView=new n.Rectangle};n.Camera.FOLLOW_LOCKON=0;n.Camera.FOLLOW_PLATFORMER=1;n.Camera.FOLLOW_TOPDOWN=2;n.Camera.FOLLOW_TOPDOWN_TIGHT=3;n.Camera.SHAKE_BOTH=4;n.Camera.SHAKE_HORIZONTAL=5;n.Camera.SHAKE_VERTICAL=6;n.Camera.ENABLE_FX=!0;n.Camera.prototype={boot:function(){this.displayObject=this.game.world;this.scale=this.game.world.scale;this.game.camera=this;n.Graphics&&n.Camera.ENABLE_FX&&(this.fx=new n.Graphics(this.game),this.game.stage.addChild(this.fx))},preUpdate:function(){this.totalInView=0},follow:function(t,i,r,u){var f,o,e;i===undefined&&(i=n.Camera.FOLLOW_LOCKON);r===undefined&&(r=1);u===undefined&&(u=1);this.target=t;this.lerp.set(r,u);switch(i){case n.Camera.FOLLOW_PLATFORMER:o=this.width/8;e=this.height/3;this.deadzone=new n.Rectangle((this.width-o)/2,(this.height-e)/2-e*.25,o,e);break;case n.Camera.FOLLOW_TOPDOWN:f=Math.max(this.width,this.height)/4;this.deadzone=new n.Rectangle((this.width-f)/2,(this.height-f)/2,f,f);break;case n.Camera.FOLLOW_TOPDOWN_TIGHT:f=Math.max(this.width,this.height)/8;this.deadzone=new n.Rectangle((this.width-f)/2,(this.height-f)/2,f,f);break;case n.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null}},unfollow:function(){this.target=null},focusOn:function(n){this.setPosition(Math.round(n.x-this.view.halfWidth),Math.round(n.y-this.view.halfHeight))},focusOnXY:function(n,t){this.setPosition(Math.round(n-this.view.halfWidth),Math.round(t-this.view.halfHeight))},shake:function(t,i,r,u,f){return(t===undefined&&(t=.05),i===undefined&&(i=500),r===undefined&&(r=!0),u===undefined&&(u=n.Camera.SHAKE_BOTH),f===undefined&&(f=!0),!r&&this._shake.duration>0)?!1:(this._shake.intensity=t,this._shake.duration=i,this._shake.shakeBounds=f,this._shake.x=0,this._shake.y=0,this._shake.horizontal=u===n.Camera.SHAKE_BOTH||u===n.Camera.SHAKE_HORIZONTAL,this._shake.vertical=u===n.Camera.SHAKE_BOTH||u===n.Camera.SHAKE_VERTICAL,!0)},flash:function(n,t,i,r){return(n===undefined&&(n=16777215),t===undefined&&(t=500),i===undefined&&(i=!1),r===undefined&&(r=1),!this.fx||!i&&this._fxDuration>0)?!1:(this.fx.clear(),this.fx.beginFill(n,r),this.fx.drawRect(0,0,this.width,this.height),this.fx.endFill(),this.fx.alpha=1,this._fxDuration=t,this._fxType=0,!0)},fade:function(n,t,i,r){return(n===undefined&&(n=0),t===undefined&&(t=500),i===undefined&&(i=!1),r===undefined&&(r=1),!this.fx||!i&&this._fxDuration>0)?!1:(this.fx.clear(),this.fx.beginFill(n,r),this.fx.drawRect(0,0,this.width,this.height),this.fx.endFill(),this.fx.alpha=0,this._fxDuration=t,this._fxType=1,!0)},update:function(){this._fxDuration>0&&this.updateFX();this._shake.duration>0&&this.updateShake();this.bounds&&this.checkBounds();this.roundPx&&(this.view.floor(),this._shake.x=Math.floor(this._shake.x),this._shake.y=Math.floor(this._shake.y));this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},updateFX:function(){this._fxType===0?(this.fx.alpha-=this.game.time.elapsedMS/this._fxDuration,this.fx.alpha<=0&&(this._fxDuration=0,this.fx.alpha=0,this.onFlashComplete.dispatch())):(this.fx.alpha+=this.game.time.elapsedMS/this._fxDuration,this.fx.alpha>=1&&(this._fxDuration=0,this.fx.alpha=1,this.onFadeComplete.dispatch()))},updateShake:function(){this._shake.duration-=this.game.time.elapsedMS;this._shake.duration<=0?(this.onShakeComplete.dispatch(),this._shake.x=0,this._shake.y=0):(this._shake.horizontal&&(this._shake.x=this.game.rnd.frac()*this._shake.intensity*this.view.width*2-this._shake.intensity*this.view.width),this._shake.vertical&&(this._shake.y=this.game.rnd.frac()*this._shake.intensity*this.view.height*2-this._shake.intensity*this.view.height))},updateTarget:function(){this._targetPosition.x=this.view.x+this.target.worldPosition.x;this._targetPosition.y=this.view.y+this.target.worldPosition.y;this.deadzone?(this._edge=this._targetPosition.x-this.view.x,this._edge<this.deadzone.left?this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.left,this.lerp.x):this._edge>this.deadzone.right&&(this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.right,this.lerp.x)),this._edge=this._targetPosition.y-this.view.y,this._edge<this.deadzone.top?this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.top,this.lerp.y):this._edge>this.deadzone.bottom&&(this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.bottom,this.lerp.y))):(this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.view.halfWidth,this.lerp.x),this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.view.halfHeight,this.lerp.y));this.bounds&&this.checkBounds();this.roundPx&&this.view.floor();this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},setBoundsToWorld:function(){this.bounds&&this.bounds.copyFrom(this.game.world.bounds)},checkBounds:function(){this.atLimit.x=!1;this.atLimit.y=!1;var n=this.view.x+this._shake.x,t=this.view.right+this._shake.x,i=this.view.y+this._shake.y,r=this.view.bottom+this._shake.y;n<=this.bounds.x*this.scale.x?(this.atLimit.x=!0,this.view.x=this.bounds.x*this.scale.x,this._shake.shakeBounds||(this._shake.x=0)):t>=this.bounds.right*this.scale.x&&(this.atLimit.x=!0,this.view.x=this.bounds.right*this.scale.x-this.width,this._shake.shakeBounds||(this._shake.x=0));i<=this.bounds.top*this.scale.y?(this.atLimit.y=!0,this.view.y=this.bounds.top*this.scale.y,this._shake.shakeBounds||(this._shake.y=0)):r>=this.bounds.bottom*this.scale.y&&(this.atLimit.y=!0,this.view.y=this.bounds.bottom*this.scale.y-this.height,this._shake.shakeBounds||(this._shake.y=0))},setPosition:function(n,t){this.view.x=n;this.view.y=t;this.bounds&&this.checkBounds()},setSize:function(n,t){this.view.width=n;this.view.height=t},reset:function(){this.target=null;this.view.x=0;this.view.y=0;this._shake.duration=0;this._shake.x=0;this._shake.y=0;this.resetFX()},resetFX:function(){this.fx&&(this.fx.clear(),this.fx.alpha=0);this._fxDuration=0}};n.Camera.prototype.constructor=n.Camera;Object.defineProperty(n.Camera.prototype,"x",{get:function(){return this.view.x},set:function(n){this.view.x=n;this.bounds&&this.checkBounds()}});Object.defineProperty(n.Camera.prototype,"y",{get:function(){return this.view.y},set:function(n){this.view.y=n;this.bounds&&this.checkBounds()}});Object.defineProperty(n.Camera.prototype,"position",{get:function(){return this._position.set(this.view.x,this.view.y),this._position},set:function(n){typeof n.x!="undefined"&&(this.view.x=n.x);typeof n.y!="undefined"&&(this.view.y=n.y);this.bounds&&this.checkBounds()}});Object.defineProperty(n.Camera.prototype,"width",{get:function(){return this.view.width},set:function(n){this.view.width=n}});Object.defineProperty(n.Camera.prototype,"height",{get:function(){return this.view.height},set:function(n){this.view.height=n}});Object.defineProperty(n.Camera.prototype,"shakeIntensity",{get:function(){return this._shake.intensity},set:function(n){this._shake.intensity=n}});Object.defineProperty(n.Camera.prototype,"fixedView",{get:function(){return this._fixedView.setTo(0,0,this.view.width,this.view.height),this._fixedView}});Object.defineProperty(n.Camera.prototype,"centerX",{get:function(){return this.x+.5*this.width}});Object.defineProperty(n.Camera.prototype,"centerY",{get:function(){return this.y+.5*this.height}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.State=function(){this.game=null;this.key="";this.add=null;this.make=null;this.camera=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.sound=null;this.scale=null;this.stage=null;this.state=null;this.time=null;this.tweens=null;this.world=null;this.particles=null;this.physics=null;this.rnd=null};n.State.prototype={init:function(){},preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},postUpdate:function(){},preRender:function(){},render:function(){},resize:function(){},paused:function(){},resumed:function(){},pauseUpdate:function(){},shutdown:function(){}};n.State.prototype.constructor=n.State;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.StateManager=function(t,i){this.game=t;this.states={};this._pendingState=null;typeof i!="undefined"&&i!==null&&(this._pendingState=i);this._clearWorld=!1;this._clearCache=!1;this._created=!1;this._args=[];this.current="";this.onStateChange=new n.Signal;this.onInitCallback=null;this.onPreloadCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onResizeCallback=null;this.onPreRenderCallback=null;this.onLoadUpdateCallback=null;this.onLoadRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.onShutDownCallback=null};n.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this);this.game.onResume.add(this.resume,this);this._pendingState!==null&&typeof this._pendingState!="string"&&this.add("default",this._pendingState,!0)},add:function(t,i,r){r===undefined&&(r=!1);var u;return i instanceof n.State?u=i:typeof i=="object"?(u=i,u.game=this.game):typeof i=="function"&&(u=new i(this.game)),this.states[t]=u,r&&(this.game.isBooted?this.start(t):this._pendingState=t),u},remove:function(n){this.current===n&&(this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onPreRenderCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null);delete this.states[n]},start:function(n,t,i){t===undefined&&(t=!0);i===undefined&&(i=!1);this.checkState(n)&&(this._pendingState=n,this._clearWorld=t,this._clearCache=i,arguments.length>3&&(this._args=Array.prototype.splice.call(arguments,3)))},restart:function(n,t){n===undefined&&(n=!0);t===undefined&&(t=!1);this._pendingState=this.current;this._clearWorld=n;this._clearCache=t;arguments.length>2&&(this._args=Array.prototype.slice.call(arguments,2))},dummy:function(){},preUpdate:function(){if(this._pendingState&&this.game.isBooted){var n=this.current;if(this.clearCurrentState(),this.setCurrentState(this._pendingState),this.onStateChange.dispatch(this.current,n),this.current!==this._pendingState)return;this._pendingState=null;this.onPreloadCallback?(this.game.load.reset(!0),this.onPreloadCallback.call(this.callbackContext,this.game),this.game.load.totalQueuedFiles()===0&&this.game.load.totalQueuedPacks()===0?this.loadComplete():this.game.load.start()):this.loadComplete()}},clearCurrentState:function(){this.current&&(this.onShutDownCallback&&this.onShutDownCallback.call(this.callbackContext,this.game),this.game.tweens.removeAll(),this.game.camera.reset(),this.game.input.reset(!0),this.game.physics.clear(),this.game.time.removeAll(),this.game.scale.reset(this._clearWorld),this.game.debug&&this.game.debug.reset(),this._clearWorld&&(this.game.world.shutdown(),this._clearCache&&this.game.cache.destroy()))},checkState:function(n){var t=this.states[n];return t?t.preload||t.create||t.update||t.render?!0:(console.warn("Invalid Phaser State object given. Must contain at least one of the required functions: preload, create, update or render"),!1):(console.warn("Phaser.StateManager - No state found with the key: "+n),!1)},link:function(n){var t=this.states[n];t.game=this.game;t.add=this.game.add;t.make=this.game.make;t.camera=this.game.camera;t.cache=this.game.cache;t.input=this.game.input;t.load=this.game.load;t.math=this.game.math;t.sound=this.game.sound;t.scale=this.game.scale;t.state=this;t.stage=this.game.stage;t.time=this.game.time;t.tweens=this.game.tweens;t.world=this.game.world;t.particles=this.game.particles;t.rnd=this.game.rnd;t.physics=this.game.physics;t.key=n},unlink:function(n){var t=this.states[n];t&&(t.game=null,t.add=null,t.make=null,t.camera=null,t.cache=null,t.input=null,t.load=null,t.math=null,t.sound=null,t.scale=null,t.state=null,t.stage=null,t.time=null,t.tweens=null,t.world=null,t.particles=null,t.rnd=null,t.physics=null)},setCurrentState:function(n){var t=this.states[n];this.callbackContext=t;this.link(n);this.onInitCallback=t.init||this.dummy;this.onPreloadCallback=t.preload||null;this.onLoadRenderCallback=t.loadRender||null;this.onLoadUpdateCallback=t.loadUpdate||null;this.onCreateCallback=t.create||null;this.onUpdateCallback=t.update||null;this.onPostUpdateCallback=t.postUpdate||null;this.onPreRenderCallback=t.preRender||null;this.onRenderCallback=t.render||null;this.onResizeCallback=t.resize||null;this.onPausedCallback=t.paused||null;this.onResumedCallback=t.resumed||null;this.onPauseUpdateCallback=t.pauseUpdate||null;this.onShutDownCallback=t.shutdown||this.dummy;this.current!==""&&this.game.physics.reset();this.current=n;this._created=!1;this.onInitCallback.apply(this.callbackContext,this._args);n===this._pendingState&&(this._args=[]);this.game._kickstart=!0},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){this._created===!1&&this.onCreateCallback?(this._created=!0,this.onCreateCallback.call(this.callbackContext,this.game)):this._created=!0},loadUpdate:function(){this._created===!1&&this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},pause:function(){this._created&&this.onPausedCallback&&this.onPausedCallback.call(this.callbackContext,this.game)},resume:function(){this._created&&this.onResumedCallback&&this.onResumedCallback.call(this.callbackContext,this.game)},update:function(){this._created?this.onUpdateCallback&&this.onUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},postUpdate:function(){this._created&&this.onPostUpdateCallback&&this.onPostUpdateCallback.call(this.callbackContext,this.game)},pauseUpdate:function(){this._created?this.onPauseUpdateCallback&&this.onPauseUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},preRender:function(n){this._created&&this.onPreRenderCallback&&this.onPreRenderCallback.call(this.callbackContext,this.game,n)},resize:function(n,t){this.onResizeCallback&&this.onResizeCallback.call(this.callbackContext,n,t)},render:function(){this._created?this.onRenderCallback&&(this.game.renderType===n.CANVAS?(this.game.context.save(),this.game.context.setTransform(1,0,0,1,0,0),this.onRenderCallback.call(this.callbackContext,this.game),this.game.context.restore()):this.onRenderCallback.call(this.callbackContext,this.game)):this.onLoadRenderCallback&&this.onLoadRenderCallback.call(this.callbackContext,this.game)},destroy:function(){this._clearWorld=!0;this._clearCache=!0;this.clearCurrentState();this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onPostUpdateCallback=null;this.onRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.game=null;this.states={};this._pendingState=null;this.current=""}};n.StateManager.prototype.constructor=n.StateManager;Object.defineProperty(n.StateManager.prototype,"created",{get:function(){return this._created}});
/**
* @author       Miller Medeiros http://millermedeiros.github.com/js-signals/
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Signal=function(){};n.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!1,validateListener:function(n,t){if(typeof n!="function")throw new Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",t));},_registerListener:function(t,i,r,u,f){var o=this._indexOfListener(t,r),e;if(o!==-1){if(e=this._bindings[o],e.isOnce()!==i)throw new Error("You cannot add"+(i?"":"Once")+"() then add"+(i?"Once":"")+"() the same listener without removing the relationship first.");}else e=new n.SignalBinding(this,t,i,r,u,f),this._addBinding(e);return this.memorize&&this._prevParams&&e.execute(this._prevParams),e},_addBinding:function(n){this._bindings||(this._bindings=[]);var t=this._bindings.length;do t--;while(this._bindings[t]&&n._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,n)},_indexOfListener:function(n,t){if(!this._bindings)return-1;t===undefined&&(t=null);for(var i=this._bindings.length,r;i--;)if(r=this._bindings[i],r._listener===n&&r.context===t)return i;return-1},has:function(n,t){return this._indexOfListener(n,t)!==-1},add:function(n,t,i){var u,r;if(this.validateListener(n,"add"),u=[],arguments.length>3)for(r=3;r<arguments.length;r++)u.push(arguments[r]);return this._registerListener(n,!1,t,i,u)},addOnce:function(n,t,i){var u,r;if(this.validateListener(n,"addOnce"),u=[],arguments.length>3)for(r=3;r<arguments.length;r++)u.push(arguments[r]);return this._registerListener(n,!0,t,i,u)},remove:function(n,t){this.validateListener(n,"remove");var i=this._indexOfListener(n,t);return i!==-1&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),n},removeAll:function(n){if(n===undefined&&(n=null),this._bindings){for(var t=this._bindings.length;t--;)n?this._bindings[t].context===n&&(this._bindings[t]._destroy(),this._bindings.splice(t,1)):this._bindings[t]._destroy();n||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){var t,n,i;if(this.active&&(this._bindings||this.memorize)&&(t=Array.prototype.slice.call(arguments),this.memorize&&(this._prevParams=t),n=this._bindings?this._bindings.length:0,n)){i=this._bindings.slice();this._shouldPropagate=!0;do n--;while(i[n]&&this._shouldPropagate&&i[n].execute(t)!==!1)}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll();this._bindings=null;this._prevParams&&(this._prevParams=null)},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};Object.defineProperty(n.Signal.prototype,"boundDispatch",{get:function(){var n=this;return this._boundDispatch||(this._boundDispatch=function(){return n.dispatch.apply(n,arguments)})}});n.Signal.prototype.constructor=n.Signal;
/**
* @author       Miller Medeiros http://millermedeiros.github.com/js-signals/
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.SignalBinding=function(n,t,i,r,u,f){this._listener=t;i&&(this._isOnce=!0);r!=null&&(this.context=r);this._signal=n;u&&(this._priority=u);f&&f.length&&(this._args=f)};n.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(n){var i,t;return this.active&&!!this._listener&&(t=this.params?this.params.concat(n):n,this._args&&(t=t.concat(this._args)),i=this._listener.apply(this.context,t),this.callCount++,this._isOnce&&this.detach()),i},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};n.SignalBinding.prototype.constructor=n.SignalBinding;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @author       Mat Groves (@Doormat23)
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Filter=function(t,i,r){var u,f;if(this.game=t,this.type=n.WEBGL_FILTER,this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.prevPoint=new n.Point,u=new Date,this.uniforms={resolution:{type:"2f",value:{x:256,y:256}},time:{type:"1f",value:0},mouse:{type:"2f",value:{x:0,y:0}},date:{type:"4fv",value:[u.getFullYear(),u.getMonth(),u.getDate(),u.getHours()*3600+u.getMinutes()*60+u.getSeconds()]},sampleRate:{type:"1f",value:44100},iChannel0:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel1:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel2:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel3:{type:"sampler2D",value:null,textureData:{repeat:!0}}},i)for(f in i)this.uniforms[f]=i[f];typeof r=="string"&&(r=r.split("\n"));this.fragmentSrc=r||[]};n.Filter.prototype={init:function(){},setResolution:function(n,t){this.uniforms.resolution.value.x=n;this.uniforms.resolution.value.y=t},update:function(n){if(n){var t=n.x/this.game.width,i=1-n.y/this.game.height;(t!==this.prevPoint.x||i!==this.prevPoint.y)&&(this.uniforms.mouse.value.x=t.toFixed(2),this.uniforms.mouse.value.y=i.toFixed(2),this.prevPoint.set(t,i))}this.uniforms.time.value=this.game.time.totalElapsedSeconds()},addToWorld:function(t,i,r,u,f,e){f===undefined&&(f=0);e===undefined&&(e=0);r!==undefined&&r!==null?this.width=r:r=this.width;u!==undefined&&u!==null?this.height=u:u=this.height;var o=this.game.add.image(t,i,n.Cache.DEFAULT);return o.width=r,o.height=u,o.anchor.set(f,e),o.filters=[this],o},syncUniforms:function(){for(var n=0;n<this.shaders.length;n++)this.shaders[n].dirty=!0},destroy:function(){this.passes.length=0;this.shaders.length=0;this.fragmentSrc.length=0;this.game=null;this.uniforms=null;this.prevPoint=null}};n.Filter.prototype.constructor=n.Filter;Object.defineProperty(n.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(n){this.uniforms.resolution.value.x=n}});Object.defineProperty(n.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(n){this.uniforms.resolution.value.y=n}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Plugin=function(n,t){t===undefined&&(t=null);this.game=n;this.parent=t;this.active=!1;this.visible=!1;this.hasPreUpdate=!1;this.hasUpdate=!1;this.hasPostUpdate=!1;this.hasRender=!1;this.hasPostRender=!1};n.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null;this.parent=null;this.active=!1;this.visible=!1}};n.Plugin.prototype.constructor=n.Plugin;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.PluginManager=function(n){this.game=n;this.plugins=[];this._len=0;this._i=0};n.PluginManager.prototype={add:function(n){var i=Array.prototype.slice.call(arguments,1),t=!1;return typeof n=="function"?n=new n(this.game,this):(n.game=this.game,n.parent=this),typeof n.preUpdate=="function"&&(n.hasPreUpdate=!0,t=!0),typeof n.update=="function"&&(n.hasUpdate=!0,t=!0),typeof n.postUpdate=="function"&&(n.hasPostUpdate=!0,t=!0),typeof n.render=="function"&&(n.hasRender=!0,t=!0),typeof n.postRender=="function"&&(n.hasPostRender=!0,t=!0),t?((n.hasPreUpdate||n.hasUpdate||n.hasPostUpdate)&&(n.active=!0),(n.hasRender||n.hasPostRender)&&(n.visible=!0),this._len=this.plugins.push(n),typeof n.init=="function"&&n.init.apply(n,i),n):null},remove:function(n,t){for(t===undefined&&(t=!0),this._i=this._len;this._i--;)if(this.plugins[this._i]===n){t&&n.destroy();this.plugins.splice(this._i,1);this._len--;return}},removeAll:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].destroy();this.plugins.length=0;this._len=0},preUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate&&this.plugins[this._i].preUpdate()},update:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasUpdate&&this.plugins[this._i].update()},postUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate&&this.plugins[this._i].postUpdate()},render:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasRender&&this.plugins[this._i].render()},postRender:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender&&this.plugins[this._i].postRender()},destroy:function(){this.removeAll();this.game=null}};n.PluginManager.prototype.constructor=n.PluginManager;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Stage=function(t){this.game=t;PIXI.DisplayObjectContainer.call(this);this.name="_stage_root";this.disableVisibilityChange=!1;this.exists=!0;this.worldTransform=new n.Matrix;this.stage=this;this.currentRenderOrderID=0;this._hiddenVar="hidden";this._onChange=null;this._bgColor={r:0,g:0,b:0,a:0,color:0,rgba:"#000000"};this.game.transparent||(this._bgColor.a=1);t.config&&this.parseConfig(t.config)};n.Stage.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);n.Stage.prototype.constructor=n.Stage;n.Stage.prototype.parseConfig=function(n){n.disableVisibilityChange&&(this.disableVisibilityChange=n.disableVisibilityChange);n.backgroundColor&&this.setBackgroundColor(n.backgroundColor)};n.Stage.prototype.boot=function(){n.DOM.getOffset(this.game.canvas,this.offset);n.Canvas.setUserSelect(this.game.canvas,"none");n.Canvas.setTouchAction(this.game.canvas,"none");this.checkVisibility()};n.Stage.prototype.preUpdate=function(){var n,t;for(this.currentRenderOrderID=0,n=0;n<this.children.length;)t=this.children[n],t.preUpdate(),this===t.parent&&n++};n.Stage.prototype.update=function(){for(var n=this.children.length;n--;)this.children[n].update()};n.Stage.prototype.postUpdate=function(){this.game.camera.update();this.game.camera.target&&(this.game.camera.target.postUpdate(),this.updateTransform(),this.game.camera.updateTarget());for(var n=0;n<this.children.length;n++)this.children[n].postUpdate();this.updateTransform()};n.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var n=0;n<this.children.length;n++)this.children[n].updateTransform()};n.Stage.prototype.checkVisibility=function(){this._hiddenVar=document.hidden!==undefined?"visibilitychange":document.webkitHidden!==undefined?"webkitvisibilitychange":document.mozHidden!==undefined?"mozvisibilitychange":document.msHidden!==undefined?"msvisibilitychange":null;var n=this;if(this._onChange=function(t){return n.visibilityChange(t)},this._onChangePause=function(){return n._onChange({type:"pause"})},this._onChangeResume=function(){return n._onChange({type:"resume"})},this._onClick=function(t){document.hasFocus===undefined||document.hasFocus()||n.visibilityChange(t)},this._hiddenVar&&document.addEventListener(this._hiddenVar,this._onChange,!1),window.onblur=this._onChange,window.onfocus=this._onChange,window.onpagehide=this._onChange,window.onpageshow=this._onChange,window.addEventListener("click",this._onClick),this.game.device.cocoonJSApp&&CocoonJS.App&&(CocoonJS.App.onSuspended&&CocoonJS.App.onSuspended.addEventListener(this._onChangePause),CocoonJS.App.onActivated&&CocoonJS.App.onActivated.addEventListener(this._onChangeResume),CocoonJS.App.on)){CocoonJS.App.on("activated",this._onChangeResume);CocoonJS.App.on("suspended",this._onChangePause)}};n.Stage.prototype.visibilityChange=function(n){switch(n.type){case"blur":case"pagehide":this.game.focusLoss(n);return;case"click":case"focus":case"pageshow":this.game.focusGain(n);return}this.disableVisibilityChange||(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||n.type==="pause"?this.game.gamePaused(n):this.game.gameResumed(n))};n.Stage.prototype.setBackgroundColor=function(t){this.game.transparent||(n.Color.valueToColor(t,this._bgColor),n.Color.updateColor(this._bgColor),this._bgColor.r/=255,this._bgColor.g/=255,this._bgColor.b/=255,this._bgColor.a=1)};n.Stage.prototype.destroy=function(){this._hiddenVar&&document.removeEventListener(this._hiddenVar,this._onChange,!1);window.onpagehide=null;window.onpageshow=null;window.onblur=null;window.onfocus=null;window.removeEventListener("click",this._onClick)};n.Stage.prototype.add=function(n,t,i){return n.parent===this?n:(n.body&&n.parent&&n.parent.hash&&n.parent.removeFromHash(n),i===undefined?this.addChild(n):this.addChildAt(n,i),n)};Object.defineProperty(n.Stage.prototype,"backgroundColor",{get:function(){return this._bgColor.color},set:function(n){this.setBackgroundColor(n)}});Object.defineProperty(n.Stage.prototype,"smoothed",{get:function(){return PIXI.scaleModes.DEFAULT===PIXI.scaleModes.LINEAR},set:function(n){PIXI.scaleModes.DEFAULT=n?PIXI.scaleModes.LINEAR:PIXI.scaleModes.NEAREST}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Group=function(t,i,r,u,f,e){u===undefined&&(u=!1);f===undefined&&(f=!1);e===undefined&&(e=n.Physics.ARCADE);this.game=t;i===undefined&&(i=t.world);this.name=r||"group";this.z=0;PIXI.DisplayObjectContainer.call(this);u?(this.game.stage.addChild(this),this.z=this.game.stage.children.length):i&&(i.addChild(this),this.z=i.children.length);this.type=n.GROUP;this.physicsType=n.GROUP;this.alive=!0;this.exists=!0;this.ignoreDestroy=!1;this.pendingDestroy=!1;this.classType=n.Sprite;this.cursor=null;this.inputEnableChildren=!1;this.updateOnlyExistingChildren=!1;this.onChildInputDown=new n.Signal;this.onChildInputUp=new n.Signal;this.onChildInputOver=new n.Signal;this.onChildInputOut=new n.Signal;this.enableBody=f;this.enableBodyDebug=!1;this.physicsBodyType=e;this.physicsSortDirection=null;this.onDestroy=new n.Signal;this.cursorIndex=0;this.fixedToCamera=!1;this.cameraOffset=new n.Point;this.hash=[];this._sortProperty="z"};n.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);n.Group.prototype.constructor=n.Group;n.Group.RETURN_NONE=0;n.Group.RETURN_TOTAL=1;n.Group.RETURN_CHILD=2;n.Group.RETURN_ALL=3;n.Group.SORT_ASCENDING=-1;n.Group.SORT_DESCENDING=1;n.Group.prototype.add=function(n,t,i){if(t===undefined&&(t=!1),n.parent===this)return n;if(n.body&&n.parent&&n.parent.hash&&n.parent.removeFromHash(n),i===undefined?(n.z=this.children.length,this.addChild(n)):(this.addChildAt(n,i),this.updateZ()),this.enableBody&&n.hasOwnProperty("body")&&n.body===null?this.game.physics.enable(n,this.physicsBodyType):n.body&&this.addToHash(n),this.inputEnableChildren&&(!n.input||n.inputEnabled)&&(n.inputEnabled=!0),!t&&n.events)n.events.onAddedToGroup$dispatch(n,this);return this.cursor===null&&(this.cursor=n),n};n.Group.prototype.addAt=function(n,t,i){return this.add(n,i,t)};n.Group.prototype.addToHash=function(n){if(n.parent===this){var t=this.hash.indexOf(n);if(t===-1)return this.hash.push(n),!0}return!1};n.Group.prototype.removeFromHash=function(n){if(n){var t=this.hash.indexOf(n);if(t!==-1)return this.hash.splice(t,1),!0}return!1};n.Group.prototype.addMultiple=function(t,i){if(t instanceof n.Group)t.moveAll(this,i);else if(Array.isArray(t))for(var r=0;r<t.length;r++)this.add(t[r],i);return t};n.Group.prototype.getAt=function(n){return n<0||n>=this.children.length?-1:this.getChildAt(n)};n.Group.prototype.create=function(n,t,i,r,u,f){u===undefined&&(u=!0);var e=new this.classType(this.game,n,t,i,r);return e.exists=u,e.visible=u,e.alive=u,this.add(e,!1,f)};n.Group.prototype.createMultiple=function(n,t,i,r,u,f){i===undefined&&(i=0);r===undefined&&(r=!1);Array.isArray(t)||(t=[t]);Array.isArray(i)||(i=[i]);var o=this,e=[];return t.forEach(function(t){i.forEach(function(i){for(var h,s=0;s<n;s++)h=o.create(0,0,t,i,r),u&&u.call(f||h,h,s),e.push(h)})}),e};n.Group.prototype.updateZ=function(){for(var n=this.children.length;n--;)this.children[n].z=n};n.Group.prototype.align=function(t,i,r,u,f,e){var s,h;if(f===undefined&&(f=n.TOP_LEFT),e===undefined&&(e=0),this.children.length===0||e>this.children.length||t===-1&&i===-1)return!1;var o=new n.Rectangle(0,0,r,u),c=t*r,l=i*u;for(s=e;s<this.children.length;s++){if(h=this.children[s],h.alignIn)h.alignIn(o,f);else continue;if(t===-1)o.y+=u,o.y===l&&(o.x+=r,o.y=0);else if(i===-1)o.x+=r,o.x===c&&(o.x=0,o.y+=u);else if(o.x+=r,o.x===c&&(o.x=0,o.y+=u,o.y===l))return!0}return!0};n.Group.prototype.resetCursor=function(n){return n===undefined&&(n=0),n>this.children.length-1&&(n=0),this.cursor?(this.cursorIndex=n,this.cursor=this.children[this.cursorIndex],this.cursor):void 0};n.Group.prototype.next=function(){if(this.cursor)return this.cursorIndex>=this.children.length-1?this.cursorIndex=0:this.cursorIndex++,this.cursor=this.children[this.cursorIndex],this.cursor};n.Group.prototype.previous=function(){if(this.cursor)return this.cursorIndex===0?this.cursorIndex=this.children.length-1:this.cursorIndex--,this.cursor=this.children[this.cursorIndex],this.cursor};n.Group.prototype.swap=function(n,t){this.swapChildren(n,t);this.updateZ()};n.Group.prototype.bringToTop=function(n){return n.parent===this&&this.getIndex(n)<this.children.length&&(this.remove(n,!1,!0),this.add(n,!0)),n};n.Group.prototype.bringChildToTop=n.Group.prototype.bringToTop;n.Group.prototype.sendToBack=function(n){return n.parent===this&&this.getIndex(n)>0&&(this.remove(n,!1,!0),this.addAt(n,0,!0)),n};n.Group.prototype.sendChildToBack=n.Group.prototype.sendToBack;n.Group.prototype.moveUp=function(n){if(n.parent===this&&this.getIndex(n)<this.children.length-1){var i=this.getIndex(n),t=this.getAt(i+1);t&&this.swap(n,t)}return n};n.Group.prototype.moveDown=function(n){if(n.parent===this&&this.getIndex(n)>0){var i=this.getIndex(n),t=this.getAt(i-1);t&&this.swap(n,t)}return n};n.Group.prototype.xy=function(n,t,i){if(n<0||n>this.children.length)return-1;this.getChildAt(n).x=t;this.getChildAt(n).y=i};n.Group.prototype.reverse=function(){this.children.reverse();this.updateZ()};n.Group.prototype.getIndex=function(n){return this.children.indexOf(n)};n.Group.prototype.getByName=function(n){return this.getFirst("name",n)};n.Group.prototype.replace=function(t,i){var r=this.getIndex(t);if(r!==-1)return i.parent&&(i.parent instanceof n.Group?i.parent.remove(i):i.parent.removeChild(i)),this.remove(t),this.addAt(i,r),t};n.Group.prototype.hasProperty=function(n,t){var i=t.length;return i===1&&t[0]in n?!0:i===2&&t[0]in n&&t[1]in n[t[0]]||i===3&&t[0]in n&&t[1]in n[t[0]]&&t[2]in n[t[0]][t[1]]||i===4&&t[0]in n&&t[1]in n[t[0]]&&t[2]in n[t[0]][t[1]]&&t[3]in n[t[0]][t[1]][t[2]]?!0:!1};n.Group.prototype.setProperty=function(n,t,i,r,u){if(u===undefined&&(u=!1),r=r||0,!this.hasProperty(n,t)&&(!u||r>0))return!1;var f=t.length;return f===1?r===0?n[t[0]]=i:r===1?n[t[0]]+=i:r===2?n[t[0]]-=i:r===3?n[t[0]]*=i:r===4&&(n[t[0]]/=i):f===2?r===0?n[t[0]][t[1]]=i:r===1?n[t[0]][t[1]]+=i:r===2?n[t[0]][t[1]]-=i:r===3?n[t[0]][t[1]]*=i:r===4&&(n[t[0]][t[1]]/=i):f===3?r===0?n[t[0]][t[1]][t[2]]=i:r===1?n[t[0]][t[1]][t[2]]+=i:r===2?n[t[0]][t[1]][t[2]]-=i:r===3?n[t[0]][t[1]][t[2]]*=i:r===4&&(n[t[0]][t[1]][t[2]]/=i):f===4&&(r===0?n[t[0]][t[1]][t[2]][t[3]]=i:r===1?n[t[0]][t[1]][t[2]][t[3]]+=i:r===2?n[t[0]][t[1]][t[2]][t[3]]-=i:r===3?n[t[0]][t[1]][t[2]][t[3]]*=i:r===4&&(n[t[0]][t[1]][t[2]][t[3]]/=i)),!0};n.Group.prototype.checkProperty=function(t,i,r,u){if(u===undefined&&(u=!1),this!==t.parent)return!1;var f=n.Utils.getProperty(t,i);return f===undefined&&u||f!==r?!1:!0};n.Group.prototype.set=function(n,t,i,r,u,f,e){return e===undefined&&(e=!1),t=t.split("."),r===undefined&&(r=!1),u===undefined&&(u=!1),(r===!1||r&&n.alive)&&(u===!1||u&&n.visible)?this.setProperty(n,t,i,f,e):void 0};n.Group.prototype.setAll=function(n,t,i,r,u,f){var s,e,o;for(i===undefined&&(i=!1),r===undefined&&(r=!1),f===undefined&&(f=!1),n=n.split("."),u=u||0,s=this.children.length,e=0;e<s;e++)o=this.children[e],(!i||o.alive)&&(!r||o.visible)&&this.setProperty(o,n,t,u,f)};n.Group.prototype.setAllChildren=function(t,i,r,u,f,e){var h,s,o;for(r===undefined&&(r=!1),u===undefined&&(u=!1),e===undefined&&(e=!1),f=f||0,h=this.children.length,s=0;s<h;s++)o=this.children[s],(!r||o.alive)&&(!u||o.visible)&&(o instanceof n.Group?o.setAllChildren(t,i,r,u,f,e):this.setProperty(o,t.split("."),i,f,e))};n.Group.prototype.checkAll=function(n,t,i,r,u){var f,e;for(i===undefined&&(i=!1),r===undefined&&(r=!1),u===undefined&&(u=!1),f=0;f<this.children.length;f++)if(e=this.children[f],(!i||e.alive)&&(!r||e.visible)&&!this.checkProperty(e,n,t,u))return!1;return!0};n.Group.prototype.checkAny=function(n,t,i,r){var u,f;for(i===undefined&&(i=!1),r===undefined&&(r=!1),u=0;u<this.children.length;u++)if(f=this.children[u],(!i||f.alive)&&(!r||f.visible)&&this.checkProperty(f,n,t))return!0;return!1};n.Group.prototype.addAll=function(n,t,i,r){this.setAll(n,t,i,r,1)};n.Group.prototype.subAll=function(n,t,i,r){this.setAll(n,t,i,r,2)};n.Group.prototype.multiplyAll=function(n,t,i,r){this.setAll(n,t,i,r,3)};n.Group.prototype.divideAll=function(n,t,i,r){this.setAll(n,t,i,r,4)};n.Group.prototype.kill=function(){this.alive=!1;this.exists=!1;this.visible=!1};n.Group.prototype.killAll=function(){this.callAllExists("kill",!0)};n.Group.prototype.revive=function(){this.alive=!0;this.exists=!0;this.visible=!0};n.Group.prototype.reviveAll=function(){this.callAllExists("revive",!1)};n.Group.prototype.resetAll=function(n,t,i,r,u){this.forEach(this.resetChild,this,u,n,t,i,r)};n.Group.prototype.callAllExists=function(n,t){var u,i,r;if(arguments.length>2)for(u=[],i=2;i<arguments.length;i++)u.push(arguments[i]);for(i=0;i<this.children.length;i++)r=this.children[i],r.exists===t&&r[n]&&r[n].apply(r,u)};n.Group.prototype.callbackFromArray=function(n,t,i){if(i===1){if(n[t[0]])return n[t[0]]}else if(i===2){if(n[t[0]][t[1]])return n[t[0]][t[1]]}else if(i===3){if(n[t[0]][t[1]][t[2]])return n[t[0]][t[1]][t[2]]}else if(i===4){if(n[t[0]][t[1]][t[2]][t[3]])return n[t[0]][t[1]][t[2]][t[3]]}else if(n[t])return n[t];return!1};n.Group.prototype.callAll=function(n,t){var o,s,u,r,e,i,f;if(n!==undefined){if(n=n.split("."),o=n.length,t===undefined||t===null||t===""?t=null:typeof t=="string"&&(t=t.split("."),s=t.length),arguments.length>2)for(u=[],i=2;i<arguments.length;i++)u.push(arguments[i]);for(r=null,e=null,i=0;i<this.children.length;i++)f=this.children[i],r=this.callbackFromArray(f,n,o),t&&r?(e=this.callbackFromArray(f,t,s),r.apply(e,u)):r&&r.apply(f,u)}};n.Group.prototype.preUpdate=function(){var n,t;if(this.pendingDestroy)return this.destroy(),!1;if(!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;for(n=0;n<this.children.length;)t=this.children[n],t.preUpdate(),this===t.parent&&n++;return!0};n.Group.prototype.update=function(){for(var n=this.children.length,t,i;n--;)t=this.children.length,n>=t&&(n=t-1),i=this.children[n],(!this.updateOnlyExistingChildren||i.exists)&&i.update()};n.Group.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);for(var n=0;n<this.children.length;n++)this.children[n].postUpdate()};n.Group.prototype.filter=function(t,i){for(var u=-1,e=this.children.length,f=[],r;++u<e;)r=this.children[u],(!i||i&&r.exists)&&t(r,u,this.children)&&f.push(r);return new n.ArraySet(f)};n.Group.prototype.forEach=function(n,t,i){var f,r,u;if(i===undefined&&(i=!1),arguments.length<=3)for(r=0;r<this.children.length;r++)u=this.children[r],(!i||u.exists)&&n.call(t,u);else{for(f=[null],r=3;r<arguments.length;r++)f.push(arguments[r]);for(r=0;r<this.children.length;r++)u=this.children[r],(!i||u.exists)&&(f[0]=u,n.apply(t,f))}};n.Group.prototype.forEachExists=function(t,i){var u,r;if(arguments.length>2)for(u=[null],r=2;r<arguments.length;r++)u.push(arguments[r]);this.iterate("exists",!0,n.Group.RETURN_TOTAL,t,i,u)};n.Group.prototype.forEachAlive=function(t,i){var u,r;if(arguments.length>2)for(u=[null],r=2;r<arguments.length;r++)u.push(arguments[r]);this.iterate("alive",!0,n.Group.RETURN_TOTAL,t,i,u)};n.Group.prototype.forEachDead=function(t,i){var u,r;if(arguments.length>2)for(u=[null],r=2;r<arguments.length;r++)u.push(arguments[r]);this.iterate("alive",!1,n.Group.RETURN_TOTAL,t,i,u)};n.Group.prototype.sort=function(t,i){this.children.length<2||(t===undefined&&(t="z"),i===undefined&&(i=n.Group.SORT_ASCENDING),this._sortProperty=t,i===n.Group.SORT_ASCENDING?this.children.sort(this.ascendingSortHandler.bind(this)):this.children.sort(this.descendingSortHandler.bind(this)),this.updateZ())};n.Group.prototype.customSort=function(n,t){this.children.length<2||(this.children.sort(n.bind(t)),this.updateZ())};n.Group.prototype.ascendingSortHandler=function(n,t){return n[this._sortProperty]<t[this._sortProperty]?-1:n[this._sortProperty]>t[this._sortProperty]?1:n.z<t.z?-1:1};n.Group.prototype.descendingSortHandler=function(n,t){return n[this._sortProperty]<t[this._sortProperty]?1:n[this._sortProperty]>t[this._sortProperty]?-1:0};n.Group.prototype.iterate=function(t,i,r,u,f,e){var s,h,o;if(this.children.length===0){if(r===n.Group.RETURN_TOTAL)return 0;if(r===n.Group.RETURN_ALL)return[]}for(s=0,r===n.Group.RETURN_ALL&&(h=[]),o=0;o<this.children.length;o++)if(this.children[o][t]===i){if(s++,u&&(e?(e[0]=this.children[o],u.apply(f,e)):u.call(f,this.children[o])),r===n.Group.RETURN_CHILD)return this.children[o];r===n.Group.RETURN_ALL&&h.push(this.children[o])}return r===n.Group.RETURN_TOTAL?s:r===n.Group.RETURN_ALL?h:null};n.Group.prototype.getFirst=function(t,i){return this.iterate(t,i,n.Group.RETURN_CHILD)};n.Group.prototype.getFirstExists=function(n,t,i,r,u,f){t===undefined&&(t=!1);typeof n!="boolean"&&(n=!0);var e=this.getFirst("exists",n);return e===null&&t?this.create(i,r,u,f):this.resetChild(e,i,r,u,f)};n.Group.prototype.getFirstAlive=function(n,t,i,r,u){n===undefined&&(n=!1);var f=this.getFirst("alive",!0);return f===null&&n?this.create(t,i,r,u):this.resetChild(f,t,i,r,u)};n.Group.prototype.getFirstDead=function(n,t,i,r,u){n===undefined&&(n=!1);var f=this.getFirst("alive",!1);return f===null&&n?this.create(t,i,r,u):this.resetChild(f,t,i,r,u)};n.Group.prototype.resetChild=function(n,t,i,r,u){return n===null?null:(t===undefined&&(t=null),i===undefined&&(i=null),t!==null&&i!==null&&n.reset(t,i),r!==undefined&&n.loadTexture(r,u),n)};n.Group.prototype.getTop=function(){if(this.children.length>0)return this.children[this.children.length-1]};n.Group.prototype.getBottom=function(){if(this.children.length>0)return this.children[0]};n.Group.prototype.getClosestTo=function(t,i,r){for(var u,o=Number.MAX_VALUE,f=0,s=null,e=0;e<this.children.length;e++)u=this.children[e],u.exists&&(f=Math.abs(n.Point.distance(t,u)),f<o&&(!i||i.call(r,u,f))&&(o=f,s=u));return s};n.Group.prototype.getFurthestFrom=function(t,i,r){for(var u,o=0,f=0,s=null,e=0;e<this.children.length;e++)u=this.children[e],u.exists&&(f=Math.abs(n.Point.distance(t,u)),f>o&&(!i||i.call(r,u,f))&&(o=f,s=u));return s};n.Group.prototype.count=function(t,i){return this.iterate(t,i,n.Group.RETURN_TOTAL)};n.Group.prototype.countLiving=function(){return this.count("alive",!0)};n.Group.prototype.countDead=function(){return this.count("alive",!1)};n.Group.prototype.getRandom=function(t,i){return(t===undefined&&(t=0),i===undefined&&(i=this.children.length),i===0)?null:n.ArrayUtils.getRandomItem(this.children,t,i)};n.Group.prototype.getRandomExists=function(n,t){var i=this.getAll("exists",!0,n,t);return this.game.rnd.pick(i)};n.Group.prototype.getAll=function(n,t,i,r){var u,f,e;for(i===undefined&&(i=0),r===undefined&&(r=this.children.length),u=[],f=i;f<r;f++)e=this.children[f],n?e[n]===t&&u.push(e):u.push(e);return u};n.Group.prototype.remove=function(n,t,i){if(t===undefined&&(t=!1),i===undefined&&(i=!1),this.children.length===0||this.children.indexOf(n)===-1)return!1;if(!i&&n.events&&!n.destroyPhase)n.events.onRemovedFromGroup$dispatch(n,this);var r=this.removeChild(n);return this.removeFromHash(n),this.updateZ(),this.cursor===n&&this.next(),t&&r&&r.destroy(!0),!0};n.Group.prototype.moveAll=function(t,i){if(i===undefined&&(i=!1),this.children.length>0&&t instanceof n.Group){do t.add(this.children[0],i);while(this.children.length>0);this.hash=[];this.cursor=null}return t};n.Group.prototype.removeAll=function(n,t,i){if(n===undefined&&(n=!1),t===undefined&&(t=!1),i===undefined&&(i=!1),this.children.length!==0){do{if(!t&&this.children[0].events)this.children[0].events.onRemovedFromGroup$dispatch(this.children[0],this);var r=this.removeChild(this.children[0]);this.removeFromHash(r);n&&r&&r.destroy(!0,i)}while(this.children.length>0);this.hash=[];this.cursor=null}};n.Group.prototype.removeBetween=function(n,t,i,r){var u,f;if(t===undefined&&(t=this.children.length-1),i===undefined&&(i=!1),r===undefined&&(r=!1),this.children.length!==0){if(n>t||n<0||t>this.children.length)return!1;for(u=t;u>=n;){if(!r&&this.children[u].events)this.children[u].events.onRemovedFromGroup$dispatch(this.children[u],this);f=this.removeChild(this.children[u]);this.removeFromHash(f);i&&f&&f.destroy(!0);this.cursor===this.children[u]&&(this.cursor=null);u--}this.updateZ()}};n.Group.prototype.scatter=function(n,t){n==null&&(n=this.game.world.bounds);this.forEach(function(t){t.position.set(n.randomX,n.randomY)},null,t)};n.Group.prototype.shuffle=function(){n.ArrayUtils.shuffle(this.children);this.updateZ()};n.Group.prototype.destroy=function(n,t){this.game===null||this.ignoreDestroy||(n===undefined&&(n=!0),t===undefined&&(t=!1),this.onDestroy.dispatch(this,n,t),this.removeAll(n),this.cursor=null,this.filters=null,this.pendingDestroy=!1,t||(this.parent&&this.parent.removeChild(this),this.game=null,this.exists=!1))};Object.defineProperty(n.Group.prototype,"total",{get:function(){return this.iterate("exists",!0,n.Group.RETURN_TOTAL)}});Object.defineProperty(n.Group.prototype,"length",{get:function(){return this.children.length}});Object.defineProperty(n.Group.prototype,"angle",{get:function(){return n.Math.radToDeg(this.rotation)},set:function(t){this.rotation=n.Math.degToRad(t)}});Object.defineProperty(n.Group.prototype,"centerX",{get:function(){return this.getBounds(this.parent).centerX},set:function(n){var t=this.getBounds(this.parent),i=this.x-t.x;this.x=n+i-t.halfWidth}});Object.defineProperty(n.Group.prototype,"centerY",{get:function(){return this.getBounds(this.parent).centerY},set:function(n){var t=this.getBounds(this.parent),i=this.y-t.y;this.y=n+i-t.halfHeight}});Object.defineProperty(n.Group.prototype,"left",{get:function(){return this.getBounds(this.parent).left},set:function(n){var t=this.getBounds(this.parent),i=this.x-t.x;this.x=n+i}});Object.defineProperty(n.Group.prototype,"right",{get:function(){return this.getBounds(this.parent).right},set:function(n){var t=this.getBounds(this.parent),i=this.x-t.x;this.x=n+i-t.width}});Object.defineProperty(n.Group.prototype,"top",{get:function(){return this.getBounds(this.parent).top},set:function(n){var t=this.getBounds(this.parent),i=this.y-t.y;this.y=n+i}});Object.defineProperty(n.Group.prototype,"bottom",{get:function(){return this.getBounds(this.parent).bottom},set:function(n){var t=this.getBounds(this.parent),i=this.y-t.y;this.y=n+i-t.height}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.World=function(t){n.Group.call(this,t,null,"__world",!1);this.bounds=new n.Rectangle(0,0,t.width,t.height);this.camera=null;this._definedSize=!1;this._width=t.width;this._height=t.height;this.game.state.onStateChange.add(this.stateChange,this)};n.World.prototype=Object.create(n.Group.prototype);n.World.prototype.constructor=n.World;n.World.prototype.boot=function(){this.camera=new n.Camera(this.game,0,0,0,this.game.width,this.game.height);this.game.stage.addChild(this);this.camera.boot()};n.World.prototype.stateChange=function(){this.x=0;this.y=0;this.camera.reset()};n.World.prototype.setBounds=function(n,t,i,r){this._definedSize=!0;this._width=i;this._height=r;this.bounds.setTo(n,t,i,r);this.x=n;this.y=t;this.camera.bounds&&this.camera.bounds.setTo(n,t,Math.max(i,this.game.width),Math.max(r,this.game.height));this.game.physics.setBoundsToWorld()};n.World.prototype.resize=function(n,t){this._definedSize&&(n<this._width&&(n=this._width),t<this._height&&(t=this._height));this.bounds.width=n;this.bounds.height=t;this.game.camera.setBoundsToWorld();this.game.physics.setBoundsToWorld()};n.World.prototype.shutdown=function(){this.destroy(!0,!0)};n.World.prototype.wrap=function(n,t,i,r,u){t===undefined&&(t=0);i===undefined&&(i=!1);r===undefined&&(r=!0);u===undefined&&(u=!0);i?(n.getBounds(),r&&(n.x+n._currentBounds.width<this.bounds.x?n.x=this.bounds.right:n.x>this.bounds.right&&(n.x=this.bounds.left)),u&&(n.y+n._currentBounds.height<this.bounds.top?n.y=this.bounds.bottom:n.y>this.bounds.bottom&&(n.y=this.bounds.top))):(r&&n.x+t<this.bounds.x?n.x=this.bounds.right+t:r&&n.x-t>this.bounds.right&&(n.x=this.bounds.left-t),u&&n.y+t<this.bounds.top?n.y=this.bounds.bottom+t:u&&n.y-t>this.bounds.bottom&&(n.y=this.bounds.top-t))};n.World.prototype.wrapAll=function(n,t,i,r,u,f){n.forEach(this.wrap,this,t,i,r,u,f)};Object.defineProperty(n.World.prototype,"width",{get:function(){return this.bounds.width},set:function(n){n<this.game.width&&(n=this.game.width);this.bounds.width=n;this._width=n;this._definedSize=!0}});Object.defineProperty(n.World.prototype,"height",{get:function(){return this.bounds.height},set:function(n){n<this.game.height&&(n=this.game.height);this.bounds.height=n;this._height=n;this._definedSize=!0}});Object.defineProperty(n.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth+this.bounds.x}});Object.defineProperty(n.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight+this.bounds.y}});Object.defineProperty(n.World.prototype,"randomX",{get:function(){return this.bounds.x<0?this.game.rnd.between(this.bounds.x,this.bounds.width-Math.abs(this.bounds.x)):this.game.rnd.between(this.bounds.x,this.bounds.width)}});Object.defineProperty(n.World.prototype,"randomY",{get:function(){return this.bounds.y<0?this.game.rnd.between(this.bounds.y,this.bounds.height-Math.abs(this.bounds.y)):this.game.rnd.between(this.bounds.y,this.bounds.height)}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Game=function(t,i,r,u,f,e,o,s){return this.id=n.GAMES.push(this)-1,this.config=null,this.physicsConfig=s,this.parent="",this.width=800,this.height=600,this.resolution=1,this._width=800,this._height=600,this.transparent=!1,this.antialias=!0,this.multiTexture=!1,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!0,this.renderer=null,this.renderType=n.AUTO,this.state=null,this.isBooted=!1,this.isRunning=!1,this.raf=null,this.add=null,this.make=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.net=null,this.scale=null,this.sound=null,this.stage=null,this.time=null,this.tweens=null,this.world=null,this.physics=null,this.plugins=null,this.rnd=null,this.device=n.Device,this.camera=null,this.canvas=null,this.context=null,this.debug=null,this.particles=null,this.create=null,this.lockRender=!1,this.pendingDestroy=!1,this.stepping=!1,this.pendingStep=!1,this.stepCount=0,this.onPause=null,this.onResume=null,this.onBlur=null,this.onFocus=null,this._paused=!1,this._codePaused=!1,this.currentUpdateID=0,this.updatesThisFrame=1,this.rendersThisFrame=1,this._deltaTime=0,this._lastCount=0,this._spiraling=0,this._kickstart=!0,this.fpsProblemNotifier=new n.Signal,this.forceSingleUpdate=!0,this.forceSingleRender=!0,this.dropFrames=!1,this.powerPreference="default",this._nextFpsNotification=0,arguments.length===1&&typeof arguments[0]=="object"?this.parseConfig(arguments[0]):(this.config={enableDebug:!0},typeof t!="undefined"&&(this._width=t),typeof i!="undefined"&&(this._height=i),typeof r!="undefined"&&(this.renderType=r),typeof u!="undefined"&&(this.parent=u),typeof e!="undefined"&&(this.transparent=e),typeof o!="undefined"&&(this.antialias=o),this.rnd=new n.RandomDataGenerator([(Date.now()*Math.random()).toString()]),this.state=new n.StateManager(this,f)),this.device.whenReady(this.boot,this),this};n.Game.prototype={parseConfig:function(t){var i,r;this.config=t;t.enableDebug===undefined&&(this.config.enableDebug=!0);t.width&&(this._width=t.width);t.height&&(this._height=t.height);t.renderer&&(this.renderType=t.renderer);t.parent&&(this.parent=t.parent);t.transparent!==undefined&&(this.transparent=t.transparent);t.antialias!==undefined&&(this.antialias=t.antialias);t.clearBeforeRender!==undefined&&(this.clearBeforeRender=t.clearBeforeRender);t.multiTexture!==undefined&&(this.multiTexture=t.multiTexture);t.resolution&&(this.resolution=t.resolution);t.preserveDrawingBuffer!==undefined&&(this.preserveDrawingBuffer=t.preserveDrawingBuffer);t.powerPreference!==undefined&&(this.powerPreference=t.powerPreference);t.physicsConfig&&(this.physicsConfig=t.physicsConfig);i=[(Date.now()*Math.random()).toString()];t.seed&&(i=t.seed);this.rnd=new n.RandomDataGenerator(i);r=null;t.state&&(r=t.state);this.state=new n.StateManager(this,r)},boot:function(){if(!this.isBooted){if(this.onPause=new n.Signal,this.onResume=new n.Signal,this.onBlur=new n.Signal,this.onFocus=new n.Signal,this.isBooted=!0,PIXI.game=this,this.math=n.Math,this.scale=new n.ScaleManager(this,this._width,this._height),this.stage=new n.Stage(this),this.setUpRenderer(),this.world=new n.World(this),this.add=new n.GameObjectFactory(this),this.make=new n.GameObjectCreator(this),this.cache=new n.Cache(this),this.load=new n.Loader(this),this.time=new n.Time(this),this.tweens=new n.TweenManager(this),this.input=new n.Input(this),this.sound=new n.SoundManager(this),this.physics=new n.Physics(this,this.physicsConfig),this.particles=new n.Particles(this),this.create=new n.Create(this),this.plugins=new n.PluginManager(this),this.net=new n.Net(this),this.time.boot(),this.stage.boot(),this.world.boot(),this.scale.boot(),this.input.boot(this.config),this.sound.boot(),this.state.boot(),this.config.enableDebug)this.debug=new n.Utils.Debug(this),this.debug.boot();else{var t=function(){};this.debug={preUpdate:t,update:t,reset:t,destroy:t,isDisabled:!0}}(this.showDebugHeader(),this.isRunning=!0,this.raf=this.config&&this.config.forceSetTimeOut?new n.RequestAnimationFrame(this,this.config.forceSetTimeOut):new n.RequestAnimationFrame(this,!1),this._kickstart=!0,this.focusWindow(),this.config.disableStart)||(this.cache.isReady?this.raf.start():this.cache.onReady.addOnce(function(){this.raf.start()},this))}},showDebugHeader:function(){var i,r;if(!window.PhaserGlobal||!window.PhaserGlobal.hideBanner){var e=n.VERSION,t="Canvas",u="HTML Audio",f=1;if(this.renderType===n.WEBGL?(t="WebGL",f++):this.renderType===n.HEADLESS&&(t="Headless"),this.device.webAudio&&(u="WebAudio",f++),this.device.ie)window.console&&console.log("Phaser v"+e+" | Pixi.js | "+t+" | "+u+" | http://phaser.io");else{for(i=["%c %c %c Phaser CE v"+e+" | Pixi.js | "+t+" | "+u+"  %c %c %c http://phaser.io %c\u2665%c\u2665%c\u2665","background: #fb8cb3","background: #d44a52","color: #ffffff; background: #871905;","background: #d44a52","background: #fb8cb3","background: #ffffff"],r=0;r<3;r++)r<f?i.push("color: #ff2424; background: #fff"):i.push("color: #959595; background: #fff");console.log.apply(console,i)}}},setUpRenderer:function(){if(!this.device.canvas)throw new Error("Phaser.Game - Cannot create Canvas 2d context, aborting.");if(this.canvas=this.config.canvas?this.config.canvas:n.Canvas.create(this,this.width,this.height,this.config.canvasID,!0),this.config.canvasStyle?this.canvas.style=this.config.canvasStyle:this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%",this.config.crisp&&n.Canvas.setImageRenderingCrisp(this.canvas),this.renderType===n.WEBGL||this.renderType===n.WEBGL_MULTI||this.renderType===n.AUTO&&this.device.webGL){(this.multiTexture||this.renderType===n.WEBGL_MULTI)&&(PIXI.enableMultiTexture(),this.multiTexture=!0);try{this.renderer=new PIXI.WebGLRenderer(this,this.config);this.renderType=n.WEBGL;this.context=null;this.canvas.addEventListener("webglcontextlost",this.contextLost.bind(this),!1);this.canvas.addEventListener("webglcontextrestored",this.contextRestored.bind(this),!1)}catch(t){if(PIXI.defaultRenderer=null,this.renderer=null,this.multiTexture=!1,PIXI._enableMultiTextureToggle=!1,this.renderType===n.WEBGL)throw t;}}this.renderer||(this.renderer=new PIXI.CanvasRenderer(this,this.config),this.context=this.renderer.context,this.renderType===n.AUTO&&(this.renderType=n.CANVAS));this.device.cocoonJS&&(this.canvas.screencanvas=this.renderType===n.CANVAS?!0:!1);this.renderType!==n.HEADLESS&&(this.stage.smoothed=this.antialias,n.Canvas.addToDOM(this.canvas,this.parent,!1),n.Canvas.setTouchAction(this.canvas))},contextLost:function(n){n.preventDefault();this.renderer.contextLost=!0},contextRestored:function(){this.renderer.initContext();this.cache.clearGLTextures();this.renderer.contextLost=!1},update:function(t){var r,i;if(this.pendingDestroy){this.destroy();return}if(this.time.update(t),this._kickstart){this.updateLogic(this.time.desiredFpsMult);this.updateRender(this.time.slowMotion*this.time.desiredFps);this._kickstart=!1;return}if(this._spiraling>1&&!this.forceSingleUpdate)this.time.time>this._nextFpsNotification&&(this._nextFpsNotification=this.time.time+1e4,this.fpsProblemNotifier.dispatch()),this._deltaTime=0,this._spiraling=0,this.dropFrames?this.rendersThisFrame=0:(this.updateRender(this.time.slowMotion*this.time.desiredFps),this.rendersThisFrame=1);else{for(r=this.time.slowMotion*1e3/this.time.desiredFps,this._deltaTime+=Math.max(Math.min(r*3,this.time.elapsed),0),i=0,this.updatesThisFrame=Math.floor(this._deltaTime/r),this.forceSingleUpdate&&(this.updatesThisFrame=Math.min(1,this.updatesThisFrame)),this.rendersThisFrame=this.forceSingleRender?1:Math.min(1,this.updatesThisFrame);this._deltaTime>=r;)if(this._deltaTime-=r,this.currentUpdateID=i,this.updateLogic(this.time.desiredFpsMult),i++,this.forceSingleUpdate&&i===1)break;else this.time.refresh();i>this._lastCount?this._spiraling++:i<this._lastCount&&(this._spiraling=0);this._lastCount=i;this.rendersThisFrame>0&&this.updateRender(this._deltaTime/r)}this.renderer.type===n.WEBGL&&this.renderer.gl.flush()},updateLogic:function(n){this._paused||this.pendingStep?(this.scale.pauseUpdate(),this.state.pauseUpdate(n),this.debug.preUpdate(),this.input.pauseUpdate()):(this.stepping&&(this.pendingStep=!0),this.time.countUpdate(),this.scale.preUpdate(),this.debug.preUpdate(),this.camera.preUpdate(),this.physics.preUpdate(),this.state.preUpdate(n),this.plugins.preUpdate(n),this.stage.preUpdate(),this.state.update(),this.stage.update(),this.tweens.update(),this.sound.update(),this.input.update(),this.physics.update(),this.plugins.update(),this.stage.postUpdate(),this.state.postUpdate(),this.plugins.postUpdate());this.stage.updateTransform()},updateRender:function(t){this.lockRender||this.renderType===n.HEADLESS||(this.time.countRender(),this.state.preRender(t),this.renderer.render(this.stage),this.plugins.render(t),this.state.render(t),this.plugins.postRender(t))},enableStep:function(){this.stepping=!0;this.pendingStep=!1;this.stepCount=0},disableStep:function(){this.stepping=!1;this.pendingStep=!1},step:function(){this.pendingStep=!1;this.stepCount++},destroy:function(){this.raf.stop();this.debug.destroy();this.state.destroy();this.sound.destroy();this.scale.destroy();this.stage.destroy();this.input.destroy();this.physics.destroy();this.plugins.destroy();this.tweens.destroy();this.debug=null;this.state=null;this.sound=null;this.scale=null;this.stage=null;this.input=null;this.physics=null;this.plugins=null;this.tweens=null;this.cache=null;this.load=null;this.time=null;this.world=null;this.isBooted=!1;this.renderer.destroy(!1);n.Canvas.removeFromDOM(this.canvas);PIXI.game===this&&(PIXI.game=null);PIXI.defaultRenderer=null;n.GAMES[this.id]=null},gamePaused:function(n){this._paused||(this._paused=!0,this.time.gamePaused(),this.sound.muteOnPause&&this.sound.setMute(),this.onPause.dispatch(n),this.device.cordova&&this.device.iOS&&(this.lockRender=!0))},gameResumed:function(n){this._paused&&!this._codePaused&&(this._paused=!1,this.time.gameResumed(),this.input.reset(),this.sound.muteOnPause&&this.sound.unsetMute(),this.onResume.dispatch(n),this.device.cordova&&this.device.iOS&&(this.lockRender=!1))},focusLoss:function(n){this.onBlur.dispatch(n);this.stage.disableVisibilityChange||this.gamePaused(n)},focusGain:function(n){this.focusWindow();this.onFocus.dispatch(n);this.stage.disableVisibilityChange||this.gameResumed(n)},focusWindow:function(){window.focus&&(window.PhaserGlobal&&(!window.PhaserGlobal||window.PhaserGlobal.stopFocus)||window.focus())}};n.Game.prototype.constructor=n.Game;Object.defineProperty(n.Game.prototype,"paused",{get:function(){return this._paused},set:function(n){n===!0?(this._paused===!1&&(this._paused=!0,this.sound.muteOnPause&&this.sound.setMute(),this.time.gamePaused(),this.onPause.dispatch(this)),this._codePaused=!0):(this._paused&&(this._paused=!1,this.input.reset(),this.sound.unsetMute(),this.time.gameResumed(),this.onResume.dispatch(this)),this._codePaused=!1)}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Input=function(t){this.game=t;this.hitCanvas=null;this.hitContext=null;this.moveCallbacks=[];this.customCandidateHandler=null;this.customCandidateHandlerContext=null;this.pollRate=0;this.enabled=!0;this.multiInputOverride=n.Input.MOUSE_TOUCH_COMBINE;this.position=null;this.speed=null;this.circle=null;this.scale=null;this.maxPointers=-1;this.tapRate=200;this.doubleTapRate=300;this.holdRate=2e3;this.justPressedRate=200;this.justReleasedRate=200;this.recordPointerHistory=!1;this.recordRate=100;this.recordLimit=100;this.touchLockCallbacks=[];this.pointer1=null;this.pointer2=null;this.pointer3=null;this.pointer4=null;this.pointer5=null;this.pointer6=null;this.pointer7=null;this.pointer8=null;this.pointer9=null;this.pointer10=null;this.pointers=[];this.activePointer=null;this.mousePointer=null;this.mouse=null;this.keyboard=null;this.touch=null;this.mspointer=null;this.gamepad=null;this.resetLocked=!1;this.onDown=null;this.onUp=null;this.onTap=null;this.onHold=null;this.minPriorityID=0;this.interactiveItems=new n.ArraySet;this._localPoint=new n.Point;this._pollCounter=0;this._oldPosition=null;this._x=0;this._y=0};n.Input.MOUSE_OVERRIDES_TOUCH=0;n.Input.TOUCH_OVERRIDES_MOUSE=1;n.Input.MOUSE_TOUCH_COMBINE=2;n.Input.MAX_POINTERS=10;n.Input.prototype={boot:function(t){"maxPointers"in t&&(this.maxPointers=t.maxPointers);this.mousePointer=new n.Pointer(this.game,0,n.PointerMode.CURSOR);this.addPointer();this.addPointer();this.mouse=new n.Mouse(this.game);this.touch=new n.Touch(this.game);this.mspointer=new n.MSPointer(this.game);this.mouseWheel=new n.MouseWheel(this.game);this.pointerLock=new n.PointerLock(this.game);n.Keyboard&&(this.keyboard=new n.Keyboard(this.game));n.Gamepad&&(this.gamepad=new n.Gamepad(this.game));this.onDown=new n.Signal;this.onUp=new n.Signal;this.onTap=new n.Signal;this.onHold=new n.Signal;this.scale=new n.Point(1,1);this.speed=new n.Point;this.position=new n.Point;this._oldPosition=new n.Point;this.circle=new n.Circle(0,0,45);this.activePointer=this.mousePointer;this.hitCanvas=n.CanvasPool.create(this,1,1);this.hitContext=this.hitCanvas.getContext("2d");this.game.device.mspointer&&t.mspointer!==!1?this.mspointer.start():this.game.device.touch&&t.touch!==!1&&this.touch.start();this.mspointer.active||t.mouse===!1||this.mouse.start();this.mousePointer.active=!0;t.mouseWheel!==!1&&this.mouseWheel.start();t.pointerLock!==!1&&this.pointerLock.start();this.keyboard&&t.keyboard!==!1&&this.keyboard.start();var i=this;this._onClickTrampoline=function(n){i.onClickTrampoline(n)};this.game.canvas.addEventListener("click",this._onClickTrampoline,!1)},destroy:function(){this.mouse.stop();this.mouseWheel.stop();this.touch.stop();this.mspointer.stop();this.pointerLock.stop();this.keyboard&&this.keyboard.stop();this.gamepad&&this.gamepad.stop();this.moveCallbacks=[];n.CanvasPool.remove(this);this.game.canvas.removeEventListener("click",this._onClickTrampoline)},setInteractiveCandidateHandler:function(n,t){this.customCandidateHandler=n;this.customCandidateHandlerContext=t},addMoveCallback:function(n,t){this.moveCallbacks.push({callback:n,context:t})},addTouchLockCallback:function(n,t,i){i===undefined&&(i=!1);this.touchLockCallbacks.push({callback:n,context:t,onEnd:i})},removeTouchLockCallback:function(n,t){for(var i=this.touchLockCallbacks.length;i--;)if(this.touchLockCallbacks[i].callback===n&&this.touchLockCallbacks[i].context===t)return this.touchLockCallbacks.splice(i,1),!0;return!1},executeTouchLockCallbacks:function(n,t){for(var r=this.touchLockCallbacks.length,i;r--;)i=this.touchLockCallbacks[r],i.onEnd===n&&i.callback.call(i.context,this,t)&&this.touchLockCallbacks.splice(r,1)},deleteMoveCallback:function(n,t){for(var i=this.moveCallbacks.length;i--;)if(this.moveCallbacks[i].callback===n&&this.moveCallbacks[i].context===t){this.moveCallbacks.splice(i,1);return}},addPointer:function(){if(this.pointers.length>=n.Input.MAX_POINTERS)return console.warn("Phaser.Input.addPointer: Maximum limit of "+n.Input.MAX_POINTERS+" pointers reached."),null;var i=this.pointers.length+1,t=new n.Pointer(this.game,i,n.PointerMode.CONTACT);return this.pointers.push(t),this["pointer"+i]=t,t},update:function(){if(this.keyboard&&this.keyboard.update(),this.pollRate>0&&this._pollCounter<this.pollRate){this._pollCounter++;return}this.speed.x=this.position.x-this._oldPosition.x;this.speed.y=this.position.y-this._oldPosition.y;this._oldPosition.copyFrom(this.position);this.mousePointer.update();this.gamepad&&this.gamepad.active&&this.gamepad.update();for(var n=0;n<this.pointers.length;n++)this.pointers[n].update();this._pollCounter=0},pauseUpdate:function(){this.gamepad&&this.gamepad.active&&this.gamepad.update()},reset:function(t){if(this.game.isBooted&&!this.resetLocked){t===undefined&&(t=!1);this.mousePointer.reset();this.keyboard&&this.keyboard.reset(t);for(var i=0;i<this.pointers.length;i++)this.pointers[i].reset();this.game.canvas.style.cursor!=="none"&&(this.game.canvas.style.cursor="");t&&(this.onDown.dispose(),this.onUp.dispose(),this.onTap.dispose(),this.onHold.dispose(),this.onDown=new n.Signal,this.onUp=new n.Signal,this.onTap=new n.Signal,this.onHold=new n.Signal,this.moveCallbacks=[]);this._pollCounter=0}},resetSpeed:function(n,t){this._oldPosition.setTo(n,t);this.speed.setTo(0,0)},startPointer:function(n){var t,i;if(this.maxPointers>=0&&this.countActivePointers(this.maxPointers)>=this.maxPointers)return null;if(!this.pointer1.active)return this.pointer1.start(n);if(!this.pointer2.active)return this.pointer2.start(n);for(t=2;t<this.pointers.length;t++)if(i=this.pointers[t],!i.active)return i.start(n);return null},updatePointer:function(n){var t,i;if(this.pointer1.active&&this.pointer1.identifier===n.identifier)return this.pointer1.move(n);if(this.pointer2.active&&this.pointer2.identifier===n.identifier)return this.pointer2.move(n);for(t=2;t<this.pointers.length;t++)if(i=this.pointers[t],i.active&&i.identifier===n.identifier)return i.move(n);return null},stopPointer:function(n){var t,i;if(this.pointer1.active&&this.pointer1.identifier===n.identifier)return this.pointer1.stop(n);if(this.pointer2.active&&this.pointer2.identifier===n.identifier)return this.pointer2.stop(n);for(t=2;t<this.pointers.length;t++)if(i=this.pointers[t],i.active&&i.identifier===n.identifier)return i.stop(n);return null},countActivePointers:function(n){var t,i,r;for(n===undefined&&(n=this.pointers.length),t=n,i=0;i<this.pointers.length&&t>0;i++)r=this.pointers[i],r.active&&t--;return n-t},getPointer:function(n){var t,i;for(n===undefined&&(n=!1),t=0;t<this.pointers.length;t++)if(i=this.pointers[t],i.active===n)return i;return null},getPointerFromIdentifier:function(n){for(var i,t=0;t<this.pointers.length;t++)if(i=this.pointers[t],i.identifier===n)return i;return null},getPointerFromId:function(n){for(var i,t=0;t<this.pointers.length;t++)if(i=this.pointers[t],i.pointerId===n)return i;return null},getLocalPosition:function(t,i,r){r===undefined&&(r=new n.Point);var u=t.worldTransform,f=1/(u.a*u.d+u.c*-u.b);return r.setTo(u.d*f*i.x+-u.c*f*i.y+(u.ty*u.c-u.tx*u.d)*f,u.a*f*i.y+-u.b*f*i.x+(-u.ty*u.a+u.tx*u.b)*f)},hitTest:function(t,i,r){var u,h,f;if(!t.worldVisible)return!1;if(this.getLocalPosition(t,i,this._localPoint),r.copyFrom(this._localPoint),t.hitArea&&t.hitArea.contains)return t.hitArea.contains(this._localPoint.x,this._localPoint.y);if(n.Creature&&t instanceof n.Creature){var e=Math.abs(t.width),o=Math.abs(t.height),s=t.x-e*t.anchorX;if(this.game.camera.x+i.x>=s&&this.game.camera.x+i.x<s+e&&(u=t.y-o*t.anchorY,this.game.camera.y+i.y>=u&&this.game.camera.y+i.y<u+o))return!0}else if(t instanceof n.TileSprite){var e=t.width,o=t.height,s=-e*t.anchor.x;if(this._localPoint.x>=s&&this._localPoint.x<s+e&&(u=-o*t.anchor.y,this._localPoint.y>=u&&this._localPoint.y<u+o))return!0}else if(t instanceof PIXI.Sprite){var e=t.texture.frame.width/t.texture.baseTexture.resolution,o=t.texture.frame.height/t.texture.baseTexture.resolution,s=-e*t.anchor.x;if(this._localPoint.x>=s&&this._localPoint.x<s+e&&(u=-o*t.anchor.y,this._localPoint.y>=u&&this._localPoint.y<u+o))return!0}else if(t instanceof n.Graphics)for(f=0;f<t.graphicsData.length;f++)if((h=t.graphicsData[f],h.fill)&&h.shape&&h.shape.contains(this._localPoint.x,this._localPoint.y))return!0;for(f=0;f<t.children.length;f++)if(this.hitTest(t.children[f],i,r))return!0;return!1},onClickTrampoline:function(){this.activePointer.processClickTrampolines()},callAll:function(n,t){for(var r=this.interactiveItems.list,u=r.length,i;u--;)i=r[u],i&&i.enabled&&i[n](t)}};n.Input.prototype.constructor=n.Input;Object.defineProperty(n.Input.prototype,"x",{get:function(){return this._x},set:function(n){this._x=Math.floor(n)}});Object.defineProperty(n.Input.prototype,"y",{get:function(){return this._y},set:function(n){this._y=Math.floor(n)}});Object.defineProperty(n.Input.prototype,"pollLocked",{get:function(){return this.pollRate>0&&this._pollCounter<this.pollRate}});Object.defineProperty(n.Input.prototype,"totalInactivePointers",{get:function(){return this.pointers.length-this.countActivePointers()}});Object.defineProperty(n.Input.prototype,"totalActivePointers",{get:function(){return this.countActivePointers()}});Object.defineProperty(n.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}});Object.defineProperty(n.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Mouse=function(n){this.game=n;this.input=n.input;this.callbackContext=this.game;this.mouseDownCallback=null;this.mouseUpCallback=null;this.mouseOutCallback=null;this.mouseOverCallback=null;this.capture=!1;this.active=!1;this.enabled=!0;this.stopOnGameOut=!1;this.event=null;this._onMouseDown=null;this._onMouseMove=null;this._onMouseUp=null;this._onMouseOut=null;this._onMouseOver=null};n.Mouse.NO_BUTTON=-1;n.Mouse.LEFT_BUTTON=0;n.Mouse.MIDDLE_BUTTON=1;n.Mouse.RIGHT_BUTTON=2;n.Mouse.BACK_BUTTON=3;n.Mouse.FORWARD_BUTTON=4;n.Mouse.prototype={start:function(){var i=this.game.device,n,t;return i.isAndroidStockBrowser()&&this.input.touch.active?!1:this._onMouseDown!==null?!1:(n=this,this._onMouseDown=function(t){return n.onMouseDown(t)},this._onMouseMove=function(t){return n.onMouseMove(t)},this._onMouseUp=function(t){return n.onMouseUp(t)},this._onMouseUpGlobal=function(t){return n.onMouseUpGlobal(t)},this._onMouseOutGlobal=function(t){return n.onMouseOutGlobal(t)},this._onMouseOut=function(t){return n.onMouseOut(t)},this._onMouseOver=function(t){return n.onMouseOver(t)},t=this.game.canvas,t.addEventListener("mousedown",this._onMouseDown,!0),t.addEventListener("mousemove",this._onMouseMove,!0),t.addEventListener("mouseup",this._onMouseUp,!0),i.cocoonJS||(window.addEventListener("mouseup",this._onMouseUpGlobal,!0),window.addEventListener("mouseout",this._onMouseOutGlobal,!0),t.addEventListener("mouseover",this._onMouseOver,!0),t.addEventListener("mouseout",this._onMouseOut,!0)),this.active=!0,!0)},onMouseDown:function(n){(this.event=n,this.capture&&n.preventDefault(),this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,n),this.input.enabled&&this.enabled)&&(n.identifier=0,this.input.mousePointer.start(n))},onMouseMove:function(n){(this.event=n,this.capture&&n.preventDefault(),this.mouseMoveCallback&&this.mouseMoveCallback.call(this.callbackContext,n),this.input.enabled&&this.enabled)&&(n.identifier=0,this.input.mousePointer.move(n))},onMouseUp:function(n){(this.event=n,this.capture&&n.preventDefault(),this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,n),this.input.enabled&&this.enabled)&&(n.identifier=0,this.input.mousePointer.stop(n))},onMouseUpGlobal:function(n){this.input.mousePointer.withinGame||(this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,n),n.identifier=0,this.input.mousePointer.stop(n))},onMouseOutGlobal:function(n){(this.event=n,this.capture&&n.preventDefault(),this.input.mousePointer.withinGame=!1,this.input.enabled&&this.enabled)&&(this.input.mousePointer.stop(n),this.input.mousePointer.resetButtons())},onMouseOut:function(n){(this.event=n,this.capture&&n.preventDefault(),this.input.mousePointer.withinGame=!1,this.mouseOutCallback&&this.mouseOutCallback.call(this.callbackContext,n),this.input.enabled&&this.enabled)&&(this.input.mousePointer.updateButtons(n),this.stopOnGameOut&&(n.identifier=0,this.input.mousePointer.stop(n),this.input.callAll("_pointerOutHandler",this.input.mousePointer)))},onMouseOver:function(n){(this.event=n,this.capture&&n.preventDefault(),this.input.mousePointer.withinGame=!0,this.mouseOverCallback&&this.mouseOverCallback.call(this.callbackContext,n),this.input.enabled&&this.enabled)&&this.input.mousePointer.updateButtons(n)},stop:function(){var n=this.game.canvas;n.removeEventListener("mousedown",this._onMouseDown,!0);n.removeEventListener("mousemove",this._onMouseMove,!0);n.removeEventListener("mouseup",this._onMouseUp,!0);n.removeEventListener("mouseover",this._onMouseOver,!0);n.removeEventListener("mouseout",this._onMouseOut,!0);window.removeEventListener("mouseup",this._onMouseUpGlobal,!0);window.removeEventListener("mouseout",this._onMouseOutGlobal,!0);this.active=!1}};n.Mouse.prototype.constructor=n.Mouse;n.MouseWheel=function(n){this.game=n;this.input=n.input;this.element=n.canvas;this.preventDefault=!0;this.active=!1;this.callback=null;this.callbackContext=n;this.delta=0;this.wheelEventName=n.device.wheelEvent;this.boundOnWheelHandler=this.onWheelHandler.bind(this);this.eventProxy=null};n.MouseWheel.UP=1;n.MouseWheel.DOWN=-1;n.MouseWheel.prototype.start=function(){return!this.wheelEventName||this.active?!1:(this.element.addEventListener(this.wheelEventName,this.boundOnWheelHandler,!0),this.wheelEventName==="mousewheel"?this.eventProxy=new n.WheelEventProxy(-1/40,1):this.wheelEventName==="DOMMouseScroll"&&(this.eventProxy=new n.WheelEventProxy(1,1)),this.active=!0,!0)};n.MouseWheel.prototype.stop=function(){this.active&&(this.element.removeEventListener(this.wheelEventName,this.boundOnWheelHandler,!0),this.active=!1)};n.MouseWheel.prototype.onWheelHandler=function(t){this.eventProxy&&(t=this.eventProxy.bindEvent(t));this.preventDefault&&t.preventDefault();this.delta=n.Math.clamp(-t.deltaY,-1,1);this.callback&&this.callback.call(this.callbackContext,t)};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.MSPointer=function(n){this.game=n;this.input=n.input;this.callbackContext=this.game;this.pointerDownCallback=null;this.pointerMoveCallback=null;this.pointerUpCallback=null;this.pointerOutCallback=null;this.pointerOverCallback=null;this.capture=!1;this.event=null;this.active=!1;this.enabled=!0;this.stopOnGameOut=!1;this._onMSPointerDown=null;this._onMSPointerMove=null;this._onMSPointerUp=null;this._onMSPointerUpGlobal=null;this._onMSPointerOut=null;this._onMSPointerOver=null};n.MSPointer.prototype={start:function(){var t,n;return this.game.device.mspointer?this._onMSPointerDown!==null?!1:(t=this,this._onMSPointerDown=function(n){return t.onPointerDown(n)},this._onMSPointerMove=function(n){return t.onPointerMove(n)},this._onMSPointerUp=function(n){return t.onPointerUp(n)},this._onMSPointerUpGlobal=function(n){return t.onPointerUpGlobal(n)},this._onMSPointerOut=function(n){return t.onPointerOut(n)},this._onMSPointerOver=function(n){return t.onPointerOver(n)},n=this.game.canvas,n.addEventListener("MSPointerDown",this._onMSPointerDown,!1),n.addEventListener("MSPointerMove",this._onMSPointerMove,!1),n.addEventListener("MSPointerUp",this._onMSPointerUp,!1),n.addEventListener("pointerdown",this._onMSPointerDown,!1),n.addEventListener("pointermove",this._onMSPointerMove,!1),n.addEventListener("pointerup",this._onMSPointerUp,!1),n.style["-ms-content-zooming"]="none",n.style["-ms-touch-action"]="none",this.game.device.cocoonJS||(window.addEventListener("MSPointerUp",this._onMSPointerUpGlobal,!0),n.addEventListener("MSPointerOver",this._onMSPointerOver,!0),n.addEventListener("MSPointerOut",this._onMSPointerOut,!0),window.addEventListener("pointerup",this._onMSPointerUpGlobal,!0),n.addEventListener("pointerover",this._onMSPointerOver,!0),n.addEventListener("pointerout",this._onMSPointerOut,!0)),this.active=!0,!0):!1},onPointerDown:function(n){(this.game.input.executeTouchLockCallbacks(!1,n),this.event=n,this.capture&&n.preventDefault(),this.pointerDownCallback&&this.pointerDownCallback.call(this.callbackContext,n),this.input.enabled&&this.enabled)&&(n.identifier=n.pointerId,n.pointerType==="mouse"||n.pointerType===4?this.input.mousePointer.start(n):this.input.startPointer(n))},onPointerMove:function(n){(this.event=n,this.capture&&n.preventDefault(),this.pointerMoveCallback&&this.pointerMoveCallback.call(this.callbackContext,n),this.input.enabled&&this.enabled)&&(n.identifier=n.pointerId,n.pointerType==="mouse"||n.pointerType===4?this.input.mousePointer.move(n):this.input.updatePointer(n))},onPointerUp:function(n){(this.game.input.executeTouchLockCallbacks(!0,n),this.event=n,this.capture&&n.preventDefault(),this.pointerUpCallback&&this.pointerUpCallback.call(this.callbackContext,n),this.input.enabled&&this.enabled)&&(n.identifier=n.pointerId,n.pointerType==="mouse"||n.pointerType===4?this.input.mousePointer.stop(n):this.input.stopPointer(n))},onPointerUpGlobal:function(n){if(n.identifier=n.pointerId,n.pointerType!=="mouse"&&n.pointerType!==4||this.input.mousePointer.withinGame){var t=this.input.getPointerFromIdentifier(n.identifier);if(t&&t.withinGame)this.onPointerUp(n)}else this.onPointerUp(n)},onPointerOut:function(n){if(this.event=n,this.capture&&n.preventDefault(),n.identifier=n.pointerId,n.pointerType==="mouse"||n.pointerType===4)this.input.mousePointer.withinGame=!1;else{var t=this.input.getPointerFromIdentifier(n.identifier);t&&(t.withinGame=!1)}(this.pointerOutCallback&&this.pointerOutCallback.call(this.callbackContext,n),this.input.enabled&&this.enabled)&&this.stopOnGameOut&&(n.identifier=0,t||(t=this.input.mousePointer),t.stop(n),this.input.callAll("_pointerOutHandler",t))},onPointerOver:function(n){if(this.event=n,this.capture&&n.preventDefault(),n.identifier=n.pointerId,n.pointerType==="mouse"||n.pointerType===4)this.input.mousePointer.withinGame=!0;else{var t=this.input.getPointerFromIdentifier(n.identifier);t&&(t.withinGame=!0)}this.pointerOverCallback&&this.pointerOverCallback.call(this.callbackContext,n)},stop:function(){var n=this.game.canvas;n.removeEventListener("MSPointerDown",this._onMSPointerDown,!1);n.removeEventListener("MSPointerMove",this._onMSPointerMove,!1);n.removeEventListener("MSPointerUp",this._onMSPointerUp,!1);n.removeEventListener("pointerdown",this._onMSPointerDown,!1);n.removeEventListener("pointermove",this._onMSPointerMove,!1);n.removeEventListener("pointerup",this._onMSPointerUp,!1);window.removeEventListener("MSPointerUp",this._onMSPointerUpGlobal,!0);n.removeEventListener("MSPointerOver",this._onMSPointerOver,!0);n.removeEventListener("MSPointerOut",this._onMSPointerOut,!0);window.removeEventListener("pointerup",this._onMSPointerUpGlobal,!0);n.removeEventListener("pointerover",this._onMSPointerOver,!0);n.removeEventListener("pointerout",this._onMSPointerOut,!0);this.active=!1}};n.MSPointer.prototype.constructor=n.MSPointer;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @author       @karlmacklin <tacklemcclean@gmail.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.DeviceButton=function(t,i){this.parent=t;this.game=t.game;this.event=null;this.isDown=!1;this.isUp=!0;this.timeDown=0;this.timeUp=0;this.repeats=0;this.altKey=!1;this.shiftKey=!1;this.ctrlKey=!1;this.value=0;this.buttonCode=i;this.onDown=new n.Signal;this.onUp=new n.Signal;this.onFloat=new n.Signal};n.DeviceButton.prototype={start:function(n,t){this.isDown||(this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.repeats=0,this.event=n,this.value=t,n&&(this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.ctrlKey=n.ctrlKey),this.onDown.dispatch(this,t))},stop:function(n,t){this.isUp||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.event=n,this.value=t,n&&(this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.ctrlKey=n.ctrlKey),this.onUp.dispatch(this,t))},startStop:function(n,t,i){n?this.start(t,i):this.stop(t,i)},padFloat:function(n){this.isDown=!1;this.isUp=!1;this.value=n;this.onFloat.dispatch(this,n)},justPressed:function(n){return n=n||250,this.isDown&&this.timeDown+n>this.game.time.time},justReleased:function(n){return n=n||250,this.isUp&&this.timeUp+n>this.game.time.time},reset:function(){this.isDown=!1;this.isUp=!0;this.timeDown=this.game.time.time;this.repeats=0;this.altKey=!1;this.shiftKey=!1;this.ctrlKey=!1},destroy:function(){this.onDown.dispose();this.onUp.dispose();this.onFloat.dispose();this.parent=null;this.game=null}};n.DeviceButton.prototype.constructor=n.DeviceButton;Object.defineProperty(n.DeviceButton.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Pointer=function(t,i,r){this.game=t;this.id=i;this.type=n.POINTER;this.exists=!0;this.identifier=0;this.pointerId=null;this.pointerMode=r||n.PointerMode.CURSOR|n.PointerMode.CONTACT;this.target=null;this.button=null;this.leftButton=new n.DeviceButton(this,n.Pointer.LEFT_BUTTON);this.middleButton=new n.DeviceButton(this,n.Pointer.MIDDLE_BUTTON);this.rightButton=new n.DeviceButton(this,n.Pointer.RIGHT_BUTTON);this.backButton=new n.DeviceButton(this,n.Pointer.BACK_BUTTON);this.forwardButton=new n.DeviceButton(this,n.Pointer.FORWARD_BUTTON);this.eraserButton=new n.DeviceButton(this,n.Pointer.ERASER_BUTTON);this._holdSent=!1;this._history=[];this._nextDrop=0;this._stateReset=!1;this.withinGame=!1;this.clientX=-1;this.clientY=-1;this.pageX=-1;this.pageY=-1;this.screenX=-1;this.screenY=-1;this.rawMovementX=0;this.rawMovementY=0;this.movementX=0;this.movementY=0;this.x=-1;this.y=-1;this.isMouse=i===0;this.isDown=!1;this.isUp=!0;this.timeDown=0;this.timeUp=0;this.previousTapTime=0;this.totalTouches=0;this.msSinceLastClick=Number.MAX_VALUE;this.targetObject=null;this.interactiveCandidates=[];this.active=!1;this.dirty=!1;this.position=new n.Point;this.positionDown=new n.Point;this.positionUp=new n.Point;this.circle=new n.Circle(0,0,44);this._clickTrampolines=null;this._trampolineTargetObject=null};n.Pointer.NO_BUTTON=0;n.Pointer.LEFT_BUTTON=1;n.Pointer.RIGHT_BUTTON=2;n.Pointer.MIDDLE_BUTTON=4;n.Pointer.BACK_BUTTON=8;n.Pointer.FORWARD_BUTTON=16;n.Pointer.ERASER_BUTTON=32;n.Pointer.prototype={resetButtons:function(){this.isDown=!1;this.isUp=!0;this.isMouse&&(this.leftButton.reset(),this.middleButton.reset(),this.rightButton.reset(),this.backButton.reset(),this.forwardButton.reset(),this.eraserButton.reset())},processButtonsDown:function(t,i){switch(t){case n.Mouse.LEFT_BUTTON:this.leftButton.start(i);break;case n.Mouse.RIGHT_BUTTON:this.rightButton.start(i);break;case n.Mouse.MIDDLE_BUTTON:this.middleButton.start(i);break;case n.Mouse.BACK_BUTTON:this.backButton.start(i);break;case n.Mouse.FORWARD_BUTTON:this.forwardButton.start(i)}},processButtonsUp:function(t,i){switch(t){case n.Mouse.LEFT_BUTTON:this.leftButton.stop(i);break;case n.Mouse.RIGHT_BUTTON:this.rightButton.stop(i);break;case n.Mouse.MIDDLE_BUTTON:this.middleButton.stop(i);break;case n.Mouse.BACK_BUTTON:this.backButton.stop(i);break;case n.Mouse.FORWARD_BUTTON:this.forwardButton.stop(i)}},processButtonsUpDown:function(t,i){var u=i.type.toLowerCase().substr(-4),r=u==="down",f=u==="move";t!==undefined?(r&&t===1&&i.ctrlKey&&(t=2),this.leftButton.startStop(n.Pointer.LEFT_BUTTON&t,i),this.rightButton.startStop(n.Pointer.RIGHT_BUTTON&t,i),this.middleButton.startStop(n.Pointer.MIDDLE_BUTTON&t,i),this.backButton.startStop(n.Pointer.BACK_BUTTON&t,i),this.forwardButton.startStop(n.Pointer.FORWARD_BUTTON&t,i),this.eraserButton.startStop(n.Pointer.ERASER_BUTTON&t,i)):i.button!==undefined?r&&i.ctrlKey&&i.button===0?this.rightButton.start(i):r?this.processButtonsDown(i.button,i):f||this.processButtonsUp(i.button,i):r?i.ctrlKey?this.rightButton.start(i):this.leftButton.start(i):(this.leftButton.stop(i),this.rightButton.stop(i))},updateButtons:function(n){this.button=n.button;this.processButtonsUpDown(n.buttons,n);this.isUp=!0;this.isDown=!1;(this.leftButton.isDown||this.rightButton.isDown||this.middleButton.isDown||this.backButton.isDown||this.forwardButton.isDown||this.eraserButton.isDown)&&(this.isUp=!1,this.isDown=!0)},start:function(t){var i=this.game.input;return t.pointerId&&(this.pointerId=t.pointerId),this.identifier=t.identifier,this.target=t.target,this.isMouse?this.updateButtons(t):(this.isDown=!0,this.isUp=!1),this.active=!0,this.withinGame=!0,this.dirty=!1,this._history=[],this._clickTrampolines=null,this._trampolineTargetObject=null,this.msSinceLastClick=this.game.time.time-this.timeDown,this.timeDown=this.game.time.time,this._holdSent=!1,this.move(t,!0),this.positionDown.setTo(this.x,this.y),(i.multiInputOverride===n.Input.MOUSE_OVERRIDES_TOUCH||i.multiInputOverride===n.Input.MOUSE_TOUCH_COMBINE||i.multiInputOverride===n.Input.TOUCH_OVERRIDES_MOUSE&&i.totalActivePointers===0)&&(i.x=this.x,i.y=this.y,i.position.setTo(this.x,this.y),i.onDown.dispatch(this,t),i.resetSpeed(this.x,this.y)),this._stateReset=!1,this.totalTouches++,this.targetObject!==null&&this.targetObject._touchedHandler(this),this},update:function(){var t=this.game.input;this.active&&(this.dirty&&(t.interactiveItems.total>0&&this.processInteractiveObjects(!1),this.dirty=!1),this._holdSent===!1&&this.duration>=t.holdRate&&((t.multiInputOverride===n.Input.MOUSE_OVERRIDES_TOUCH||t.multiInputOverride===n.Input.MOUSE_TOUCH_COMBINE||t.multiInputOverride===n.Input.TOUCH_OVERRIDES_MOUSE&&t.totalActivePointers===0)&&t.onHold.dispatch(this),this._holdSent=!0),t.recordPointerHistory&&this.game.time.time>=this._nextDrop&&(this._nextDrop=this.game.time.time+t.recordRate,this._history.push({x:this.position.x,y:this.position.y}),this._history.length>t.recordLimit&&this._history.shift()))},move:function(t,i){var r=this.game.input,u;if(!r.pollLocked){for(i===undefined&&(i=!1),t.button!==undefined&&(this.button=t.button),this.isMouse&&this.updateButtons(t),this.clientX=t.clientX,this.clientY=t.clientY,this.pageX=t.pageX,this.pageY=t.pageY,this.screenX=t.screenX,this.screenY=t.screenY,this.isMouse&&r.pointerLock.locked&&!i&&(this.rawMovementX=t.movementX||t.mozMovementX||t.webkitMovementX||0,this.rawMovementY=t.movementY||t.mozMovementY||t.webkitMovementY||0,this.movementX+=this.rawMovementX,this.movementY+=this.rawMovementY),this.x=(this.pageX-this.game.scale.offset.x)*r.scale.x,this.y=(this.pageY-this.game.scale.offset.y)*r.scale.y,this.position.setTo(this.x,this.y),this.circle.x=this.x,this.circle.y=this.y,(r.multiInputOverride===n.Input.MOUSE_OVERRIDES_TOUCH||r.multiInputOverride===n.Input.MOUSE_TOUCH_COMBINE||r.multiInputOverride===n.Input.TOUCH_OVERRIDES_MOUSE&&r.totalActivePointers===0)&&(r.activePointer=this,r.x=this.x,r.y=this.y,r.position.setTo(r.x,r.y),r.circle.x=r.x,r.circle.y=r.y),this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY),u=r.moveCallbacks.length;u--;)r.moveCallbacks[u].callback.call(r.moveCallbacks[u].context,this,this.x,this.y,i,t);return this.targetObject!==null&&(!this.game.paused||this.targetObject.noPause)&&this.targetObject.isDragged===!0?this.targetObject.update(this)===!1&&(this.targetObject=null):r.interactiveItems.total>0&&this.processInteractiveObjects(i),this}},processInteractiveObjects:function(n){var r=0,u=-1,i=null,t=this.game.input.interactiveItems.first;for(this.interactiveCandidates=[];t;)t.checked=!1,t.validForInput(u,r,!1)&&(!this.game.paused||t.sprite.noPause)&&(t.checked=!0,(n&&t.checkPointerDown(this,!0)||!n&&t.checkPointerOver(this,!0))&&(r=t.sprite.renderOrderID,u=t.priorityID,i=t,this.interactiveCandidates.push(t))),t=this.game.input.interactiveItems.next;for(t=this.game.input.interactiveItems.first;t;)!t.checked&&t.validForInput(u,r,!0)&&(n&&t.checkPointerDown(this,!1)||!n&&t.checkPointerOver(this,!1))&&(r=t.sprite.renderOrderID,u=t.priorityID,i=t,this.interactiveCandidates.push(t)),t=this.game.input.interactiveItems.next;return this.game.input.customCandidateHandler&&(i=this.game.input.customCandidateHandler.call(this.game.input.customCandidateHandlerContext,this,this.interactiveCandidates,i)),this.swapTarget(i,!1),this.targetObject!==null},swapTarget:function(n,t){t===undefined&&(t=!1);n===null?this.targetObject&&(this.targetObject._pointerOutHandler(this,t),this.targetObject=null):this.targetObject===null?(this.targetObject=n,n._pointerOverHandler(this,t)):this.targetObject===n?n.update(this)===!1&&(this.targetObject=null):(this.targetObject._pointerOutHandler(this,t),this.targetObject=n,this.targetObject._pointerOverHandler(this,t))},leave:function(n){this.withinGame=!1;this.move(n,!1)},stop:function(t){var i=this.game.input,r;if(this._stateReset&&this.withinGame){t.preventDefault();return}return this.timeUp=this.game.time.time,(i.multiInputOverride===n.Input.MOUSE_OVERRIDES_TOUCH||i.multiInputOverride===n.Input.MOUSE_TOUCH_COMBINE||i.multiInputOverride===n.Input.TOUCH_OVERRIDES_MOUSE&&i.totalActivePointers===0)&&(i.onUp.dispatch(this,t),this.duration>=0&&this.duration<=i.tapRate&&(r=this.timeUp-this.previousTapTime<i.doubleTapRate,i.onTap.dispatch(this,r,t),this.previousTapTime=this.timeUp)),this.isMouse?this.updateButtons(t):(this.isDown=!1,this.isUp=!0),this.id>0&&(this.active=!1),this.withinGame=this.game.scale.bounds.contains(t.pageX,t.pageY),this.pointerId=null,this.identifier=null,this.positionUp.setTo(this.x,this.y),this.isMouse===!1&&i.currentPointers--,i.callAll("_releasedHandler",this),this._clickTrampolines&&(this._trampolineTargetObject=this.targetObject),this.targetObject=null,this},justPressed:function(n){return n=n||this.game.input.justPressedRate,this.isDown===!0&&this.timeDown+n>this.game.time.time},justReleased:function(n){return n=n||this.game.input.justReleasedRate,this.isUp&&this.timeUp+n>this.game.time.time},addClickTrampoline:function(n,t,i,r){var u,f;if(this.isDown){for(u=this._clickTrampolines=this._clickTrampolines||[],f=0;f<u.length;f++)if(u[f].name===n){u.splice(f,1);break}u.push({name:n,targetObject:this.targetObject,callback:t,callbackContext:i,callbackArgs:r})}},processClickTrampolines:function(){var i=this._clickTrampolines,t,n;if(i){for(t=0;t<i.length;t++)n=i[t],n.targetObject===this._trampolineTargetObject&&n.callback.apply(n.callbackContext,n.callbackArgs);this._clickTrampolines=null;this._trampolineTargetObject=null}},reset:function(){this.isMouse===!1&&(this.active=!1);this.pointerId=null;this.identifier=null;this.dirty=!1;this.totalTouches=0;this._holdSent=!1;this._history.length=0;this._stateReset=!0;this.resetButtons();this.targetObject&&this.targetObject._releasedHandler(this);this.targetObject=null},resetMovement:function(){this.movementX=0;this.movementY=0}};n.Pointer.prototype.constructor=n.Pointer;Object.defineProperty(n.Pointer.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}});Object.defineProperty(n.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}});Object.defineProperty(n.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}});n.PointerMode={CURSOR:1,CONTACT:2};n.PointerModes={};n.PointerModes[n.PointerMode.CURSOR]="CURSOR";n.PointerModes[n.PointerMode.CONTACT]="CONTACT";
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Touch=function(n){this.game=n;this.active=!1;this.enabled=!0;this.callbackContext=this.game;this.touchStartCallback=null;this.touchMoveCallback=null;this.touchEndCallback=null;this.touchEnterCallback=null;this.touchLeaveCallback=null;this.touchCancelCallback=null;this.preventDefault=!0;this.event=null;this._onTouchStart=null;this._onTouchMove=null;this._onTouchEnd=null;this._onTouchEnter=null;this._onTouchLeave=null;this._onTouchCancel=null;this._onTouchMove=null};n.Touch.prototype={start:function(){if(!this.game.device.touch||this._onTouchStart!==null)return!1;var n=this;return this._onTouchStart=function(t){return n.onTouchStart(t)},this._onTouchMove=function(t){return n.onTouchMove(t)},this._onTouchEnd=function(t){return n.onTouchEnd(t)},this._onTouchEnter=function(t){return n.onTouchEnter(t)},this._onTouchLeave=function(t){return n.onTouchLeave(t)},this._onTouchCancel=function(t){return n.onTouchCancel(t)},this.game.canvas.addEventListener("touchstart",this._onTouchStart,!1),this.game.canvas.addEventListener("touchmove",this._onTouchMove,!1),this.game.canvas.addEventListener("touchend",this._onTouchEnd,!1),this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,!1),this.game.device.cocoonJS||(this.game.canvas.addEventListener("touchenter",this._onTouchEnter,!1),this.game.canvas.addEventListener("touchleave",this._onTouchLeave,!1)),this.active=!0,!0},consumeDocumentTouches:function(){this._documentTouchMove=function(n){n.preventDefault()};document.addEventListener("touchmove",this._documentTouchMove,!1)},onTouchStart:function(n){if(this.game.input.executeTouchLockCallbacks(!1,n),this.event=n,this.game.input.enabled&&this.enabled){this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,n);this.preventDefault&&n.preventDefault();for(var t=0;t<n.changedTouches.length;t++)this.game.input.startPointer(n.changedTouches[t])}},onTouchCancel:function(n){if(this.event=n,this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,n),this.game.input.enabled&&this.enabled){this.preventDefault&&n.preventDefault();for(var t=0;t<n.changedTouches.length;t++)this.game.input.stopPointer(n.changedTouches[t])}},onTouchEnter:function(n){(this.event=n,this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,n),this.game.input.enabled&&this.enabled)&&this.preventDefault&&n.preventDefault()},onTouchLeave:function(n){this.event=n;this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,n);this.preventDefault&&n.preventDefault()},onTouchMove:function(n){this.event=n;this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,n);this.preventDefault&&n.preventDefault();for(var t=0;t<n.changedTouches.length;t++)this.game.input.updatePointer(n.changedTouches[t])},onTouchEnd:function(n){this.game.input.executeTouchLockCallbacks(!0,n);this.event=n;this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,n);this.preventDefault&&n.preventDefault();for(var t=0;t<n.changedTouches.length;t++)this.game.input.stopPointer(n.changedTouches[t])},stop:function(){this.game.device.touch&&(this.game.canvas.removeEventListener("touchstart",this._onTouchStart),this.game.canvas.removeEventListener("touchmove",this._onTouchMove),this.game.canvas.removeEventListener("touchend",this._onTouchEnd),this.game.canvas.removeEventListener("touchenter",this._onTouchEnter),this.game.canvas.removeEventListener("touchleave",this._onTouchLeave),this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel),this.active=!1)}};n.Touch.prototype.constructor=n.Touch;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.InputHandler=function(t){this.sprite=t;this.game=t.game;this.enabled=!1;this.checked=!1;this.priorityID=0;this.useHandCursor=!1;this._setHandCursor=!1;this.isDragged=!1;this.allowHorizontalDrag=!0;this.allowVerticalDrag=!0;this.bringToTop=!1;this.snapOffset=null;this.snapOnDrag=!1;this.snapOnRelease=!1;this.snapX=0;this.snapY=0;this.snapOffsetX=0;this.snapOffsetY=0;this.pixelPerfectOver=!1;this.pixelPerfectClick=!1;this.pixelPerfectAlpha=255;this.draggable=!1;this.boundsRect=null;this.boundsSprite=null;this.scaleLayer=!1;this.dragOffset=new n.Point;this.dragFromCenter=!1;this.dragStopBlocksInputUp=!1;this.dragStartPoint=new n.Point;this.dragDistanceThreshold=0;this.dragTimeThreshold=0;this.downPoint=new n.Point;this.snapPoint=new n.Point;this._dragPoint=new n.Point;this._dragPhase=!1;this._pendingDrag=!1;this._dragTimePass=!1;this._dragDistancePass=!1;this._wasEnabled=!1;this._tempPoint=new n.Point;this._pointerData=[];this._pointerData.push({id:0,x:0,y:0,camX:0,camY:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1})};n.InputHandler.prototype={start:function(t,i){if(t=t||0,i===undefined&&(i=!1),this.enabled===!1){this.game.input.interactiveItems.add(this);this.useHandCursor=i;this.priorityID=t;for(var r=0;r<10;r++)this._pointerData[r]={id:r,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1};this.snapOffset=new n.Point;this.enabled=!0;this._wasEnabled=!0}return this.sprite.events.onAddedToGroup.add(this.addedToGroup,this),this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this),this.sprite},addedToGroup:function(){this._dragPhase||this._wasEnabled&&!this.enabled&&this.start()},removedFromGroup:function(){this._dragPhase||(this.enabled?(this._wasEnabled=!0,this.stop()):this._wasEnabled=!1)},reset:function(){this.enabled=!1;for(var n=0;n<10;n++)this._pointerData[n]={id:n,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1}},stop:function(){this.enabled!==!1&&(this.enabled=!1,this.game.input.interactiveItems.remove(this))},destroy:function(){this.sprite&&(this._setHandCursor&&(this.game.canvas.style.cursor="",this._setHandCursor=!1),this.enabled=!1,this.game.input.interactiveItems.remove(this),this._pointerData.length=0,this.boundsRect=null,this.boundsSprite=null,this.sprite=null)},validForInput:function(n,t,i){return(i===undefined&&(i=!0),!this.enabled||this.sprite.scale.x===0||this.sprite.scale.y===0||this.priorityID<this.game.input.minPriorityID||this.sprite.parent&&this.sprite.parent.ignoreChildInput)?!1:!i&&(this.pixelPerfectClick||this.pixelPerfectOver)?!1:this.priorityID>n||this.priorityID===n&&this.sprite.renderOrderID>t?!0:!1},isPixelPerfect:function(){return this.pixelPerfectClick||this.pixelPerfectOver},pointerX:function(n){return n=n||0,this._pointerData[n].x},pointerY:function(n){return n=n||0,this._pointerData[n].y},pointerDown:function(n){return n=n||0,this._pointerData[n].isDown},pointerUp:function(n){return n=n||0,this._pointerData[n].isUp},pointerTimeDown:function(n){return n=n||0,this._pointerData[n].timeDown},pointerTimeUp:function(n){return n=n||0,this._pointerData[n].timeUp},pointerOver:function(n){if(!this.enabled)return!1;if(n===undefined){for(var t=0;t<10;t++)if(this._pointerData[t].isOver)return!0;return!1}return this._pointerData[n].isOver},pointerOut:function(n){if(!this.enabled)return!1;if(n===undefined){for(var t=0;t<10;t++)if(this._pointerData[t].isOut)return!0}else return this._pointerData[n].isOut},pointerTimeOver:function(n){return n=n||0,this._pointerData[n].timeOver},pointerTimeOut:function(n){return n=n||0,this._pointerData[n].timeOut},pointerDragged:function(n){return n=n||0,this._pointerData[n].isDragged},checkPointerDown:function(n,t){return!n.isDown||!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible||this.sprite.worldScale.x===0||this.sprite.worldScale.y===0?!1:this.game.input.hitTest(this.sprite,n,this._tempPoint)?(t===undefined&&(t=!1),!t&&this.pixelPerfectClick?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0):!1},checkPointerOver:function(n,t){return!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible||this.sprite.worldScale.x===0||this.sprite.worldScale.y===0?!1:this.game.input.hitTest(this.sprite,n,this._tempPoint)?(t===undefined&&(t=!1),!t&&this.pixelPerfectOver?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0):!1},checkPixel:function(n,t,i){var n,t,r;if(this.sprite.texture.baseTexture.source){if(n===null&&t===null&&(this.game.input.getLocalPosition(this.sprite,i,this._tempPoint),n=this._tempPoint.x,t=this._tempPoint.y),this.sprite.anchor.x!==0&&(n-=-this.sprite.texture.frame.width*this.sprite.anchor.x),this.sprite.anchor.y!==0&&(t-=-this.sprite.texture.frame.height*this.sprite.anchor.y),n+=this.sprite.texture.frame.x,t+=this.sprite.texture.frame.y,this.sprite.texture.trim&&(n-=this.sprite.texture.trim.x,t-=this.sprite.texture.trim.y,n<this.sprite.texture.crop.x||n>this.sprite.texture.crop.right||t<this.sprite.texture.crop.y||t>this.sprite.texture.crop.bottom))return this._dx=n,this._dy=t,!1;if(this._dx=n,this._dy=t,this.game.input.hitContext.clearRect(0,0,1,1),this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,n,t,1,1,0,0,1,1),r=this.game.input.hitContext.getImageData(0,0,1,1),r.data[3]>=this.pixelPerfectAlpha)return!0}return!1},update:function(t){if(this.sprite!==null&&this.sprite.parent!==undefined)return!this.enabled||!this.sprite.visible||!this.sprite.parent.visible?(this._pointerOutHandler(t),!1):this._pendingDrag?(this._dragDistancePass||(this._dragDistancePass=n.Math.distance(t.x,t.y,this.downPoint.x,this.downPoint.y)>=this.dragDistanceThreshold),this._dragDistancePass&&this._dragTimePass&&this.startDrag(t),!0):this.draggable&&this._draggedPointerID===t.id?this.updateDrag(t,!1):this._pointerData[t.id].isOver?this.checkPointerOver(t)?(this._pointerData[t.id].x=t.x-this.sprite.x,this._pointerData[t.id].y=t.y-this.sprite.y,!0):(this._pointerOutHandler(t),!1):void 0},_pointerOverHandler:function(n,t){var i,r;if(this.sprite!==null&&(i=this._pointerData[n.id],i.isOver===!1||n.dirty)){if(r=i.isOver===!1,i.isOver=!0,i.isOut=!1,i.timeOver=this.game.time.time,i.x=n.x-this.sprite.x,i.y=n.y-this.sprite.y,this.useHandCursor&&i.isDragged===!1&&(this.game.canvas.style.cursor="pointer",this._setHandCursor=!0),!t&&r&&this.sprite&&this.sprite.events)this.sprite.events.onInputOver$dispatch(this.sprite,n);this.sprite.parent&&this.sprite.parent.onChildInputOver&&this.sprite.parent.onChildInputOver.dispatch(this.sprite,n)}},_pointerOutHandler:function(n,t){if(this.sprite!==null){var i=this._pointerData[n.id];if(i.isOver=!1,i.isOut=!0,i.timeOut=this.game.time.time,this.useHandCursor&&i.isDragged===!1&&(this.game.canvas.style.cursor="",this._setHandCursor=!1),!t&&this.sprite&&this.sprite.events){this.sprite.events.onInputOut$dispatch(this.sprite,n);this.sprite&&this.sprite.parent&&this.sprite.parent.onChildInputOut&&this.sprite.parent.onChildInputOut.dispatch(this.sprite,n)}}},_touchedHandler:function(n){if(this.sprite!==null){var t=this._pointerData[n.id];if(!t.isDown&&t.isOver){if(this.pixelPerfectClick&&!this.checkPixel(null,null,n))return;if(t.isDown=!0,t.isUp=!1,t.timeDown=this.game.time.time,this.downPoint.set(n.x,n.y),n.dirty=!0,this.sprite&&this.sprite.events){this.sprite.events.onInputDown$dispatch(this.sprite,n);if(this.sprite&&this.sprite.parent&&this.sprite.parent.onChildInputDown&&this.sprite.parent.onChildInputDown.dispatch(this.sprite,n),this.sprite===null)return}this.draggable&&this.isDragged===!1&&(this.dragTimeThreshold===0&&this.dragDistanceThreshold===0?this.startDrag(n):(this._pendingDrag=!0,this._dragDistancePass=this.dragDistanceThreshold===0,this.dragTimeThreshold>0?(this._dragTimePass=!1,this.game.time.events.add(this.dragTimeThreshold,this.dragTimeElapsed,this,n)):this._dragTimePass=!0));this.bringToTop&&this.sprite.bringToTop()}}},dragTimeElapsed:function(n){this._dragTimePass=!0;this._pendingDrag&&this.sprite&&this._dragDistancePass&&this.startDrag(n)},_releasedHandler:function(n){var t,i;if(this.sprite!==null&&(t=this._pointerData[n.id],t.isDown&&n.isUp)){if(t.isDown=!1,t.isUp=!0,t.timeUp=this.game.time.time,t.downDuration=t.timeUp-t.timeDown,i=this.checkPointerOver(n),this.sprite&&this.sprite.events){if(!this.dragStopBlocksInputUp||this.dragStopBlocksInputUp&&!(this.draggable&&this.isDragged&&this._draggedPointerID===n.id))this.sprite.events.onInputUp$dispatch(this.sprite,n,i);this.sprite&&this.sprite.parent&&this.sprite.parent.onChildInputUp&&this.sprite.parent.onChildInputUp.dispatch(this.sprite,n,i);i&&(i=this.checkPointerOver(n))}t.isOver=i;!i&&this.useHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1);n.dirty=!0;this._pendingDrag=!1;this.draggable&&this.isDragged&&this._draggedPointerID===n.id&&this.stopDrag(n)}},updateDrag:function(n,t){var u=this.game.camera,s=this.dragOffset,h=this._dragPoint,v=this._pointerData[n.id],c=this.snapPoint,i=this.sprite,f,e,o,l,a;if(t===undefined&&(t=!1),n.isUp)return this.stopDrag(n),!1;if(f=this.globalToLocal(n),i.fixedToCamera?(e=u.scale.x*f.x+h.x+s.x,o=u.scale.y*f.y+h.y+s.y):(e=f.x+h.x+s.x,o=f.y+h.y+s.y),i.fixedToCamera){var r=i.cameraOffset,y=r.x,p=r.y;this.allowHorizontalDrag&&(r.x=e-u.x);this.allowVerticalDrag&&(r.y=o-u.y);this.boundsRect&&this.checkBoundsRect();this.boundsSprite&&this.checkBoundsSprite();this.snapOnDrag&&(r.x=Math.round((r.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,r.y=Math.round((r.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY,c.set(r.x,r.y));l=r.x-y;a=r.y-p}else{var w=u.x-v.camX,b=u.y-v.camY,y=i.x,p=i.y;this.allowHorizontalDrag&&(i.x=e+w);this.allowVerticalDrag&&(i.y=o+b);this.boundsRect&&this.checkBoundsRect();this.boundsSprite&&this.checkBoundsSprite();this.snapOnDrag&&(i.x=Math.round((i.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,i.y=Math.round((i.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY,c.set(i.x,i.y));l=i.x-y;a=i.y-p}return this.sprite.events.onDragUpdate.dispatch(i,n,e,o,c,t,l,a),!0},justOver:function(n,t){return n=n||0,t=t||500,this._pointerData[n].isOver&&this.overDuration(n)<t},justOut:function(n,t){return n=n||0,t=t||500,this._pointerData[n].isOut&&this.game.time.time-this._pointerData[n].timeOut<t},justPressed:function(n,t){return n=n||0,t=t||500,this._pointerData[n].isDown&&this.downDuration(n)<t},justReleased:function(n,t){return n=n||0,t=t||500,this._pointerData[n].isUp&&this.game.time.time-this._pointerData[n].timeUp<t},overDuration:function(n){return(n=n||0,this._pointerData[n].isOver)?this.game.time.time-this._pointerData[n].timeOver:-1},downDuration:function(n){return(n=n||0,this._pointerData[n].isDown)?this.game.time.time-this._pointerData[n].timeDown:-1},enableDrag:function(t,i,r,u,f,e){t===undefined&&(t=!1);i===undefined&&(i=!1);r===undefined&&(r=!1);u===undefined&&(u=255);f===undefined&&(f=null);e===undefined&&(e=null);this._dragPoint=new n.Point;this.draggable=!0;this.bringToTop=i;this.dragOffset=new n.Point;this.dragFromCenter=t;this.pixelPerfectClick=r;this.pixelPerfectAlpha=u;f&&(this.boundsRect=f);e&&(this.boundsSprite=e)},disableDrag:function(){if(this._pointerData)for(var n=0;n<10;n++)this._pointerData[n].isDragged=!1;this.draggable=!1;this.isDragged=!1;this._draggedPointerID=-1;this._pendingDrag=!1},startDrag:function(t){var f=this.sprite.x,e=this.sprite.y,i=this.globalToLocal(t),r,u;this.isDragged=!0;this._draggedPointerID=t.id;this._pointerData[t.id].camX=this.game.camera.x;this._pointerData[t.id].camY=this.game.camera.y;this._pointerData[t.id].isDragged=!0;this.sprite.fixedToCamera?(this.dragFromCenter&&(r=this.sprite.getBounds(),u=this.globalToLocal(new n.Point(r.centerX,r.centerY)),this.sprite.cameraOffset.x=i.x+(this.sprite.cameraOffset.x-u.x),this.sprite.cameraOffset.y=i.y+(this.sprite.cameraOffset.y-u.y)),this._dragPoint.setTo(this.sprite.cameraOffset.x-t.x,this.sprite.cameraOffset.y-t.y)):(this.dragFromCenter&&(r=this.sprite.getBounds(),u=this.globalToLocal(new n.Point(r.centerX,r.centerY)),this.sprite.x=i.x+(this.sprite.x-u.x),this.sprite.y=i.y+(this.sprite.y-u.y)),this._dragPoint.setTo(this.sprite.x-i.x,this.sprite.y-i.y));this.updateDrag(t,!0);this.bringToTop&&(this._dragPhase=!0,this.sprite.bringToTop());this.dragStartPoint.set(f,e);this.sprite.events.onDragStart$dispatch(this.sprite,t,f,e);this._pendingDrag=!1},globalToLocalX:function(n){return this.scaleLayer&&(n-=this.game.scale.grid.boundsFluid.x,n*=this.game.scale.grid.scaleFluidInversed.x),n},globalToLocalY:function(n){return this.scaleLayer&&(n-=this.game.scale.grid.boundsFluid.y,n*=this.game.scale.grid.scaleFluidInversed.y),n},globalToLocal:function(n){return this.sprite.parent?this.game.input.getLocalPosition(this.sprite.parent,{x:n.x,y:n.y}):n},stopDrag:function(n){this.isDragged=!1;this._draggedPointerID=-1;this._pointerData[n.id].isDragged=!1;this._dragPhase=!1;this._pendingDrag=!1;this.snapOnRelease&&(this.sprite.fixedToCamera?(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY):(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY));this.sprite.events.onDragStop$dispatch(this.sprite,n);this.checkPointerOver(n)===!1&&this._pointerOutHandler(n)},setDragLock:function(n,t){n===undefined&&(n=!0);t===undefined&&(t=!0);this.allowHorizontalDrag=n;this.allowVerticalDrag=t},enableSnap:function(n,t,i,r,u,f){i===undefined&&(i=!0);r===undefined&&(r=!1);u===undefined&&(u=0);f===undefined&&(f=0);this.snapX=n;this.snapY=t;this.snapOffsetX=u;this.snapOffsetY=f;this.snapOnDrag=i;this.snapOnRelease=r},disableSnap:function(){this.snapOnDrag=!1;this.snapOnRelease=!1},checkBoundsRect:function(){this.sprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsRect.left?this.sprite.cameraOffset.x=this.boundsRect.left:this.sprite.cameraOffset.x+this.sprite.width>this.boundsRect.right&&(this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width),this.sprite.cameraOffset.y<this.boundsRect.top?this.sprite.cameraOffset.y=this.boundsRect.top:this.sprite.cameraOffset.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height)):(this.sprite.left<this.boundsRect.left?this.sprite.x=this.boundsRect.x+this.sprite.offsetX:this.sprite.right>this.boundsRect.right&&(this.sprite.x=this.boundsRect.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsRect.top?this.sprite.y=this.boundsRect.top+this.sprite.offsetY:this.sprite.bottom>this.boundsRect.bottom&&(this.sprite.y=this.boundsRect.bottom-(this.sprite.height-this.sprite.offsetY)))},checkBoundsSprite:function(){this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsSprite.cameraOffset.x?this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x:this.sprite.cameraOffset.x+this.sprite.width>this.boundsSprite.cameraOffset.x+this.boundsSprite.width&&(this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x+this.boundsSprite.width-this.sprite.width),this.sprite.cameraOffset.y<this.boundsSprite.cameraOffset.y?this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y:this.sprite.cameraOffset.y+this.sprite.height>this.boundsSprite.cameraOffset.y+this.boundsSprite.height&&(this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y+this.boundsSprite.height-this.sprite.height)):(this.sprite.left<this.boundsSprite.left?this.sprite.x=this.boundsSprite.left+this.sprite.offsetX:this.sprite.right>this.boundsSprite.right&&(this.sprite.x=this.boundsSprite.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsSprite.top?this.sprite.y=this.boundsSprite.top+this.sprite.offsetY:this.sprite.bottom>this.boundsSprite.bottom&&(this.sprite.y=this.boundsSprite.bottom-(this.sprite.height-this.sprite.offsetY)))}};n.InputHandler.prototype.constructor=n.InputHandler;n.PointerLock=function(t){this.game=t;this.input=t.input;this.element=t.canvas;this.active=!1;this.locked=!1;this.onChange=new n.Signal;this.onError=new n.Signal;this.boundOnChangeHandler=this.onChangeHandler.bind(this);this.boundOnErrorHandler=this.onErrorHandler.bind(this);var i=t.device;this.pointerLockElement=i.pointerLockElement;this.pointerlockchange=i.pointerlockchange;this.pointerlockerror=i.pointerlockerror};n.PointerLock.prototype.start=function(){return!this.game.device.pointerLock||this.active?!1:(this.element.requestPointerLock||(this.element.requestPointerLock=this.element.mozRequestPointerLock||this.element.webkitRequestPointerLock),document.exitPointerLock||(document.exitPointerLock=document.mozExitPointerLock||document.webkitExitPointerLock),document.addEventListener(this.pointerlockchange,this.boundOnChangeHandler,!0),document.addEventListener(this.pointerlockerror,this.boundOnErrorHandler,!0),this.active=!0,!0)};n.PointerLock.prototype.stop=function(){this.active&&(document.removeEventListener(this.pointerlockchange,this.boundOnChangeHandler,!0),document.removeEventListener(this.pointerlockerror,this.boundOnErrorHandler,!0),this.active=!1)};n.PointerLock.prototype.request=function(){this.active&&!this.locked&&this.element.requestPointerLock()};n.PointerLock.prototype.exit=function(){document.exitPointerLock()};n.PointerLock.prototype.onChangeHandler=function(n){this.locked=document[this.pointerLockElement]===this.element;this.onChange.dispatch(this.locked,n)};n.PointerLock.prototype.onErrorHandler=function(n){this.onError.dispatch(n)};
/**
* @author       @karlmacklin <tacklemcclean@gmail.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Gamepad=function(t){this.game=t;this._gamepadIndexMap={};this._rawPads=[];this._active=!1;this.enabled=!0;this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||navigator.userAgent.indexOf("Firefox/")!==-1||!!navigator.getGamepads;this._prevRawGamepadTypes=[];this._prevTimestamps=[];this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this._ongamepadconnected=null;this._gamepaddisconnected=null;this._gamepads=[new n.SinglePad(t,this),new n.SinglePad(t,this),new n.SinglePad(t,this),new n.SinglePad(t,this)]};n.Gamepad.prototype={addCallbacks:function(n,t){typeof t!="undefined"&&(this.onConnectCallback=typeof t.onConnect=="function"?t.onConnect:this.onConnectCallback,this.onDisconnectCallback=typeof t.onDisconnect=="function"?t.onDisconnect:this.onDisconnectCallback,this.onDownCallback=typeof t.onDown=="function"?t.onDown:this.onDownCallback,this.onUpCallback=typeof t.onUp=="function"?t.onUp:this.onUpCallback,this.onAxisCallback=typeof t.onAxis=="function"?t.onAxis:this.onAxisCallback,this.onFloatCallback=typeof t.onFloat=="function"?t.onFloat:this.onFloatCallback,this.callbackContext=n)},start:function(){if(!this._active){this._active=!0;var n=this;this._onGamepadConnected=function(t){return n.onGamepadConnected(t)};this._onGamepadDisconnected=function(t){return n.onGamepadDisconnected(t)};window.addEventListener("gamepadconnected",this._onGamepadConnected,!1);window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected,!1)}},onGamepadConnected:function(n){var t=n.gamepad;this._rawPads.push(t);this._gamepads[t.index].connect(t)},onGamepadDisconnected:function(n){var t=n.gamepad;for(var i in this._rawPads)this._rawPads[i].index===t.index&&this._rawPads.splice(i,1);this._gamepads[t.index].disconnect()},update:function(){this._pollGamepads();this.pad1.pollStatus();this.pad2.pollStatus();this.pad3.pollStatus();this.pad4.pollStatus()},_pollGamepads:function(){var t,c,n,f,r,i,e,s,u,h,o;if(this._active&&(navigator.getGamepads?t=navigator.getGamepads():navigator.webkitGetGamepads?t=navigator.webkitGetGamepads():navigator.webkitGamepads&&(t=navigator.webkitGamepads()),t)){for(this._rawPads=[],c=!1,n=0;n<t.length;n++)if(typeof t[n]!==this._prevRawGamepadTypes[n]&&(c=!0,this._prevRawGamepadTypes[n]=typeof t[n]),t[n]&&this._rawPads.push(t[n]),n===3)break;for(f=0;f<this._gamepads.length;f++)this._gamepads[f]._rawPad=this._rawPads[f];if(c){for(r={rawIndices:{},padIndices:{}},e=0;e<this._gamepads.length;e++)if(i=this._gamepads[e],i.connected)for(s=0;s<this._rawPads.length;s++)this._rawPads[s].index===i.index&&(r.rawIndices[i.index]=!0,r.padIndices[e]=!0);for(u=0;u<this._gamepads.length;u++)if(i=this._gamepads[u],!r.padIndices[u])for(this._rawPads.length<1&&i.disconnect(),h=0;h<this._rawPads.length;h++){if(r.padIndices[u])break;if(o=this._rawPads[h],o)if(r.rawIndices[o.index]){i.disconnect();continue}else i.connect(o),r.rawIndices[o.index]=!0,r.padIndices[u]=!0;else i.disconnect()}}}},setDeadZones:function(n){for(var t=0;t<this._gamepads.length;t++)this._gamepads[t].deadZone=n},stop:function(){this._active=!1;window.removeEventListener("gamepadconnected",this._onGamepadConnected);window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected)},reset:function(){this.update();for(var n=0;n<this._gamepads.length;n++)this._gamepads[n].reset()},justPressed:function(n,t){for(var i=0;i<this._gamepads.length;i++)if(this._gamepads[i].justPressed(n,t)===!0)return!0;return!1},justReleased:function(n,t){for(var i=0;i<this._gamepads.length;i++)if(this._gamepads[i].justReleased(n,t)===!0)return!0;return!1},isDown:function(n){for(var t=0;t<this._gamepads.length;t++)if(this._gamepads[t].isDown(n)===!0)return!0;return!1},destroy:function(){this.stop();for(var n=0;n<this._gamepads.length;n++)this._gamepads[n].destroy()}};n.Gamepad.prototype.constructor=n.Gamepad;Object.defineProperty(n.Gamepad.prototype,"active",{get:function(){return this._active}});Object.defineProperty(n.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}});Object.defineProperty(n.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}});Object.defineProperty(n.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}});Object.defineProperty(n.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}});Object.defineProperty(n.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}});Object.defineProperty(n.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}});n.Gamepad.BUTTON_0=0;n.Gamepad.BUTTON_1=1;n.Gamepad.BUTTON_2=2;n.Gamepad.BUTTON_3=3;n.Gamepad.BUTTON_4=4;n.Gamepad.BUTTON_5=5;n.Gamepad.BUTTON_6=6;n.Gamepad.BUTTON_7=7;n.Gamepad.BUTTON_8=8;n.Gamepad.BUTTON_9=9;n.Gamepad.BUTTON_10=10;n.Gamepad.BUTTON_11=11;n.Gamepad.BUTTON_12=12;n.Gamepad.BUTTON_13=13;n.Gamepad.BUTTON_14=14;n.Gamepad.BUTTON_15=15;n.Gamepad.AXIS_0=0;n.Gamepad.AXIS_1=1;n.Gamepad.AXIS_2=2;n.Gamepad.AXIS_3=3;n.Gamepad.AXIS_4=4;n.Gamepad.AXIS_5=5;n.Gamepad.AXIS_6=6;n.Gamepad.AXIS_7=7;n.Gamepad.AXIS_8=8;n.Gamepad.AXIS_9=9;n.Gamepad.XBOX360_A=0;n.Gamepad.XBOX360_B=1;n.Gamepad.XBOX360_X=2;n.Gamepad.XBOX360_Y=3;n.Gamepad.XBOX360_LEFT_BUMPER=4;n.Gamepad.XBOX360_RIGHT_BUMPER=5;n.Gamepad.XBOX360_LEFT_TRIGGER=6;n.Gamepad.XBOX360_RIGHT_TRIGGER=7;n.Gamepad.XBOX360_BACK=8;n.Gamepad.XBOX360_START=9;n.Gamepad.XBOX360_STICK_LEFT_BUTTON=10;n.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11;n.Gamepad.XBOX360_DPAD_LEFT=14;n.Gamepad.XBOX360_DPAD_RIGHT=15;n.Gamepad.XBOX360_DPAD_UP=12;n.Gamepad.XBOX360_DPAD_DOWN=13;n.Gamepad.XBOX360_STICK_LEFT_X=0;n.Gamepad.XBOX360_STICK_LEFT_Y=1;n.Gamepad.XBOX360_STICK_RIGHT_X=2;n.Gamepad.XBOX360_STICK_RIGHT_Y=3;n.Gamepad.PS3XC_X=0;n.Gamepad.PS3XC_CIRCLE=1;n.Gamepad.PS3XC_SQUARE=2;n.Gamepad.PS3XC_TRIANGLE=3;n.Gamepad.PS3XC_L1=4;n.Gamepad.PS3XC_R1=5;n.Gamepad.PS3XC_L2=6;n.Gamepad.PS3XC_R2=7;n.Gamepad.PS3XC_SELECT=8;n.Gamepad.PS3XC_START=9;n.Gamepad.PS3XC_STICK_LEFT_BUTTON=10;n.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11;n.Gamepad.PS3XC_DPAD_UP=12;n.Gamepad.PS3XC_DPAD_DOWN=13;n.Gamepad.PS3XC_DPAD_LEFT=14;n.Gamepad.PS3XC_DPAD_RIGHT=15;n.Gamepad.PS3XC_STICK_LEFT_X=0;n.Gamepad.PS3XC_STICK_LEFT_Y=1;n.Gamepad.PS3XC_STICK_RIGHT_X=2;n.Gamepad.PS3XC_STICK_RIGHT_Y=3;
/**
* @author       @karlmacklin <tacklemcclean@gmail.com>
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.SinglePad=function(n,t){this.game=n;this.index=null;this.connected=!1;this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this.deadZone=.26;this._padParent=t;this._rawPad=null;this._prevTimestamp=null;this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0};n.SinglePad.prototype={addCallbacks:function(n,t){typeof t!="undefined"&&(this.onConnectCallback=typeof t.onConnect=="function"?t.onConnect:this.onConnectCallback,this.onDisconnectCallback=typeof t.onDisconnect=="function"?t.onDisconnect:this.onDisconnectCallback,this.onDownCallback=typeof t.onDown=="function"?t.onDown:this.onDownCallback,this.onUpCallback=typeof t.onUp=="function"?t.onUp:this.onUpCallback,this.onAxisCallback=typeof t.onAxis=="function"?t.onAxis:this.onAxisCallback,this.onFloatCallback=typeof t.onFloat=="function"?t.onFloat:this.onFloatCallback,this.callbackContext=n)},getButton:function(n){return this._buttons[n]?this._buttons[n]:null},pollStatus:function(){var n,t,i,r;if(this.connected&&this.game.input.enabled&&this.game.input.gamepad.enabled&&this._rawPad&&(!this._rawPad.timestamp||this._rawPad.timestamp!==this._prevTimestamp)){for(n=0;n<this._buttonsLen;n++)t=isNaN(this._rawPad.buttons[n])?this._rawPad.buttons[n].value:this._rawPad.buttons[n],t!==this._buttons[n].value&&(t===1?this.processButtonDown(n,t):t===0?this.processButtonUp(n,t):this.processButtonFloat(n,t));for(i=0;i<this._axesLen;i++)r=this._rawPad.axes[i],r>0&&r>this.deadZone||r<0&&r<-this.deadZone?this.processAxisChange(i,r):this.processAxisChange(i,0);this._prevTimestamp=this._rawPad.timestamp}},connect:function(t){var u=!this.connected,i,r;for(this.connected=!0,this.index=t.index,this._rawPad=t,this._buttons=[],this._buttonsLen=t.buttons.length,this._axes=[],this._axesLen=t.axes.length,i=0;i<this._axesLen;i++)this._axes[i]=t.axes[i];for(r in t.buttons)r=parseInt(r,10),this._buttons[r]=new n.DeviceButton(this,r);u&&this._padParent.onConnectCallback&&this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index);u&&this.onConnectCallback&&this.onConnectCallback.call(this.callbackContext)},disconnect:function(){var t=this.connected,i=this.index,n;for(this.connected=!1,this.index=null,this._rawPad=undefined,n=0;n<this._buttonsLen;n++)this._buttons[n].destroy();this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;t&&this._padParent.onDisconnectCallback&&this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,i);t&&this.onDisconnectCallback&&this.onDisconnectCallback.call(this.callbackContext)},destroy:function(){this._rawPad=undefined;for(var n=0;n<this._buttonsLen;n++)this._buttons[n].destroy();this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null},processAxisChange:function(n,t){this._axes[n]!==t&&(this._axes[n]=t,this._padParent.onAxisCallback&&this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,n,t),this.onAxisCallback&&this.onAxisCallback.call(this.callbackContext,this,n,t))},processButtonDown:function(n,t){this._buttons[n]&&this._buttons[n].start(null,t);this._padParent.onDownCallback&&this._padParent.onDownCallback.call(this._padParent.callbackContext,n,t,this.index);this.onDownCallback&&this.onDownCallback.call(this.callbackContext,n,t)},processButtonUp:function(n,t){this._padParent.onUpCallback&&this._padParent.onUpCallback.call(this._padParent.callbackContext,n,t,this.index);this.onUpCallback&&this.onUpCallback.call(this.callbackContext,n,t);this._buttons[n]&&this._buttons[n].stop(null,t)},processButtonFloat:function(n,t){this._padParent.onFloatCallback&&this._padParent.onFloatCallback.call(this._padParent.callbackContext,n,t,this.index);this.onFloatCallback&&this.onFloatCallback.call(this.callbackContext,n,t);this._buttons[n]&&this._buttons[n].padFloat(t)},axis:function(n){return this._axes[n]?this._axes[n]:!1},isDown:function(n){return this._buttons[n]?this._buttons[n].isDown:!1},isUp:function(n){return this._buttons[n]?this._buttons[n].isUp:!1},justReleased:function(n,t){if(this._buttons[n])return this._buttons[n].justReleased(t)},justPressed:function(n,t){if(this._buttons[n])return this._buttons[n].justPressed(t)},buttonValue:function(n){return this._buttons[n]?this._buttons[n].value:null},reset:function(){for(var n=0;n<this._axes.length;n++)this._axes[n]=0}};n.SinglePad.prototype.constructor=n.SinglePad;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Key=function(t,i){this.game=t;this._enabled=!0;this.event=null;this.isDown=!1;this.isUp=!0;this.altKey=!1;this.ctrlKey=!1;this.shiftKey=!1;this.timeDown=0;this.duration=0;this.timeUp=-2500;this.durationUp=-2500;this.repeats=0;this.keyCode=i;this.onDown=new n.Signal;this.onHoldCallback=null;this.onHoldContext=null;this.onUp=new n.Signal;this._justDown=!1;this._justUp=!1};n.Key.prototype={update:function(){this._enabled&&(this.isDown?(this.duration=this.game.time.time-this.timeDown,this.repeats++,this.onHoldCallback&&this.onHoldCallback.call(this.onHoldContext,this)):this.durationUp=this.game.time.time-this.timeUp)},processKeyDown:function(n){this._enabled&&((this.event=n,this.isDown)||(this.altKey=n.altKey,this.ctrlKey=n.ctrlKey,this.shiftKey=n.shiftKey,this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.duration=0,this.durationUp=this.game.time.time-this.timeUp,this.repeats=0,this._justDown=!0,this.onDown.dispatch(this)))},processKeyUp:function(n){this._enabled&&((this.event=n,this.isUp)||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.duration=this.game.time.time-this.timeDown,this.durationUp=0,this._justUp=!0,this.onUp.dispatch(this)))},reset:function(n){n===undefined&&(n=!0);this.isDown=!1;this.isUp=!0;this.timeUp=this.game.time.time;this.duration=0;this.durationUp=-2500;this._enabled=!0;this._justDown=!1;this._justUp=!1;n&&(this.onDown.removeAll(),this.onUp.removeAll(),this.onHoldCallback=null,this.onHoldContext=null)},downDuration:function(n){return n===undefined&&(n=50),this.isDown&&this.duration<n},upDuration:function(n){return n===undefined&&(n=50),!this.isDown&&this.game.time.time-this.timeUp<n},justPressed:function(){return this.isDown&&this.duration===0},justReleased:function(){return!this.isDown&&this.durationUp===0}};Object.defineProperty(n.Key.prototype,"justDown",{get:function(){var n=this._justDown;return this._justDown=!1,n}});Object.defineProperty(n.Key.prototype,"justUp",{get:function(){var n=this._justUp;return this._justUp=!1,n}});Object.defineProperty(n.Key.prototype,"enabled",{get:function(){return this._enabled},set:function(n){n=!!n;n!==this._enabled&&(n||this.reset(!1),this._enabled=n)}});n.Key.prototype.constructor=n.Key;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Keyboard=function(n){this.game=n;this.active=!1;this.enabled=!0;this.event=null;this.pressEvent=null;this.callbackContext=this;this.onDownCallback=null;this.onPressCallback=null;this.onUpCallback=null;this._keys=[];this._capture=[];this._onKeyDown=null;this._onKeyPress=null;this._onKeyUp=null;this._i=0;this._k=0};n.Keyboard.prototype={addCallbacks:function(n,t,i,r){this.callbackContext=n;t!==undefined&&t!==null&&(this.onDownCallback=t);i!==undefined&&i!==null&&(this.onUpCallback=i);r!==undefined&&r!==null&&(this.onPressCallback=r)},removeCallbacks:function(){this.callbackContext=this;this.onDownCallback=null;this.onUpCallback=null;this.onPressCallback=null},addKey:function(t){return this._keys[t]||(this._keys[t]=new n.Key(this.game,t),this.addKeyCapture(t)),this._keys[t]},addKeys:function(n){var t={};for(var i in n)t[i]=this.addKey(n[i]);return t},removeKey:function(n){this._keys[n]&&(this._keys[n]=null,this.removeKeyCapture(n))},createCursorKeys:function(){return this.addKeys({up:n.KeyCode.UP,down:n.KeyCode.DOWN,left:n.KeyCode.LEFT,right:n.KeyCode.RIGHT})},start:function(){if(this.game.device.cocoonJS||this.active)return!1;var n=this;return this._onKeyDown=function(t){return n.processKeyDown(t)},this._onKeyUp=function(t){return n.processKeyUp(t)},this._onKeyPress=function(t){return n.processKeyPress(t)},window.addEventListener("keydown",this._onKeyDown,!1),window.addEventListener("keyup",this._onKeyUp,!1),window.addEventListener("keypress",this._onKeyPress,!1),this.active=!0,!0},stop:function(){window.removeEventListener("keydown",this._onKeyDown);window.removeEventListener("keyup",this._onKeyUp);window.removeEventListener("keypress",this._onKeyPress);this._onKeyDown=null;this._onKeyUp=null;this._onKeyPress=null;this.active=!1},destroy:function(){this.stop();this.clearCaptures();this._keys.length=0;this._i=0},addKeyCapture:function(n){if(typeof n=="object")for(var t in n)this._capture[n[t]]=!0;else this._capture[n]=!0},removeKeyCapture:function(n){delete this._capture[n]},clearCaptures:function(){this._capture={}},update:function(){for(this._i=this._keys.length;this._i--;)this._keys[this._i]&&this._keys[this._i].update()},processKeyDown:function(t){if(this.event=t,this.game.input.enabled&&this.enabled){var i=t.keyCode;this._capture[i]&&t.preventDefault();this._keys[i]||(this._keys[i]=new n.Key(this.game,i));this._keys[i].processKeyDown(t);this._k=i;this.onDownCallback&&this.onDownCallback.call(this.callbackContext,t)}},processKeyPress:function(n){(this.pressEvent=n,this.game.input.enabled&&this.enabled)&&this.onPressCallback&&this.onPressCallback.call(this.callbackContext,String.fromCharCode(n.charCode),n)},processKeyUp:function(t){if(this.event=t,this.game.input.enabled&&this.enabled){var i=t.keyCode;this._capture[i]&&t.preventDefault();this._keys[i]||(this._keys[i]=new n.Key(this.game,i));this._keys[i].processKeyUp(t);this.onUpCallback&&this.onUpCallback.call(this.callbackContext,t)}},reset:function(n){n===undefined&&(n=!0);this.event=null;for(var t=this._keys.length;t--;)this._keys[t]&&this._keys[t].reset(n)},downDuration:function(n,t){return this._keys[n]?this._keys[n].downDuration(t):null},upDuration:function(n,t){return this._keys[n]?this._keys[n].upDuration(t):null},justPressed:function(n){return this._keys[n]?this._keys[n].justPressed():null},justReleased:function(n){return this._keys[n]?this._keys[n].justReleased():null},isDown:function(n){return this._keys[n]?this._keys[n].isDown:null}};Object.defineProperty(n.Keyboard.prototype,"lastChar",{get:function(){return this.event&&this.event.charCode===32?"":this.pressEvent?String.fromCharCode(this.pressEvent.charCode):null}});Object.defineProperty(n.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}});n.Keyboard.prototype.constructor=n.Keyboard;n.KeyCode={A:"A".charCodeAt(0),B:"B".charCodeAt(0),C:"C".charCodeAt(0),D:"D".charCodeAt(0),E:"E".charCodeAt(0),F:"F".charCodeAt(0),G:"G".charCodeAt(0),H:"H".charCodeAt(0),I:"I".charCodeAt(0),J:"J".charCodeAt(0),K:"K".charCodeAt(0),L:"L".charCodeAt(0),M:"M".charCodeAt(0),N:"N".charCodeAt(0),O:"O".charCodeAt(0),P:"P".charCodeAt(0),Q:"Q".charCodeAt(0),R:"R".charCodeAt(0),S:"S".charCodeAt(0),T:"T".charCodeAt(0),U:"U".charCodeAt(0),V:"V".charCodeAt(0),W:"W".charCodeAt(0),X:"X".charCodeAt(0),Y:"Y".charCodeAt(0),Z:"Z".charCodeAt(0),ZERO:"0".charCodeAt(0),ONE:"1".charCodeAt(0),TWO:"2".charCodeAt(0),THREE:"3".charCodeAt(0),FOUR:"4".charCodeAt(0),FIVE:"5".charCodeAt(0),SIX:"6".charCodeAt(0),SEVEN:"7".charCodeAt(0),EIGHT:"8".charCodeAt(0),NINE:"9".charCodeAt(0),NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_ENTER:108,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,COLON:186,EQUALS:187,COMMA:188,UNDERSCORE:189,PERIOD:190,QUESTION_MARK:191,TILDE:192,OPEN_BRACKET:219,BACKWARD_SLASH:220,CLOSED_BRACKET:221,QUOTES:222,BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,CAPS_LOCK:20,ESC:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PLUS:43,MINUS:44,INSERT:45,DELETE:46,HELP:47,NUM_LOCK:144};for(f in n.KeyCode)n.KeyCode.hasOwnProperty(f)&&!f.match(/[a-z]/)&&(n.Keyboard[f]=n.KeyCode[f]);
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component=function(){};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.Angle=function(){};n.Component.Angle.prototype={angle:{get:function(){return n.Math.wrapAngle(n.Math.radToDeg(this.rotation))},set:function(t){this.rotation=n.Math.degToRad(n.Math.wrapAngle(t))}}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.Animation=function(){};n.Component.Animation.prototype={play:function(n,t,i,r){if(this.animations)return this.animations.play(n,t,i,r)}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.AutoCull=function(){};n.Component.AutoCull.prototype={autoCull:!1,inCamera:{get:function(){return this.autoCull||this.checkWorldBounds||(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y),this.game.world.camera.view.intersects(this._bounds)}}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.Bounds=function(){};n.Component.Bounds.prototype={offsetX:{get:function(){return this.anchor.x*this.width}},offsetY:{get:function(){return this.anchor.y*this.height}},centerX:{get:function(){return this.x-this.offsetX+this.width*.5},set:function(n){this.x=n+this.offsetX-this.width*.5}},centerY:{get:function(){return this.y-this.offsetY+this.height*.5},set:function(n){this.y=n+this.offsetY-this.height*.5}},left:{get:function(){return this.x-this.offsetX},set:function(n){this.x=n+this.offsetX}},right:{get:function(){return this.x+this.width-this.offsetX},set:function(n){this.x=n-this.width+this.offsetX}},top:{get:function(){return this.y-this.offsetY},set:function(n){this.y=n+this.offsetY}},bottom:{get:function(){return this.y+this.height-this.offsetY},set:function(n){this.y=n-this.height+this.offsetY}},alignIn:function(t,i,r,u){r===undefined&&(r=0);u===undefined&&(u=0);switch(i){default:case n.TOP_LEFT:this.left=t.left-r;this.top=t.top-u;break;case n.TOP_CENTER:this.centerX=t.centerX+r;this.top=t.top-u;break;case n.TOP_RIGHT:this.right=t.right+r;this.top=t.top-u;break;case n.LEFT_CENTER:this.left=t.left-r;this.centerY=t.centerY+u;break;case n.CENTER:this.centerX=t.centerX+r;this.centerY=t.centerY+u;break;case n.RIGHT_CENTER:this.right=t.right+r;this.centerY=t.centerY+u;break;case n.BOTTOM_LEFT:this.left=t.left-r;this.bottom=t.bottom+u;break;case n.BOTTOM_CENTER:this.centerX=t.centerX+r;this.bottom=t.bottom+u;break;case n.BOTTOM_RIGHT:this.right=t.right+r;this.bottom=t.bottom+u}return this},alignTo:function(t,i,r,u){r===undefined&&(r=0);u===undefined&&(u=0);switch(i){default:case n.TOP_LEFT:this.left=t.left-r;this.bottom=t.top-u;break;case n.TOP_CENTER:this.centerX=t.centerX+r;this.bottom=t.top-u;break;case n.TOP_RIGHT:this.right=t.right+r;this.bottom=t.top-u;break;case n.LEFT_TOP:this.right=t.left-r;this.top=t.top-u;break;case n.LEFT_CENTER:this.right=t.left-r;this.centerY=t.centerY+u;break;case n.LEFT_BOTTOM:this.right=t.left-r;this.bottom=t.bottom+u;break;case n.RIGHT_TOP:this.left=t.right+r;this.top=t.top-u;break;case n.RIGHT_CENTER:this.left=t.right+r;this.centerY=t.centerY+u;break;case n.RIGHT_BOTTOM:this.left=t.right+r;this.bottom=t.bottom+u;break;case n.BOTTOM_LEFT:this.left=t.left-r;this.top=t.bottom+u;break;case n.BOTTOM_CENTER:this.centerX=t.centerX+r;this.top=t.bottom+u;break;case n.BOTTOM_RIGHT:this.right=t.right+r;this.top=t.bottom+u}return this}};n.Group.prototype.alignIn=n.Component.Bounds.prototype.alignIn;n.Group.prototype.alignTo=n.Component.Bounds.prototype.alignTo;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.BringToTop=function(){};n.Component.BringToTop.prototype.bringToTop=function(){return this.parent&&this.parent.bringChildToTop&&this.parent.bringChildToTop(this),this};n.Component.BringToTop.prototype.sendToBack=function(){return this.parent&&this.parent.sendChildToBack&&this.parent.sendChildToBack(this),this};n.Component.BringToTop.prototype.moveUp=function(){return this.parent&&this.parent.moveUp(this),this};n.Component.BringToTop.prototype.moveDown=function(){return this.parent&&this.parent.moveDown(this),this};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.Core=function(){};n.Component.Core.skipTypeChecks=!1;n.Component.Core.install=function(t){var i,r,u;for(n.Utils.mixinPrototype(this,n.Component.Core.prototype),this.components={},i=0;i<t.length;i++)r=t[i],u=!1,r==="Destroy"&&(u=!0),n.Utils.mixinPrototype(this,n.Component[r].prototype,u),this.components[r]=!0};n.Component.Core.init=function(t,i,r,u,f){if(!n.Component.Core.skipTypeChecks){if(!(t instanceof n.Game))throw new Error("The value passed as the `game` argument ("+t+") is not an instance of Phaser.Game.");typeof i!="number"&&(console.warn("The `x` argument value (%s) should be a number.",i),i=0);typeof r!="number"&&(console.warn("The `y` argument value (%s) should be a number.",r),r=0)}this.game=t;this.key=u;this.data={};this.position.set(i,r);this.world=new n.Point(i,r);this.previousPosition=new n.Point(i,r);this.events=new n.Events(this);this._bounds=new n.Rectangle;this.components.PhysicsBody&&(this.body=this.body);this.components.Animation&&(this.animations=new n.AnimationManager(this));this.components.LoadTexture&&u!==null&&this.loadTexture(u,f);this.components.FixedToCamera&&(this.cameraOffset=new n.Point(i,r))};n.Component.Core.preUpdate=function(){return this.pendingDestroy?(this.destroy(),!1):(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,!this.exists||!this.parent.exists)?(this.renderOrderID=-1,!1):(this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this.renderOrderID=this.game.stage.currentRenderOrderID++),this.animations&&this.animations.update(),this.body&&this.body.preUpdate(),this.preUpdateChildren(),!0)};n.Component.Core.prototype={game:null,name:"",data:{},components:{},z:0,events:undefined,animations:undefined,key:"",world:null,debug:!1,previousPosition:null,previousRotation:0,renderOrderID:0,fresh:!0,pendingDestroy:!1,_bounds:null,_exists:!0,exists:{get:function(){return this._exists},set:function(t){t?(this._exists=!0,this.body&&this.body.type===n.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._exists=!1,this.body&&this.body.type===n.Physics.P2JS&&this.body.removeFromWorld(),this.visible=!1)}},preUpdateChildren:function(){for(var n=0,t;n<this.children.length;)t=this.children[n],t.preUpdate(),this===t.parent&&n++},update:function(){},postUpdate:function(){this.customRender&&this.key.render();this.components.PhysicsBody&&n.Component.PhysicsBody.postUpdate.call(this);this.components.FixedToCamera&&n.Component.FixedToCamera.postUpdate.call(this);for(var t=0;t<this.children.length;t++)this.children[t].postUpdate()}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.Crop=function(){};n.Component.Crop.prototype={cropRect:null,_crop:null,crop:function(t,i){i===undefined&&(i=!1);t?(i&&this.cropRect!==null?this.cropRect.setTo(t.x,t.y,t.width,t.height):this.cropRect=i&&this.cropRect===null?new n.Rectangle(t.x,t.y,t.width,t.height):t,this.updateCrop()):(this._crop=null,this.cropRect=null,this.resetFrame())},updateCrop:function(){if(this.cropRect){var f=this.texture.crop.x,e=this.texture.crop.y,o=this.texture.crop.width,s=this.texture.crop.height;this._crop=n.Rectangle.clone(this.cropRect,this._crop);this._crop.x+=this._frame.x;this._crop.y+=this._frame.y;var t=Math.max(this._frame.x,this._crop.x),i=Math.max(this._frame.y,this._crop.y),r=Math.min(this._frame.right,this._crop.right)-t,u=Math.min(this._frame.bottom,this._crop.bottom)-i;this.texture.crop.x=t;this.texture.crop.y=i;this.texture.crop.width=r;this.texture.crop.height=u;this.texture.frame.width=Math.min(r,this.cropRect.width);this.texture.frame.height=Math.min(u,this.cropRect.height);this.texture.width=this.texture.frame.width;this.texture.height=this.texture.frame.height;this.texture._updateUvs();this.tint!==16777215&&(f!==t||e!==i||o!==r||s!==u)&&(this.texture.requiresReTint=!0)}}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.Delta=function(){};n.Component.Delta.prototype={deltaX:{get:function(){return this.world.x-this.previousPosition.x}},deltaY:{get:function(){return this.world.y-this.previousPosition.y}},deltaZ:{get:function(){return this.rotation-this.previousRotation}}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.Destroy=function(){};n.Component.Destroy.prototype={destroyPhase:!1,destroy:function(t,i){if(this.game!==null&&!this.destroyPhase){if(t===undefined&&(t=!0),i===undefined&&(i=!1),this.destroyPhase=!0,this.events)this.events.onDestroy$dispatch(this);this.parent&&(this.parent instanceof n.Group?this.parent.remove(this):this.parent.removeChild(this));this.input&&this.input.destroy();this.animations&&this.animations.destroy();this.body&&this.body.destroy();this.events&&this.events.destroy();this.game.tweens.removeFrom(this);var r=this.children.length;if(t)while(r--)this.children[r].destroy(t);else while(r--)this.removeChild(this.children[r]);this._crop&&(this._crop=null,this.cropRect=null);this._frame&&(this._frame=null);n.Video&&this.key instanceof n.Video&&this.key.onChangeSource.remove(this.resizeFrame,this);n.BitmapText&&this._glyphs&&(this._glyphs=[]);this.alive=!1;this.exists=!1;this.visible=!1;this.filters=null;this.mask=null;this.game=null;this.data={};this.renderable=!1;this.transformCallback&&(this.transformCallback=null,this.transformCallbackContext=null);this.hitArea=null;this.parent=null;this.stage=null;this.worldTransform=null;this.filterArea=null;this._bounds=null;this._currentBounds=null;this._mask=null;this._destroyCachedSprite();this._destroyTintedTexture();i&&this.texture.destroy(!0);this.destroyPhase=!1;this.pendingDestroy=!1}}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Events=function(n){this.parent=n};n.Events.prototype={destroy:function(){this._parent=null;this._onDestroy&&this._onDestroy.dispose();this._onAddedToGroup&&this._onAddedToGroup.dispose();this._onRemovedFromGroup&&this._onRemovedFromGroup.dispose();this._onKilled&&this._onKilled.dispose();this._onRevived&&this._onRevived.dispose();this._onEnterBounds&&this._onEnterBounds.dispose();this._onOutOfBounds&&this._onOutOfBounds.dispose();this._onInputOver&&this._onInputOver.dispose();this._onInputOut&&this._onInputOut.dispose();this._onInputDown&&this._onInputDown.dispose();this._onInputUp&&this._onInputUp.dispose();this._onDragStart&&this._onDragStart.dispose();this._onDragUpdate&&this._onDragUpdate.dispose();this._onDragStop&&this._onDragStop.dispose();this._onAnimationStart&&this._onAnimationStart.dispose();this._onAnimationComplete&&this._onAnimationComplete.dispose();this._onAnimationLoop&&this._onAnimationLoop.dispose()},onAddedToGroup:null,onRemovedFromGroup:null,onDestroy:null,onKilled:null,onRevived:null,onOutOfBounds:null,onEnterBounds:null,onInputOver:null,onInputOut:null,onInputDown:null,onInputUp:null,onDragStart:null,onDragUpdate:null,onDragStop:null,onAnimationStart:null,onAnimationComplete:null,onAnimationLoop:null};n.Events.prototype.constructor=n.Events;for(r in n.Events.prototype)n.Events.prototype.hasOwnProperty(r)&&r.indexOf("on")===0&&n.Events.prototype[r]===null&&function(t,i){"use strict";Object.defineProperty(n.Events.prototype,t,{get:function(){return this[i]||(this[i]=new n.Signal)}});n.Events.prototype[t+"$dispatch"]=function(){return this[i]?this[i].dispatch.apply(this[i],arguments):null}}(r,"_"+r);
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.FixedToCamera=function(){};n.Component.FixedToCamera.postUpdate=function(){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)};n.Component.FixedToCamera.prototype={_fixedToCamera:!1,fixedToCamera:{get:function(){return this._fixedToCamera},set:function(n){n?(this._fixedToCamera=!0,this.cameraOffset.set(this.x,this.y)):this._fixedToCamera=!1}},cameraOffset:new n.Point};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.Health=function(){};n.Component.Health.prototype={health:1,maxHealth:100,damage:function(n){return this.alive&&(this.health-=n,this.health<=0&&this.kill()),this},setHealth:function(n){return this.health=n,this.health>this.maxHealth&&(this.health=this.maxHealth),this},heal:function(n){return this.alive&&(this.health+=n,this.health>this.maxHealth&&(this.health=this.maxHealth)),this}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.InCamera=function(){};n.Component.InCamera.prototype={inCamera:{get:function(){return this.game.world.camera.view.intersects(this._bounds)}}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.InputEnabled=function(){};n.Component.InputEnabled.prototype={input:null,inputEnabled:{get:function(){return this.input&&this.input.enabled},set:function(t){t?this.input===null?(this.input=new n.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.InWorld=function(){};n.Component.InWorld.preUpdate=function(){if(this.pendingDestroy)return this.destroy(),!1;if(this.autoCull||this.checkWorldBounds){if(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y,this.autoCull)if(this.game.world.camera.view.intersects(this._bounds))this.renderable=!0,this.game.world.camera.totalInView++;else if(this.renderable=!1,this.outOfCameraBoundsKill)return this.kill(),!1;if(this.checkWorldBounds)if(this._outOfBoundsFired&&this.game.world.bounds.intersects(this._bounds)){this._outOfBoundsFired=!1;this.events.onEnterBounds$dispatch(this)}else if(!this._outOfBoundsFired&&!this.game.world.bounds.intersects(this._bounds)){this._outOfBoundsFired=!0;this.events.onOutOfBounds$dispatch(this);if(this.outOfBoundsKill)return this.kill(),!1}}return!0};n.Component.InWorld.prototype={checkWorldBounds:!1,outOfBoundsKill:!1,outOfCameraBoundsKill:!1,_outOfBoundsFired:!1,inWorld:{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.LifeSpan=function(){};n.Component.LifeSpan.preUpdate=function(){return this.pendingDestroy?(this.destroy(),!1):this.lifespan>0&&(this.lifespan-=this.game.time.physicsElapsedMS,this.lifespan<=0)?(this.kill(),!1):!0};n.Component.LifeSpan.prototype={alive:!0,lifespan:0,revive:function(n){if(n===undefined&&(n=100),this.alive=!0,this.exists=!0,this.visible=!0,typeof this.setHealth=="function"&&this.setHealth(n),this.events)this.events.onRevived$dispatch(this);return this},kill:function(){if(this.alive=!1,this.exists=!1,this.visible=!1,this.events)this.events.onKilled$dispatch(this);return this}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.LoadTexture=function(){};n.Component.LoadTexture.prototype={customRender:!1,_frame:null,loadTexture:function(t,i,r){var s,u;t===n.PENDING_ATLAS?(t=i,i=0):i=i||0;(r||r===undefined)&&this.animations&&this.animations.stop();this.key=t;this.customRender=!1;var f=this.game.cache,e=!0,o=this.texture.baseTexture.scaleMode===PIXI.scaleModes.LINEAR;n.RenderTexture&&t instanceof n.RenderTexture?(this.key=t.key,this.setTexture(t)):n.BitmapData&&t instanceof n.BitmapData?(this.customRender=!0,this.setTexture(t.texture),e=f.hasFrameData(t.key,n.Cache.BITMAPDATA)?!this.animations.loadFrameData(f.getFrameData(t.key,n.Cache.BITMAPDATA),i):!this.animations.loadFrameData(t.frameData,0)):n.Video&&t instanceof n.Video?(this.customRender=!0,s=t.texture.valid,this.setTexture(t.texture),this.setFrame(t.texture.frame.clone()),t.onChangeSource.add(this.resizeFrame,this),this.texture.valid=s):n.Tilemap&&t instanceof n.TilemapLayer?this.setTexture(PIXI.Texture.fromCanvas(t.canvas)):t instanceof PIXI.Texture?(o=t.baseTexture.scaleMode===PIXI.scaleModes.LINEAR,this.setTexture(t)):(u=f.getImage(t,!0),this.key=u.key,this.setTexture(new PIXI.Texture(u.base)),this.texture.baseTexture.skipRender=t==="__default"?!0:!1,e=!this.animations.loadFrameData(u.frameData,i));e&&(this._frame=n.Rectangle.clone(this.texture.frame));o||(this.texture.baseTexture.scaleMode=1)},setFrame:function(n){this._frame=n;this.texture.frame.x=n.x;this.texture.frame.y=n.y;this.texture.frame.width=n.width;this.texture.frame.height=n.height;this.texture.crop.x=n.x;this.texture.crop.y=n.y;this.texture.crop.width=n.width;this.texture.crop.height=n.height;n.trimmed?(this.texture.trim?(this.texture.trim.x=n.spriteSourceSizeX,this.texture.trim.y=n.spriteSourceSizeY,this.texture.trim.width=n.sourceSizeW,this.texture.trim.height=n.sourceSizeH):this.texture.trim={x:n.spriteSourceSizeX,y:n.spriteSourceSizeY,width:n.sourceSizeW,height:n.sourceSizeH},this.texture.width=n.sourceSizeW,this.texture.height=n.sourceSizeH,this.texture.frame.width=n.sourceSizeW,this.texture.frame.height=n.sourceSizeH):!n.trimmed&&this.texture.trim&&(this.texture.trim=null);n.rotated&&(this.texture.rotated=!0);this.cropRect&&this.updateCrop();this.texture.requiresReTint=!0;this.texture._updateUvs();this.tilingTexture&&(this.refreshTexture=!0)},resizeFrame:function(n,t,i){this.texture.frame.resize(t,i);this.texture.setFrame(this.texture.frame)},resetFrame:function(){this._frame&&this.setFrame(this._frame)},frame:{get:function(){return this.animations.frame},set:function(n){this.animations.frame=n}},frameName:{get:function(){return this.animations.frameName},set:function(n){this.animations.frameName=n}}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.Overlap=function(){};n.Component.Overlap.prototype={overlap:function(t){return n.Rectangle.intersects(this.getBounds(),t.getBounds())}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.PhysicsBody=function(){};n.Component.PhysicsBody.preUpdate=function(){return this.pendingDestroy?(this.destroy(),!1):this.fresh&&this.exists?(this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.body&&this.body.preUpdate(),this.fresh=!1,this.preUpdateChildren(),!1):(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,!this._exists||!this.parent.exists)?(this.renderOrderID=-1,!1):!0};n.Component.PhysicsBody.postUpdate=function(){this.exists&&this.body&&this.body.postUpdate()};n.Component.PhysicsBody.prototype={body:null,x:{get:function(){return this.position.x},set:function(n){this.position.x=n;this.body&&!this.body.dirty&&(this.body._reset=!0)}},y:{get:function(){return this.position.y},set:function(n){this.position.y=n;this.body&&!this.body.dirty&&(this.body._reset=!0)}}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.Reset=function(){};n.Component.Reset.prototype.reset=function(n,t,i){return i===undefined&&(i=1),this.world.set(n,t),this.position.set(n,t),this.fresh=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this.components.InWorld&&(this._outOfBoundsFired=!1),this.components.LifeSpan&&(this.alive=!0,this.health=i),this.components.PhysicsBody&&this.body&&this.body.reset(n,t,!1,!1),this};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.ScaleMinMax=function(){};n.Component.ScaleMinMax.prototype={transformCallback:null,transformCallbackContext:this,scaleMin:null,scaleMax:null,checkTransform:function(n){this.scaleMin&&(n.a<this.scaleMin.x&&(n.a=this.scaleMin.x),n.d<this.scaleMin.y&&(n.d=this.scaleMin.y));this.scaleMax&&(n.a>this.scaleMax.x&&(n.a=this.scaleMax.x),n.d>this.scaleMax.y&&(n.d=this.scaleMax.y))},setScaleMinMax:function(t,i,r,u){i===undefined?i=r=u=t:r===undefined&&(r=u=i,i=t);t===null?this.scaleMin=null:this.scaleMin?this.scaleMin.set(t,i):this.scaleMin=new n.Point(t,i);r===null?this.scaleMax=null:this.scaleMax?this.scaleMax.set(r,u):this.scaleMax=new n.Point(r,u);this.scaleMin===null?this.transformCallback=null:(this.transformCallback=this.checkTransform,this.transformCallbackContext=this)}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Component.Smoothed=function(){};n.Component.Smoothed.prototype={smoothed:{get:function(){return!this.texture.baseTexture.scaleMode},set:function(n){n?this.texture&&this.texture.baseTexture.scaleMode!==0&&(this.texture.baseTexture.scaleMode=0,this.texture.baseTexture.dirty()):this.texture&&this.texture.baseTexture.scaleMode!==1&&(this.texture.baseTexture.scaleMode=1,this.texture.baseTexture.dirty())}}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.GameObjectFactory=function(n){this.game=n;this.world=this.game.world};n.GameObjectFactory.prototype={existing:function(n){return this.world.add(n)},weapon:function(t,i,r,u,f){var e=this.game.plugins.add(n.Weapon);return f&&(e.bulletClass=f),e.createBullets(t,i,r,u),e},image:function(t,i,r,u,f){return f===undefined&&(f=this.world),f.add(new n.Image(this.game,t,i,r,u))},sprite:function(t,i,r,u,f){return f===undefined&&(f=this.world),f.add(new n.Sprite(this.game,t,i,r,u))},creature:function(t,i,r,u,f,e,o){f===undefined&&(f=this.world);var s=new n.Creature(this.game,t,i,r,u,e,o);return f.add(s),s},tween:function(n){return this.game.tweens.create(n)},group:function(t,i,r,u,f){return new n.Group(this.game,t,i,r,u,f)},physicsGroup:function(t,i,r,u){return new n.Group(this.game,i,r,u,!0,t)},spriteBatch:function(t,i,r){return t===undefined&&(t=null),i===undefined&&(i="group"),r===undefined&&(r=!1),new n.SpriteBatch(this.game,t,i,r)},audio:function(n,t,i,r){return this.game.sound.add(n,t,i,r)},sound:function(n,t,i,r){return this.game.sound.add(n,t,i,r)},audioSprite:function(n){return this.game.sound.addSprite(n)},tileSprite:function(t,i,r,u,f,e,o){return o===undefined&&(o=this.world),o.add(new n.TileSprite(this.game,t,i,r,u,f,e))},rope:function(t,i,r,u,f,e){return e===undefined&&(e=this.world),e.add(new n.Rope(this.game,t,i,r,u,f))},text:function(t,i,r,u,f){return f===undefined&&(f=this.world),f.add(new n.Text(this.game,t,i,r,u))},button:function(t,i,r,u,f,e,o,s,h,c){return c===undefined&&(c=this.world),c.add(new n.Button(this.game,t,i,r,u,f,e,o,s,h))},graphics:function(t,i,r){return r===undefined&&(r=this.world),r.add(new n.Graphics(this.game,t,i))},emitter:function(t,i,r){return this.game.particles.add(new n.Particles.Arcade.Emitter(this.game,t,i,r))},retroFont:function(t,i,r,u,f,e,o,s,h){return new n.RetroFont(this.game,t,i,r,u,f,e,o,s,h)},bitmapText:function(t,i,r,u,f,e){return e===undefined&&(e=this.world),e.add(new n.BitmapText(this.game,t,i,r,u,f))},tilemap:function(t,i,r,u,f){return new n.Tilemap(this.game,t,i,r,u,f)},renderTexture:function(t,i,r,u){(r===undefined||r==="")&&(r=this.game.rnd.uuid());u===undefined&&(u=!1);var f=new n.RenderTexture(this.game,t,i,r);return u&&this.game.cache.addRenderTexture(r,f),f},video:function(t,i){return new n.Video(this.game,t,i)},bitmapData:function(t,i,r,u){u===undefined&&(u=!1);(r===undefined||r==="")&&(r=this.game.rnd.uuid());var f=new n.BitmapData(this.game,r,t,i);return u&&this.game.cache.addBitmapData(r,f),f},filter:function(t){var i=Array.prototype.slice.call(arguments,1),t=new n.Filter[t](this.game);return t.init.apply(t,i),t},plugin:function(){return this.game.plugins.add.apply(this.game.plugins,arguments)}};n.GameObjectFactory.prototype.constructor=n.GameObjectFactory;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.GameObjectCreator=function(n){this.game=n;this.world=this.game.world};n.GameObjectCreator.prototype={image:function(t,i,r,u){return new n.Image(this.game,t,i,r,u)},sprite:function(t,i,r,u){return new n.Sprite(this.game,t,i,r,u)},tween:function(t){return new n.Tween(t,this.game,this.game.tweens)},group:function(t,i,r,u,f){return new n.Group(this.game,t||null,i,r,u,f)},spriteBatch:function(t,i,r){return i===undefined&&(i="group"),r===undefined&&(r=!1),new n.SpriteBatch(this.game,t,i,r)},audio:function(n,t,i,r){return this.game.sound.add(n,t,i,r)},audioSprite:function(n){return this.game.sound.addSprite(n)},sound:function(n,t,i,r){return this.game.sound.add(n,t,i,r)},tileSprite:function(t,i,r,u,f,e){return new n.TileSprite(this.game,t,i,r,u,f,e)},rope:function(t,i,r,u,f){return new n.Rope(this.game,t,i,r,u,f)},text:function(t,i,r,u){return new n.Text(this.game,t,i,r,u)},button:function(t,i,r,u,f,e,o,s,h){return new n.Button(this.game,t,i,r,u,f,e,o,s,h)},graphics:function(t,i){return new n.Graphics(this.game,t,i)},emitter:function(t,i,r){return new n.Particles.Arcade.Emitter(this.game,t,i,r)},retroFont:function(t,i,r,u,f,e,o,s,h){return new n.RetroFont(this.game,t,i,r,u,f,e,o,s,h)},bitmapText:function(t,i,r,u,f,e){return new n.BitmapText(this.game,t,i,r,u,f,e)},tilemap:function(t,i,r,u,f){return new n.Tilemap(this.game,t,i,r,u,f)},renderTexture:function(t,i,r,u){(r===undefined||r==="")&&(r=this.game.rnd.uuid());u===undefined&&(u=!1);var f=new n.RenderTexture(this.game,t,i,r);return u&&this.game.cache.addRenderTexture(r,f),f},bitmapData:function(t,i,r,u){u===undefined&&(u=!1);(r===undefined||r==="")&&(r=this.game.rnd.uuid());var f=new n.BitmapData(this.game,r,t,i);return u&&this.game.cache.addBitmapData(r,f),f},filter:function(t){var i=Array.prototype.slice.call(arguments,1),t=new n.Filter[t](this.game);return t.init.apply(t,i),t}};n.GameObjectCreator.prototype.constructor=n.GameObjectCreator;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Sprite=function(t,i,r,u,f){i=i||0;r=r||0;u=u||null;f=f||null;this.type=n.SPRITE;this.physicsType=n.SPRITE;PIXI.Sprite.call(this,n.Cache.DEFAULT);n.Component.Core.init.call(this,t,i,r,u,f)};n.Sprite.prototype=Object.create(PIXI.Sprite.prototype);n.Sprite.prototype.constructor=n.Sprite;n.Component.Core.install.call(n.Sprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]);n.Sprite.prototype.preUpdatePhysics=n.Component.PhysicsBody.preUpdate;n.Sprite.prototype.preUpdateLifeSpan=n.Component.LifeSpan.preUpdate;n.Sprite.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate;n.Sprite.prototype.preUpdateCore=n.Component.Core.preUpdate;n.Sprite.prototype.preUpdate=function(){return!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()?!1:this.preUpdateCore()};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Image=function(t,i,r,u,f){i=i||0;r=r||0;u=u||null;f=f||null;this.type=n.IMAGE;PIXI.Sprite.call(this,n.Cache.DEFAULT);n.Component.Core.init.call(this,t,i,r,u,f)};n.Image.prototype=Object.create(PIXI.Sprite.prototype);n.Image.prototype.constructor=n.Image;n.Component.Core.install.call(n.Image.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Destroy","FixedToCamera","InputEnabled","LifeSpan","LoadTexture","Overlap","Reset","ScaleMinMax","Smoothed"]);n.Image.prototype.preUpdateLifeSpan=n.Component.LifeSpan.preUpdate;n.Image.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate;n.Image.prototype.preUpdateCore=n.Component.Core.preUpdate;n.Image.prototype.preUpdate=function(){return!this.preUpdateInWorld()||!this.preUpdateLifeSpan()?!1:this.preUpdateCore()};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Button=function(t,i,r,u,f,e,o,s,h,c){i=i||0;r=r||0;u=u||null;f=f||null;e=e||this;n.Image.call(this,t,i,r,u,s);this.type=n.BUTTON;this.physicsType=n.SPRITE;this._onOverFrame=null;this._onOutFrame=null;this._onDownFrame=null;this._onUpFrame=null;this.onOverSound=null;this.onOutSound=null;this.onDownSound=null;this.onUpSound=null;this.onOverSoundMarker="";this.onOutSoundMarker="";this.onDownSoundMarker="";this.onUpSoundMarker="";this.onInputOver=new n.Signal;this.onInputOut=new n.Signal;this.onInputDown=new n.Signal;this.onInputUp=new n.Signal;this.onOverMouseOnly=!0;this.justReleasedPreventsOver=n.PointerMode.CONTACT;this.freezeFrames=!1;this.forceOut=!1;this.inputEnabled=!0;this.input.start(0,!0);this.input.useHandCursor=!0;this.setFrames(o,s,h,c);f!==null&&this.onInputUp.add(f,e);this.events.onInputOver.add(this.onInputOverHandler,this);this.events.onInputOut.add(this.onInputOutHandler,this);this.events.onInputDown.add(this.onInputDownHandler,this);this.events.onInputUp.add(this.onInputUpHandler,this)};n.Button.prototype=Object.create(n.Image.prototype);n.Button.prototype.constructor=n.Button;var u="Over",t="Out",e="Down",o="Up";n.Button.prototype.clearFrames=function(){this.setFrames(null,null,null,null)};n.Button.prototype.setStateFrame=function(n,t,i){var r="_on"+n+"Frame";t!==null?(this[r]=t,i&&this.changeStateFrame(n)):this[r]=null};n.Button.prototype.changeStateFrame=function(n){if(this.freezeFrames)return!1;var i="_on"+n+"Frame",t=this[i];return typeof t=="string"?(this.frameName=t,!0):typeof t=="number"?(this.frame=t,!0):!1};n.Button.prototype.setFrames=function(n,i,r,f){this.setStateFrame(u,n,this.input.pointerOver());this.setStateFrame(t,i,!this.input.pointerOver());this.setStateFrame(e,r,this.input.pointerDown());this.setStateFrame(o,f,this.input.pointerUp())};n.Button.prototype.setStateSound=function(t,i,r){var u="on"+t+"Sound",f="on"+t+"SoundMarker";i instanceof n.Sound||i instanceof n.AudioSprite?(this[u]=i,this[f]=typeof r=="string"?r:""):(this[u]=null,this[f]="")};n.Button.prototype.playStateSound=function(n){var u="on"+n+"Sound",t=this[u],i,r;return t?(i="on"+n+"SoundMarker",r=this[i],t.play(r),!0):!1};n.Button.prototype.setSounds=function(n,i,r,f,s,h,c,l){this.setStateSound(u,n,i);this.setStateSound(t,s,h);this.setStateSound(e,r,f);this.setStateSound(o,c,l)};n.Button.prototype.setOverSound=function(n,t){this.setStateSound(u,n,t)};n.Button.prototype.setOutSound=function(n,i){this.setStateSound(t,n,i)};n.Button.prototype.setDownSound=function(n,t){this.setStateSound(e,n,t)};n.Button.prototype.setUpSound=function(n,t){this.setStateSound(o,n,t)};n.Button.prototype.onInputOverHandler=function(n,t){t.justReleased()&&(this.justReleasedPreventsOver&t.pointerMode)===t.pointerMode||(this.changeStateFrame(u),!this.onOverMouseOnly||t.isMouse)&&(this.playStateSound(u),this.onInputOver&&this.onInputOver.dispatch(this,t))};n.Button.prototype.onInputOutHandler=function(n,i){this.changeStateFrame(t);this.playStateSound(t);this.onInputOut&&this.onInputOut.dispatch(this,i)};n.Button.prototype.onInputDownHandler=function(n,t){this.changeStateFrame(e);this.playStateSound(e);this.onInputDown&&this.onInputDown.dispatch(this,t)};n.Button.prototype.onInputUpHandler=function(n,i,r){if(this.playStateSound(o),this.onInputUp&&this.onInputUp.dispatch(this,i,r),!this.freezeFrames)if(this.forceOut===!0||(this.forceOut&i.pointerMode)===i.pointerMode)this.changeStateFrame(t);else{var f=this.changeStateFrame(o);f||(r?this.changeStateFrame(u):this.changeStateFrame(t))}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.SpriteBatch=function(t,i,r,u){(i===undefined||i===null)&&(i=t.world);n.Group.call(this,t,i,r,u);this.type=n.SPRITEBATCH;this.fastSpriteBatch=null;this.ready=!1};n.SpriteBatch.prototype=Object.create(n.Group.prototype);n.SpriteBatch.prototype.constructor=n.SpriteBatch;n.SpriteBatch.prototype._renderWebGL=function(n){!this.visible||this.alpha<=0||!this.children.length||(this.ready||(this.fastSpriteBatch=new PIXI.WebGLFastSpriteBatch(n.gl),this.ready=!0),this.fastSpriteBatch.gl!==n.gl&&this.fastSpriteBatch.setContext(n.gl),n.spriteBatch.stop(),n.shaderManager.setShader(n.shaderManager.fastShader),this.fastSpriteBatch.begin(this,n),this.fastSpriteBatch.render(this),n.spriteBatch.start())};n.SpriteBatch.prototype._renderCanvas=function(n){var u,f,e,o,t,s,i;if(this.visible&&!(this.alpha<=0)&&this.children.length)for(u=n.context,u.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform(),f=this.worldTransform,e=!0,o=0;o<this.children.length;o++)if(t=this.children[o],t.visible)if(s=t.texture,i=s.frame,u.globalAlpha=this.worldAlpha*t.alpha,t.rotation%(Math.PI*2)==0)e&&(u.setTransform(f.a,f.b,f.c,f.d,f.tx,f.ty),e=!1),u.drawImage(s.baseTexture.source,i.x,i.y,i.width,i.height,t.anchor.x*-i.width*t.scale.x+t.position.x+.5+n.shakeX|0,t.anchor.y*-i.height*t.scale.y+t.position.y+.5+n.shakeY|0,i.width*t.scale.x,i.height*t.scale.y);else{e||(e=!0);t.displayObjectUpdateTransform();var r=t.worldTransform,h=r.tx*n.resolution+n.shakeX,c=r.ty*n.resolution+n.shakeY;n.roundPixels?u.setTransform(r.a,r.b,r.c,r.d,h|0,c|0):u.setTransform(r.a,r.b,r.c,r.d,h,c);u.drawImage(s.baseTexture.source,i.x,i.y,i.width,i.height,t.anchor.x*-i.width+.5|0,t.anchor.y*-i.height+.5|0,i.width,i.height)}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.BitmapData=function(t,i,r,u,f){(r===undefined||r===0)&&(r=256);(u===undefined||u===0)&&(u=256);f===undefined&&(f=!1);this.game=t;this.key=i;this.width=r;this.height=u;this.canvas=n.Canvas.create(this,r,u,null,f);this.context=this.canvas.getContext("2d",{alpha:!0});this.ctx=this.context;this.smoothProperty=t.renderType===n.CANVAS?t.renderer.renderSession.smoothProperty:n.Canvas.getSmoothingPrefix(this.context);this.imageData=this.context.getImageData(0,0,r,u);this.data=null;this.imageData&&(this.data=this.imageData.data);this.pixels=null;this.data&&(this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data);this.baseTexture=new PIXI.BaseTexture(this.canvas,null,this.game.resolution);this.texture=new PIXI.Texture(this.baseTexture);this.frameData=new n.FrameData;this.textureFrame=this.frameData.addFrame(new n.Frame(0,0,0,r,u,"bitmapData"));this.texture.frame=this.textureFrame;this.type=n.BITMAPDATA;this.disableTextureUpload=!1;this.dirty=!1;this.cls=this.clear;this._image=null;this._pos=new n.Point;this._size=new n.Point;this._scale=new n.Point;this._rotate=0;this._alpha={prev:1,current:1};this._anchor=new n.Point;this._tempR=0;this._tempG=0;this._tempB=0;this._circle=new n.Circle;this._swapCanvas=undefined};n.BitmapData.prototype={move:function(n,t,i){return n!==0&&this.moveH(n,i),t!==0&&this.moveV(t,i),this},moveH:function(t,i){var u;i===undefined&&(i=!0);this._swapCanvas===undefined&&(this._swapCanvas=n.CanvasPool.create(this,this.width,this.height));var o=this._swapCanvas,f=o.getContext("2d"),r=this.height,e=this.canvas;return f.clearRect(0,0,this.width,this.height),t<0?(t=Math.abs(t),u=this.width-t,i&&f.drawImage(e,0,0,t,r,u,0,t,r),f.drawImage(e,t,0,u,r,0,0,u,r)):(u=this.width-t,i&&f.drawImage(e,u,0,t,r,0,0,t,r),f.drawImage(e,0,0,u,r,t,0,u,r)),this.clear(),this.copy(this._swapCanvas)},moveV:function(t,i){var u;i===undefined&&(i=!0);this._swapCanvas===undefined&&(this._swapCanvas=n.CanvasPool.create(this,this.width,this.height));var o=this._swapCanvas,f=o.getContext("2d"),r=this.width,e=this.canvas;return f.clearRect(0,0,this.width,this.height),t<0?(t=Math.abs(t),u=this.height-t,i&&f.drawImage(e,0,0,r,t,0,u,r,t),f.drawImage(e,0,t,r,u,0,0,r,u)):(u=this.height-t,i&&f.drawImage(e,0,u,r,t,0,0,r,t),f.drawImage(e,0,0,r,u,0,t,r,u)),this.clear(),this.copy(this._swapCanvas)},add:function(n){if(Array.isArray(n))for(var t=0;t<n.length;t++)n[t].loadTexture&&n[t].loadTexture(this);else n.loadTexture(this);return this},load:function(n){if(typeof n=="string"&&(n=this.game.cache.getImage(n)),n)this.resize(n.width,n.height),this.cls();else return;return this.draw(n),this.update(),this},clear:function(n,t,i,r){return n===undefined&&(n=0),t===undefined&&(t=0),i===undefined&&(i=this.width),r===undefined&&(r=this.height),this.context.clearRect(n,t,i,r),this.dirty=!0,this},fill:function(n,t,i,r){return r===undefined&&(r=1),this.context.fillStyle="rgba("+n+","+t+","+i+","+r+")",this.context.fillRect(0,0,this.width,this.height),this.dirty=!0,this},generateTexture:function(n,t,i){var u=this.game.cache,r=new Image,f;return(t&&(r.onload=function(){var f=u.addImage(n,"",r),e=new PIXI.Texture(f.base);t.call(i||null,e);r.onload=null}),r.src=this.canvas.toDataURL("image/png"),!t)?(f=u.addImage(n,"",r),new PIXI.Texture(f.base)):null},resize:function(n,t){return(n!==this.width||t!==this.height)&&(this.width=n,this.height=t,this.canvas.width=n,this.canvas.height=t,this._swapCanvas!==undefined&&(this._swapCanvas.width=n,this._swapCanvas.height=t),this.baseTexture.width=n,this.baseTexture.height=t,this.textureFrame.width=n,this.textureFrame.height=t,this.texture.width=n,this.texture.height=t,this.texture.crop.width=n,this.texture.crop.height=t,this.update(),this.dirty=!0),this},update:function(n,t,i,r){return n===undefined&&(n=0),t===undefined&&(t=0),i===undefined&&(i=Math.max(1,this.width)),r===undefined&&(r=Math.max(1,this.height)),this.imageData=this.context.getImageData(n,t,i,r),this.data=this.imageData.data,this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data,this},processPixelRGB:function(t,i,r,u,f,e){var s,h;r===undefined&&(r=0);u===undefined&&(u=0);f===undefined&&(f=this.width);e===undefined&&(e=this.height);var a=r+f,v=u+e,c=n.Color.createColor(),o={r:0,g:0,b:0,a:0},l=!1;for(s=u;s<v;s++)for(h=r;h<a;h++)n.Color.unpackPixel(this.getPixel32(h,s),c),o=t.call(i,c,h,s),o!==!1&&o!==null&&o!==undefined&&(this.setPixel32(h,s,o.r,o.g,o.b,o.a,!1),l=!0);return l&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},processPixel:function(n,t,i,r,u,f){var e,o;i===undefined&&(i=0);r===undefined&&(r=0);u===undefined&&(u=this.width);f===undefined&&(f=this.height);var l=i+u,a=r+f,s=0,h=0,c=!1;for(e=r;e<a;e++)for(o=i;o<l;o++)s=this.getPixel32(o,e),h=n.call(t,s,o,e),h!==s&&(this.pixels[e*this.width+o]=h,c=!0);return c&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},replaceRGB:function(t,i,r,u,f,e,o,s,h){var a=0,v=0,y=this.width,p=this.height,w=n.Color.packPixel(t,i,r,u),c,l;for(h!==undefined&&h instanceof n.Rectangle&&(a=h.x,v=h.y,y=h.width,p=h.height),c=0;c<p;c++)for(l=0;l<y;l++)this.getPixel32(a+l,v+c)===w&&this.setPixel32(a+l,v+c,f,e,o,s,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this},setHSL:function(t,i,r,u){var s=t||t===0,h=i||i===0,c=r||r===0,f,e,o;if(s||h||c){for(u===undefined&&(u=new n.Rectangle(0,0,this.width,this.height)),f=n.Color.createColor(),e=u.y;e<u.bottom;e++)for(o=u.x;o<u.right;o++)n.Color.unpackPixel(this.getPixel32(o,e),f,!0),s&&(f.h=t),h&&(f.s=i),c&&(f.l=r),n.Color.HSLtoRGB(f.h,f.s,f.l,f),this.setPixel32(o,e,f.r,f.g,f.b,f.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},shiftHSL:function(t,i,r,u){var f,e,o;if((t===undefined||t===null)&&(t=!1),(i===undefined||i===null)&&(i=!1),(r===undefined||r===null)&&(r=!1),t||i||r){for(u===undefined&&(u=new n.Rectangle(0,0,this.width,this.height)),f=n.Color.createColor(),e=u.y;e<u.bottom;e++)for(o=u.x;o<u.right;o++)n.Color.unpackPixel(this.getPixel32(o,e),f,!0),t&&(f.h=this.game.math.wrap(f.h+t,0,1)),i&&(f.s=this.game.math.clamp(f.s+i,0,1)),r&&(f.l=this.game.math.clamp(f.l+r,0,1)),n.Color.HSLtoRGB(f.h,f.s,f.l,f),this.setPixel32(o,e,f.r,f.g,f.b,f.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},setPixel32:function(t,i,r,u,f,e,o){return o===undefined&&(o=!0),t>=0&&t<=this.width&&i>=0&&i<=this.height&&(this.pixels[i*this.width+t]=n.Device.LITTLE_ENDIAN?e<<24|f<<16|u<<8|r:r<<24|u<<16|f<<8|e,o&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0)),this},setPixel:function(n,t,i,r,u,f){return this.setPixel32(n,t,i,r,u,255,f)},getPixel:function(t,i,r){r||(r=n.Color.createColor());var u=~~(t+i*this.width);return u*=4,r.r=this.data[u],r.g=this.data[++u],r.b=this.data[++u],r.a=this.data[++u],r},getPixel32:function(n,t){if(n>=0&&n<=this.width&&t>=0&&t<=this.height)return this.pixels[t*this.width+n]},getPixelRGB:function(t,i,r,u,f){return n.Color.unpackPixel(this.getPixel32(t,i),r,u,f)},getPixels:function(n){return this.context.getImageData(n.x,n.y,n.width,n.height)},getFirstPixel:function(t){t===undefined&&(t=0);var u=n.Color.createColor(),i=0,r=0,f=1,e=!1;t===1?(f=-1,r=this.height):t===3&&(f=-1,i=this.width);do n.Color.unpackPixel(this.getPixel32(i,r),u),t===0||t===1?(i++,i===this.width&&(i=0,r+=f,(r>=this.height||r<=0)&&(e=!0))):(t===2||t===3)&&(r++,r===this.height&&(r=0,i+=f,(i>=this.width||i<=0)&&(e=!0)));while(u.a===0&&!e);return u.x=i,u.y=r,u},getBounds:function(t){return(t===undefined&&(t=new n.Rectangle),t.x=this.getFirstPixel(2).x,t.x===this.width)?t.setTo(0,0,0,0):(t.y=this.getFirstPixel(0).y,t.width=this.getFirstPixel(3).x-t.x+1,t.height=this.getFirstPixel(1).y-t.y+1,t)},addToWorld:function(n,t,i,r,u,f){u=u||1;f=f||1;var e=this.game.add.image(n,t,this);return e.anchor.set(i,r),e.scale.set(u,f),e},copy:function(t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){if((t===undefined||t===null)&&(t=this),t instanceof n.RenderTexture&&(t=t.getCanvas()),this._image=t,t instanceof n.Sprite||t instanceof n.Image||t instanceof n.Text||t instanceof PIXI.Sprite)this._pos.set(t.texture.crop.x,t.texture.crop.y),this._size.set(t.texture.crop.width,t.texture.crop.height),this._scale.set(t.scale.x,t.scale.y),this._anchor.set(t.anchor.x,t.anchor.y),this._rotate=t.rotation,this._alpha.current=t.alpha,this._image=t.texture instanceof n.RenderTexture?t.texture.getCanvas():t.texture.baseTexture.source,(e===undefined||e===null)&&(e=t.x),(o===undefined||o===null)&&(o=t.y),t.texture.trim&&(e+=t.texture.trim.x-t.anchor.x*t.texture.trim.width,o+=t.texture.trim.y-t.anchor.y*t.texture.trim.height),t.tint!==16777215&&(t.cachedTint!==t.tint&&(t.cachedTint=t.tint,t.tintedTexture=PIXI.CanvasTinter.getTintedTexture(t,t.tint)),this._image=t.tintedTexture,this._pos.set(0));else{if(this._pos.set(0),this._scale.set(1),this._anchor.set(0),this._rotate=0,this._alpha.current=1,t instanceof n.BitmapData)this._image=t.canvas;else if(typeof t=="string"){if(t=this.game.cache.getImage(t),t===null)return this;this._image=t}this._size.set(this._image.width,this._image.height)}if((i===undefined||i===null)&&(i=0),(r===undefined||r===null)&&(r=0),u&&(this._size.x=u),f&&(this._size.y=f),(e===undefined||e===null)&&(e=i),(o===undefined||o===null)&&(o=r),(s===undefined||s===null)&&(s=this._size.x),(h===undefined||h===null)&&(h=this._size.y),typeof c=="number"&&(this._rotate=c),typeof l=="number"&&(this._anchor.x=l),typeof a=="number"&&(this._anchor.y=a),typeof v=="number"&&(this._scale.x=v),typeof y=="number"&&(this._scale.y=y),typeof p=="number"&&(this._alpha.current=p),w===undefined&&(w=null),b===undefined&&(b=!1),this._alpha.current<=0||this._scale.x===0||this._scale.y===0||this._size.x===0||this._size.y===0)return this;var k=this.context;return this._alpha.prev=k.globalAlpha,k.save(),k.globalAlpha=this._alpha.current,w&&(this.op=w),b&&(e|=0,o|=0),k.translate(e,o),k.scale(this._scale.x,this._scale.y),k.rotate(this._rotate),k.drawImage(this._image,this._pos.x+i,this._pos.y+r,this._size.x,this._size.y,-s*this._anchor.x,-h*this._anchor.y,s,h),k.restore(),k.globalAlpha=this._alpha.prev,this.dirty=!0,this},copyTransform:function(t,i,r){var u,e,o,f;return(i===undefined&&(i=null),r===undefined&&(r=!1),!t.hasOwnProperty("worldTransform")||!t.worldVisible||t.worldAlpha===0)?this:(u=t.worldTransform,this._pos.set(t.texture.crop.x,t.texture.crop.y),this._size.set(t.texture.crop.width,t.texture.crop.height),u.a===0||u.d===0||this._size.x===0||this._size.y===0)?this:(this._image=t.texture instanceof n.RenderTexture?t.texture.getCanvas():t.texture.baseTexture.source,e=u.tx,o=u.ty,t.texture.trim&&(e+=t.texture.trim.x-t.anchor.x*t.texture.trim.width,o+=t.texture.trim.y-t.anchor.y*t.texture.trim.height),t.tint!==16777215&&(t.cachedTint!==t.tint&&(t.cachedTint=t.tint,t.tintedTexture=PIXI.CanvasTinter.getTintedTexture(t,t.tint)),this._image=t.tintedTexture,this._pos.set(0)),r&&(e|=0,o|=0),f=this.context,this._alpha.prev=f.globalAlpha,f.save(),f.globalAlpha=this._alpha.current,i&&(this.op=i),f[this.smoothProperty]=t.texture.baseTexture.scaleMode===PIXI.scaleModes.LINEAR,f.setTransform(u.a,u.b,u.c,u.d,e,o),f.drawImage(this._image,this._pos.x,this._pos.y,this._size.x,this._size.y,-this._size.x*t.anchor.x,-this._size.y*t.anchor.y,this._size.x,this._size.y),f.restore(),f.globalAlpha=this._alpha.prev,this.dirty=!0,this)},copyRect:function(n,t,i,r,u,f,e){return this.copy(n,t.x,t.y,t.width,t.height,i,r,t.width,t.height,0,0,0,1,1,u,f,e)},draw:function(n,t,i,r,u,f,e){return this.copy(n,null,null,null,null,t,i,r,u,null,null,null,null,null,null,f,e)},drawGroup:function(n,t,i){return n.total>0&&n.forEachExists(this.drawGroupProxy,this,t,i),this},drawGroupProxy:function(t,i,r){if(t.hasOwnProperty("texture")&&this.copyTransform(t,i,r),t.type===n.GROUP&&t.exists)this.drawGroup(t,i,r);else if(t.hasOwnProperty("children")&&t.children.length>0)for(var u=0;u<t.children.length;u++)t.children[u].exists&&this.copyTransform(t.children[u],i,r)},drawFull:function(t,i,r){var f,u;if(t.worldVisible===!1||t.worldAlpha===0||t.hasOwnProperty("exists")&&t.exists===!1)return this;if(t.type!==n.GROUP&&t.type!==n.EMITTER&&t.type!==n.BITMAPTEXT&&(t.type===n.GRAPHICS?(f=t.getBounds(),this.ctx.save(),this.ctx.translate(f.x,f.y),PIXI.CanvasGraphics.renderGraphics(t,this.ctx),this.ctx.restore()):this.copy(t,null,null,null,null,t.worldPosition.x,t.worldPosition.y,null,null,t.worldRotation,null,null,t.worldScale.x,t.worldScale.y,t.worldAlpha,i,r)),t.children)for(u=0;u<t.children.length;u++)this.drawFull(t.children[u],i,r);return this},shadow:function(n,t,i,r){var u=this.context;return n===undefined||n===null?u.shadowColor="rgba(0,0,0,0)":(u.shadowColor=n,u.shadowBlur=t===0?0:t||5,u.shadowOffsetX=i===0?0:i||10,u.shadowOffsetY=r===0?0:r||10),this},alphaMask:function(n,t,i,r){return r===undefined||r===null?this.draw(t).blendSourceAtop():this.draw(t,r.x,r.y,r.width,r.height).blendSourceAtop(),i===undefined||i===null?this.draw(n).blendReset():this.draw(n,i.x,i.y,i.width,i.height).blendReset(),this},extract:function(n,t,i,r,u,f,e,o,s){return u===undefined&&(u=255),f===undefined&&(f=!1),e===undefined&&(e=t),o===undefined&&(o=i),s===undefined&&(s=r),f&&n.resize(this.width,this.height),this.processPixelRGB(function(f,h,c){return f.r===t&&f.g===i&&f.b===r&&n.setPixel32(h,c,e,o,s,u,!1),!1},this),n.context.putImageData(n.imageData,0,0),n.dirty=!0,n},rect:function(n,t,i,r,u){return typeof u!="undefined"&&(this.context.fillStyle=u),this.context.fillRect(n,t,i,r),this},text:function(n,t,i,r,u,f){t===undefined&&(t=0);i===undefined&&(i=0);r===undefined&&(r="14px Courier");u===undefined&&(u="rgb(255,255,255)");f===undefined&&(f=!0);var e=this.context,o=e.font;return e.font=r,f&&(e.fillStyle="rgb(0,0,0)",e.fillText(n,t+1,i+1)),e.fillStyle=u,e.fillText(n,t,i),e.font=o,this},circle:function(n,t,i,r){var u=this.context;return r!==undefined&&(u.fillStyle=r),u.beginPath(),u.arc(n,t,i,0,Math.PI*2,!1),u.closePath(),u.fill(),this},line:function(n,t,i,r,u,f){u===undefined&&(u="#fff");f===undefined&&(f=1);var e=this.context;return e.beginPath(),e.moveTo(n,t),e.lineTo(i,r),e.lineWidth=f,e.strokeStyle=u,e.stroke(),e.closePath(),this},polygon:function(n,t,i,r){var u,f,o,e;for(r===undefined&&(r="#fff"),i===undefined&&(i=0),u=this.context,t&&(u.fillStyle=t),i&&(u.lineWidth=i,u.strokeStyle=r),u.beginPath(),u.moveTo(n[0].x,n[0].y),f=1,o=n.length;f<o;f++)e=n[f],u.lineTo(e.x,e.y);return u.closePath(),t&&u.fill(),i&&u.stroke(),this},textureLine:function(t,i,r){var f,u;if(r===undefined&&(r="repeat-x"),typeof i!="string"||(i=this.game.cache.getImage(i),i))return f=t.length,r==="no-repeat"&&f>i.width&&(f=i.width),u=this.context,u.fillStyle=u.createPattern(i,r),this._circle=new n.Circle(t.start.x,t.start.y,i.height),this._circle.circumferencePoint(t.angle-1.5707963267948966,!1,this._pos),u.save(),u.translate(this._pos.x,this._pos.y),u.rotate(t.angle),u.fillRect(0,0,f,i.height),u.restore(),this.dirty=!0,this},render:function(){return!this.disableTextureUpload&&this.dirty&&(this.baseTexture.dirty(),this.dirty=!1),this},destroy:function(){this.frameData.destroy();this.texture.destroy(!0);n.CanvasPool.remove(this)},blendReset:function(){return this.op="source-over",this},blendSourceOver:function(){return this.op="source-over",this},blendSourceIn:function(){return this.op="source-in",this},blendSourceOut:function(){return this.op="source-out",this},blendSourceAtop:function(){return this.op="source-atop",this},blendDestinationOver:function(){return this.op="destination-over",this},blendDestinationIn:function(){return this.op="destination-in",this},blendDestinationOut:function(){return this.op="destination-out",this},blendDestinationAtop:function(){return this.op="destination-atop",this},blendXor:function(){return this.op="xor",this},blendAdd:function(){return this.op="lighter",this},blendMultiply:function(){return this.op="multiply",this},blendScreen:function(){return this.op="screen",this},blendOverlay:function(){return this.op="overlay",this},blendDarken:function(){return this.op="darken",this},blendLighten:function(){return this.op="lighten",this},blendColorDodge:function(){return this.op="color-dodge",this},blendColorBurn:function(){return this.op="color-burn",this},blendHardLight:function(){return this.op="hard-light",this},blendSoftLight:function(){return this.op="soft-light",this},blendDifference:function(){return this.op="difference",this},blendExclusion:function(){return this.op="exclusion",this},blendHue:function(){return this.op="hue",this},blendSaturation:function(){return this.op="saturation",this},blendColor:function(){return this.op="color",this},blendLuminosity:function(){return this.op="luminosity",this},copyBitmapData:function(n,t,i){var r,f,u;for(n.update(),r=0;r<n.height;r++)for(f=(i+r)*this.width+t,u=0;u<n.width;u++)this.pixels[f+u]=n.pixels[r*n.width+u];return this}};Object.defineProperty(n.BitmapData.prototype,"smoothed",{get:function(){return n.Canvas.getSmoothingEnabled(this.context)},set:function(t){n.Canvas.setSmoothingEnabled(this.context,t)}});Object.defineProperty(n.BitmapData.prototype,"op",{get:function(){return this.context.globalCompositeOperation},set:function(n){this.context.globalCompositeOperation=n}});n.BitmapData.getTransform=function(n,t,i,r,u,f){return typeof n!="number"&&(n=0),typeof t!="number"&&(t=0),typeof i!="number"&&(i=1),typeof r!="number"&&(r=1),typeof u!="number"&&(u=0),typeof f!="number"&&(f=0),{sx:i,sy:r,scaleX:i,scaleY:r,skewX:u,skewY:f,translateX:n,translateY:t,tx:n,ty:t}};n.BitmapData.prototype.constructor=n.BitmapData;n.EarCut={};n.EarCut.Triangulate=function(t,i,r){var u,f,c,l,e,o,p,s;r=r||2;var v=i&&i.length,y=v?i[0]*r:t.length,h=n.EarCut.linkedList(t,0,y,r,!0),a=[];if(!h)return a;if(v&&(h=n.EarCut.eliminateHoles(t,i,h,r)),t.length>80*r){for(u=c=t[0],f=l=t[1],s=r;s<y;s+=r)e=t[s],o=t[s+1],e<u&&(u=e),o<f&&(f=o),e>c&&(c=e),o>l&&(l=o);p=Math.max(c-u,l-f)}return n.EarCut.earcutLinked(h,a,r,u,f,p),a};n.EarCut.linkedList=function(t,i,r,u,f){for(var h=0,o,e=i,s=r-u;e<r;e+=u)h+=(t[s]-t[e])*(t[e+1]+t[s+1]),s=e;if(f===h>0)for(e=i;e<r;e+=u)o=n.EarCut.insertNode(e,t[e],t[e+1],o);else for(e=r-u;e>=i;e-=u)o=n.EarCut.insertNode(e,t[e],t[e+1],o);return o};n.EarCut.filterPoints=function(t,i){if(!t)return t;i||(i=t);var r=t,u;do if(u=!1,!r.steiner&&(n.EarCut.equals(r,r.next)||n.EarCut.area(r.prev,r,r.next)===0)){if(n.EarCut.removeNode(r),r=i=r.prev,r===r.next)return null;u=!0}else r=r.next;while(u||r!==i);return i};n.EarCut.earcutLinked=function(t,i,r,u,f,e,o){if(t){!o&&e&&n.EarCut.indexCurve(t,u,f,e);for(var h=t,c,s;t.prev!==t.next;){if(c=t.prev,s=t.next,e?n.EarCut.isEarHashed(t,u,f,e):n.EarCut.isEar(t)){i.push(c.i/r);i.push(t.i/r);i.push(s.i/r);n.EarCut.removeNode(t);t=s.next;h=s.next;continue}if(t=s,t===h){o?o===1?(t=n.EarCut.cureLocalIntersections(t,i,r),n.EarCut.earcutLinked(t,i,r,u,f,e,2)):o===2&&n.EarCut.splitEarcut(t,i,r,u,f,e):n.EarCut.earcutLinked(n.EarCut.filterPoints(t),i,r,u,f,e,1);break}}}};n.EarCut.isEar=function(t){var r=t.prev,u=t,f=t.next,i;if(n.EarCut.area(r,u,f)>=0)return!1;for(i=t.next.next;i!==t.prev;){if(n.EarCut.pointInTriangle(r.x,r.y,u.x,u.y,f.x,f.y,i.x,i.y)&&n.EarCut.area(i.prev,i,i.next)>=0)return!1;i=i.next}return!0};n.EarCut.isEarHashed=function(t,i,r,u){var o=t.prev,s=t,e=t.next;if(n.EarCut.area(o,s,e)>=0)return!1;for(var h=o.x<s.x?o.x<e.x?o.x:e.x:s.x<e.x?s.x:e.x,c=o.y<s.y?o.y<e.y?o.y:e.y:s.y<e.y?s.y:e.y,l=o.x>s.x?o.x>e.x?o.x:e.x:s.x>e.x?s.x:e.x,a=o.y>s.y?o.y>e.y?o.y:e.y:s.y>e.y?s.y:e.y,v=n.EarCut.zOrder(h,c,i,r,u),y=n.EarCut.zOrder(l,a,i,r,u),f=t.nextZ;f&&f.z<=y;){if(f!==t.prev&&f!==t.next&&n.EarCut.pointInTriangle(o.x,o.y,s.x,s.y,e.x,e.y,f.x,f.y)&&n.EarCut.area(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(f=t.prevZ;f&&f.z>=v;){if(f!==t.prev&&f!==t.next&&n.EarCut.pointInTriangle(o.x,o.y,s.x,s.y,e.x,e.y,f.x,f.y)&&n.EarCut.area(f.prev,f,f.next)>=0)return!1;f=f.prevZ}return!0};n.EarCut.cureLocalIntersections=function(t,i,r){var u=t,e,f;do e=u.prev,f=u.next.next,n.EarCut.intersects(e,u,u.next,f)&&n.EarCut.locallyInside(e,f)&&n.EarCut.locallyInside(f,e)&&(i.push(e.i/r),i.push(u.i/r),i.push(f.i/r),n.EarCut.removeNode(u),n.EarCut.removeNode(u.next),u=t=f),u=u.next;while(u!==t);return u};n.EarCut.splitEarcut=function(t,i,r,u,f,e){var o=t,s,h;do{for(s=o.next.next;s!==o.prev;){if(o.i!==s.i&&n.EarCut.isValidDiagonal(o,s)){h=n.EarCut.splitPolygon(o,s);o=n.EarCut.filterPoints(o,o.next);h=n.EarCut.filterPoints(h,h.next);n.EarCut.earcutLinked(o,i,r,u,f,e);n.EarCut.earcutLinked(h,i,r,u,f,e);return}s=s.next}o=o.next}while(o!==t)};n.EarCut.eliminateHoles=function(t,i,r,u){for(var o=[],h,c,e,f=0,s=i.length;f<s;f++)h=i[f]*u,c=f<s-1?i[f+1]*u:t.length,e=n.EarCut.linkedList(t,h,c,u,!1),e===e.next&&(e.steiner=!0),o.push(n.EarCut.getLeftmost(e));for(o.sort(n.EarCut.compareX),f=0;f<o.length;f++)n.EarCut.eliminateHole(o[f],r),r=n.EarCut.filterPoints(r,r.next);return r};n.EarCut.compareX=function(n,t){return n.x-t.x};n.EarCut.eliminateHole=function(t,i){if(i=n.EarCut.findHoleBridge(t,i),i){var r=n.EarCut.splitPolygon(i,t);n.EarCut.filterPoints(r,r.next)}};n.EarCut.findHoleBridge=function(t,i){var r=i,e=t.x,f=t.y,o=-Infinity,u,s,l,h,c;do f<=r.y&&f>=r.next.y&&(s=r.x+(f-r.y)*(r.next.x-r.x)/(r.next.y-r.y),s<=e&&s>o&&(o=s,u=r.x<r.next.x?r:r.next)),r=r.next;while(r!==i);if(!u)return null;if(t.x===u.x)return u.prev;for(l=u,h=Infinity,r=u.next;r!==l;)e>=r.x&&r.x>=u.x&&n.EarCut.pointInTriangle(f<u.y?e:o,f,u.x,u.y,f<u.y?o:e,f,r.x,r.y)&&(c=Math.abs(f-r.y)/(e-r.x),(c<h||c===h&&r.x>u.x)&&n.EarCut.locallyInside(r,t)&&(u=r,h=c)),r=r.next;return u};n.EarCut.indexCurve=function(t,i,r,u){var f=t;do f.z===null&&(f.z=n.EarCut.zOrder(f.x,f.y,i,r,u)),f.prevZ=f.prev,f.nextZ=f.next,f=f.next;while(f!==t);f.prevZ.nextZ=null;f.prevZ=null;n.EarCut.sortLinked(f)};n.EarCut.sortLinked=function(n){var o,i,t,r,u,s,f,e,h=1;do{for(i=n,n=null,u=null,s=0;i;){for(s++,t=i,f=0,o=0;o<h;o++)if(f++,t=t.nextZ,!t)break;for(e=h;f>0||e>0&&t;)f===0?(r=t,t=t.nextZ,e--):e!==0&&t?i.z<=t.z?(r=i,i=i.nextZ,f--):(r=t,t=t.nextZ,e--):(r=i,i=i.nextZ,f--),u?u.nextZ=r:n=r,r.prevZ=u,u=r;i=t}u.nextZ=null;h*=2}while(s>1);return n};n.EarCut.zOrder=function(n,t,i,r,u){return n=32767*(n-i)/u,t=32767*(t-r)/u,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,n|t<<1};n.EarCut.getLeftmost=function(n){var t=n,i=n;do t.x<i.x&&(i=t),t=t.next;while(t!==n);return i};n.EarCut.pointInTriangle=function(n,t,i,r,u,f,e,o){return(u-e)*(t-o)-(n-e)*(f-o)>=0&&(n-e)*(r-o)-(i-e)*(t-o)>=0&&(i-e)*(f-o)-(u-e)*(r-o)>=0};n.EarCut.isValidDiagonal=function(t,i){return n.EarCut.equals(t,i)||t.next.i!==i.i&&t.prev.i!==i.i&&!n.EarCut.intersectsPolygon(t,i)&&n.EarCut.locallyInside(t,i)&&n.EarCut.locallyInside(i,t)&&n.EarCut.middleInside(t,i)};n.EarCut.area=function(n,t,i){return(t.y-n.y)*(i.x-t.x)-(t.x-n.x)*(i.y-t.y)};n.EarCut.equals=function(n,t){return n.x===t.x&&n.y===t.y};n.EarCut.intersects=function(t,i,r,u){return n.EarCut.area(t,i,r)>0!=n.EarCut.area(t,i,u)>0&&n.EarCut.area(r,u,t)>0!=n.EarCut.area(r,u,i)>0};n.EarCut.intersectsPolygon=function(t,i){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==i.i&&r.next.i!==i.i&&n.EarCut.intersects(r,r.next,t,i))return!0;r=r.next}while(r!==t);return!1};n.EarCut.locallyInside=function(t,i){return n.EarCut.area(t.prev,t,t.next)<0?n.EarCut.area(t,i,t.next)>=0&&n.EarCut.area(t,t.prev,i)>=0:n.EarCut.area(t,i,t.prev)<0||n.EarCut.area(t,t.next,i)<0};n.EarCut.middleInside=function(n,t){var i=n,r=!1,f=(n.x+t.x)/2,u=(n.y+t.y)/2;do i.y>u!=i.next.y>u&&f<(i.next.x-i.x)*(u-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==n);return r};n.EarCut.splitPolygon=function(t,i){var u=new n.EarCut.Node(t.i,t.x,t.y),r=new n.EarCut.Node(i.i,i.x,i.y),f=t.next,e=i.prev;return t.next=i,i.prev=t,u.next=f,f.prev=u,r.next=u,u.prev=r,e.next=r,r.prev=e,r};n.EarCut.insertNode=function(t,i,r,u){var f=new n.EarCut.Node(t,i,r);return u?(f.next=u.next,f.prev=u,u.next.prev=f,u.next=f):(f.prev=f,f.next=f),f};n.EarCut.removeNode=function(n){n.next.prev=n.prev;n.prev.next=n.next;n.prevZ&&(n.prevZ.nextZ=n.nextZ);n.nextZ&&(n.nextZ.prevZ=n.prevZ)};n.EarCut.Node=function(n,t,i){this.i=n;this.x=t;this.y=i;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=!1};PIXI.WebGLGraphics=function(){};PIXI.WebGLGraphics.stencilBufferLimit=6;PIXI.WebGLGraphics.renderGraphics=function(t,i){var r=i.gl,s=i.projection,h=i.offset,u=i.shaderManager.primitiveShader,f,e,o;if(t.dirty&&PIXI.WebGLGraphics.updateGraphics(t,r),e=t._webGL[r.id],e)for(o=0;o<e.data.length;o++)e.data[o].mode===1?(f=e.data[o],i.stencilManager.pushStencil(t,f,i),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,(f.indices.length-4)*2),i.stencilManager.popStencil(t,f,i)):(f=e.data[o],i.shaderManager.setShader(u),u=i.shaderManager.primitiveShader,r.uniformMatrix3fv(u.translationMatrix,!1,t.worldTransform.toArray(!0)),r.uniform1f(u.flipY,1),r.uniform2f(u.projectionVector,s.x,-s.y),r.uniform2f(u.offsetVector,-h.x,-h.y),r.uniform3fv(u.tintColor,n.Color.hexToRGBArray(t.tint)),r.uniform1f(u.alpha,t.worldAlpha),r.bindBuffer(r.ARRAY_BUFFER,f.buffer),r.vertexAttribPointer(u.aVertexPosition,2,r.FLOAT,!1,24,0),r.vertexAttribPointer(u.colorAttribute,4,r.FLOAT,!1,24,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,f.indexBuffer),r.drawElements(r.TRIANGLE_STRIP,f.indices.length,r.UNSIGNED_SHORT,0))};PIXI.WebGLGraphics.updateGraphics=function(t,i){var u=t._webGL[i.id],e,o,f,r,s;if(u||(u=t._webGL[i.id]={lastIndex:0,data:[],gl:i}),t.dirty=!1,t.clearDirty){for(t.clearDirty=!1,e=0;e<u.data.length;e++)o=u.data[e],o.reset(),PIXI.WebGLGraphics.graphicsDataPool.push(o);u.data=[];u.lastIndex=0}for(e=u.lastIndex;e<t.graphicsData.length;e++)r=t.graphicsData[e],r.type===n.POLYGON?(r.points=r.shape.points.slice(),r.shape.closed&&(r.points[0]!==r.points[r.points.length-2]||r.points[1]!==r.points[r.points.length-1])&&r.points.push(r.points[0],r.points[1]),r.fill&&r.points.length>=PIXI.WebGLGraphics.stencilBufferLimit&&(r.points.length<PIXI.WebGLGraphics.stencilBufferLimit*2?(f=PIXI.WebGLGraphics.switchMode(u,0),s=PIXI.WebGLGraphics.buildPoly(r,f),s||(f=PIXI.WebGLGraphics.switchMode(u,1),PIXI.WebGLGraphics.buildComplexPoly(r,f))):(f=PIXI.WebGLGraphics.switchMode(u,1),PIXI.WebGLGraphics.buildComplexPoly(r,f))),r.lineWidth>0&&(f=PIXI.WebGLGraphics.switchMode(u,0),PIXI.WebGLGraphics.buildLine(r,f))):(f=PIXI.WebGLGraphics.switchMode(u,0),r.type===n.RECTANGLE?PIXI.WebGLGraphics.buildRectangle(r,f):r.type===n.CIRCLE||r.type===n.ELLIPSE?PIXI.WebGLGraphics.buildCircle(r,f):r.type===n.ROUNDEDRECTANGLE&&PIXI.WebGLGraphics.buildRoundedRectangle(r,f)),u.lastIndex++;for(e=0;e<u.data.length;e++)f=u.data[e],f.dirty&&f.upload()};PIXI.WebGLGraphics.switchMode=function(n,t){var i;return n.data.length?(i=n.data[n.data.length-1],(i.mode!==t||t===1)&&(i=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(n.gl),i.mode=t,n.data.push(i))):(i=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(n.gl),i.mode=t,n.data.push(i)),i.dirty=!0,i};PIXI.WebGLGraphics.buildRectangle=function(t,i){var s=t.shape,r=s.x,u=s.y,h=s.width,c=s.height,p;if(t.fill){var y=n.Color.hexToRGBArray(t.fillColor),e=t.fillAlpha,l=y[0]*e,a=y[1]*e,v=y[2]*e,f=i.points,w=i.indices,o=f.length/6;f.push(r,u);f.push(l,a,v,e);f.push(r+h,u);f.push(l,a,v,e);f.push(r,u+c);f.push(l,a,v,e);f.push(r+h,u+c);f.push(l,a,v,e);w.push(o,o,o+1,o+2,o+3,o+3)}t.lineWidth&&(p=t.points,t.points=[r,u,r+h,u,r+h,u+c,r,u+c,r,u],PIXI.WebGLGraphics.buildLine(t,i),t.points=p)};PIXI.WebGLGraphics.buildRoundedRectangle=function(t,i){var l=t.shape,u=l.x,f=l.y,s=l.width,h=l.height,o=l.radius,r=[],b;if(r.push(u,f+o),r=r.concat(PIXI.WebGLGraphics.quadraticBezierCurve(u,f+h-o,u,f+h,u+o,f+h)),r=r.concat(PIXI.WebGLGraphics.quadraticBezierCurve(u+s-o,f+h,u+s,f+h,u+s,f+h-o)),r=r.concat(PIXI.WebGLGraphics.quadraticBezierCurve(u+s,f+o,u+s,f,u+s-o,f)),r=r.concat(PIXI.WebGLGraphics.quadraticBezierCurve(u+o,f,u,f,u,f+o)),t.fill){for(var p=n.Color.hexToRGBArray(t.fillColor),y=t.fillAlpha,k=p[0]*y,d=p[1]*y,g=p[2]*y,w=i.points,a=i.indices,v=w.length/6,c=n.EarCut.Triangulate(r,null,2),e=0,e=0;e<c.length;e+=3)a.push(c[e]+v),a.push(c[e]+v),a.push(c[e+1]+v),a.push(c[e+2]+v),a.push(c[e+2]+v);for(e=0;e<r.length;e++)w.push(r[e],r[++e],k,d,g,y)}t.lineWidth&&(b=t.points,t.points=r,PIXI.WebGLGraphics.buildLine(t,i),t.points=b)};PIXI.WebGLGraphics.quadraticBezierCurve=function(n,t,i,r,u,f){function o(n,t,i){var r=t-n;return n+r*i}for(var h,c,l,a,v,y,p=20,w=[],e=0,s=0;s<=p;s++)e=s/p,h=o(n,i,e),c=o(t,r,e),l=o(i,u,e),a=o(r,f,e),v=o(h,l,e),y=o(c,a,e),w.push(v,y);return w};PIXI.WebGLGraphics.buildCircle=function(t,i){var u=t.shape,c=u.x,l=u.y,e,o,d;t.type===n.CIRCLE?(e=u.radius,o=u.radius):(e=u.width,o=u.height);var a=40,s=Math.PI*2/a,r=0;if(t.fill){var v=n.Color.hexToRGBArray(t.fillColor),f=t.fillAlpha,w=v[0]*f,b=v[1]*f,k=v[2]*f,y=i.points,p=i.indices,h=y.length/6;for(p.push(h),r=0;r<a+1;r++)y.push(c,l,w,b,k,f),y.push(c+Math.sin(s*r)*e,l+Math.cos(s*r)*o,w,b,k,f),p.push(h++,h++);p.push(h-1)}if(t.lineWidth){for(d=t.points,t.points=[],r=0;r<a+1;r++)t.points.push(c+Math.sin(s*r)*e,l+Math.cos(s*r)*o);PIXI.WebGLGraphics.buildLine(t,i);t.points=d}};PIXI.WebGLGraphics.buildLine=function(t,i){var h=0,r=t.points,it,g,ht,ct;if(r.length!==0){if(t.lineWidth%2)for(h=0;h<r.length;h++)r[h]+=.5;it=new PIXI.Point(r[0],r[1]);g=new PIXI.Point(r[r.length-2],r[r.length-1]);it.x===g.x&&it.y===g.y&&(r=r.slice(),r.pop(),r.pop(),g=new PIXI.Point(r[r.length-2],r[r.length-1]),ht=g.x+(it.x-g.x)*.5,ct=g.y+(it.y-g.y)*.5,r.unshift(ht,ct),r.push(ht,ct));var s=i.points,lt=i.indices,rt=r.length/2,gt=r.length,at=s.length/6,p=t.lineWidth/2,vt=n.Color.hexToRGBArray(t.lineColor),l=t.lineAlpha,a=vt[0]*l,v=vt[1]*l,y=vt[2]*l,ut,ft,w,b,e,o,ot,st,u,f,k,d,nt,tt,yt,pt,wt,bt,kt,dt,et,ni,c;for(w=r[0],b=r[1],e=r[2],o=r[3],u=-(b-o),f=w-e,c=Math.sqrt(u*u+f*f),u/=c,f/=c,u*=p,f*=p,s.push(w-u,b-f,a,v,y,l),s.push(w+u,b+f,a,v,y,l),h=1;h<rt-1;h++){if(w=r[(h-1)*2],b=r[(h-1)*2+1],e=r[h*2],o=r[h*2+1],ot=r[(h+1)*2],st=r[(h+1)*2+1],u=-(b-o),f=w-e,c=Math.sqrt(u*u+f*f),u/=c,f/=c,u*=p,f*=p,k=-(o-st),d=e-ot,c=Math.sqrt(k*k+d*d),k/=c,d/=c,k*=p,d*=p,yt=-f+b-(-f+o),pt=-u+e-(-u+w),wt=(-u+w)*(-f+o)-(-u+e)*(-f+b),bt=-d+st-(-d+o),kt=-k+e-(-k+ot),dt=(-k+ot)*(-d+o)-(-k+e)*(-d+st),et=yt*kt-bt*pt,Math.abs(et)<.1){et+=10.1;s.push(e-u,o-f,a,v,y,l);s.push(e+u,o+f,a,v,y,l);continue}ut=(pt*dt-kt*wt)/et;ft=(bt*wt-yt*dt)/et;ni=(ut-e)*(ut-e)+(ft-o)+(ft-o);ni>19600?(nt=u-k,tt=f-d,c=Math.sqrt(nt*nt+tt*tt),nt/=c,tt/=c,nt*=p,tt*=p,s.push(e-nt,o-tt),s.push(a,v,y,l),s.push(e+nt,o+tt),s.push(a,v,y,l),s.push(e-nt,o-tt),s.push(a,v,y,l),gt++):(s.push(ut,ft),s.push(a,v,y,l),s.push(e-(ut-e),o-(ft-o)),s.push(a,v,y,l))}for(w=r[(rt-2)*2],b=r[(rt-2)*2+1],e=r[(rt-1)*2],o=r[(rt-1)*2+1],u=-(b-o),f=w-e,c=Math.sqrt(u*u+f*f),u/=c,f/=c,u*=p,f*=p,s.push(e-u,o-f),s.push(a,v,y,l),s.push(e+u,o+f),s.push(a,v,y,l),lt.push(at),h=0;h<gt;h++)lt.push(at++);lt.push(at-1)}};PIXI.WebGLGraphics.buildComplexPoly=function(t,i){var u=t.points.slice(),l,r,a;if(!(u.length<6)){l=i.indices;i.points=u;i.alpha=t.fillAlpha;i.color=n.Color.hexToRGBArray(t.fillColor);var f=Infinity,e=-Infinity,o=Infinity,s=-Infinity,h,c;for(r=0;r<u.length;r+=2)h=u[r],c=u[r+1],f=h<f?h:f,e=h>e?h:e,o=c<o?c:o,s=c>s?c:s;for(u.push(f,o,e,o,e,s,f,s),a=u.length/2,r=0;r<a;r++)l.push(r)}};PIXI.WebGLGraphics.buildPoly=function(t,i){var e=t.points,f,r;if(!(e.length<6)){var c=i.points,o=i.indices,l=e.length/2,h=n.Color.hexToRGBArray(t.fillColor),s=t.fillAlpha,a=h[0]*s,v=h[1]*s,y=h[2]*s,u=n.EarCut.Triangulate(e,null,2);if(!u)return!1;for(f=c.length/6,r=0,r=0;r<u.length;r+=3)o.push(u[r]+f),o.push(u[r]+f),o.push(u[r+1]+f),o.push(u[r+2]+f),o.push(u[r+2]+f);for(r=0;r<l;r++)c.push(e[r*2],e[r*2+1],a,v,y,s);return!0}};PIXI.WebGLGraphics.graphicsDataPool=[];PIXI.WebGLGraphicsData=function(n){this.gl=n;this.color=[0,0,0];this.points=[];this.indices=[];this.buffer=n.createBuffer();this.indexBuffer=n.createBuffer();this.mode=1;this.alpha=1;this.dirty=!0};PIXI.WebGLGraphicsData.prototype.reset=function(){this.points=[];this.indices=[]};PIXI.WebGLGraphicsData.prototype.upload=function(){var n=this.gl;this.glPoints=new Float32Array(this.points);n.bindBuffer(n.ARRAY_BUFFER,this.buffer);n.bufferData(n.ARRAY_BUFFER,this.glPoints,n.STATIC_DRAW);this.glIndicies=new Uint16Array(this.indices);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.glIndicies,n.STATIC_DRAW);this.dirty=!1};PIXI.CanvasGraphics=function(){};PIXI.CanvasGraphics.renderGraphics=function(t,i){var h=t.worldAlpha,d,f,b;for(t.dirty&&(this.updateGraphicsTint(t),t.dirty=!1),d=0;d<t.graphicsData.length;d++){var r=t.graphicsData[d],u=r.shape,p=r._fillTint,w=r._lineTint;if(i.lineWidth=r.lineWidth,r.type===n.POLYGON){for(i.beginPath(),f=u.points,i.moveTo(f[0],f[1]),b=1;b<f.length/2;b++)i.lineTo(f[b*2],f[b*2+1]);u.closed&&i.lineTo(f[0],f[1]);f[0]===f[f.length-2]&&f[1]===f[f.length-1]&&i.closePath();r.fill&&(i.globalAlpha=r.fillAlpha*h,i.fillStyle="#"+("00000"+(p|0).toString(16)).substr(-6),i.fill());r.lineWidth&&(i.globalAlpha=r.lineAlpha*h,i.strokeStyle="#"+("00000"+(w|0).toString(16)).substr(-6),i.stroke())}else if(r.type===n.RECTANGLE)(r.fillColor||r.fillColor===0)&&(i.globalAlpha=r.fillAlpha*h,i.fillStyle="#"+("00000"+(p|0).toString(16)).substr(-6),i.fillRect(u.x,u.y,u.width,u.height)),r.lineWidth&&(i.globalAlpha=r.lineAlpha*h,i.strokeStyle="#"+("00000"+(w|0).toString(16)).substr(-6),i.strokeRect(u.x,u.y,u.width,u.height));else if(r.type===n.CIRCLE)i.beginPath(),i.arc(u.x,u.y,u.radius,0,2*Math.PI),i.closePath(),r.fill&&(i.globalAlpha=r.fillAlpha*h,i.fillStyle="#"+("00000"+(p|0).toString(16)).substr(-6),i.fill()),r.lineWidth&&(i.globalAlpha=r.lineAlpha*h,i.strokeStyle="#"+("00000"+(w|0).toString(16)).substr(-6),i.stroke());else if(r.type===n.ELLIPSE){var g=u.width*2,nt=u.height*2,v=u.x-g/2,k=u.y-nt/2;i.beginPath();var ft=.5522848,tt=g/2*ft,it=nt/2*ft,rt=v+g,ut=k+nt,y=v+g/2,c=k+nt/2;i.moveTo(v,c);i.bezierCurveTo(v,c-it,y-tt,k,y,k);i.bezierCurveTo(y+tt,k,rt,c-it,rt,c);i.bezierCurveTo(rt,c+it,y+tt,ut,y,ut);i.bezierCurveTo(y-tt,ut,v,c+it,v,c);i.closePath();r.fill&&(i.globalAlpha=r.fillAlpha*h,i.fillStyle="#"+("00000"+(p|0).toString(16)).substr(-6),i.fill());r.lineWidth&&(i.globalAlpha=r.lineAlpha*h,i.strokeStyle="#"+("00000"+(w|0).toString(16)).substr(-6),i.stroke())}else if(r.type===n.ROUNDEDRECTANGLE){var e=u.x,o=u.y,l=u.width,a=u.height,s=u.radius,et=Math.min(l,a)/2|0;s=s>et?et:s;i.beginPath();i.moveTo(e,o+s);i.lineTo(e,o+a-s);i.quadraticCurveTo(e,o+a,e+s,o+a);i.lineTo(e+l-s,o+a);i.quadraticCurveTo(e+l,o+a,e+l,o+a-s);i.lineTo(e+l,o+s);i.quadraticCurveTo(e+l,o,e+l-s,o);i.lineTo(e+s,o);i.quadraticCurveTo(e,o,e,o+s);i.closePath();(r.fillColor||r.fillColor===0)&&(i.globalAlpha=r.fillAlpha*h,i.fillStyle="#"+("00000"+(p|0).toString(16)).substr(-6),i.fill());r.lineWidth&&(i.globalAlpha=r.lineAlpha*h,i.strokeStyle="#"+("00000"+(w|0).toString(16)).substr(-6),i.stroke())}}};PIXI.CanvasGraphics.renderGraphicsMask=function(t,i){var it=t.graphicsData.length,w,s,r,e,y;if(it!==0)for(i.beginPath(),w=0;w<it;w++)if(s=t.graphicsData[w],r=s.shape,s.type===n.POLYGON){for(e=r.points,i.moveTo(e[0],e[1]),y=1;y<e.length/2;y++)i.lineTo(e[y*2],e[y*2+1]);e[0]===e[e.length-2]&&e[1]===e[e.length-1]&&i.closePath()}else if(s.type===n.RECTANGLE)i.rect(r.x,r.y,r.width,r.height),i.closePath();else if(s.type===n.CIRCLE)i.arc(r.x,r.y,r.radius,0,2*Math.PI),i.closePath();else if(s.type===n.ELLIPSE){var b=r.width*2,k=r.height*2,a=r.x-b/2,p=r.y-k/2,rt=.5522848,d=b/2*rt,g=k/2*rt,nt=a+b,tt=p+k,v=a+b/2,h=p+k/2;i.moveTo(a,h);i.bezierCurveTo(a,h-g,v-d,p,v,p);i.bezierCurveTo(v+d,p,nt,h-g,nt,h);i.bezierCurveTo(nt,h+g,v+d,tt,v,tt);i.bezierCurveTo(v-d,tt,a,h+g,a,h);i.closePath()}else if(s.type===n.ROUNDEDRECTANGLE){var u=r.x,f=r.y,c=r.width,l=r.height,o=r.radius,ut=Math.min(c,l)/2|0;o=o>ut?ut:o;i.moveTo(u,f+o);i.lineTo(u,f+l-o);i.quadraticCurveTo(u,f+l,u+o,f+l);i.lineTo(u+c-o,f+l);i.quadraticCurveTo(u+c,f+l,u+c,f+l-o);i.lineTo(u+c,f+o);i.quadraticCurveTo(u+c,f,u+c-o,f);i.lineTo(u+o,f);i.quadraticCurveTo(u,f,u,f+o);i.closePath()}};PIXI.CanvasGraphics.updateGraphicsTint=function(n){var t;if(n.tint!==16777215){var f=(n.tint>>16&255)/255,e=(n.tint>>8&255)/255,o=(n.tint&255)/255;for(t=0;t<n.graphicsData.length;t++){var i=n.graphicsData[t],r=i.fillColor|0,u=i.lineColor|0;i._fillTint=((r>>16&255)/255*f*255<<16)+((r>>8&255)/255*e*255<<8)+(r&255)/255*o*255;i._lineTint=((u>>16&255)/255*f*255<<16)+((u>>8&255)/255*e*255<<8)+(u&255)/255*o*255}}};n.GraphicsData=function(n,t,i,r,u,f,e){this.lineWidth=n;this.lineColor=t;this.lineAlpha=i;this._lineTint=t;this.fillColor=r;this.fillAlpha=u;this._fillTint=r;this.fill=f;this.shape=e;this.type=e.type};n.GraphicsData.prototype.constructor=n.GraphicsData;n.GraphicsData.prototype.clone=function(){return new n.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Graphics=function(t,i,r){i===undefined&&(i=0);r===undefined&&(r=0);this.type=n.GRAPHICS;this.physicsType=n.SPRITE;this.anchor=new n.Point;PIXI.DisplayObjectContainer.call(this);this.renderable=!0;this.fillAlpha=1;this.lineWidth=0;this.lineColor=0;this.graphicsData=[];this.tint=16777215;this.blendMode=PIXI.blendModes.NORMAL;this.currentPath=null;this._webGL=[];this.isMask=!1;this.boundsPadding=0;this._localBounds=new n.Rectangle(0,0,1,1);this.dirty=!0;this._boundsDirty=!1;this.webGLDirty=!1;this.cachedSpriteDirty=!1;n.Component.Core.init.call(this,t,i,r,"",null)};n.Graphics.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);n.Graphics.prototype.constructor=n.Graphics;n.Component.Core.install.call(n.Graphics.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]);n.Graphics.prototype.preUpdatePhysics=n.Component.PhysicsBody.preUpdate;n.Graphics.prototype.preUpdateLifeSpan=n.Component.LifeSpan.preUpdate;n.Graphics.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate;n.Graphics.prototype.preUpdateCore=n.Component.Core.preUpdate;n.Graphics.prototype.preUpdate=function(){return!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()?!1:this.preUpdateCore()};n.Graphics.prototype.postUpdate=function(){n.Component.PhysicsBody.postUpdate.call(this);n.Component.FixedToCamera.postUpdate.call(this);this._boundsDirty&&(this.updateLocalBounds(),this._boundsDirty=!1);for(var t=0;t<this.children.length;t++)this.children[t].postUpdate()};n.Graphics.prototype.destroy=function(t){this.clear();n.Component.Destroy.prototype.destroy.call(this,t)};n.Graphics.prototype.drawTriangle=function(t,i){var r;if(i===undefined&&(i=!1),r=new n.Polygon(t),i){var u=new n.Point(this.game.camera.x-t[0].x,this.game.camera.y-t[0].y),f=new n.Point(t[1].x-t[0].x,t[1].y-t[0].y),e=new n.Point(t[1].x-t[2].x,t[1].y-t[2].y),o=e.cross(f);u.dot(o)>0&&this.drawPolygon(r)}else this.drawPolygon(r)};n.Graphics.prototype.drawTriangles=function(t,i,r){r===undefined&&(r=!1);var e=new n.Point,o=new n.Point,s=new n.Point,f=[],u;if(i)if(t[0]instanceof n.Point)for(u=0;u<i.length/3;u++)f.push(t[i[u*3]]),f.push(t[i[u*3+1]]),f.push(t[i[u*3+2]]),f.length===3&&(this.drawTriangle(f,r),f=[]);else for(u=0;u<i.length;u++)e.x=t[i[u]*2],e.y=t[i[u]*2+1],f.push(e.copyTo({})),f.length===3&&(this.drawTriangle(f,r),f=[]);else if(t[0]instanceof n.Point)for(u=0;u<t.length/3;u++)this.drawTriangle([t[u*3],t[u*3+1],t[u*3+2]],r);else for(u=0;u<t.length/6;u++)e.x=t[u*6+0],e.y=t[u*6+1],o.x=t[u*6+2],o.y=t[u*6+3],s.x=t[u*6+4],s.y=t[u*6+5],this.drawTriangle([e,o,s],r)};n.Graphics.prototype.lineStyle=function(t,i,r){return this.lineWidth=t||0,this.lineColor=i||0,this.lineAlpha=r===undefined?1:r,this.currentPath&&(this.currentPath.shape.points.length?this.drawShape(new n.Polygon(this.currentPath.shape.points.slice(-2))):(this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha)),this};n.Graphics.prototype.moveTo=function(t,i){return this.drawShape(new n.Polygon([t,i])),this};n.Graphics.prototype.lineTo=function(n,t){return this.currentPath||this.moveTo(0,0),this.currentPath.shape.points.push(n,t),this.dirty=!0,this._boundsDirty=!0,this};n.Graphics.prototype.quadraticCurveTo=function(n,t,i,r){var o,s,h,u,e;this.currentPath?this.currentPath.shape.points.length===0&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);h=20;u=this.currentPath.shape.points;u.length===0&&this.moveTo(0,0);var c=u[u.length-2],l=u[u.length-1],f=0;for(e=1;e<=h;++e)f=e/h,o=c+(n-c)*f,s=l+(t-l)*f,u.push(o+(n+(i-n)*f-o)*f,s+(t+(r-t)*f-s)*f);return this.dirty=!0,this._boundsDirty=!0,this};n.Graphics.prototype.bezierCurveTo=function(n,t,i,r,u,f){var l;this.currentPath?this.currentPath.shape.points.length===0&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var y=20,o,h,a,c,v,s=this.currentPath.shape.points,p=s[s.length-2],w=s[s.length-1],e=0;for(l=1;l<=y;++l)e=l/y,o=1-e,h=o*o,a=h*o,c=e*e,v=c*e,s.push(a*p+3*h*e*n+3*o*c*i+v*u,a*w+3*h*e*t+3*o*c*r+v*f);return this.dirty=!0,this._boundsDirty=!0,this};n.Graphics.prototype.arcTo=function(n,t,i,r,u){this.currentPath?this.currentPath.shape.points.length===0&&this.currentPath.shape.points.push(n,t):this.moveTo(n,t);var f=this.currentPath.shape.points,g=f[f.length-2],nt=f[f.length-1],e=nt-t,o=g-n,s=r-t,h=i-n,a=Math.abs(e*h-o*s);if(a<1e-8||u===0)(f[f.length-2]!==n||f[f.length-1]!==t)&&f.push(n,t);else{var p=e*e+o*o,w=s*s+h*h,b=e*s+o*h,c=u*Math.sqrt(p)/a,l=u*Math.sqrt(w)/a,k=c*b/p,d=l*b/w,v=c*h+l*o,y=c*s+l*e,tt=o*(l+k),it=e*(l+k),rt=h*(c+d),ut=s*(c+d),ft=Math.atan2(it-y,tt-v),et=Math.atan2(ut-y,rt-v);this.arc(v+n,y+t,u,ft,et,o*s>h*e)}return this.dirty=!0,this._boundsDirty=!0,this};n.Graphics.prototype.arc=function(n,t,i,r,u,f,e){var s,c,a,v,o;if(r===u||(f===undefined&&(f=!1),e===undefined&&(e=40),!f&&u<=r?u+=Math.PI*2:f&&r<=u&&(r+=Math.PI*2),s=f?(r-u)*-1:u-r,c=Math.ceil(Math.abs(s)/(Math.PI*2))*e,s===0))return this;a=n+Math.cos(r)*i;v=t+Math.sin(r)*i;f&&this.filling?this.moveTo(n,t):this.moveTo(a,v);var d=this.currentPath.shape.points,h=s/(c*2),g=h*2,y=Math.cos(h),p=Math.sin(h),l=c-1,nt=l%1/l;for(o=0;o<=l;o++){var tt=o+nt*o,w=h+r+g*tt,b=Math.cos(w),k=-Math.sin(w);d.push((y*b+p*k)*i+n,(y*-k+p*b)*i+t)}return this.dirty=!0,this._boundsDirty=!0,this};n.Graphics.prototype.beginFill=function(n,t){return this.filling=!0,this.fillColor=n||0,this.fillAlpha=t===undefined?1:t,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this};n.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this};n.Graphics.prototype.drawRect=function(t,i,r,u){return this.drawShape(new n.Rectangle(t,i,r,u)),this};n.Graphics.prototype.drawRoundedRect=function(t,i,r,u,f){return this.drawShape(new n.RoundedRectangle(t,i,r,u,f)),this};n.Graphics.prototype.drawCircle=function(t,i,r){return this.drawShape(new n.Circle(t,i,r)),this};n.Graphics.prototype.drawEllipse=function(t,i,r,u){return this.drawShape({x:t,y:i,width:r,height:u,type:n.ELLIPSE}),this};n.Graphics.prototype.drawPolygon=function(t){var i,r;if(t instanceof n.Polygon&&(t=t.points),i=t,!Array.isArray(i))for(i=new Array(arguments.length),r=0;r<i.length;++r)i[r]=arguments[r];return this.drawShape(new n.Polygon(i)),this};n.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this._boundsDirty=!0,this.clearDirty=!0,this.graphicsData=[],this.updateLocalBounds(),this};n.Graphics.prototype.generateTexture=function(n,t,i){var r,u,f;return n===undefined&&(n=1),t===undefined&&(t=PIXI.scaleModes.DEFAULT),i===undefined&&(i=0),r=this.getBounds(),r.width+=i,r.height+=i,u=new PIXI.CanvasBuffer(r.width*n,r.height*n),f=PIXI.Texture.fromCanvas(u.canvas,t),f.baseTexture.resolution=n,u.context.scale(n,n),u.context.translate(-r.x,-r.y),PIXI.CanvasGraphics.renderGraphics(this,u.context),f};n.Graphics.prototype._renderWebGL=function(n){var i,t;if(this.visible!==!1&&this.alpha!==0&&this.isMask!==!0){if(this._cacheAsBitmap){(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1);this._cachedSprite.worldAlpha=this.worldAlpha;PIXI.Sprite.prototype._renderWebGL.call(this._cachedSprite,n);return}if(n.spriteBatch.stop(),n.blendModeManager.setBlendMode(this.blendMode),this._mask&&n.maskManager.pushMask(this._mask,n),this._filters&&n.filterManager.pushFilter(this._filterBlock),this.blendMode!==n.spriteBatch.currentBlendMode&&(n.spriteBatch.currentBlendMode=this.blendMode,i=PIXI.blendModesWebGL[n.spriteBatch.currentBlendMode],n.spriteBatch.gl.blendFunc(i[0],i[1])),this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),PIXI.WebGLGraphics.renderGraphics(this,n),this.children.length){for(n.spriteBatch.start(),t=0;t<this.children.length;t++)this.children[t]._renderWebGL(n);n.spriteBatch.stop()}this._filters&&n.filterManager.popFilter();this._mask&&n.maskManager.popMask(this.mask,n);n.drawCount++;n.spriteBatch.start()}};n.Graphics.prototype._renderCanvas=function(n){var i,t,u;if(this.visible!==!1&&this.alpha!==0&&this.isMask!==!0){if(this._prevTint!==this.tint&&(this.dirty=!0,this._prevTint=this.tint),this._cacheAsBitmap){(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1);this._cachedSprite.alpha=this.alpha;PIXI.Sprite.prototype._renderCanvas.call(this._cachedSprite,n);return}i=n.context;t=this.worldTransform;this.blendMode!==n.currentBlendMode&&(n.currentBlendMode=this.blendMode,i.globalCompositeOperation=PIXI.blendModesCanvas[n.currentBlendMode]);this._mask&&n.maskManager.pushMask(this._mask,n);var r=n.resolution,f=t.tx*n.resolution+n.shakeX,e=t.ty*n.resolution+n.shakeY;for(i.setTransform(t.a*r,t.b*r,t.c*r,t.d*r,f,e),PIXI.CanvasGraphics.renderGraphics(this,i),u=0;u<this.children.length;u++)this.children[u]._renderCanvas(n);this._mask&&n.maskManager.popMask(n)}};n.Graphics.prototype.getBounds=function(t){if(this._currentBounds)return this._currentBounds;if(this.isMask)return n.EmptyRectangle;this.dirty&&(this.updateLocalBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var e=this._localBounds,s=e.x,h=e.width+e.x,c=e.y,l=e.height+e.y,o=t||this.worldTransform,a=o.a,v=o.b,y=o.c,p=o.d,w=o.tx,b=o.ty,rt=a*h+y*l+w,ut=p*l+v*h+b,k=a*s+y*l+w,d=p*l+v*s+b,g=a*s+y*c+w,nt=p*c+v*s+b,tt=a*h+y*c+w,it=p*c+v*h+b,u=rt,f=ut,i=rt,r=ut;return i=k<i?k:i,i=g<i?g:i,i=tt<i?tt:i,r=d<r?d:r,r=nt<r?nt:r,r=it<r?it:r,u=k>u?k:u,u=g>u?g:u,u=tt>u?tt:u,f=d>f?d:f,f=nt>f?nt:f,f=it>f?it:f,this._bounds.x=i,this._bounds.width=u-i,this._bounds.y=r,this._bounds.height=f-r,this._currentBounds=this._bounds,this._currentBounds};n.Graphics.prototype.getLocalBounds=function(){var r=this.worldTransform,t,i;for(this.worldTransform=n.identityMatrix,t=0;t<this.children.length;t++)this.children[t].updateTransform();for(i=this.getBounds(),this.worldTransform=r,t=0;t<this.children.length;t++)this.children[t].updateTransform();return i};n.Graphics.prototype.containsPoint=function(t,i){var f,r,u;for(i===undefined&&(i=new n.Point),this.worldTransform.applyInverse(t,i),f=this.graphicsData,r=0;r<f.length;r++)if((u=f[r],u.fill)&&u.shape&&u.shape.contains(i.x,i.y))return!0;return!1};n.Graphics.prototype.getVisualBounds=function(n){return this._boundsDirty&&(this.updateLocalBounds(),this._boundsDirty=!1),this._localBounds.clone(n)};n.Graphics.prototype.updateLocalBounds=function(){var u=Infinity,e=-Infinity,f=Infinity,o=-Infinity,s,a,t,i,h,c,y,l,v;if(this.graphicsData.length)for(y=0;y<this.graphicsData.length;y++){var w=this.graphicsData[y],p=w.type,r=w.lineWidth;if(s=w.shape,p===n.RECTANGLE||p===n.ROUNDEDRECTANGLE)t=s.x-r/2,i=s.y-r/2,h=s.width+r,c=s.height+r,u=t<u?t:u,e=t+h>e?t+h:e,f=i<f?i:f,o=i+c>o?i+c:o;else if(p===n.CIRCLE)t=s.x,i=s.y,h=s.radius+r/2,c=s.radius+r/2,u=t-h<u?t-h:u,e=t+h>e?t+h:e,f=i-c<f?i-c:f,o=i+c>o?i+c:o;else if(p===n.ELLIPSE)t=s.x,i=s.y,h=s.width+r/2,c=s.height+r/2,u=t-h<u?t-h:u,e=t+h>e?t+h:e,f=i-c<f?i-c:f,o=i+c>o?i+c:o;else for(a=s.points,l=0;l<a.length;l++)a[l]instanceof n.Point?(t=a[l].x,i=a[l].y):(t=a[l],i=a[l+1],l<a.length-1&&l++),u=t-r<u?t-r:u,e=t+r>e?t+r:e,f=i-r<f?i-r:f,o=i+r>o?i+r:o}else u=0,e=0,f=0,o=0;v=this.boundsPadding;this._localBounds.x=u-v;this._localBounds.width=e-u+v*2;this._localBounds.y=f-v;this._localBounds.height=o-f+v*2};n.Graphics.prototype._generateCachedSprite=function(){var n=this.getLocalBounds(),t,i;this._cachedSprite?this._cachedSprite.buffer.resize(n.width,n.height):(t=new PIXI.CanvasBuffer(n.width,n.height),i=PIXI.Texture.fromCanvas(t.canvas),this._cachedSprite=new PIXI.Sprite(i),this._cachedSprite.buffer=t,this._cachedSprite.worldTransform=this.worldTransform);this._cachedSprite.anchor.x=-(n.x/n.width);this._cachedSprite.anchor.y=-(n.y/n.height);this._cachedSprite.buffer.context.translate(-n.x,-n.y);this.worldAlpha=1;PIXI.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context);this._cachedSprite.alpha=this.alpha};n.Graphics.prototype.updateCachedSpriteTexture=function(){var i=this._cachedSprite,n=i.texture,t=i.buffer.canvas;n.baseTexture.width=t.width;n.baseTexture.height=t.height;n.crop.width=n.frame.width=t.width;n.crop.height=n.frame.height=t.height;i._width=t.width;i._height=t.height;n.baseTexture.dirty()};n.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0);this._cachedSprite=null};n.Graphics.prototype.drawShape=function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop();this.currentPath=null;t instanceof n.Polygon&&(t=t.clone(),t.flatten());var i=new n.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,t);return this.graphicsData.push(i),i.type===n.POLYGON&&(i.shape.closed=this.filling,this.currentPath=i),this.dirty=!0,this._boundsDirty=!0,i};Object.defineProperty(n.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(n){this._cacheAsBitmap=n;this._cacheAsBitmap?this._generateCachedSprite():this.destroyCachedSprite();this.dirty=!0;this.webGLDirty=!0}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.RenderTexture=function(t,i,r,u,f,e,o,s){if(i===undefined&&(i=100),r===undefined&&(r=100),u===undefined&&(u=""),f===undefined&&(f=n.scaleModes.DEFAULT),e===undefined&&(e=1),o===undefined&&(o=PIXI.defaultRenderer),s===undefined&&(s=0),this.game=t,this.key=u,this.type=n.RENDERTEXTURE,this._tempMatrix=new n.Matrix,this.width=i,this.height=r,this.resolution=e,this.frame=new n.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=this.frame.clone(),this.baseTexture=new PIXI.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=f,this.baseTexture.hasLoaded=!0,PIXI.Texture.call(this,this.baseTexture,this.frame.clone()),this.renderer=o,this.renderer.type===n.WEBGL){var h=this.renderer.gl;this.baseTexture.textureIndex=s;this.baseTexture._dirty[h.id]=!1;this.textureBuffer=new PIXI.FilterTexture(h,this.width,this.height,this.baseTexture.scaleMode,s);this.baseTexture._glTextures[h.id]=this.textureBuffer.texture;this.projection=new n.Point(this.width*.5,-this.height*.5)}else this.textureBuffer=new PIXI.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0;this.tempMatrix=new n.Matrix;this._updateUvs()};n.RenderTexture.prototype=Object.create(PIXI.Texture.prototype);n.RenderTexture.prototype.constructor=n.RenderTexture;n.RenderTexture.prototype.renderXY=function(t,i,r,u){t.updateTransform();this._tempMatrix.copyFrom(t.worldTransform);this._tempMatrix.tx=i;this._tempMatrix.ty=r;this.renderer.type===n.WEBGL?this._renderWebGL(t,this._tempMatrix,u):this._renderCanvas(t,this._tempMatrix,u)};n.RenderTexture.prototype.renderRawXY=function(t,i,r,u){this._tempMatrix.identity().translate(i,r);this.renderer.type===n.WEBGL?this._renderWebGL(t,this._tempMatrix,u):this._renderCanvas(t,this._tempMatrix,u)};n.RenderTexture.prototype.render=function(t,i,r){i===undefined||i===null?this._tempMatrix.copyFrom(t.worldTransform):this._tempMatrix.copyFrom(i);this.renderer.type===n.WEBGL?this._renderWebGL(t,this._tempMatrix,r):this._renderCanvas(t,this._tempMatrix,r)};n.RenderTexture.prototype.resize=function(t,i,r){(t!==this.width||i!==this.height)&&(this.valid=t>0&&i>0,this.width=t,this.height=i,this.frame.width=this.crop.width=t*this.resolution,this.frame.height=this.crop.height=i*this.resolution,r&&(this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution),this.renderer.type===n.WEBGL&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid)&&this.textureBuffer.resize(this.width,this.height)};n.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===n.WEBGL&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())};n.RenderTexture.prototype._renderWebGL=function(n,t,i){var u,f,r;if(this.valid&&n.alpha!==0){for(u=n.worldTransform,u.identity(),u.translate(0,this.projection.y*2),t&&u.append(t),u.scale(1,-1),f=0;f<n.children.length;f++)n.children[f].updateTransform();r=this.renderer.gl;r.viewport(0,0,this.width*this.resolution,this.height*this.resolution);r.bindFramebuffer(r.FRAMEBUFFER,this.textureBuffer.frameBuffer);i&&this.textureBuffer.clear();this.renderer.spriteBatch.dirty=!0;this.renderer.renderDisplayObject(n,this.projection,this.textureBuffer.frameBuffer,t);this.renderer.spriteBatch.dirty=!0;r.bindFramebuffer(r.FRAMEBUFFER,null)}};n.RenderTexture.prototype._renderCanvas=function(n,t,i){var u,r,f;if(this.valid&&n.alpha!==0){for(u=n.worldTransform,u.identity(),t&&u.append(t),r=0;r<n.children.length;r++)n.children[r].updateTransform();i&&this.textureBuffer.clear();f=this.renderer.resolution;this.renderer.resolution=this.resolution;this.renderer.renderDisplayObject(n,this.textureBuffer.context,t);this.renderer.resolution=f}};n.RenderTexture.prototype.getImage=function(){var n=new Image;return n.src=this.getBase64(),n};n.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()};n.RenderTexture.prototype.getCanvas=function(){var u,f;if(this.renderer.type===n.WEBGL){var t=this.renderer.gl,i=this.textureBuffer.width,r=this.textureBuffer.height,e=new Uint8Array(4*i*r);return t.bindFramebuffer(t.FRAMEBUFFER,this.textureBuffer.frameBuffer),t.readPixels(0,0,i,r,t.RGBA,t.UNSIGNED_BYTE,e),t.bindFramebuffer(t.FRAMEBUFFER,null),u=new PIXI.CanvasBuffer(i,r),f=u.context.getImageData(0,0,i,r),f.data.set(e),u.context.putImageData(f,0,0),u.canvas}return this.textureBuffer.canvas};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Text=function(t,i,r,u,f){i=i||0;r=r||0;u=u===undefined||u===null?"":u.toString();this.canvas=n.CanvasPool.create(this);n.Sprite.call(this,t,i,r,PIXI.Texture.fromCanvas(this.canvas));this.type=n.TEXT;this.physicsType=n.SPRITE;this.padding=new n.Point;this.textBounds=null;this.context=this.canvas.getContext("2d");this.colors=[];this.strokeColors=[];this.fontStyles=[];this.fontWeights=[];this.autoRound=!1;this.useAdvancedWrap=!1;this.splitRegExp=/(?:\r\n|\r|\n)/;this.characterLimitSize=-1;this.characterLimitSuffix="";this._testString="|M\u00c9q";this._res=t.renderer.resolution;this._text=u;this._fontComponents=null;this._lineSpacing=0;this._charCount=0;this._width=0;this._height=0;this.style={};this.setStyle(f||{});u!==""&&this.updateText()};n.Text.prototype=Object.create(n.Sprite.prototype);n.Text.prototype.constructor=n.Text;n.Text.prototype.preUpdate=function(){return!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()?!1:this.preUpdateCore()};n.Text.prototype.update=function(){};n.Text.prototype.destroy=function(t){this.texture.destroy(!0);n.Component.Destroy.prototype.destroy.call(this,t)};n.Text.prototype.setShadow=function(n,t,i,r,u,f){return n===undefined&&(n=0),t===undefined&&(t=0),i===undefined&&(i="rgba(0, 0, 0, 1)"),r===undefined&&(r=0),u===undefined&&(u=!0),f===undefined&&(f=!0),this.style.shadowOffsetX=n,this.style.shadowOffsetY=t,this.style.shadowColor=i,this.style.shadowBlur=r,this.style.shadowStroke=u,this.style.shadowFill=f,this.dirty=!0,this};n.Text.prototype.setStyle=function(n,t){var i,r;return t===undefined&&(t=!1),i=Object.assign({},n),i.font=n.font||"bold 20pt Arial",i.backgroundColor=n.backgroundColor||null,i.fill=n.fill||"black",i.align=(n.align||"left").toLowerCase(),i.boundsAlignH=(n.boundsAlignH||"left").toLowerCase(),i.boundsAlignV=(n.boundsAlignV||"top").toLowerCase(),i.stroke=n.stroke||"black",i.strokeThickness=Number(n.strokeThickness)||0,i.wordWrap=n.wordWrap||!1,i.wordWrapWidth=n.wordWrapWidth||100,i.maxLines=n.maxLines||0,i.shadowOffsetX=n.shadowOffsetX||0,i.shadowOffsetY=n.shadowOffsetY||0,i.shadowColor=n.shadowColor||"rgba(0,0,0,0)",i.shadowBlur=n.shadowBlur||0,i.tabs=n.tabs||0,r=this.fontToComponents(i.font),i.fontStyle&&(r.fontStyle=i.fontStyle),i.fontVariant&&(r.fontVariant=i.fontVariant),i.fontWeight&&(r.fontWeight=i.fontWeight),i.fontSize&&(typeof i.fontSize=="number"&&(i.fontSize=i.fontSize+"px"),r.fontSize=i.fontSize),this._fontComponents=r,i.font=this.componentsToFont(this._fontComponents),this.style=i,this.dirty=!0,t&&this.updateText(),this};n.Text.prototype.updateText=function(){var h,n,o,r,y,p,i,b,u,f;this.texture.baseTexture.resolution=this._res;this.context.font=this.style.font;h=this.text;this.characterLimitSize>-1&&this.characterLimitSize<h.length&&(h=this.text.substring(0,this.characterLimitSize)+this.characterLimitSuffix);this.style.wordWrap&&(h=this.runWordWrap(this.text));var t=h.split(this.splitRegExp),s=this.style.tabs,l=[],c=0,w=this.determineFontProperties(this.style.font),a=t.length;for(this.style.maxLines>0&&this.style.maxLines<t.length&&(a=this.style.maxLines),this._charCount=0,n=0;n<a;n++){if(s===0)r=this.style.strokeThickness+this.padding.x,r+=this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?this.measureLine(t[n]):this.context.measureText(t[n]).width,this.style.wordWrap&&(r-=this.context.measureText(" ").width);else if(o=t[n].split(/(?:\t)/),r=this.padding.x+this.style.strokeThickness,Array.isArray(s))for(y=0,i=0;i<o.length;i++)p=0,p=this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?this.measureLine(o[i]):Math.ceil(this.context.measureText(o[i]).width),i>0&&(y+=s[i-1]),r=y+p;else for(i=0;i<o.length;i++)r+=this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?this.measureLine(o[i]):Math.ceil(this.context.measureText(o[i]).width),b=this.game.math.snapToCeil(r,s)-r,r+=b;l[n]=Math.ceil(r);c=Math.max(c,l[n])}this.canvas.width=c*this._res;var v=w.fontSize+this.style.strokeThickness+this.padding.y,k=v*a,e=this._lineSpacing;for(e<0&&Math.abs(e)>v&&(e=-v),e!==0&&(k+=e>0?e*t.length:e*(t.length-1)),this.canvas.height=k*this._res,this.context.scale(this._res,this._res),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.style.backgroundColor&&(this.context.fillStyle=this.style.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.textBaseline="alphabetic",this.context.lineWidth=this.style.strokeThickness,this.context.lineCap="round",this.context.lineJoin="round",this._charCount=0,n=0;n<a;n++)u=this.style.strokeThickness/2,f=this.style.strokeThickness/2+n*v+w.ascent,n>0&&(f+=e*n),this.style.align==="right"?u+=c-l[n]:this.style.align==="center"&&(u+=(c-l[n])/2),this.autoRound&&(u=Math.round(u),f=Math.round(f)),this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?this.updateLine(t[n],u,f):(this.style.stroke&&this.style.strokeThickness&&(this.updateShadow(this.style.shadowStroke),s===0?this.context.strokeText(t[n],u,f):this.renderTabLine(t[n],u,f,!1)),this.style.fill&&(this.updateShadow(this.style.shadowFill),s===0?this.context.fillText(t[n],u,f):this.renderTabLine(t[n],u,f,!0)));this.updateTexture();this.dirty=!1};n.Text.prototype.renderTabLine=function(n,t,i,r){var f=n.split(/(?:\t)/),o=this.style.tabs,e=0,s,u,h;if(Array.isArray(o))for(s=0,u=0;u<f.length;u++)u>0&&(s+=o[u-1]),e=t+s,r?this.context.fillText(f[u],e,i):this.context.strokeText(f[u],e,i);else for(u=0;u<f.length;u++)h=Math.ceil(this.context.measureText(f[u]).width),e=this.game.math.snapToCeil(t,o),r?this.context.fillText(f[u],e,i):this.context.strokeText(f[u],e,i),t=e+h};n.Text.prototype.updateShadow=function(n){n?(this.context.shadowOffsetX=this.style.shadowOffsetX,this.context.shadowOffsetY=this.style.shadowOffsetY,this.context.shadowColor=this.style.shadowColor,this.context.shadowBlur=this.style.shadowBlur):(this.context.shadowOffsetX=0,this.context.shadowOffsetY=0,this.context.shadowColor=0,this.context.shadowBlur=0)};n.Text.prototype.measureLine=function(n){for(var u,t,r=0,i=0;i<n.length;i++)u=n[i],(this.fontWeights.length>0||this.fontStyles.length>0)&&(t=this.fontToComponents(this.context.font),this.fontStyles[this._charCount]&&(t.fontStyle=this.fontStyles[this._charCount]),this.fontWeights[this._charCount]&&(t.fontWeight=this.fontWeights[this._charCount]),this.context.font=this.componentsToFont(t)),this.style.stroke&&this.style.strokeThickness&&(this.strokeColors[this._charCount]&&(this.context.strokeStyle=this.strokeColors[this._charCount]),this.updateShadow(this.style.shadowStroke)),this.style.fill&&(this.colors[this._charCount]&&(this.context.fillStyle=this.colors[this._charCount]),this.updateShadow(this.style.shadowFill)),r+=this.context.measureText(u).width,this._charCount++;return Math.ceil(r)};n.Text.prototype.updateLine=function(n,t,i){for(var u,f,r=0;r<n.length;r++)u=n[r],(this.fontWeights.length>0||this.fontStyles.length>0)&&(f=this.fontToComponents(this.context.font),this.fontStyles[this._charCount]&&(f.fontStyle=this.fontStyles[this._charCount]),this.fontWeights[this._charCount]&&(f.fontWeight=this.fontWeights[this._charCount]),this.context.font=this.componentsToFont(f)),this.style.stroke&&this.style.strokeThickness&&(this.strokeColors[this._charCount]&&(this.context.strokeStyle=this.strokeColors[this._charCount]),this.updateShadow(this.style.shadowStroke),this.context.strokeText(u,t,i)),this.style.fill&&(this.colors[this._charCount]&&(this.context.fillStyle=this.colors[this._charCount]),this.updateShadow(this.style.shadowFill),this.context.fillText(u,t,i)),t+=this.context.measureText(u).width,this._charCount++};n.Text.prototype.clearColors=function(){return this.colors=[],this.strokeColors=[],this.dirty=!0,this};n.Text.prototype.clearFontValues=function(){return this.fontStyles=[],this.fontWeights=[],this.dirty=!0,this};n.Text.prototype.addColor=function(n,t){return this.colors[t]=n,this.dirty=!0,this};n.Text.prototype.addStrokeColor=function(n,t){return this.strokeColors[t]=n,this.dirty=!0,this};n.Text.prototype.addFontStyle=function(n,t){return this.fontStyles[t]=n,this.dirty=!0,this};n.Text.prototype.addFontWeight=function(n,t){return this.fontWeights[t]=n,this.dirty=!0,this};n.Text.prototype.precalculateWordWrap=function(n){this.texture.baseTexture.resolution=this._res;this.context.font=this.style.font;var t=this.runWordWrap(n);return t.split(/(?:\r\n|\r|\n)/)};n.Text.prototype.runWordWrap=function(n){return this.useAdvancedWrap?this.advancedWordWrap(n):this.basicWordWrap(n)};n.Text.prototype.advancedWordWrap=function(n){for(var r,o,p,s,u,t,i,b,k,d,c=this.context,v=this.style.wordWrapWidth,l="",f=n.replace(/ +/gi," ").split(/\r?\n/gi),y=f.length,e=0;e<y;e++){if(r=f[e],o="",r=r.replace(/^ *|\s*$/gi,""),p=c.measureText(r).width,p<v){l+=r+"\n";continue}for(s=v,u=r.split(" "),t=0;t<u.length;t++){var w=u[t],a=w+" ",h=c.measureText(a).width;if(h>s){if(t===0){for(i=a;i.length;)if(i=i.slice(0,-1),h=c.measureText(i).width,h<=s)break;if(!i.length)throw new Error("This text's wordWrapWidth setting is less than a single character!");b=w.substr(i.length);u[t]=b;o+=i}k=u[t].length?t:t+1;d=u.slice(k).join(" ").replace(/[ \n]*$/gi,"");f[e+1]=d+" "+(f[e+1]||"");y=f.length;break}else o+=a,s-=h}l+=o.replace(/[ \n]*$/gi,"")+"\n"}return l.replace(/[\s|\n]*$/gi,"")};n.Text.prototype.basicWordWrap=function(n){for(var f,r,t,o,s,i="",e=n.split("\n"),u=0;u<e.length;u++){for(f=this.style.wordWrapWidth,r=e[u].split(" "),t=0;t<r.length;t++)o=this.context.measureText(r[t]).width,s=o+this.context.measureText(" ").width,s>f?(t>0&&(i+="\n"),i+=r[t]+" ",f=this.style.wordWrapWidth-o):(f-=s,i+=r[t]+" ");u<e.length-1&&(i+="\n")}return i};n.Text.prototype.updateFont=function(n){var t=this.componentsToFont(n);this.style.font!==t&&(this.style.font=t,this.dirty=!0,this.parent&&this.updateTransform())};n.Text.prototype.fontToComponents=function(n){var t=n.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/),i;return t?(i=t[5].trim(),/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(i)||/['",]/.exec(i)||(i="'"+i+"'"),{font:n,fontStyle:t[1]||"normal",fontVariant:t[2]||"normal",fontWeight:t[3]||"normal",fontSize:t[4]||"medium",fontFamily:i}):(console.warn("Phaser.Text - unparsable CSS font: "+n),{font:n})};n.Text.prototype.componentsToFont=function(n){var i=[],t;return t=n.fontStyle,t&&t!=="normal"&&i.push(t),t=n.fontVariant,t&&t!=="normal"&&i.push(t),t=n.fontWeight,t&&t!=="normal"&&i.push(t),t=n.fontSize,t&&t!=="medium"&&i.push(t),t=n.fontFamily,t&&i.push(t),i.length||i.push(n.font),i.join(" ")};n.Text.prototype.setText=function(n,t){return(t===undefined&&(t=!1),n=n.toString()||"",n===this._text)?this:(this.text=n,t?this.updateText():this.dirty=!0,this)};n.Text.prototype.parseList=function(n){var i,t;if(Array.isArray(n))for(i="",t=0;t<n.length;t++)Array.isArray(n[t])?(i+=n[t].join("\t"),t<n.length-1&&(i+="\n")):(i+=n[t],t<n.length-1&&(i+="\t"));else return this;return this.text=i,this.dirty=!0,this};n.Text.prototype.setTextBounds=function(t,i,r,u){return t===undefined?this.textBounds=null:(this.textBounds?this.textBounds.setTo(t,i,r,u):this.textBounds=new n.Rectangle(t,i,r,u),this.style.wordWrapWidth>r&&(this.style.wordWrapWidth=r)),this.updateTexture(),this};n.Text.prototype.updateTexture=function(){var u=this.texture.baseTexture,f=this.texture.crop,e=this.texture.frame,n=this.canvas.width,t=this.canvas.height,i,r;u.width=n;u.height=t;f.width=n;f.height=t;e.width=n;e.height=t;this.texture.width=n;this.texture.height=t;this._width=n;this._height=t;this.textBounds&&(i=this.textBounds.x,r=this.textBounds.y,this.style.boundsAlignH==="right"?i+=this.textBounds.width-this.canvas.width/this.resolution:this.style.boundsAlignH==="center"&&(i+=this.textBounds.halfWidth-this.canvas.width/this.resolution/2),this.style.boundsAlignV==="bottom"?r+=this.textBounds.height-this.canvas.height/this.resolution:this.style.boundsAlignV==="middle"&&(r+=this.textBounds.halfHeight-this.canvas.height/this.resolution/2),this.pivot.x=-i,this.pivot.y=-r);this.renderable=n!==0&&t!==0;this.texture.requiresReTint=!0;this.texture.baseTexture.dirty()};n.Text.prototype._renderWebGL=function(n){this.dirty&&(this.updateText(),this.dirty=!1);PIXI.Sprite.prototype._renderWebGL.call(this,n)};n.Text.prototype._renderCanvas=function(n){this.dirty&&(this.updateText(),this.dirty=!1);PIXI.Sprite.prototype._renderCanvas.call(this,n)};n.Text.prototype.determineFontProperties=function(t){var i=n.Text.fontPropertiesCache[t],a=this.testString||"|M\u00c9q",v,r;if(!i){i={};v=n.Text.fontPropertiesCanvas;r=n.Text.fontPropertiesContext;r.font=t;var o=Math.ceil(r.measureText(a).width),u=Math.ceil(r.measureText(a).width),s=2*u;if(u=u*1.4|0,v.width=o,v.height=s,r.fillStyle="#f00",r.fillRect(0,0,o,s),r.font=t,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(a,0,u),!r.getImageData(0,0,o,s))return i.ascent=u,i.descent=u+6,i.fontSize=i.ascent+i.descent,n.Text.fontPropertiesCache[t]=i,i;for(var y=r.getImageData(0,0,o,s).data,p=y.length,h=o*4,e,c=0,l=!1,f=0;f<u;f++){for(e=0;e<h;e+=4)if(y[c+e]!==255){l=!0;break}if(l)break;else c+=h}for(i.ascent=u-f,c=p-h,l=!1,f=s;f>u;f--){for(e=0;e<h;e+=4)if(y[c+e]!==255){l=!0;break}if(l)break;else c-=h}i.descent=f-u;i.descent+=6;i.fontSize=i.ascent+i.descent;n.Text.fontPropertiesCache[t]=i}return i};n.Text.prototype.getBounds=function(n){return this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype.getBounds.call(this,n)};n.Text.prototype.setCharacterLimit=function(n,t){this.characterLimitSuffix=t===undefined?"":t;this.characterLimitSize=n;this.updateText()};Object.defineProperty(n.Text.prototype,"text",{get:function(){return this._text},set:function(n){n!==this._text&&(this._text=n.toString()||"",this.dirty=!0,this.parent&&this.updateTransform())}});Object.defineProperty(n.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(n){n=n||"bold 20pt Arial";this._fontComponents=this.fontToComponents(n);this.updateFont(this._fontComponents)}});Object.defineProperty(n.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(n){n=n||"Arial";n=n.trim();/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(n)||/['",]/.exec(n)||(n="'"+n+"'");this._fontComponents.fontFamily=n;this.updateFont(this._fontComponents)}});Object.defineProperty(n.Text.prototype,"fontSize",{get:function(){var n=this._fontComponents.fontSize;return n&&/(?:^0$|px$)/.exec(n)?parseInt(n,10):n},set:function(n){n=n||"0";typeof n=="number"&&(n=n+"px");this._fontComponents.fontSize=n;this.updateFont(this._fontComponents)}});Object.defineProperty(n.Text.prototype,"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},set:function(n){n=n||"normal";this._fontComponents.fontWeight=n;this.updateFont(this._fontComponents)}});Object.defineProperty(n.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(n){n=n||"normal";this._fontComponents.fontStyle=n;this.updateFont(this._fontComponents)}});Object.defineProperty(n.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||"normal"},set:function(n){n=n||"normal";this._fontComponents.fontVariant=n;this.updateFont(this._fontComponents)}});Object.defineProperty(n.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(n){n!==this.style.fill&&(this.style.fill=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"align",{get:function(){return this.style.align},set:function(n){n=n.toLowerCase();n!==this.style.align&&(this.style.align=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"resolution",{get:function(){return this._res},set:function(n){n!==this._res&&(this._res=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"tabs",{get:function(){return this.style.tabs},set:function(n){n!==this.style.tabs&&(this.style.tabs=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"boundsAlignH",{get:function(){return this.style.boundsAlignH},set:function(n){n=n.toLowerCase();n!==this.style.boundsAlignH&&(this.style.boundsAlignH=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"boundsAlignV",{get:function(){return this.style.boundsAlignV},set:function(n){n=n.toLowerCase();n!==this.style.boundsAlignV&&(this.style.boundsAlignV=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(n){n!==this.style.stroke&&(this.style.stroke=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(n){n!==this.style.strokeThickness&&(this.style.strokeThickness=Number(n),this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(n){n!==this.style.wordWrap&&(this.style.wordWrap=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(n){n!==this.style.wordWrapWidth&&(this.style.wordWrapWidth=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(n){n!==this._lineSpacing&&(this._lineSpacing=parseFloat(n),this.dirty=!0,this.parent&&this.updateTransform())}});Object.defineProperty(n.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(n){n!==this.style.shadowOffsetX&&(this.style.shadowOffsetX=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(n){n!==this.style.shadowOffsetY&&(this.style.shadowOffsetY=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(n){n!==this.style.shadowColor&&(this.style.shadowColor=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(n){n!==this.style.shadowBlur&&(this.style.shadowBlur=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"shadowStroke",{get:function(){return this.style.shadowStroke},set:function(n){n!==this.style.shadowStroke&&(this.style.shadowStroke=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"shadowFill",{get:function(){return this.style.shadowFill},set:function(n){n!==this.style.shadowFill&&(this.style.shadowFill=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*(this.texture.frame.width/this.resolution)},set:function(n){this.scale.x=n/this.texture.frame.width;this._width=n}});Object.defineProperty(n.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*(this.texture.frame.height/this.resolution)},set:function(n){this.scale.y=n/this.texture.frame.height;this._height=n}});Object.defineProperty(n.Text.prototype,"testString",{get:function(){return this._testString},set:function(n){this._testString=n;this.updateText()}});n.Text.fontPropertiesCache={};n.Text.fontPropertiesCanvas=document.createElement("canvas");n.Text.fontPropertiesContext=n.Text.fontPropertiesCanvas.getContext("2d");
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.BitmapText=function(t,i,r,u,f,e,o){i=i||0;r=r||0;u=u||"";f=f||"";e=e||32;o=o||"left";PIXI.DisplayObjectContainer.call(this);this.type=n.BITMAPTEXT;this.physicsType=n.SPRITE;this.textWidth=0;this.textHeight=0;this.anchor=new n.Point;this._prevAnchor=new n.Point;this._glyphs=[];this._maxWidth=0;this._text=f.toString()||"";this._data=t.cache.getBitmapFont(u);this._font=u;this._fontSize=e;this._align=o;this._letterSpacing=0;this._tint=16777215;this.updateText();this.dirty=!1;n.Component.Core.init.call(this,t,i,r,"",null)};n.BitmapText.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);n.BitmapText.prototype.constructor=n.BitmapText;n.Component.Core.install.call(n.BitmapText.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]);n.BitmapText.prototype.preUpdatePhysics=n.Component.PhysicsBody.preUpdate;n.BitmapText.prototype.preUpdateLifeSpan=n.Component.LifeSpan.preUpdate;n.BitmapText.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate;n.BitmapText.prototype.preUpdateCore=n.Component.Core.preUpdate;n.BitmapText.prototype.preUpdate=function(){return!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()?!1:this.preUpdateCore()};n.BitmapText.prototype.postUpdate=function(){n.Component.PhysicsBody.postUpdate.call(this);n.Component.FixedToCamera.postUpdate.call(this);this.body&&this.body.type===n.Physics.ARCADE&&(this.textWidth!==this.body.sourceWidth||this.textHeight!==this.body.sourceHeight)&&this.body.setSize(this.textWidth,this.textHeight)};n.BitmapText.prototype.setText=function(n){this.text=n};n.BitmapText.prototype.scanLine=function(n,t,i){for(var l,e,a=0,f=0,c=-1,v=0,o=null,y=this._maxWidth>0?this._maxWidth:null,s=[],r=0;r<i.length;r++){if(l=r===i.length-1?!0:!1,/(?:\r\n|\r|\n)/.test(i.charAt(r)))return{width:f,text:i.substr(0,r),end:l,chars:s};var h=i.charCodeAt(r),u=n.chars[h],p=0;if(u===undefined&&(h=32,u=n.chars[h]),e=o&&u.kerning[o]?u.kerning[o]:0,/(\s)/.test(i.charAt(r))&&(c=r,v=f),p=(e+u.texture.width+u.xOffset)*t,y&&f+p>=y&&c>-1)return{width:v||f,text:i.substr(0,r-(r-c)),end:!1,chars:s};f+=(u.xAdvance+e+this.letterSpacing)*t;s.push(a+(u.xOffset+e+this.letterSpacing)*t);a+=(u.xAdvance+e+this.letterSpacing)*t;o=h}return{width:f,text:i,end:l,chars:s}};n.BitmapText.prototype.cleanText=function(n,t){var o,s,i,r,u,e,f;if(t===undefined&&(t=""),o=this._data.font,!o)return"";for(s=/\r\n|\n\r|\n|\r/g,i=n.replace(s,"\n").split("\n"),r=0;r<i.length;r++){for(u="",e=i[r],f=0;f<e.length;f++)u=o.chars[e.charCodeAt(f)]?u.concat(e[f]):u.concat(t);i[r]=u}return i.join("\n")};n.BitmapText.prototype.updateText=function(){var r=this._data.font,i,n,u,o,f,t;if(r){var s=this.text,e=this._fontSize/r.size,h=[],c=0;this.textWidth=0;do n=this.scanLine(r,e,s),n.y=c,h.push(n),n.width>this.textWidth&&(this.textWidth=n.width),c+=r.lineHeight*e,s=s.substr(n.text.length+1);while(n.end===!1);this.textHeight=c;var l=0,a=0,v=this.textWidth*this.anchor.x,y=this.textHeight*this.anchor.y;for(i=0;i<h.length;i++)for(n=h[i],this._align==="right"?a=this.textWidth-n.width:this._align==="center"&&(a=(this.textWidth-n.width)/2),u=0;u<n.text.length;u++)o=n.text.charCodeAt(u),f=r.chars[o],f===undefined&&(o=32,f=r.chars[o]),t=this._glyphs[l],t?t.texture=f.texture:(t=new PIXI.Sprite(f.texture),t.name=n.text[u],this._glyphs.push(t)),t.position.x=n.chars[u]+a-v,t.position.y=n.y+f.yOffset*e-y,t.scale.set(e),t.tint=this.tint,t.texture.requiresReTint=!0,t.cachedTint=16777215,t.parent||this.addChild(t),l++;for(i=l;i<this._glyphs.length;i++)this.removeChild(this._glyphs[i])}};n.BitmapText.prototype.purgeGlyphs=function(){for(var i=this._glyphs.length,t=[],n=0;n<this._glyphs.length;n++)this._glyphs[n].parent!==this?this._glyphs[n].destroy():t.push(this._glyphs[n]);return this._glyphs=[],this._glyphs=t,this.updateText(),i-t.length};n.BitmapText.prototype.updateTransform=function(){(this.dirty||!this.anchor.equals(this._prevAnchor))&&(this.updateText(),this.dirty=!1,this._prevAnchor.copyFrom(this.anchor));PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)};Object.defineProperty(n.BitmapText.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(n){typeof n=="number"&&(this._letterSpacing=n,this.updateText())}});Object.defineProperty(n.BitmapText.prototype,"align",{get:function(){return this._align},set:function(n){n!==this._align&&(n==="left"||n==="center"||n==="right")&&(this._align=n,this.updateText())}});Object.defineProperty(n.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(n){n!==this._tint&&(this._tint=n,this.updateText())}});Object.defineProperty(n.BitmapText.prototype,"font",{get:function(){return this._font},set:function(n){n!==this._font&&(this._font=n.trim(),this._data=this.game.cache.getBitmapFont(this._font),this.updateText())}});Object.defineProperty(n.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(n){n=parseInt(n,10);n!==this._fontSize&&n>0&&(this._fontSize=n,this.updateText())}});Object.defineProperty(n.BitmapText.prototype,"text",{get:function(){return this._text},set:function(n){n!==this._text&&(this._text=n.toString()||"",this.updateText())}});Object.defineProperty(n.BitmapText.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(n){n!==this._maxWidth&&(this._maxWidth=n,this.updateText())}});Object.defineProperty(n.BitmapText.prototype,"smoothed",{get:function(){return!this._data.base.scaleMode},set:function(n){this._data.base.scaleMode=n?0:1;this._data.base.dirty()}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.RetroFont=function(t,i,r,u,f,e,o,s,h,c){var l,p;if(!t.cache.checkImageKey(i))return!1;(e===undefined||e===null)&&(e=t.cache.getImage(i).width/r);this.characterWidth=r;this.characterHeight=u;this.characterSpacingX=o||0;this.characterSpacingY=s||0;this.characterPerRow=e;this.offsetX=h||0;this.offsetY=c||0;this.align="left";this.multiLine=!1;this.autoUpperCase=!0;this.customSpacingX=0;this.customSpacingY=0;this.fixedWidth=0;this.fontSet=t.cache.getImage(i);this._text="";this.grabData=[];this.frameData=new n.FrameData;var a=this.offsetX,y=this.offsetY,v=0;for(l=0;l<f.length;l++)p=this.frameData.addFrame(new n.Frame(l,a,y,this.characterWidth,this.characterHeight)),this.grabData[f.charCodeAt(l)]=p.index,v++,v===this.characterPerRow?(v=0,a=this.offsetX,y+=this.characterHeight+this.characterSpacingY):a+=this.characterWidth+this.characterSpacingX;t.cache.updateFrameData(i,this.frameData);this.stamp=new n.Image(t,0,0,i,0);n.RenderTexture.call(this,t,100,100,"",n.scaleModes.NEAREST);this.type=n.RETROFONT};n.RetroFont.prototype=Object.create(n.RenderTexture.prototype);n.RetroFont.prototype.constructor=n.RetroFont;n.RetroFont.ALIGN_LEFT="left";n.RetroFont.ALIGN_RIGHT="right";n.RetroFont.ALIGN_CENTER="center";n.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";n.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ";n.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ";n.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789";n.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789";n.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ";n.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39";n.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ";n.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!";n.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ";n.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789";n.RetroFont.prototype.setFixedWidth=function(n,t){t===undefined&&(t="left");this.fixedWidth=n;this.align=t};n.RetroFont.prototype.setText=function(n,t,i,r,u,f){this.multiLine=t||!1;this.customSpacingX=i||0;this.customSpacingY=r||0;this.align=u||"left";this.autoUpperCase=f?!1:!0;n.length>0&&(this.text=n)};n.RetroFont.prototype.buildRetroFontText=function(){var t=0,u=0,i,r;if(this.clear(),this.multiLine)for(i=this._text.split("\n"),this.fixedWidth>0?this.resize(this.fixedWidth,i.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0):this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),i.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0),r=0;r<i.length;r++)t=0,this.align===n.RetroFont.ALIGN_RIGHT?t=this.width-i[r].length*(this.characterWidth+this.customSpacingX):this.align===n.RetroFont.ALIGN_CENTER&&(t=this.width/2-i[r].length*(this.characterWidth+this.customSpacingX)/2+this.customSpacingX/2),t<0&&(t=0),this.pasteLine(i[r],t,u,this.customSpacingX),u+=this.characterHeight+this.customSpacingY;else this.fixedWidth>0?this.resize(this.fixedWidth,this.characterHeight,!0):this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,!0),t=0,this.align===n.RetroFont.ALIGN_RIGHT?t=this.width-this._text.length*(this.characterWidth+this.customSpacingX):this.align===n.RetroFont.ALIGN_CENTER&&(t=this.width/2-this._text.length*(this.characterWidth+this.customSpacingX)/2+this.customSpacingX/2),t<0&&(t=0),this.pasteLine(this._text,t,0,this.customSpacingX);this.requiresReTint=!0};n.RetroFont.prototype.pasteLine=function(n,t,i,r){for(var u=0;u<n.length;u++)if(n.charAt(u)===" ")t+=this.characterWidth+r;else if(this.grabData[n.charCodeAt(u)]>=0&&(this.stamp.frame=this.grabData[n.charCodeAt(u)],this.renderXY(this.stamp,t,i,!1),t+=this.characterWidth+r,t>this.width))break};n.RetroFont.prototype.getLongestLine=function(){var i=0,t,n;if(this._text.length>0)for(t=this._text.split("\n"),n=0;n<t.length;n++)t[n].length>i&&(i=t[n].length);return i};n.RetroFont.prototype.removeUnsupportedCharacters=function(n){for(var t,u,i="",r=0;r<this._text.length;r++)t=this._text[r],u=t.charCodeAt(0),(this.grabData[u]>=0||!n&&t==="\n")&&(i=i.concat(t));return i};n.RetroFont.prototype.updateOffset=function(n,t){if(this.offsetX!==n||this.offsetY!==t){for(var u=n-this.offsetX,f=t-this.offsetY,i=this.game.cache.getFrameData(this.stamp.key).getFrames(),r=i.length;r--;)i[r].x+=u,i[r].y+=f;this.buildRetroFontText()}};Object.defineProperty(n.RetroFont.prototype,"text",{get:function(){return this._text},set:function(n){var t;t=this.autoUpperCase?n.toUpperCase():n;t!==this._text&&(this._text=t,this.removeUnsupportedCharacters(this.multiLine),this.buildRetroFontText())}});Object.defineProperty(n.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(n){this.stamp.smoothed=n;this.buildRetroFontText()}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @author       Mat Groves (@Doormat23)
* @author       Rovanion Luckey
* @copyright    2016 Photon Storm Ltd, Richard Davey
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Rope=function(t,i,r,u,f,e){this.points=e||[];this._hasUpdateAnimation=!1;this._updateAnimationCallback=null;i=i||0;r=r||0;u=u||null;f=f||null;this.type=n.ROPE;PIXI.DisplayObjectContainer.call(this);this.texture=n.Cache.DEFAULT;this.uvs=new Float32Array([0,1,1,1,1,0,0,1]);this.vertices=new Float32Array([0,0,100,0,100,100,0,100]);this.colors=new Float32Array([1,1,1,1]);this.indices=new Uint16Array([0,1,2,3]);e&&(this.vertices=new Float32Array(e.length*4),this.uvs=new Float32Array(e.length*4),this.colors=new Float32Array(e.length*2),this.indices=new Uint16Array(e.length*2));this.dirty=!0;this.canvasPadding=0;this.drawMode=n.Rope.TRIANGLE_STRIP;n.Component.Core.init.call(this,t,i,r,u,f);this.refresh()};n.Rope.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);n.Rope.prototype.constructor=n.Rope;n.Component.Core.install.call(n.Rope.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]);n.Rope.prototype.preUpdatePhysics=n.Component.PhysicsBody.preUpdate;n.Rope.prototype.preUpdateLifeSpan=n.Component.LifeSpan.preUpdate;n.Rope.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate;n.Rope.prototype.preUpdateCore=n.Component.Core.preUpdate;n.Rope.TRIANGLE_STRIP=0;n.Rope.TRIANGLES=1;n.Rope.prototype.preUpdate=function(){return!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()?!1:this.preUpdateCore()};n.Rope.prototype.update=function(){this._hasUpdateAnimation&&this.updateAnimation.call(this)};n.Rope.prototype.reset=function(t,i){return n.Component.Reset.prototype.reset.call(this,t,i),this};n.Rope.prototype.refresh=function(){var u=this.points,t;if(!(u.length<1)){var i=this.uvs,f=this.indices,e=this.colors;this.count-=.2;var o=u.length,n=0,r=0;for(t=0;t<o;t++)n=t*4,r=t/(o-1),i[n]=r,i[n+1]=0,i[n+2]=r,i[n+3]=1,n=t*2,e[n]=1,e[n+1]=1,n=t*2,f[n]=n,f[n+1]=n+1}};n.Rope.prototype.updateTransform=function(){var r=this.points,f,o,n,i;if(!(r.length<1)){f=r[0];n={x:0,y:0};this.count-=.2;var e=this.vertices,c=r.length,t,u,s,h,l=this.texture.height/2;for(i=0;i<c;i++)t=r[i],u=i*4,o=i<c-1?r[i+1]:t,n.y=-(o.x-f.x),n.x=o.y-f.y,s=Math.sqrt(n.x*n.x+n.y*n.y),h=l,n.x/=s,n.y/=s,n.x*=h,n.y*=h,e[u]=t.x+n.x,e[u+1]=t.y+n.y,e[u+2]=t.x-n.x,e[u+3]=t.y-n.y,f=t;PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)}};n.Rope.prototype.setTexture=function(n){this.texture=n};n.Rope.prototype._renderWebGL=function(n){!this.visible||this.alpha<=0||(n.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(n),n.shaderManager.setShader(n.shaderManager.stripShader),this._renderStrip(n),n.spriteBatch.start())};n.Rope.prototype._initWebGL=function(n){var t=n.gl;this._vertexBuffer=t.createBuffer();this._indexBuffer=t.createBuffer();this._uvBuffer=t.createBuffer();this._colorBuffer=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer);t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,this._uvBuffer);t.bufferData(t.ARRAY_BUFFER,this.uvs,t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,this._colorBuffer);t.bufferData(t.ARRAY_BUFFER,this.colors,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW)};n.Rope.prototype._renderStrip=function(t){var i=t.gl,u=t.projection,f=t.offset,r=t.shaderManager.stripShader,e=this.drawMode===n.Rope.TRIANGLE_STRIP?i.TRIANGLE_STRIP:i.TRIANGLES;t.blendModeManager.setBlendMode(this.blendMode);i.uniformMatrix3fv(r.translationMatrix,!1,this.worldTransform.toArray(!0));i.uniform2f(r.projectionVector,u.x,-u.y);i.uniform2f(r.offsetVector,-f.x,-f.y);i.uniform1f(r.alpha,this.worldAlpha);this.dirty?(this.dirty=!1,i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferData(i.ARRAY_BUFFER,this.vertices,i.STATIC_DRAW),i.vertexAttribPointer(r.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.bufferData(i.ARRAY_BUFFER,this.uvs,i.STATIC_DRAW),i.vertexAttribPointer(r.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),this.texture.baseTexture._dirty[i.id]?t.renderer.updateTexture(this.texture.baseTexture):i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,this.indices,i.STATIC_DRAW)):(i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,this.vertices),i.vertexAttribPointer(r.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.vertexAttribPointer(r.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),this.texture.baseTexture._dirty[i.id]?t.renderer.updateTexture(this.texture.baseTexture):i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer));i.drawElements(e,this.indices.length,i.UNSIGNED_SHORT,0)};n.Rope.prototype._renderCanvas=function(t){var r=t.context,i=this.worldTransform,u=i.tx*t.resolution+t.shakeX,f=i.ty*t.resolution+t.shakeY;t.roundPixels?r.setTransform(i.a,i.b,i.c,i.d,u|0,f|0):r.setTransform(i.a,i.b,i.c,i.d,u,f);this.drawMode===n.Rope.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(r):this._renderCanvasTriangles(r)};n.Rope.prototype._renderCanvasTriangleStrip=function(n){var r=this.vertices,u=this.uvs,f=r.length/2,t,i;for(this.count++,t=0;t<f-2;t++)i=t*2,this._renderCanvasDrawTriangle(n,r,u,i,i+2,i+4)};n.Rope.prototype._renderCanvasTriangles=function(n){var r=this.vertices,u=this.uvs,i=this.indices,f=i.length,t;for(this.count++,t=0;t<f;t+=3){var e=i[t]*2,o=i[t+1]*2,s=i[t+2]*2;this._renderCanvasDrawTriangle(n,r,u,e,o,s)}};n.Rope.prototype._renderCanvasDrawTriangle=function(n,t,i,r,u,f){var ot=this.texture.baseTexture.source,rt=this.texture.width,ut=this.texture.height,h=t[r],c=t[u],l=t[f],a=t[r+1],v=t[u+1],y=t[f+1],p=i[r]*rt,w=i[u]*rt,b=i[f]*rt,k=i[r+1]*ut,d=i[u+1]*ut,g=i[f+1]*ut;if(this.canvasPadding>0){var ft=this.canvasPadding/this.worldTransform.a,et=this.canvasPadding/this.worldTransform.d,nt=(h+c+l)/3,tt=(a+v+y)/3,o=h-nt,s=a-tt,e=Math.sqrt(o*o+s*s);h=nt+o/e*(e+ft);a=tt+s/e*(e+et);o=c-nt;s=v-tt;e=Math.sqrt(o*o+s*s);c=nt+o/e*(e+ft);v=tt+s/e*(e+et);o=l-nt;s=y-tt;e=Math.sqrt(o*o+s*s);l=nt+o/e*(e+ft);y=tt+s/e*(e+et)}n.save();n.beginPath();n.moveTo(h,a);n.lineTo(c,v);n.lineTo(l,y);n.closePath();n.clip();var it=p*d+k*b+w*g-d*b-k*w-p*g,st=h*d+k*l+c*g-d*l-k*c-h*g,ht=p*c+h*b+w*l-c*b-h*w-p*l,ct=p*d*l+k*c*b+h*w*g-h*d*b-k*w*l-p*c*g,lt=a*d+k*y+v*g-d*y-k*v-a*g,at=p*v+a*b+w*y-v*b-a*w-p*y,vt=p*d*y+k*v*b+a*w*g-a*d*b-k*w*y-p*v*g;n.transform(st/it,lt/it,ht/it,at/it,ct/it,vt/it);n.drawImage(ot,0,0);n.restore()};n.Rope.prototype.renderStripFlat=function(n){var t=this.context,i=n.vertices,f=i.length/2,u;for(this.count++,t.beginPath(),u=1;u<f-2;u++){var r=u*2,e=i[r],o=i[r+2],s=i[r+4],h=i[r+1],c=i[r+3],l=i[r+5];t.moveTo(e,h);t.lineTo(o,c);t.lineTo(s,l)}t.fillStyle="#FF0000";t.fill();t.closePath()};n.Rope.prototype.getBounds=function(t){for(var i,r=t||this.worldTransform,y=r.a,p=r.b,w=r.c,b=r.d,k=r.tx,d=r.ty,o=-Infinity,f=-Infinity,u=Infinity,e=Infinity,l=this.vertices,s=0;s<l.length;s+=2){var a=l[s],v=l[s+1],h=y*a+w*v+k,c=b*v+p*a+d;u=h<u?h:u;e=c<e?c:e;o=h>o?h:o;f=c>f?c:f}return u===-Infinity||f===Infinity?n.EmptyRectangle:(i=this._bounds,i.x=u,i.width=o-u,i.y=e,i.height=f-e,this._currentBounds=i,i)};Object.defineProperty(n.Rope.prototype,"updateAnimation",{get:function(){return this._updateAnimation},set:function(n){n&&typeof n=="function"?(this._hasUpdateAnimation=!0,this._updateAnimation=n):(this._hasUpdateAnimation=!1,this._updateAnimation=null)}});Object.defineProperty(n.Rope.prototype,"segments",{get:function(){for(var f=[],t,i,r,e,o,s,h,c,u=0;u<this.points.length;u++)t=u*4,i=this.vertices[t]*this.scale.x,r=this.vertices[t+1]*this.scale.y,e=this.vertices[t+4]*this.scale.x,o=this.vertices[t+3]*this.scale.y,s=n.Math.difference(i,e),h=n.Math.difference(r,o),i+=this.world.x,r+=this.world.y,c=new n.Rectangle(i,r,s,h),f.push(c);return f}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.TileSprite=function(t,i,r,u,f,e,o){i=i||0;r=r||0;u=u||256;f=f||256;e=e||null;o=o||null;PIXI.Sprite.call(this,new PIXI.Texture(n.Cache.DEFAULT.baseTexture),u,f);this.type=n.TILESPRITE;this.physicsType=n.SPRITE;this._scroll=new n.Point;this.tileScale=new n.Point(1,1);this.tileScaleOffset=new n.Point(1,1);this.tilePosition=new n.Point;this.textureDebug=!1;this.canvasBuffer=null;this.tilingTexture=null;this.tilePattern=null;this.refreshTexture=!0;this.frameWidth=0;this.frameHeight=0;this._width=u;this._height=f;n.Component.Core.init.call(this,t,i,r,e,o)};n.TileSprite.prototype=Object.create(PIXI.Sprite.prototype);n.TileSprite.prototype.constructor=n.TileSprite;n.Component.Core.install.call(n.TileSprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","Smoothed"]);n.TileSprite.prototype.preUpdatePhysics=n.Component.PhysicsBody.preUpdate;n.TileSprite.prototype.preUpdateLifeSpan=n.Component.LifeSpan.preUpdate;n.TileSprite.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate;n.TileSprite.prototype.preUpdateCore=n.Component.Core.preUpdate;n.TileSprite.prototype.preUpdate=function(){return(this._scroll.x!==0&&(this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed),this._scroll.y!==0&&(this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed),!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld())?!1:this.preUpdateCore()};n.TileSprite.prototype.autoScroll=function(n,t){return this._scroll.set(n,t),this};n.TileSprite.prototype.stopScroll=function(){return this._scroll.set(0,0),this};n.TileSprite.prototype.destroy=function(t){n.Component.Destroy.prototype.destroy.call(this,t);PIXI.Sprite.prototype.destroy.call(this);this.canvasBuffer&&(this.canvasBuffer.destroy(),this.canvasBuffer=null);this.tileScale=null;this.tileScaleOffset=null;this.tilePosition=null;this.tilingTexture&&(this.tilingTexture.destroy(!0),this.tilingTexture=null)};n.TileSprite.prototype.reset=function(t,i){return n.Component.Reset.prototype.reset.call(this,t,i),this.tilePosition.x=0,this.tilePosition.y=0,this};n.TileSprite.prototype.setTexture=function(n){return this.texture!==n&&(this.texture=n,this.refreshTexture=!0,this.cachedTint=16777215),this};n.TileSprite.prototype._renderWebGL=function(n){var t,i;if(this.visible&&this.renderable&&this.alpha!==0){if(this._mask&&(n.spriteBatch.stop(),n.maskManager.pushMask(this.mask,n),n.spriteBatch.start()),this._filters&&(n.spriteBatch.flush(),n.filterManager.pushFilter(this._filterBlock)),this.refreshTexture)if(this.generateTilingTexture(!0,n),this.tilingTexture)this.tilingTexture.needsUpdate&&(this.tilingTexture.baseTexture.textureIndex=this.texture.baseTexture.textureIndex,n.renderer.updateTexture(this.tilingTexture.baseTexture),this.tilingTexture.needsUpdate=!1);else return;for(n.spriteBatch.renderTilingSprite(this),t=0;t<this.children.length;t++)this.children[t]._renderWebGL(n);i=!1;this._filters&&(i=!0,n.spriteBatch.stop(),n.filterManager.popFilter());this._mask&&(i||n.spriteBatch.stop(),n.maskManager.popMask(this._mask,n));i&&n.spriteBatch.start()}};n.TileSprite.prototype._renderCanvas=function(n){var t,s,i,r,c,l,h;if(this.visible&&this.renderable&&this.alpha!==0){t=n.context;this._mask&&n.maskManager.pushMask(this._mask,n);t.globalAlpha=this.worldAlpha;var u=this.worldTransform,f=n.resolution,e=u.tx*f+n.shakeX,o=u.ty*f+n.shakeY;if(t.setTransform(u.a*f,u.b*f,u.c*f,u.d*f,e,o),this.tint!==16777215&&(this.texture.requiresReTint||this.cachedTint!==this.tint)&&(this.tintedTexture=PIXI.CanvasTinter.getTintedTexture(this,this.tint),this.cachedTint=this.tint,this.texture.requiresReTint=!1,this.refreshTexture=!0),this.refreshTexture)if(this.generateTilingTexture(!1,n),this.tilingTexture)this.tilePattern=t.createPattern(this.tilingTexture.baseTexture.source,"repeat");else return;for(s=n.currentBlendMode,this.blendMode!==n.currentBlendMode&&(n.currentBlendMode=this.blendMode,t.globalCompositeOperation=PIXI.blendModesCanvas[n.currentBlendMode]),i=this.tilePosition,r=this.tileScale,i.x%=this.tilingTexture.baseTexture.width,i.y%=this.tilingTexture.baseTexture.height,t.scale(r.x,r.y),t.translate(i.x+this.anchor.x*-this._width,i.y+this.anchor.y*-this._height),t.fillStyle=this.tilePattern,e=-i.x,o=-i.y,c=this._width/r.x,l=this._height/r.y,n.roundPixels&&(e|=0,o|=0,c|=0,l|=0),t.fillRect(e,o,c,l),t.scale(1/r.x,1/r.y),t.translate(-i.x+this.anchor.x*this._width,-i.y+this.anchor.y*this._height),this._mask&&n.maskManager.popMask(n),h=0;h<this.children.length;h++)this.children[h]._renderCanvas(n);s!==this.blendMode&&(n.currentBlendMode=s,t.globalCompositeOperation=PIXI.blendModesCanvas[s])}};n.TileSprite.prototype.onTextureUpdate=function(){};n.TileSprite.prototype.generateTilingTexture=function(t){var f,e,c;if(this.texture.baseTexture.hasLoaded){var u=this.texture,o=u.frame,i=this._frame.sourceSizeW||this._frame.width,r=this._frame.sourceSizeH||this._frame.height,s=0,h=0;this._frame.trimmed&&(s=this._frame.spriteSourceSizeX,h=this._frame.spriteSourceSizeY);t&&(i=n.Math.getNextPowerOfTwo(i),r=n.Math.getNextPowerOfTwo(r));this.canvasBuffer?(this.canvasBuffer.resize(i,r),this.tilingTexture.baseTexture.width=i,this.tilingTexture.baseTexture.height=r,this.tilingTexture.needsUpdate=!0):(this.canvasBuffer=new PIXI.CanvasBuffer(i,r),this.tilingTexture=PIXI.Texture.fromCanvas(this.canvasBuffer.canvas),this.tilingTexture.isTiling=!0,this.tilingTexture.needsUpdate=!0);this.textureDebug&&(this.canvasBuffer.context.strokeStyle="#00ff00",this.canvasBuffer.context.strokeRect(0,0,i,r));f=u.crop.width;e=u.crop.height;(f!==i||e!==r)&&(f=i,e=r);c=this.tintedTexture?this.tintedTexture:u.baseTexture.source;this.canvasBuffer.context.drawImage(c,u.crop.x,u.crop.y,u.crop.width,u.crop.height,s,h,f,e);this.tileScaleOffset.x=o.width/i;this.tileScaleOffset.y=o.height/r;this.refreshTexture=!1;this.tilingTexture.baseTexture._powerOf2=!0}};n.TileSprite.prototype.getBounds=function(){var rt=this._width,ut=this._height,e=rt*(1-this.anchor.x),o=rt*-this.anchor.x,s=ut*(1-this.anchor.y),h=ut*-this.anchor.y,f=this.worldTransform,c=f.a,l=f.b,a=f.c,v=f.d,y=f.tx,p=f.ty,w=c*o+a*h+y,b=v*h+l*o+p,k=c*e+a*h+y,d=v*h+l*e+p,g=c*e+a*s+y,nt=v*s+l*e+p,tt=c*o+a*s+y,it=v*s+l*o+p,i=-Infinity,r=-Infinity,n=Infinity,t=Infinity,u;return n=w<n?w:n,n=k<n?k:n,n=g<n?g:n,n=tt<n?tt:n,t=b<t?b:t,t=d<t?d:t,t=nt<t?nt:t,t=it<t?it:t,i=w>i?w:i,i=k>i?k:i,i=g>i?g:i,i=tt>i?tt:i,r=b>r?b:r,r=d>r?d:r,r=nt>r?nt:r,r=it>r?it:r,u=this._bounds,u.x=n,u.width=i-n,u.y=t,u.height=r-t,this._currentBounds=u,u};Object.defineProperty(n.TileSprite.prototype,"width",{get:function(){return this._width},set:function(n){this._width=n}});Object.defineProperty(n.TileSprite.prototype,"height",{get:function(){return this._height},set:function(n){this._height=n}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.CanvasPool={create:function(t,i,r){var f=n.CanvasPool.getFirst(),u,e;return f===-1?(e={parent:t,canvas:document.createElement("canvas")},n.CanvasPool.pool.push(e),u=e.canvas):(n.CanvasPool.pool[f].parent=t,u=n.CanvasPool.pool[f].canvas),i!==undefined&&(u.width=i,u.height=r),u},getFirst:function(){for(var i=n.CanvasPool.pool,t=0;t<i.length;t++)if(!i[t].parent)return t;return-1},remove:function(t){for(var r=n.CanvasPool.pool,i=0;i<r.length;i++)r[i].parent===t&&(r[i].parent=null,r[i].canvas.width=1,r[i].canvas.height=1)},removeByCanvas:function(t){for(var r=n.CanvasPool.pool,i=0;i<r.length;i++)r[i].canvas===t&&(r[i].parent=null,r[i].canvas.width=1,r[i].canvas.height=1)},getTotal:function(){for(var i=n.CanvasPool.pool,r=0,t=0;t<i.length;t++)i[t].parent&&r++;return r},getFree:function(){for(var i=n.CanvasPool.pool,r=0,t=0;t<i.length;t++)i[t].parent||r++;return r},log:function(){console.log("CanvasPool: %s used, %s free, %s total",n.CanvasPool.getTotal(),n.CanvasPool.getFree(),n.CanvasPool.pool.length)}};n.CanvasPool.pool=[];Object.defineProperty(n.CanvasPool,"length",{get:function(){return this.pool.length}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Device=function(){this.deviceReadyAt=0;this.initialized=!1;this.desktop=!1;this.iOS=!1;this.iOSVersion=0;this.cocoonJS=!1;this.cocoonJSApp=!1;this.cordova=!1;this.node=!1;this.nodeWebkit=!1;this.electron=!1;this.ejecta=!1;this.crosswalk=!1;this.android=!1;this.chromeOS=!1;this.linux=!1;this.macOS=!1;this.windows=!1;this.windowsPhone=!1;this.canvas=!1;this.canvasBitBltShift=null;this.canHandleAlpha=!1;this.canUseMultiply=!1;this.webGL=!1;this.file=!1;this.fileSystem=!1;this.localStorage=!1;this.worker=!1;this.css3D=!1;this.pointerLock=!1;this.typedArray=!1;this.vibration=!1;this.getUserMedia=!0;this.quirksMode=!1;this.touch=!1;this.mspointer=!1;this.wheelEvent=null;this.arora=!1;this.chrome=!1;this.chromeVersion=0;this.epiphany=!1;this.firefox=!1;this.firefoxVersion=0;this.ie=!1;this.ieVersion=0;this.trident=!1;this.tridentVersion=0;this.edge=!1;this.mobileSafari=!1;this.midori=!1;this.opera=!1;this.safari=!1;this.safariVersion=0;this.webApp=!1;this.silk=!1;this.audioData=!1;this.webAudio=!1;this.ogg=!1;this.opus=!1;this.mp3=!1;this.wav=!1;this.m4a=!1;this.webm=!1;this.dolby=!1;this.oggVideo=!1;this.h264Video=!1;this.mp4Video=!1;this.webmVideo=!1;this.vp9Video=!1;this.hlsVideo=!1;this.iPhone=!1;this.iPhone4=!1;this.iPad=!1;this.pixelRatio=0;this.littleEndian=!1;this.LITTLE_ENDIAN=!1;this.support32bit=!1;this.fullscreen=!1;this.requestFullscreen="";this.cancelFullscreen="";this.fullscreenKeyboard=!1};n.Device=new n.Device;n.Device.onInitialized=new n.Signal;n.Device.whenReady=function(n,t,i){var r=this._readyCheck,u,f;this.deviceReadyAt||!r?n.call(t,this):r._monitor||i?(r._queue=r._queue||[],r._queue.push([n,t])):(r._monitor=r.bind(this),r._queue=r._queue||[],r._queue.push([n,t]),u=typeof window.cordova!="undefined",f=navigator.isCocoonJS,document.readyState==="complete"||document.readyState==="interactive"?window.setTimeout(r._monitor,0):u&&!f?document.addEventListener("deviceready",r._monitor,!1):(document.addEventListener("DOMContentLoaded",r._monitor,!1),window.addEventListener("load",r._monitor,!1)))};n.Device._readyCheck=function(){var n=this._readyCheck,t,i,r;if(document.body){if(!this.deviceReadyAt){for(this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",n._monitor),document.removeEventListener("DOMContentLoaded",n._monitor),window.removeEventListener("load",n._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);t=n._queue.shift();)i=t[0],r=t[1],i.call(r,this);this._readyCheck=null;this._initialize=null;this.onInitialized=null}}else window.setTimeout(n._monitor,20)};n.Device._initialize=function(){function i(){var n=navigator.userAgent,i;/Playstation Vita/.test(n)?t.vita=!0:/Kindle/.test(n)||/\bKF[A-Z][A-Z]+/.test(n)||/Silk.*Mobile Safari/.test(n)?t.kindle=!0:/Android/.test(n)?t.android=!0:/CrOS/.test(n)?t.chromeOS=!0:/iP[ao]d|iPhone/i.test(n)?(t.iOS=!0,navigator.appVersion.match(/OS (\d+)/),t.iOSVersion=parseInt(RegExp.$1,10)):/Linux/.test(n)?t.linux=!0:/Mac OS/.test(n)?t.macOS=!0:/Windows/.test(n)&&(t.windows=!0);(/Windows Phone/i.test(n)||/IEMobile/i.test(n))&&(t.android=!1,t.iOS=!1,t.macOS=!1,t.windows=!0,t.windowsPhone=!0);i=/Silk/.test(n);(t.windows||t.macOS||t.linux&&!i||t.chromeOS)&&(t.desktop=!0);(t.windowsPhone||/Windows NT/i.test(n)&&/Touch/i.test(n))&&(t.desktop=!1)}function r(){var f=n.CanvasPool.create(this,6,1),i=f.getContext("2d"),r,u;i.fillStyle="rgba(10, 20, 30, 0.5)";i.fillRect(0,0,1,1);r=i.getImageData(0,0,1,1);r&&(i.putImageData(r,1,0),u=i.getImageData(1,0,1,1),t.canHandleAlpha=u.data[0]===r.data[0]&&u.data[1]===r.data[1]&&u.data[2]===r.data[2]&&u.data[3]===r.data[3]);i.globalCompositeOperation="multiply";t.canUseMultiply=i.globalCompositeOperation==="multiply";n.CanvasPool.removeByCanvas(f);PIXI.CanvasTinter.tintMethod=t.canUseMultiply?PIXI.CanvasTinter.tintWithMultiply:PIXI.CanvasTinter.tintWithPerPixel}function u(){t.canvas=!!window.CanvasRenderingContext2D||t.cocoonJS;try{t.localStorage=!!localStorage.getItem}catch(n){t.localStorage=!1}t.file=!!window.File&&!!window.FileReader&&!!window.FileList&&!!window.Blob;t.fileSystem=!!window.requestFileSystem;t.webGL=!!window.WebGLRenderingContext;t.worker=!!window.Worker;t.pointerLockElement="pointerLockElement"in document&&"pointerLockElement"||"mozPointerLockElement"in document&&"mozPointerLockElement"||"webkitPointerLockElement"in document&&"webkitPointerLockElement";t.pointerlockchange="onpointerlockchange"in document&&"pointerlockchange"||"onmozpointerlockchange"in document&&"mozpointerlockchange"||"onwebkitpointerlockchange"in document&&"webkitpointerlockchange";t.pointerlockerror="onpointerlockerror"in document&&"pointerlockerror"||"onmozpointerlockerror"in document&&"mozpointerlockerror"||"onwebkitpointerlockerror"in document&&"webkitpointerlockerror";t.pointerLock=!!t.pointerLockElement;t.quirksMode=document.compatMode==="CSS1Compat"?!1:!0;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia;window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;t.getUserMedia=t.getUserMedia&&!!navigator.getUserMedia&&!!window.URL;t.firefox&&t.firefoxVersion<21&&(t.getUserMedia=!1);!t.iOS&&(t.ie||t.firefox||t.chrome)&&(t.canvasBitBltShift=!0);(t.safari||t.mobileSafari)&&(t.canvasBitBltShift=!1)}function f(){("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(t.touch=!0);(window.PointerEvent||window.MSPointerEvent||window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(t.mspointer=!0);t.cocoonJS||("onwheel"in window||t.ie&&"WheelEvent"in window?t.wheelEvent="wheel":"onmousewheel"in window?t.wheelEvent="mousewheel":t.firefox&&"MouseScrollEvent"in window&&(t.wheelEvent="DOMMouseScroll"))}function e(){for(var i,r=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],u=document.createElement("div"),n=0;n<r.length;n++)if(u[r[n]]){t.fullscreen=!0;t.requestFullscreen=r[n];break}if(i=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"],t.fullscreen)for(n=0;n<i.length;n++)if(document[i[n]]){t.cancelFullscreen=i[n];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(t.fullscreenKeyboard=!0)}function o(){var n=navigator.userAgent;if(/Arora/.test(n)?t.arora=!0:/Edge\/\d+/.test(n)?t.edge=!0:/Chrome\/(\d+)/.test(n)&&!t.windowsPhone?(t.chrome=!0,t.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(n)?t.epiphany=!0:/Firefox\D+(\d+)/.test(n)?(t.firefox=!0,t.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(n)&&t.iOS?t.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(n)?(t.ie=!0,t.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(n)?t.midori=!0:/Opera/.test(n)?t.opera=!0:/Safari\/(\d+)/.test(n)&&!t.windowsPhone?(t.safari=!0,/Version\/(\d+)\./.test(n)&&(t.safariVersion=parseInt(RegExp.$1,10))):/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(n)&&(t.ie=!0,t.trident=!0,t.tridentVersion=parseInt(RegExp.$1,10),t.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(n)&&(t.silk=!0),navigator.standalone&&(t.webApp=!0),typeof cordova!="undefined"&&(t.cordova=!0),typeof process!="undefined"&&typeof require!="undefined"&&(t.node=!0),t.node&&typeof process.versions=="object"&&(t.nodeWebkit=!!process.versions["node-webkit"],t.electron=!!process.versions.electron),navigator.isCocoonJS&&(t.cocoonJS=!0),t.cocoonJS)try{t.cocoonJSApp=typeof CocoonJS!="undefined"}catch(i){t.cocoonJSApp=!1}typeof ejecta!="undefined"&&(t.ejecta=!0);/Crosswalk/.test(n)&&(t.crosswalk=!0)}function s(){var n=document.createElement("video");try{n.canPlayType&&(n.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(t.oggVideo=!0),n.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(t.h264Video=!0,t.mp4Video=!0),n.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(t.webmVideo=!0),n.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(t.vp9Video=!0),n.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(t.hlsVideo=!0))}catch(i){}}function h(){var n,i,r;t.audioData=!!window.Audio;t.webAudio=!!(window.AudioContext||window.webkitAudioContext);n=document.createElement("audio");try{n.canPlayType&&(n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(t.ogg=!0),(n.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||n.canPlayType("audio/opus;").replace(/^no$/,""))&&(t.opus=!0),n.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(t.mp3=!0),n.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(t.wav=!0),(n.canPlayType("audio/x-m4a;")||n.canPlayType("audio/aac;").replace(/^no$/,""))&&(t.m4a=!0),n.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(t.webm=!0),n.canPlayType('audio/mp4;codecs="ec-3"')!==""&&(t.edge?t.dolby=!0:t.safari&&t.safariVersion>=9&&/Mac OS X (\d+)_(\d+)/.test(navigator.userAgent)&&(i=parseInt(RegExp.$1,10),r=parseInt(RegExp.$2,10),(i===10&&r>=11||i>10)&&(t.dolby=!0))))}catch(u){}}function c(){var t=new ArrayBuffer(4),n=new Uint8Array(t),i=new Uint32Array(t);return(n[0]=161,n[1]=178,n[2]=195,n[3]=212,i[0]===3569595041)?!0:i[0]===2712847316?!1:null}function l(){var i,t,r;return Uint8ClampedArray===undefined?!1:(i=n.CanvasPool.create(this,1,1),t=i.getContext("2d"),!t)?!1:(r=t.createImageData(1,1),n.CanvasPool.remove(this),r.data instanceof Uint8ClampedArray)}function a(){t.pixelRatio=window.devicePixelRatio||1;t.iPhone=navigator.userAgent.toLowerCase().indexOf("iphone")!==-1;t.iPhone4=t.pixelRatio===2&&t.iPhone;t.iPad=navigator.userAgent.toLowerCase().indexOf("ipad")!==-1;t.typedArray=typeof Int8Array!="undefined"?!0:!1;typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined"&&typeof Uint32Array!="undefined"&&(t.littleEndian=c(),t.LITTLE_ENDIAN=t.littleEndian);t.support32bit=typeof ArrayBuffer!="undefined"&&typeof Uint8ClampedArray!="undefined"&&typeof Int32Array!="undefined"&&t.littleEndian!==null&&l();navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;navigator.vibrate&&(t.vibration=!0)}function v(){var n=document.createElement("p"),i,u={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"},r;document.body.insertBefore(n,null);for(r in u)n.style[r]!==undefined&&(n.style[r]="translate3d(1px,1px,1px)",i=window.getComputedStyle(n).getPropertyValue(u[r]));document.body.removeChild(n);t.css3D=i!==undefined&&i.length>0&&i!=="none"}var t=this;i();o();h();s();v();a();u();r();e();f()};n.Device.canPlayAudio=function(n){return n==="mp3"&&this.mp3?!0:n==="ogg"&&(this.ogg||this.opus)||n==="m4a"&&this.m4a||n==="opus"&&this.opus||n==="wav"&&this.wav||n==="webm"&&this.webm||n==="mp4"&&this.dolby?!0:!1};n.Device.canPlayVideo=function(n){return n==="webm"&&(this.webmVideo||this.vp9Video)?!0:n==="mp4"&&(this.mp4Video||this.h264Video)||(n==="ogg"||n==="ogv")&&this.oggVideo||n==="mpeg"&&this.hlsVideo?!0:!1};n.Device.needsTouchUnlock=function(){return!!(!this.cocoonJS&&(this.iOS||this.android)||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock)};n.Device.isAndroidStockBrowser=function(){var n=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return n&&n[1]<537};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Canvas={create:function(t,i,r,u,f){i=i||256;r=r||256;var e=f?document.createElement("canvas"):n.CanvasPool.create(t,i,r);return typeof u=="string"&&u!==""&&(e.id=u),e.width=i,e.height=r,e.style.display="block",e},setBackgroundColor:function(n,t){return t=t||"rgb(0,0,0)",n.style.backgroundColor=t,n},setTouchAction:function(n,t){return t=t||"none",n.style.msTouchAction=t,n.style["ms-touch-action"]=t,n.style["touch-action"]=t,n},setUserSelect:function(n,t){return t=t||"none",n.style["-webkit-touch-callout"]=t,n.style["-webkit-user-select"]=t,n.style["-khtml-user-select"]=t,n.style["-moz-user-select"]=t,n.style["-ms-user-select"]=t,n.style["user-select"]=t,n.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",n},addToDOM:function(n,t,i){var r;return i===undefined&&(i=!0),t&&(typeof t=="string"?r=document.getElementById(t):typeof t=="object"&&t.nodeType===1&&(r=t)),r||(r=document.body),i&&r.style&&(r.style.overflow="hidden"),r.appendChild(n),n},removeFromDOM:function(n){n.parentNode&&n.parentNode.removeChild(n)},setTransform:function(n,t,i,r,u,f,e){return n.setTransform(r,f,e,u,t,i),n},setSmoothingEnabled:function(t,i){var r=n.Canvas.getSmoothingPrefix(t);return r&&(t[r]=i),t},getSmoothingPrefix:function(n){var i=["i","webkitI","msI","mozI","oI"],r,t;for(r in i)if(t=i[r]+"mageSmoothingEnabled",t in n)return t;return null},getSmoothingEnabled:function(t){var i=n.Canvas.getSmoothingPrefix(t);if(i)return t[i]},setImageRenderingCrisp:function(n){for(var i=["-webkit-optimize-contrast","-moz-crisp-edges","crisp-edges","pixelated"],t=0;t<i.length;t++)n.style["image-rendering"]=i[t];return n.style.msInterpolationMode="nearest-neighbor",n},setImageRenderingBicubic:function(n){return n.style["image-rendering"]="auto",n.style.msInterpolationMode="bicubic",n}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.RequestAnimationFrame=function(n,t){var r,i;for(t===undefined&&(t=!1),this.game=n,this.isRunning=!1,this.forceSetTimeOut=t,r=["ms","moz","webkit","o"],i=0;i<r.length&&!window.requestAnimationFrame;i++)window.requestAnimationFrame=window[r[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[r[i]+"CancelAnimationFrame"]||window[r[i]+"CancelRequestAnimationFrame"];this._isSetTimeOut=!1;this._onLoop=null;this._timeOutID=null};n.RequestAnimationFrame.prototype={start:function(){this.isRunning=!0;var n=this;!window.requestAnimationFrame||this.forceSetTimeOut?(this._isSetTimeOut=!0,this._onLoop=function(){return n.updateSetTimeout()},this._timeOutID=window.setTimeout(this._onLoop,0)):(this._isSetTimeOut=!1,this._onLoop=function(t){return n.updateRAF(t)},this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateRAF:function(n){this.isRunning&&(this.game.update(Math.floor(n)),this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateSetTimeout:function(){this.isRunning&&(this.game.update(Date.now()),this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall))},stop:function(){this._isSetTimeOut?clearTimeout(this._timeOutID):window.cancelAnimationFrame(this._timeOutID);this.isRunning=!1},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return this._isSetTimeOut===!1}};n.RequestAnimationFrame.prototype.constructor=n.RequestAnimationFrame;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Math={PI2:Math.PI*2,HALF_PI:Math.PI*.5,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,degToRad:function(t){return t*n.Math.DEG_TO_RAD},radToDeg:function(t){return t*n.Math.RAD_TO_DEG},getNextPowerOfTwo:function(n){if(n>0&&(n&n-1)==0)return n;for(var t=1;t<n;)t<<=1;return t},isPowerOfTwo:function(n,t){return n>0&&(n&n-1)==0&&t>0&&(t&t-1)==0},random:function(n,t){if(n===undefined&&(n=0),t===undefined&&(t=1),n===t)return n;if(n>t){var i=n;n=t;t=i}return Math.random()*(t-n)+n},between:function(n,t){if(n===undefined&&(n=0),t===undefined&&(t=1),n===t)return n;if(n>t){var i=n;n=t;t=i}return n=Math.ceil(n),t=Math.floor(t),Math.floor(Math.random()*(t-n+1))+n},fuzzyEqual:function(n,t,i){return i===undefined&&(i=.0001),Math.abs(n-t)<i},fuzzyLessThan:function(n,t,i){return i===undefined&&(i=.0001),n<t+i},fuzzyGreaterThan:function(n,t,i){return i===undefined&&(i=.0001),n>t-i},fuzzyCeil:function(n,t){return t===undefined&&(t=.0001),Math.ceil(n-t)},fuzzyFloor:function(n,t){return t===undefined&&(t=.0001),Math.floor(n+t)},average:function(){for(var t=0,i=arguments.length,n=0;n<i;n++)t+=+arguments[n];return t/i},shear:function(n){return n%1},snapTo:function(n,t,i){return(i===undefined&&(i=0),t===0)?n:(n-=i,n=t*Math.round(n/t),i+n)},snapToFloor:function(n,t,i){return(i===undefined&&(i=0),t===0)?n:(n-=i,n=t*Math.floor(n/t),i+n)},snapToCeil:function(n,t,i){return(i===undefined&&(i=0),t===0)?n:(n-=i,n=t*Math.ceil(n/t),i+n)},roundTo:function(n,t,i){t===undefined&&(t=0);i===undefined&&(i=10);var r=Math.pow(i,-t);return Math.round(n*r)/r},floorTo:function(n,t,i){t===undefined&&(t=0);i===undefined&&(i=10);var r=Math.pow(i,-t);return Math.floor(n*r)/r},ceilTo:function(n,t,i){t===undefined&&(t=0);i===undefined&&(i=10);var r=Math.pow(i,-t);return Math.ceil(n*r)/r},trunc:function(n){return isFinite(n)?n-n%1||(n<0?-0:n===0?n:0):n},rotateToAngle:function(t,i,r){return(r===undefined&&(r=.05),t===i)?t:(Math.abs(i-t)<=r||Math.abs(i-t)>=n.Math.PI2-r?t=i:(Math.abs(i-t)>Math.PI&&(i<t?i+=n.Math.PI2:i-=n.Math.PI2),i>t?t+=r:i<t&&(t-=r)),t)},getShortestAngle:function(n,t){var i=t-n,r;return i===0?0:(r=Math.floor((i- -180)/360),i-r*360)},angleBetween:function(n,t,i,r){return Math.atan2(r-t,i-n)},angleBetweenY:function(n,t,i,r){return Math.atan2(i-n,r-t)},angleBetweenPoints:function(n,t){return Math.atan2(t.y-n.y,t.x-n.x)},angleBetweenPointsY:function(n,t){return Math.atan2(t.x-n.x,t.y-n.y)},reverseAngle:function(n){return this.normalizeAngle(n+Math.PI,!0)},normalizeAngle:function(n){return n=n%(2*Math.PI),n>=0?n:n+2*Math.PI},maxAdd:function(n,t,i){return Math.min(n+t,i)},minSub:function(n,t,i){return Math.max(n-t,i)},wrap:function(n,t,i){var u=i-t,r;return u<=0?0:(r=(n-t)%u,r<0&&(r+=u),r+t)},wrapValue:function(n,t,i){return n=Math.abs(n),t=Math.abs(t),i=Math.abs(i),(n+t)%i},isOdd:function(n){return!!(n&1)},isEven:function(n){return!(n&1)},min:function(){for(var n=arguments.length===1&&typeof arguments[0]=="object"?arguments[0]:arguments,t=1,i=0,r=n.length;t<r;t++)n[t]<n[i]&&(i=t);return n[i]},max:function(){for(var n=arguments.length===1&&typeof arguments[0]=="object"?arguments[0]:arguments,t=1,i=0,r=n.length;t<r;t++)n[t]>n[i]&&(i=t);return n[i]},minProperty:function(n){for(var t=arguments.length===2&&typeof arguments[1]=="object"?arguments[1]:arguments.slice(1),i=1,r=0,u=t.length;i<u;i++)t[i][n]<t[r][n]&&(r=i);return t[r][n]},maxProperty:function(n){for(var t=arguments.length===2&&typeof arguments[1]=="object"?arguments[1]:arguments.slice(1),i=1,r=0,u=t.length;i<u;i++)t[i][n]>t[r][n]&&(r=i);return t[r][n]},wrapAngle:function(n,t){return t?this.wrap(n,-Math.PI,Math.PI):this.wrap(n,-180,180)},linearInterpolation:function(n,t){var i=n.length-1,r=i*t,u=Math.floor(r);return t<0?this.linear(n[0],n[1],r):t>1?this.linear(n[i],n[i-1],i-r):this.linear(n[u],n[u+1>i?i:u+1],r-u)},bezierInterpolation:function(n,t){for(var u=0,r=n.length-1,i=0;i<=r;i++)u+=Math.pow(1-t,r-i)*Math.pow(t,i)*n[i]*this.bernstein(r,i);return u},catmullRomInterpolation:function(n,t){var i=n.length-1,u=i*t,r=Math.floor(u);return n[0]===n[i]?(t<0&&(r=Math.floor(u=i*(1+t))),this.catmullRom(n[(r-1+i)%i],n[r],n[(r+1)%i],n[(r+2)%i],u-r)):t<0?n[0]-(this.catmullRom(n[0],n[0],n[1],n[1],-u)-n[0]):t>1?n[i]-(this.catmullRom(n[i],n[i],n[i-1],n[i-1],u-i)-n[i]):this.catmullRom(n[r?r-1:0],n[r],n[i<r+1?i:r+1],n[i<r+2?i:r+2],u-r)},linear:function(n,t,i){return(t-n)*i+n},bernstein:function(n,t){return this.factorial(n)/this.factorial(t)/this.factorial(n-t)},factorial:function(n){if(n===0)return 1;for(var t=n;--n;)t*=n;return t},catmullRom:function(n,t,i,r,u){var f=(i-n)*.5,e=(r-t)*.5,o=u*u,s=u*o;return(2*t-2*i+f+e)*s+(-3*t+3*i-2*f-e)*o+f*u+t},difference:function(n,t){return Math.abs(n-t)},roundAwayFromZero:function(n){return n>0?Math.ceil(n):Math.floor(n)},sinCosGenerator:function(n,t,i,r){var u;t===undefined&&(t=1);i===undefined&&(i=1);r===undefined&&(r=1);var f=t,e=i,o=r*Math.PI/n,s=[],h=[];for(u=0;u<n;u++)e-=f*o,f+=e*o,s[u]=e,h[u]=f;return{sin:h,cos:s,length:n}},hypot:function(n,t){return Math.sqrt(n*n+t*t)},distance:function(n,t,i,r){var u=n-i,f=t-r;return Math.sqrt(u*u+f*f)},distanceSq:function(n,t,i,r){var u=n-i,f=t-r;return u*u+f*f},distancePow:function(n,t,i,r,u){return u===undefined&&(u=2),Math.sqrt(Math.pow(i-n,u)+Math.pow(r-t,u))},clamp:function(n,t,i){return n<t?t:i<n?i:n},clampBottom:function(n,t){return n<t?t:n},within:function(n,t,i){return Math.abs(n-t)<=i},mapLinear:function(n,t,i,r,u){return r+(n-t)*(u-r)/(i-t)},smoothstep:function(n,t,i){return n=Math.max(0,Math.min(1,(n-t)/(i-t))),n*n*(3-2*n)},smootherstep:function(n,t,i){return n=Math.max(0,Math.min(1,(n-t)/(i-t))),n*n*n*(n*(n*6-15)+10)},sign:function(n){return n<0?-1:n>0?1:0},percent:function(n,t,i){return i===undefined&&(i=0),n>t||i>t?1:n<i||i>n?0:(n-i)/t}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.RandomDataGenerator=function(n){n===undefined&&(n=[]);this.c=1;this.s0=0;this.s1=0;this.s2=0;typeof n=="string"?this.state(n):this.sow(n)};n.RandomDataGenerator.prototype={rnd:function(){var n=2091639*this.s0+this.c*23283064365386963e-26;return this.c=n|0,this.s0=this.s1,this.s1=this.s2,this.s2=n-this.c,this.s2},sow:function(n){var t,i;if(this.s0=this.hash(" "),this.s1=this.hash(this.s0),this.s2=this.hash(this.s1),this.c=1,n)for(t=0;t<n.length&&n[t]!=null;t++)i=n[t],this.s0-=this.hash(i),this.s0+=~~(this.s0<0),this.s1-=this.hash(i),this.s1+=~~(this.s1<0),this.s2-=this.hash(i),this.s2+=~~(this.s2<0)},hash:function(n){var i,r,t;for(t=4022871197,n=n.toString(),r=0;r<n.length;r++)t+=n.charCodeAt(r),i=.025196032824169379*t,t=i>>>0,i-=t,i*=t,t=i>>>0,i-=t,t+=i*4294967296;return(t>>>0)*23283064365386963e-26},integer:function(){return this.rnd.apply(this)*4294967296},frac:function(){return this.rnd.apply(this)+(this.rnd.apply(this)*2097152|0)*11102230246251565e-32},real:function(){return this.integer()+this.frac()},integerInRange:function(n,t){return Math.floor(this.realInRange(0,t-n+1)+n)},between:function(n,t){return this.integerInRange(n,t)},realInRange:function(n,t){return this.frac()*(t-n)+n},normal:function(){return 1-2*this.frac()},uuid:function(){for(var n="",t="",t=n="";n++<36;t+=~n%5|n*3&4?(n^15?8^this.frac()*(n^20?16:4):4).toString(16):"-");return t},pick:function(n){return n[this.integerInRange(0,n.length-1)]},sign:function(){return this.pick([-1,1])},weightedPick:function(n){return n[~~(Math.pow(this.frac(),2)*(n.length-1)+.5)]},timestamp:function(n,t){return this.realInRange(n||9466848e5,t||1577862e6)},angle:function(){return this.integerInRange(-180,180)},state:function(n){return typeof n=="string"&&n.match(/^!rnd/)&&(n=n.split(","),this.c=parseFloat(n[1]),this.s0=parseFloat(n[2]),this.s1=parseFloat(n[3]),this.s2=parseFloat(n[4])),["!rnd",this.c,this.s0,this.s1,this.s2].join(",")}};n.RandomDataGenerator.prototype.constructor=n.RandomDataGenerator;
/**
 * @author       Timo Hausmann
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2016 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
n.QuadTree=function(n,t,i,r,u,f,e){this.maxObjects=10;this.maxLevels=4;this.level=0;this.bounds={};this.objects=[];this.nodes=[];this._empty=[];this.reset(n,t,i,r,u,f,e)};n.QuadTree.prototype={reset:function(n,t,i,r,u,f,e){this.maxObjects=u||10;this.maxLevels=f||4;this.level=e||0;this.bounds={x:Math.round(n),y:Math.round(t),width:i,height:r,subWidth:Math.floor(i/2),subHeight:Math.floor(r/2),right:Math.round(n)+Math.floor(i/2),bottom:Math.round(t)+Math.floor(r/2)};this.objects.length=0;this.nodes.length=0},populate:function(n){n.forEach(this.populateHandler,this,!0)},populateHandler:function(n){n.body&&n.exists&&this.insert(n.body)},split:function(){this.nodes[0]=new n.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[1]=new n.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[2]=new n.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[3]=new n.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1)},insert:function(n){var i=0,t;if(this.nodes[0]!=null&&(t=this.getIndex(n),t!==-1)){this.nodes[t].insert(n);return}if(this.objects.push(n),this.objects.length>this.maxObjects&&this.level<this.maxLevels)for(this.nodes[0]==null&&this.split();i<this.objects.length;)t=this.getIndex(this.objects[i]),t!==-1?this.nodes[t].insert(this.objects.splice(i,1)[0]):i++},getIndex:function(n){var t=-1;return n.x<this.bounds.right&&n.right<this.bounds.right?n.y<this.bounds.bottom&&n.bottom<this.bounds.bottom?t=1:n.y>this.bounds.bottom&&(t=2):n.x>this.bounds.right&&(n.y<this.bounds.bottom&&n.bottom<this.bounds.bottom?t=0:n.y>this.bounds.bottom&&(t=3)),t},retrieve:function(t){var i,r;if(t instanceof n.Rectangle)i=this.objects,r=this.getIndex(t);else{if(!t.body)return this._empty;i=this.objects;r=this.getIndex(t.body)}return this.nodes[0]&&(r!==-1?i=i.concat(this.nodes[r].retrieve(t)):(i=i.concat(this.nodes[0].retrieve(t)),i=i.concat(this.nodes[1].retrieve(t)),i=i.concat(this.nodes[2].retrieve(t)),i=i.concat(this.nodes[3].retrieve(t)))),i},clear:function(){this.objects.length=0;for(var n=this.nodes.length;n--;)this.nodes[n].clear(),this.nodes.splice(n,1);this.nodes.length=0}};n.QuadTree.prototype.constructor=n.QuadTree;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Net=function(n){this.game=n};n.Net.prototype={getHostName:function(){return window.location&&window.location.hostname?window.location.hostname:null},checkDomainName:function(n){return window.location.hostname.indexOf(n)!==-1},updateQueryString:function(n,t,i,r){var u,f,o,e;if(i===undefined&&(i=!1),(r===undefined||r==="")&&(r=window.location.href),u="",f=new RegExp("([?|&])"+n+"=.*?(&|#|$)(.*)","gi"),f.test(r)?u=typeof t!="undefined"&&t!==null?r.replace(f,"$1"+n+"="+t+"$2$3"):r.replace(f,"$1$3").replace(/(&|\?)$/,""):typeof t!="undefined"&&t!==null?(o=r.indexOf("?")!==-1?"&":"?",e=r.split("#"),r=e[0]+o+n+"="+t,e[1]&&(r+="#"+e[1]),u=r):u=r,i)window.location.href=u;else return u},getQueryString:function(n){var i,r,u,t;n===undefined&&(n="");i={};r=location.search.substring(1).split("&");for(u in r)if(t=r[u].split("="),t.length>1){if(n&&n===this.decodeURI(t[0]))return this.decodeURI(t[1]);i[this.decodeURI(t[0])]=this.decodeURI(t[1])}return i},decodeURI:function(n){return decodeURIComponent(n.replace(/\+/g," "))}};n.Net.prototype.constructor=n.Net;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.TweenManager=function(t){this.game=t;this.frameBased=!1;this._tweens=[];this._add=[];this.easeMap={Power0:n.Easing.Power0,Power1:n.Easing.Power1,Power2:n.Easing.Power2,Power3:n.Easing.Power3,Power4:n.Easing.Power4,Linear:n.Easing.Linear.None,Quad:n.Easing.Quadratic.Out,Cubic:n.Easing.Cubic.Out,Quart:n.Easing.Quartic.Out,Quint:n.Easing.Quintic.Out,Sine:n.Easing.Sinusoidal.Out,Expo:n.Easing.Exponential.Out,Circ:n.Easing.Circular.Out,Elastic:n.Easing.Elastic.Out,Back:n.Easing.Back.Out,Bounce:n.Easing.Bounce.Out,"Quad.easeIn":n.Easing.Quadratic.In,"Cubic.easeIn":n.Easing.Cubic.In,"Quart.easeIn":n.Easing.Quartic.In,"Quint.easeIn":n.Easing.Quintic.In,"Sine.easeIn":n.Easing.Sinusoidal.In,"Expo.easeIn":n.Easing.Exponential.In,"Circ.easeIn":n.Easing.Circular.In,"Elastic.easeIn":n.Easing.Elastic.In,"Back.easeIn":n.Easing.Back.In,"Bounce.easeIn":n.Easing.Bounce.In,"Quad.easeOut":n.Easing.Quadratic.Out,"Cubic.easeOut":n.Easing.Cubic.Out,"Quart.easeOut":n.Easing.Quartic.Out,"Quint.easeOut":n.Easing.Quintic.Out,"Sine.easeOut":n.Easing.Sinusoidal.Out,"Expo.easeOut":n.Easing.Exponential.Out,"Circ.easeOut":n.Easing.Circular.Out,"Elastic.easeOut":n.Easing.Elastic.Out,"Back.easeOut":n.Easing.Back.Out,"Bounce.easeOut":n.Easing.Bounce.Out,"Quad.easeInOut":n.Easing.Quadratic.InOut,"Cubic.easeInOut":n.Easing.Cubic.InOut,"Quart.easeInOut":n.Easing.Quartic.InOut,"Quint.easeInOut":n.Easing.Quintic.InOut,"Sine.easeInOut":n.Easing.Sinusoidal.InOut,"Expo.easeInOut":n.Easing.Exponential.InOut,"Circ.easeInOut":n.Easing.Circular.InOut,"Elastic.easeInOut":n.Easing.Elastic.InOut,"Back.easeInOut":n.Easing.Back.InOut,"Bounce.easeInOut":n.Easing.Bounce.InOut};this.game.onPause.add(this._pauseAll,this);this.game.onResume.add(this._resumeAll,this)};n.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var n=0;n<this._tweens.length;n++)this._tweens[n].pendingDelete=!0;this._add=[]},removeFrom:function(t,i){var r,u;if(i===undefined&&(i=!0),Array.isArray(t))for(r=0,u=t.length;r<u;r++)this.removeFrom(t[r]);else if(t.type===n.GROUP&&i)for(r=0,u=t.children.length;r<u;r++)this.removeFrom(t.children[r]);else{for(r=0,u=this._tweens.length;r<u;r++)t===this._tweens[r].target&&this.remove(this._tweens[r]);for(r=0,u=this._add.length;r<u;r++)t===this._add[r].target&&this.remove(this._add[r])}},add:function(n){n._manager=this;this._add.push(n)},create:function(t){return new n.Tween(t,this.game,this)},remove:function(n){var t=this._tweens.indexOf(n);t!==-1?this._tweens[t].pendingDelete=!0:(t=this._add.indexOf(n),t!==-1&&(this._add[t].pendingDelete=!0))},update:function(){var i=this._add.length,t=this._tweens.length,n;if(t===0&&i===0)return!1;for(n=0;n<t;)this._tweens[n].update(this.game.time.time)?n++:(this._tweens.splice(n,1),t--);return i>0&&(this._tweens=this._tweens.concat(this._add),this._add.length=0),!0},isTweening:function(n,t){return t||(t=!1),this._tweens.some(function(i){return i.target===n&&(!t||i.isRunning&&!i.pendingDelete)})},_pauseAll:function(){for(var n=this._tweens.length-1;n>=0;n--)this._tweens[n]._pause()},_resumeAll:function(){for(var n=this._tweens.length-1;n>=0;n--)this._tweens[n]._resume()},pauseAll:function(){for(var n=this._tweens.length-1;n>=0;n--)this._tweens[n].pause()},resumeAll:function(){for(var n=this._tweens.length-1;n>=0;n--)this._tweens[n].resume(!0)},destroy:function(){this.game.onPause.remove(this._pauseAll,this);this.game.onResume.remove(this._resumeAll,this);this.game=null;this._add=null;this._tweens=null}};n.TweenManager.prototype.constructor=n.TweenManager;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Tween=function(t,i,r){this.game=i;this.target=t;this.manager=r;this.timeline=[];this.reverse=!1;this.timeScale=1;this.repeatCounter=0;this.pendingDelete=!1;this.onStart=new n.Signal;this.onLoop=new n.Signal;this.onRepeat=new n.Signal;this.onChildComplete=new n.Signal;this.onComplete=new n.Signal;this.isRunning=!1;this.current=0;this.properties={};this.chainedTween=null;this.isPaused=!1;this.frameBased=r.frameBased;this._onUpdateCallback=null;this._onUpdateCallbackContext=null;this._pausedTime=0;this._codePaused=!1;this._hasStarted=!1};n.Tween.updateColor=function(t){n.Color.updateColor(t.target)};n.Tween.prototype={to:function(t,i,r,u,f,e,o){return((i===undefined||i<=0)&&(i=1e3),(r===undefined||r===null)&&(r=n.Easing.Default),u===undefined&&(u=!1),f===undefined&&(f=0),e===undefined&&(e=0),o===undefined&&(o=!1),typeof r=="string"&&this.manager.easeMap[r]&&(r=this.manager.easeMap[r]),this.isRunning)?(console.warn("Phaser.Tween.to cannot be called after Tween.start"),this):(this.timeline.push(new n.TweenData(this).to(t,i,r,f,e,o)),u&&this.start(),this)},from:function(t,i,r,u,f,e,o){return(i===undefined&&(i=1e3),(r===undefined||r===null)&&(r=n.Easing.Default),u===undefined&&(u=!1),f===undefined&&(f=0),e===undefined&&(e=0),o===undefined&&(o=!1),typeof r=="string"&&this.manager.easeMap[r]&&(r=this.manager.easeMap[r]),this.isRunning)?(console.warn("Phaser.Tween.from cannot be called after Tween.start"),this):(this.timeline.push(new n.TweenData(this).from(t,i,r,f,e,o)),u&&this.start(),this)},start:function(n){var i,t;if(n===undefined&&(n=0),this.pendingDelete)return console.warn("Phaser.Tween.start cannot be called after Tween.stop"),this;if(this.game===null||this.target===null||this.timeline.length===0||this.isRunning)return this;for(t=0;t<this.timeline.length;t++)for(i in this.timeline[t].vEnd)this.properties[i]=this.target[i]||0,Array.isArray(this.properties[i])||(this.properties[i]*=1);for(t=0;t<this.timeline.length;t++)this.timeline[t].loadValues();return this.manager.add(this),this.isRunning=!0,(n<0||n>this.timeline.length-1)&&(n=0),this.current=n,this.timeline[this.current].start(),this},stop:function(n){return n===undefined&&(n=!1),this.isRunning=!1,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,n&&(this.onComplete.dispatch(this.target,this),this._hasStarted=!1,this.chainedTween&&this.chainedTween.start()),this.manager.remove(this),this},updateTweenData:function(n,t,i){if(this.timeline.length===0)return this;if(i===undefined&&(i=0),i===-1)for(var r=0;r<this.timeline.length;r++)this.timeline[r][n]=t;else this.timeline[i][n]=t;return this},delay:function(n,t){return this.updateTweenData("delay",n,t)},repeat:function(n,t,i){return t===undefined&&(t=0),this.updateTweenData("repeatCounter",n,i),this.updateTweenData("repeatTotal",n,i),this.updateTweenData("repeatDelay",t,i)},repeatDelay:function(n,t){return this.updateTweenData("repeatDelay",n,t)},yoyo:function(n,t,i){return t===undefined&&(t=0),this.updateTweenData("yoyo",n,i),this.updateTweenData("yoyoDelay",t,i)},yoyoDelay:function(n,t){return this.updateTweenData("yoyoDelay",n,t)},easing:function(n,t){return typeof n=="string"&&this.manager.easeMap[n]&&(n=this.manager.easeMap[n]),this.updateTweenData("easingFunction",n,t)},interpolation:function(t,i,r){return i===undefined&&(i=n.Math),this.updateTweenData("interpolationFunction",t,r),this.updateTweenData("interpolationContext",i,r)},repeatAll:function(n){return n===undefined&&(n=0),this.repeatCounter=n,this},chain:function(){for(var n=arguments.length;n--;)n>0?arguments[n-1].chainedTween=arguments[n]:this.chainedTween=arguments[n];return this},loop:function(n){return n===undefined&&(n=!0),this.repeatCounter=n?-1:0,this},onUpdateCallback:function(n,t){return this._onUpdateCallback=n,this._onUpdateCallbackContext=t,this},pause:function(){this.isPaused=!0;this._codePaused=!0;this._pausedTime=this.game.time.time},_pause:function(){this._codePaused||(this.isPaused=!0,this._pausedTime=this.game.time.time)},resume:function(){if(this.isPaused){this.isPaused=!1;this._codePaused=!1;for(var n=0;n<this.timeline.length;n++)this.timeline[n].isRunning||(this.timeline[n].startTime+=this.game.time.time-this._pausedTime)}},_resume:function(){this._codePaused||this.resume()},update:function(t){var i,r;return this.pendingDelete||!this.target?!1:this.isPaused?!0:(i=this.timeline[this.current].update(t),i===n.TweenData.PENDING)?!0:i===n.TweenData.RUNNING?(this._hasStarted||(this.onStart.dispatch(this.target,this),this._hasStarted=!0),this._onUpdateCallback!==null&&this._onUpdateCallback.call(this._onUpdateCallbackContext,this,this.timeline[this.current].value,this.timeline[this.current]),this.isRunning):i===n.TweenData.LOOPED?(this.timeline[this.current].repeatCounter===-1?this.onLoop.dispatch(this.target,this):this.onRepeat.dispatch(this.target,this),!0):i===n.TweenData.COMPLETE?(r=!1,this.reverse?(this.current--,this.current<0&&(this.current=this.timeline.length-1,r=!0)):(this.current++,this.current===this.timeline.length&&(this.current=0,r=!0)),r?this.repeatCounter===-1?(this.timeline[this.current].start(),this.onLoop.dispatch(this.target,this),!0):this.repeatCounter>0?(this.repeatCounter--,this.timeline[this.current].start(),this.onRepeat.dispatch(this.target,this),!0):(this.isRunning=!1,this.onComplete.dispatch(this.target,this),this._hasStarted=!1,this.chainedTween&&this.chainedTween.start(),!1):(this.onChildComplete.dispatch(this.target,this),this.timeline[this.current].start(),!0)):void 0},generateData:function(n,t){var r,i;if(this.game===null||this.target===null)return null;for(n===undefined&&(n=60),t===undefined&&(t=[]),i=0;i<this.timeline.length;i++)for(r in this.timeline[i].vEnd)this.properties[r]=this.target[r]||0,Array.isArray(this.properties[r])||(this.properties[r]*=1);for(i=0;i<this.timeline.length;i++)this.timeline[i].loadValues();for(i=0;i<this.timeline.length;i++)t=t.concat(this.timeline[i].generateData(n));return t}};Object.defineProperty(n.Tween.prototype,"totalDuration",{get:function(){for(var t=0,n=0;n<this.timeline.length;n++)t+=this.timeline[n].duration;return t}});n.Tween.prototype.constructor=n.Tween;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.TweenData=function(t){this.parent=t;this.game=t.game;this.vStart={};this.vStartCache={};this.vEnd={};this.vEndCache={};this.duration=1e3;this.percent=0;this.value=0;this.repeatCounter=0;this.repeatDelay=0;this.repeatTotal=0;this.interpolate=!1;this.yoyo=!1;this.yoyoDelay=0;this.inReverse=!1;this.delay=0;this.dt=0;this.startTime=null;this.easingFunction=n.Easing.Default;this.interpolationFunction=n.Math.linearInterpolation;this.interpolationContext=n.Math;this.isRunning=!1;this.isFrom=!1};n.TweenData.PENDING=0;n.TweenData.RUNNING=1;n.TweenData.LOOPED=2;n.TweenData.COMPLETE=3;n.TweenData.prototype={to:function(n,t,i,r,u,f){return this.vEnd=n,this.duration=t,this.easingFunction=i,this.delay=r,this.repeatTotal=u,this.yoyo=f,this.isFrom=!1,this},from:function(n,t,i,r,u,f){return this.vEnd=n,this.duration=t,this.easingFunction=i,this.delay=r,this.repeatTotal=u,this.yoyo=f,this.isFrom=!0,this},start:function(){if(this.startTime=this.game.time.time+this.delay,this.dt=this.parent.reverse?this.duration:0,this.isRunning=this.delay>0?!1:!0,this.isFrom)for(var n in this.vStartCache)this.vStart[n]=this.vEndCache[n],this.vEnd[n]=this.vStartCache[n],this.parent.target[n]=this.vStart[n];return this.value=0,this.repeatCounter=this.repeatTotal,this},loadValues:function(){for(var n in this.parent.properties){if(this.vStart[n]=this.parent.properties[n],Array.isArray(this.vEnd[n])){if(this.vEnd[n].length===0)continue;this.percent===0&&(this.vEnd[n]=[this.vStart[n]].concat(this.vEnd[n]))}typeof this.vEnd[n]!="undefined"?(typeof this.vEnd[n]=="string"&&(this.vEnd[n]=this.vStart[n]+parseFloat(this.vEnd[n])),this.parent.properties[n]=this.vEnd[n]):this.vEnd[n]=this.vStart[n];this.vStartCache[n]=this.vStart[n];this.vEndCache[n]=this.vEnd[n]}return this},update:function(t){var u,i,f,r;if(this.isRunning){if(t<this.startTime)return n.TweenData.RUNNING}else if(t>=this.startTime)this.isRunning=!0;else return n.TweenData.PENDING;u=this.parent.frameBased?this.game.time.physicsElapsedMS:this.game.time.elapsedMS;this.parent.reverse?(this.dt-=u*this.parent.timeScale,this.dt=Math.max(this.dt,0)):(this.dt+=u*this.parent.timeScale,this.dt=Math.min(this.dt,this.duration));this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);for(i in this.vEnd)f=this.vStart[i],r=this.vEnd[i],this.parent.target[i]=Array.isArray(r)?this.interpolationFunction.call(this.interpolationContext,r,this.value):f+(r-f)*this.value;return!this.parent.reverse&&this.percent===1||this.parent.reverse&&this.percent===0?this.repeat():n.TweenData.RUNNING},generateData:function(n){var u,i,f,r,e;this.dt=this.parent.reverse?this.duration:0;var t=[],o=!1,s=1e3/n;do{this.parent.reverse?(this.dt-=s,this.dt=Math.max(this.dt,0)):(this.dt+=s,this.dt=Math.min(this.dt,this.duration));this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);u={};for(i in this.vEnd)f=this.vStart[i],r=this.vEnd[i],u[i]=Array.isArray(r)?this.interpolationFunction.call(this.interpolationContext,r,this.value):f+(r-f)*this.value;t.push(u);(!this.parent.reverse&&this.percent===1||this.parent.reverse&&this.percent===0)&&(o=!0)}while(!o);return this.yoyo&&(e=t.slice(),e.reverse(),t=t.concat(e)),t},repeat:function(){var t;if(this.yoyo){if(this.inReverse&&this.repeatCounter===0){for(t in this.vStartCache)this.vStart[t]=this.vStartCache[t],this.vEnd[t]=this.vEndCache[t];return this.inReverse=!1,n.TweenData.COMPLETE}this.inReverse=!this.inReverse}else if(this.repeatCounter===0)return n.TweenData.COMPLETE;if(this.inReverse)for(t in this.vStartCache)this.vStart[t]=this.vEndCache[t],this.vEnd[t]=this.vStartCache[t];else{for(t in this.vStartCache)this.vStart[t]=this.vStartCache[t],this.vEnd[t]=this.vEndCache[t];this.repeatCounter>0&&this.repeatCounter--}return this.startTime=this.game.time.time,this.yoyo&&this.inReverse?this.startTime+=this.yoyoDelay:this.inReverse||(this.startTime+=this.repeatDelay),this.dt=this.parent.reverse?this.duration:0,n.TweenData.LOOPED}};n.TweenData.prototype.constructor=n.TweenData;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Easing={Linear:{None:function(n){return n}},Quadratic:{In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}},Cubic:{In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}},Quartic:{In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}},Quintic:{In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}},Sinusoidal:{In:function(n){return n===0?0:n===1?1:1-Math.cos(n*Math.PI/2)},Out:function(n){return n===0?0:n===1?1:Math.sin(n*Math.PI/2)},InOut:function(n){return n===0?0:n===1?1:.5*(1-Math.cos(Math.PI*n))}},Exponential:{In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}},Circular:{In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}},Elastic:{In:function(n){var t,i=.4;return n===0?0:n===1?1:(t=i/4,-(1*Math.pow(2,10*(n-=1))*Math.sin((n-t)*2*Math.PI/i)))},Out:function(n){var t,i=.4;return n===0?0:n===1?1:(t=i/4,1*Math.pow(2,-10*n)*Math.sin((n-t)*2*Math.PI/i)+1)},InOut:function(n){var t,r=1,i=.4;return n===0?0:n===1?1:(t=i/4,(n*=2)<1)?-.5*r*Math.pow(2,10*(n-=1))*Math.sin((n-t)*2*Math.PI/i):r*Math.pow(2,-10*(n-=1))*Math.sin((n-t)*2*Math.PI/i)*.5+1}},Back:{In:function(n){var t=1.70158;return n*n*((t+1)*n-t)},Out:function(n){var t=1.70158;return--n*n*((t+1)*n+t)+1},InOut:function(n){var t=1.70158*1.525;return(n*=2)<1?.5*n*n*((t+1)*n-t):.5*((n-=2)*n*((t+1)*n+t)+2)}},Bounce:{In:function(t){return 1-n.Easing.Bounce.Out(1-t)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(t){return t<.5?n.Easing.Bounce.In(t*2)*.5:n.Easing.Bounce.Out(t*2-1)*.5+.5}}};n.Easing.Default=n.Easing.Linear.None;n.Easing.Power0=n.Easing.Linear.None;n.Easing.Power1=n.Easing.Quadratic.Out;n.Easing.Power2=n.Easing.Cubic.Out;n.Easing.Power3=n.Easing.Quartic.Out;n.Easing.Power4=n.Easing.Quintic.Out;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Time=function(t){this.game=t;this.time=0;this.prevTime=0;this.now=0;this.elapsed=0;this.elapsedMS=0;this.physicsElapsed=1/60;this.physicsElapsedMS=1/60*1e3;this.desiredFpsMult=1/60;this._desiredFps=60;this.suggestedFps=this.desiredFps;this.slowMotion=1;this.advancedTiming=!1;this.frames=0;this.updates=0;this.renders=0;this.fps=0;this.ups=0;this.rps=0;this.fpsMin=1e3;this.fpsMax=0;this.msMin=1e3;this.msMax=0;this.pauseDuration=0;this.timeToCall=0;this.timeExpected=0;this.events=new n.Timer(this.game,!1);this._frameCount=0;this._elapsedAccumulator=0;this._started=0;this._timeLastSecond=0;this._pauseStarted=0;this._justResumed=!1;this._timers=[]};n.Time.prototype={boot:function(){this._started=Date.now();this.time=Date.now();this.events.start();this.timeExpected=this.time},add:function(n){return this._timers.push(n),n},create:function(t){t===undefined&&(t=!0);var i=new n.Timer(this.game,t);return this._timers.push(i),i},removeAll:function(){for(var n=0;n<this._timers.length;n++)this._timers[n].destroy();this._timers=[];this.events.removeAll()},refresh:function(){var n=this.time;this.time=Date.now();this.elapsedMS=this.time-n},update:function(n){var t=this.time;this.time=Date.now();this.elapsedMS=this.time-t;this.prevTime=this.now;this.now=n;this.elapsed=this.now-this.prevTime;this.game.raf._isSetTimeOut&&(this.timeToCall=Math.floor(Math.max(0,1e3/this._desiredFps-(this.timeExpected-n))),this.timeExpected=n+this.timeToCall);this.advancedTiming&&this.updateAdvancedTiming();this.game.paused||(this.events.update(this.time),this._timers.length&&this.updateTimers())},updateTimers:function(){for(var n=0,t=this._timers.length;n<t;)this._timers[n].update(this.time)?n++:(this._timers.splice(n,1),t--)},updateAdvancedTiming:function(){if(this._frameCount++,this._elapsedAccumulator+=this.elapsed,this._frameCount>=this._desiredFps*2&&(this.suggestedFps=Math.floor(200/(this._elapsedAccumulator/this._frameCount))*5,this._frameCount=0,this._elapsedAccumulator=0),this.msMin=Math.min(this.msMin,this.elapsed),this.msMax=Math.max(this.msMax,this.elapsed),this.frames++,this.now>this._timeLastSecond+1e3){var n=this.now-this._timeLastSecond;this.fps=Math.round(this.frames*1e3/n);this.ups=Math.round(this.updates*1e3/n);this.rps=Math.round(this.renders*1e3/n);this.fpsMin=Math.min(this.fpsMin,this.fps);this.fpsMax=Math.max(this.fpsMax,this.fps);this._timeLastSecond=this.now;this.frames=0;this.updates=0;this.renders=0}},countUpdate:function(){this.advancedTiming&&this.updates++},countRender:function(){this.advancedTiming&&this.renders++},gamePaused:function(){this._pauseStarted=Date.now();this.events.pause();for(var n=this._timers.length;n--;)this._timers[n]._pause()},gameResumed:function(){this.time=Date.now();this.pauseDuration=this.time-this._pauseStarted;this.events.resume();for(var n=this._timers.length;n--;)this._timers[n]._resume()},totalElapsedSeconds:function(){return(this.time-this._started)*.001},elapsedSince:function(n){return this.time-n},elapsedSecondsSince:function(n){return(this.time-n)*.001},reset:function(){this._started=this.time;this.removeAll()}};Object.defineProperty(n.Time.prototype,"desiredFps",{get:function(){return this._desiredFps},set:function(n){this._desiredFps=n;this.physicsElapsed=1/n;this.physicsElapsedMS=this.physicsElapsed*1e3;this.desiredFpsMult=1/n}});n.Time.prototype.constructor=n.Time;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Timer=function(t,i){i===undefined&&(i=!0);this.game=t;this.running=!1;this.autoDestroy=i;this.expired=!1;this.elapsed=0;this.events=[];this.onComplete=new n.Signal;this.nextTick=0;this.timeCap=1e3;this.paused=!1;this._codePaused=!1;this._started=0;this._pauseStarted=0;this._pauseTotal=0;this._now=Date.now();this._len=0;this._marked=0;this._i=0;this._diff=0;this._newTick=0};n.Timer.MINUTE=6e4;n.Timer.SECOND=1e3;n.Timer.HALF=500;n.Timer.QUARTER=250;n.Timer.prototype={create:function(t,i,r,u,f,e){var o,s;return t=Math.round(t),o=t,o+=this._now===0?this.game.time.time:this._now,s=new n.TimerEvent(this,t,o,r,i,u,f,e),this.events.push(s),this.order(),this.expired=!1,s},add:function(n,t,i){return this.create(n,!1,0,t,i,Array.prototype.slice.call(arguments,3))},repeat:function(n,t,i,r){return this.create(n,!1,t,i,r,Array.prototype.slice.call(arguments,4))},loop:function(n,t,i){return this.create(n,!0,0,t,i,Array.prototype.slice.call(arguments,3))},start:function(n){if(!this.running){this._started=this.game.time.time+(n||0);this.running=!0;for(var t=0;t<this.events.length;t++)this.events[t].tick=this.events[t].delay+this._started}},stop:function(n){this.running=!1;n===undefined&&(n=!0);n&&(this.events.length=0)},remove:function(n){for(var t=0;t<this.events.length;t++)if(this.events[t]===n)return this.events[t].pendingDelete=!0,!0;return!1},order:function(){this.events.length>0&&(this.events.sort(this.sortHandler),this.nextTick=this.events[0].tick)},sortHandler:function(n,t){return n.tick<t.tick?-1:n.tick>t.tick?1:0},clearPendingEvents:function(){for(this._i=this.events.length;this._i--;)this.events[this._i].pendingDelete&&this.events.splice(this._i,1);this._len=this.events.length;this._i=0},update:function(n){if(this.paused)return!0;if(this.elapsed=n-this._now,this._now=n,this.elapsed>this.timeCap&&this.adjustEvents(n-this.elapsed),this._marked=0,this.clearPendingEvents(),this.running&&this._now>=this.nextTick&&this._len>0){while(this._i<this._len&&this.running){var t=this.events[this._i];if(this._now>=t.tick&&!t.pendingDelete)this._newTick=this._now+t.delay-(this._now-t.tick),this._newTick<0&&(this._newTick=this._now+t.delay),t.loop===!0?(t.tick=this._newTick,t.callback.apply(t.callbackContext,t.args)):t.repeatCount>0?(t.repeatCount--,t.tick=this._newTick,t.callback.apply(t.callbackContext,t.args)):(this._marked++,t.pendingDelete=!0,t.callback.apply(t.callbackContext,t.args)),this._i++;else break}this.events.length>this._marked?this.order():(this.expired=!0,this.onComplete.dispatch(this))}return this.expired&&this.autoDestroy?!1:!0},pause:function(){this.running&&((this._codePaused=!0,this.paused)||(this._pauseStarted=this.game.time.time,this.paused=!0))},_pause:function(){!this.paused&&this.running&&(this._pauseStarted=this.game.time.time,this.paused=!0)},adjustEvents:function(n){for(var i,r,t=0;t<this.events.length;t++)this.events[t].pendingDelete||(i=this.events[t].tick-n,i<0&&(i=0),this.events[t].tick=this._now+i);r=this.nextTick-n;this.nextTick=r<0?this._now:this._now+r},resume:function(){if(this.paused){var n=this.game.time.time;this._pauseTotal+=n-this._now;this._now=n;this.adjustEvents(this._pauseStarted);this.paused=!1;this._codePaused=!1}},_resume:function(){this._codePaused||this.resume()},removeAll:function(){this.onComplete.removeAll();this.events.length=0;this._len=0;this._i=0},destroy:function(){this.onComplete.removeAll();this.running=!1;this.expired=!0;this.events=[];this._len=0;this._i=0}};Object.defineProperty(n.Timer.prototype,"next",{get:function(){return this.nextTick}});Object.defineProperty(n.Timer.prototype,"duration",{get:function(){return this.running&&this.nextTick>this._now?this.nextTick-this._now:0}});Object.defineProperty(n.Timer.prototype,"length",{get:function(){return this.events.length}});Object.defineProperty(n.Timer.prototype,"ms",{get:function(){return this.running?this._now-this._started-this._pauseTotal:0}});Object.defineProperty(n.Timer.prototype,"seconds",{get:function(){return this.running?this.ms*.001:0}});n.Timer.prototype.constructor=n.Timer;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.TimerEvent=function(n,t,i,r,u,f,e,o){this.timer=n;this.delay=t;this.tick=i;this.repeatCount=r-1;this.loop=u;this.callback=f;this.callbackContext=e;this.args=o;this.pendingDelete=!1};n.TimerEvent.prototype.constructor=n.TimerEvent;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.AnimationManager=function(n){this.sprite=n;this.game=n.game;this.currentFrame=null;this.currentAnim=null;this.updateIfVisible=!0;this.isLoaded=!1;this._frameData=null;this._anims={};this._outputFrames=[]};n.AnimationManager.prototype={loadFrameData:function(n,t){if(n===undefined)return!1;if(this.isLoaded)for(var i in this._anims)this._anims[i].updateFrameData(n);return this._frameData=n,t===undefined||t===null?this.frame=0:typeof t=="string"?this.frameName=t:this.frame=t,this.isLoaded=!0,!0},copyFrameData:function(n,t){if(this._frameData=n.clone(),this.isLoaded)for(var i in this._anims)this._anims[i].updateFrameData(this._frameData);return t===undefined||t===null?this.frame=0:typeof t=="string"?this.frameName=t:this.frame=t,this.isLoaded=!0,!0},add:function(t,i,r,u,f){return i=i||[],r=r||60,u===undefined&&(u=!1),f===undefined&&(f=i&&typeof i[0]=="number"?!0:!1),this._outputFrames=[],this._frameData.getFrameIndexes(i,f,this._outputFrames),this._anims[t]=new n.Animation(this.game,this.sprite,t,this._frameData,this._outputFrames,r,u),this.currentAnim=this._anims[t],this.sprite.tilingTexture&&(this.sprite.refreshTexture=!0),this._anims[t]},validateFrames:function(n,t){t===undefined&&(t=!0);for(var i=0;i<n.length;i++)if(t===!0){if(n[i]>this._frameData.total)return!1}else if(this._frameData.checkFrameName(n[i])===!1)return!1;return!0},play:function(n,t,i,r){if(this._anims[n])return this.currentAnim===this._anims[n]?this.currentAnim.isPlaying===!1?(this.currentAnim.paused=!1,this.currentAnim.play(t,i,r)):this.currentAnim:(this.currentAnim&&this.currentAnim.isPlaying&&this.currentAnim.stop(),this.currentAnim=this._anims[n],this.currentAnim.paused=!1,this.currentFrame=this.currentAnim.currentFrame,this.currentAnim.play(t,i,r))},stop:function(n,t){t===undefined&&(t=!1);this.currentAnim&&(typeof n!="string"||n===this.currentAnim.name)&&this.currentAnim.stop(t)},update:function(){return this.updateIfVisible&&!this.sprite.visible?!1:this.currentAnim&&this.currentAnim.update()?(this.currentFrame=this.currentAnim.currentFrame,!0):!1},next:function(n){this.currentAnim&&(this.currentAnim.next(n),this.currentFrame=this.currentAnim.currentFrame)},previous:function(n){this.currentAnim&&(this.currentAnim.previous(n),this.currentFrame=this.currentAnim.currentFrame)},getAnimation:function(n){return typeof n=="string"&&this._anims[n]?this._anims[n]:null},refreshFrame:function(){},destroy:function(){for(var n in this._anims)this._anims.hasOwnProperty(n)&&this._anims[n].destroy();this._anims={};this._outputFrames=[];this._frameData=null;this.currentAnim=null;this.currentFrame=null;this.sprite=null;this.game=null}};n.AnimationManager.prototype.constructor=n.AnimationManager;Object.defineProperty(n.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}});Object.defineProperty(n.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}});Object.defineProperty(n.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(n){this.currentAnim.paused=n}});Object.defineProperty(n.AnimationManager.prototype,"name",{get:function(){return this.currentAnim?this.currentAnim.name:undefined}});Object.defineProperty(n.AnimationManager.prototype,"frame",{get:function(){return this.currentFrame?this.currentFrame.index:undefined},set:function(n){var t;typeof n=="number"&&this._frameData&&(t=this._frameData.getFrame(n))&&(this.currentFrame=t,this.sprite.setFrame(this.currentFrame))}});Object.defineProperty(n.AnimationManager.prototype,"frameName",{get:function(){return this.currentFrame?this.currentFrame.name:undefined},set:function(n){var t;typeof n=="string"&&this._frameData&&(t=this._frameData.getFrameByName(n))?(this.currentFrame=t,this._frameIndex=this.currentFrame.index,this.sprite.setFrame(this.currentFrame)):console.warn("Cannot set frameName: "+n)}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Animation=function(t,i,r,u,f,e,o){o===undefined&&(o=!1);this.game=t;this._parent=i;this._frameData=u;this.name=r;this._frames=[];this._frames=this._frames.concat(f);this.delay=1e3/e;this.loop=o;this.loopCount=0;this.killOnComplete=!1;this.isFinished=!1;this.isPlaying=!1;this.isPaused=!1;this._pauseStartTime=0;this._frameIndex=0;this._frameDiff=0;this._frameSkip=1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.onStart=new n.Signal;this.onUpdate=null;this.onComplete=new n.Signal;this.onLoop=new n.Signal;this.isReversed=!1;this.game.onPause.add(this.onPause,this);this.game.onResume.add(this.onResume,this)};n.Animation.prototype={play:function(n,t,i){typeof n=="number"&&(this.delay=1e3/n);typeof t=="boolean"&&(this.loop=t);typeof i!="undefined"&&(this.killOnComplete=i);this.isPlaying=!0;this.isFinished=!1;this.paused=!1;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+this.delay;this._frameIndex=this.isReversed?this._frames.length-1:0;this.updateCurrentFrame(!1,!0);this._parent.events.onAnimationStart$dispatch(this._parent,this);return this.onStart.dispatch(this._parent,this),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this},restart:function(){this.isPlaying=!0;this.isFinished=!1;this.paused=!1;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+this.delay;this._frameIndex=0;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this._parent.setFrame(this.currentFrame);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;this.onStart.dispatch(this._parent,this)},reverse:function(){return this.reversed=!this.reversed,this},reverseOnce:function(){return this.onComplete.addOnce(this.reverse,this),this.reverse()},setFrame:function(n,t){var r,i,u;if(t===undefined&&(t=!1),typeof n=="string")for(i=0;i<this._frames.length;i++)this._frameData.getFrame(this._frames[i]).name===n&&(r=i);else if(typeof n=="number")if(t)r=n;else for(i=0;i<this._frames.length;i++)this._frames[i]===n&&(r=i);r&&(u=this.isReversed?-1:1,this._frameIndex=r-u,this._timeNextFrame=this.game.time.time,this.update())},stop:function(n,t){if(n===undefined&&(n=!1),t===undefined&&(t=!1),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,n&&(this.currentFrame=this._frameData.getFrame(this._frames[0]),this._parent.setFrame(this.currentFrame)),t){this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this)}},onPause:function(){this.isPlaying&&(this._frameDiff=this._timeNextFrame-this.game.time.time)},onResume:function(){this.isPlaying&&(this._timeNextFrame=this.game.time.time+this._frameDiff)},update:function(){if(this.isPaused)return!1;var n=this.game.time.time,t=n-this._timeNextFrame;if(this.isPlaying&&t>=0){if(this._frameSkip=1,this._frameDiff=t,this._timeLastFrame=n,this._frameDiff>this.delay&&(this._frameSkip=Math.floor(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay),this._timeNextFrame=n+(this.delay-this._frameDiff),this.isReversed?this._frameIndex-=this._frameSkip:this._frameIndex+=this._frameSkip,!this.isReversed&&this._frameIndex>=this._frames.length||this.isReversed&&this._frameIndex<=-1){if(this.loop){this._frameIndex=Math.abs(this._frameIndex)%this._frames.length;this.isReversed&&(this._frameIndex=this._frames.length-1-this._frameIndex);this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.currentFrame&&this._parent.setFrame(this.currentFrame);this.loopCount++;this._parent.events.onAnimationLoop$dispatch(this._parent,this);return this.onLoop.dispatch(this._parent,this),this.onUpdate?(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData):!0}return this.complete(),!1}return this.updateCurrentFrame(!0)}return!1},updateCurrentFrame:function(n,t){if(t===undefined&&(t=!1),!this._frameData)return!1;var i=this.currentFrame.index;return this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(t||i!==this.currentFrame.index)&&this._parent.setFrame(this.currentFrame),this.onUpdate&&n?(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData):!0},next:function(n){n===undefined&&(n=1);var t=this._frameIndex+n;t>=this._frames.length&&(this.loop?t%=this._frames.length:t=this._frames.length-1);t!==this._frameIndex&&(this._frameIndex=t,this.updateCurrentFrame(!0))},previous:function(n){n===undefined&&(n=1);var t=this._frameIndex-n;t<0&&(this.loop?t=this._frames.length+t:t++);t!==this._frameIndex&&(this._frameIndex=t,this.updateCurrentFrame(!0))},updateFrameData:function(n){this._frameData=n;this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){this._frameData&&(this.game.onPause.remove(this.onPause,this),this.game.onResume.remove(this.onResume,this),this.game=null,this._parent=null,this._frames=null,this._frameData=null,this.currentFrame=null,this.isPlaying=!1,this.onStart.dispose(),this.onLoop.dispose(),this.onComplete.dispose(),this.onUpdate&&this.onUpdate.dispose())},complete:function(){this._frameIndex=this._frames.length-1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.updateCurrentFrame(!1);this.isPlaying=!1;this.isFinished=!0;this.paused=!1;this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this);this.killOnComplete&&this._parent.kill()}};n.Animation.prototype.constructor=n.Animation;Object.defineProperty(n.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(n){this.isPaused=n;n?this._pauseStartTime=this.game.time.time:this.isPlaying&&(this._timeNextFrame=this.game.time.time+this.delay)}});Object.defineProperty(n.Animation.prototype,"reversed",{get:function(){return this.isReversed},set:function(n){this.isReversed=n}});Object.defineProperty(n.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}});Object.defineProperty(n.Animation.prototype,"frame",{get:function(){return this.currentFrame!==null?this.currentFrame.index:this._frameIndex},set:function(n){this.currentFrame=this._frameData.getFrame(this._frames[n]);this.currentFrame!==null&&(this._frameIndex=n,this._parent.setFrame(this.currentFrame),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))}});Object.defineProperty(n.Animation.prototype,"speed",{get:function(){return 1e3/this.delay},set:function(n){n>0&&(this.delay=1e3/n)}});Object.defineProperty(n.Animation.prototype,"enableUpdate",{get:function(){return this.onUpdate!==null},set:function(t){t&&this.onUpdate===null?this.onUpdate=new n.Signal:t||this.onUpdate===null||(this.onUpdate.dispose(),this.onUpdate=null)}});n.Animation.generateFrameNames=function(t,i,r,u,f){var s,o,e;if(u===undefined&&(u=""),s=[],o="",i<r)for(e=i;e<=r;e++)o=typeof f=="number"?n.Utils.pad(e.toString(),f,"0",1):e.toString(),o=t+o+u,s.push(o);else for(e=i;e>=r;e--)o=typeof f=="number"?n.Utils.pad(e.toString(),f,"0",1):e.toString(),o=t+o+u,s.push(o);return s};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Frame=function(t,i,r,u,f,e){this.index=t;this.x=i;this.y=r;this.width=u;this.height=f;(this.width===0||this.height===0)&&console.warn('Phaser.Frame: Frame "'+this.name+'" has a width or height of zero');this.name=e;this.centerX=Math.floor(u/2);this.centerY=Math.floor(f/2);this.distance=n.Math.distance(0,0,u,f);this.rotated=!1;this.trimmed=!1;this.sourceSizeW=u;this.sourceSizeH=f;this.spriteSourceSizeX=0;this.spriteSourceSizeY=0;this.spriteSourceSizeW=0;this.spriteSourceSizeH=0;this.right=this.x+this.width;this.bottom=this.y+this.height};n.Frame.prototype={resize:function(t,i){this.width=t;this.height=i;this.centerX=Math.floor(t/2);this.centerY=Math.floor(i/2);this.distance=n.Math.distance(0,0,t,i);this.sourceSizeW=t;this.sourceSizeH=i;this.right=this.x+t;this.bottom=this.y+i},setTrim:function(n,t,i,r,u,f,e){this.trimmed=n;n&&(this.sourceSizeW=t,this.sourceSizeH=i,this.centerX=Math.floor(t/2),this.centerY=Math.floor(i/2),this.spriteSourceSizeX=r,this.spriteSourceSizeY=u,this.spriteSourceSizeW=f,this.spriteSourceSizeH=e)},clone:function(){var i=new n.Frame(this.index,this.x,this.y,this.width,this.height,this.name);for(var t in this)this.hasOwnProperty(t)&&(i[t]=this[t]);return i},getRect:function(t){return t===undefined?t=new n.Rectangle(this.x,this.y,this.width,this.height):t.setTo(this.x,this.y,this.width,this.height),t}};n.Frame.prototype.constructor=n.Frame;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.FrameData=function(){this._frames=[];this._frameNames=[]};n.FrameData.prototype={addFrame:function(n){return n.index=this._frames.length,this._frames.push(n),n.name!==""&&(this._frameNames[n.name]=n.index),n},getFrame:function(n){return n>=this._frames.length&&(n=0),this._frames[n]},getFrameByName:function(n){return typeof this._frameNames[n]=="number"?this._frames[this._frameNames[n]]:null},checkFrameName:function(n){return this._frameNames[n]==null?!1:!0},clone:function(){for(var t,i=new n.FrameData,r=0;r<this._frames.length;r++)i._frames.push(this._frames[r].clone());for(t in this._frameNames)this._frameNames.hasOwnProperty(t)&&(i._frameNames[t]=this._frameNames[t]);return i},getFrameRange:function(n,t,i){i===undefined&&(i=[]);for(var r=n;r<=t;r++)i.push(this._frames[r]);return i},getFrames:function(n,t,i){var r;if(t===undefined&&(t=!0),i===undefined&&(i=[]),n===undefined||n.length===0)for(r=0;r<this._frames.length;r++)i.push(this._frames[r]);else for(r=0;r<n.length;r++)t?i.push(this.getFrame(n[r])):i.push(this.getFrameByName(n[r]));return i},getFrameIndexes:function(n,t,i){var r;if(t===undefined&&(t=!0),i===undefined&&(i=[]),n===undefined||n.length===0)for(r=0;r<this._frames.length;r++)i.push(this._frames[r].index);else for(r=0;r<n.length;r++)t&&this._frames[n[r]]?i.push(this._frames[n[r]].index):this.getFrameByName(n[r])&&i.push(this.getFrameByName(n[r]).index);return i},destroy:function(){this._frames=null;this._frameNames=null}};n.FrameData.prototype.constructor=n.FrameData;Object.defineProperty(n.FrameData.prototype,"total",{get:function(){return this._frames.length}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.AnimationParser={spriteSheet:function(t,i,r,u,f,e,o,s){var v,c,l,w;if(f===undefined&&(f=-1),e===undefined&&(e=0),o===undefined&&(o=0),s===undefined&&(s=0),v=i,typeof i=="string"?v=t.cache.getImage(i):i=v.name,v===null)return null;if(r<=0||u<=0)return console.warn("Phaser.AnimationParser.spriteSheet: '%s' frameWidth (%s) or frameHeight (%s) must be positive",i,r,u),null;if(c=v.width,l=v.height,c===0||l===0)return console.warn("Phaser.AnimationParser.spriteSheet: '%s' width (%s) or height (%s) is zero",i,c,l),null;if(c<r||l<u)return console.warn("Phaser.AnimationParser.spriteSheet: '%s' width (%s) or height (%s) is less than the given frameWidth (%s) or frameHeight (%s)",i,c,l,r,u),null;var d=Math.floor((c-e)/(r+o)),g=Math.floor((l-e)/(u+o)),h=d*g,b=h,p=h-1,y=0,a=p;if(s>h||s<-h)return console.warn("Phaser.AnimationParser.spriteSheet: '%s' skipFrames = %s is larger than the frame total %s",i,s,h),null;if(f>-1&&(h=f,a=h-1),d<1&&console.warn("Phaser.AnimationParser.spriteSheet: image '%s' has width %d, but it should be at least %d (frameWidth=%s, margin=%s, spacing=%s)",i,c,r+e+o,r,e,o),g<1&&console.warn("Phaser.AnimationParser.spriteSheet: image '%s' has height %d, but it should be at least %d (frameHeight=%s, margin=%s, spacing=%s)",i,l,u+e+o,u,e,o),b===0)return console.warn("Phaser.AnimationParser.spriteSheet: '%s' zero frames were produced",i),null;if(s>0?(y=s,h=Math.min(h,b-s),a=y+h-1):s<0&&(a=p+s,h=Math.min(h,b+s),y=a-h+1),y<0)return console.warn("First frame index %s is outside of range [0, %d]",y,p),null;if(a>p)return console.warn("Last frame index %s is outside of range [0, %d]",a,p),null;var nt=new n.FrameData,k=e,tt=e,it=0;for(w=0;w<b;w++){if(w>a)break;w>=y&&nt.addFrame(new n.Frame(it++,k,tt,r,u,""));k+=r+o;k+r>c&&(k=e,tt+=u+o)}return nt},JSONData:function(t,i){var f,u,e,r;if(!i.frames){console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array");console.log(i);return}for(f=new n.FrameData,u=i.frames,r=0;r<u.length;r++)e=f.addFrame(new n.Frame(r,u[r].frame.x,u[r].frame.y,u[r].frame.w,u[r].frame.h,u[r].filename)),u[r].trimmed&&e.setTrim(u[r].trimmed,u[r].sourceSize.w,u[r].sourceSize.h,u[r].spriteSourceSize.x,u[r].spriteSourceSize.y,u[r].spriteSourceSize.w,u[r].spriteSourceSize.h),u[r].rotated&&(e.rotated=!0);return f},JSONDataPyxel:function(t,i){var r;if(["layers","tilewidth","tileheight","tileswide","tileshigh"].forEach(function(n){if(!i[n]){console.warn('Phaser.AnimationParser.JSONDataPyxel: Invalid Pyxel Tilemap JSON given, missing "'+n+'" key.');console.log(i);return}}),i.layers.length!==1){console.warn("Phaser.AnimationParser.JSONDataPyxel: Too many layers, this parser only supports flat Tilemaps.");console.log(i);return}var f=new n.FrameData,o=i.tileheight,s=i.tilewidth,u=i.layers[0].tiles,e;for(r=0;r<u.length;r++)e=f.addFrame(new n.Frame(r,u[r].x,u[r].y,s,o,"frame_"+r)),e.setTrim(!1);return f},JSONDataHash:function(t,i){var r;if(!i.frames){console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object");console.log(i);return}var e=new n.FrameData,u=i.frames,f,o=0;for(r in u)f=e.addFrame(new n.Frame(o,u[r].frame.x,u[r].frame.y,u[r].frame.w,u[r].frame.h,r)),u[r].trimmed&&f.setTrim(u[r].trimmed,u[r].sourceSize.w,u[r].sourceSize.h,u[r].spriteSourceSize.x,u[r].spriteSourceSize.y,u[r].spriteSourceSize.w,u[r].spriteSourceSize.h),u[r].rotated&&(f.rotated=!0),o++;return e},XMLData:function(t,i){var o,s,l,a,r,v,y,h,c,f,e,p,w,u;if(!i.getElementsByTagName("TextureAtlas")){console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag");return}for(o=new n.FrameData,s=i.getElementsByTagName("SubTexture"),u=0;u<s.length;u++)r=s[u].attributes,a=r.name.value,v=parseInt(r.x.value,10),y=parseInt(r.y.value,10),h=parseInt(r.width.value,10),c=parseInt(r.height.value,10),f=null,e=null,r.frameX&&(f=Math.abs(parseInt(r.frameX.value,10)),e=Math.abs(parseInt(r.frameY.value,10)),p=parseInt(r.frameWidth.value,10),w=parseInt(r.frameHeight.value,10)),l=o.addFrame(new n.Frame(u,v,y,h,c,a)),(f!==null||e!==null)&&l.setTrim(!0,h,c,f,e,p,w);return o}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Cache=function(t){this.game=t;this.autoResolveURL=!1;this._cache={canvas:{},image:{},texture:{},sound:{},video:{},text:{},json:{},xml:{},physics:{},tilemap:{},binary:{},bitmapData:{},bitmapFont:{},shader:{},renderTexture:{},compressedTexture:{}};this._urlMap={};this._urlResolver=new Image;this._urlTemp=null;this.onSoundUnlock=new n.Signal;this._cacheMap=[];this._cacheMap[n.Cache.CANVAS]=this._cache.canvas;this._cacheMap[n.Cache.IMAGE]=this._cache.image;this._cacheMap[n.Cache.TEXTURE]=this._cache.texture;this._cacheMap[n.Cache.SOUND]=this._cache.sound;this._cacheMap[n.Cache.TEXT]=this._cache.text;this._cacheMap[n.Cache.PHYSICS]=this._cache.physics;this._cacheMap[n.Cache.TILEMAP]=this._cache.tilemap;this._cacheMap[n.Cache.BINARY]=this._cache.binary;this._cacheMap[n.Cache.BITMAPDATA]=this._cache.bitmapData;this._cacheMap[n.Cache.BITMAPFONT]=this._cache.bitmapFont;this._cacheMap[n.Cache.JSON]=this._cache.json;this._cacheMap[n.Cache.XML]=this._cache.xml;this._cacheMap[n.Cache.VIDEO]=this._cache.video;this._cacheMap[n.Cache.SHADER]=this._cache.shader;this._cacheMap[n.Cache.RENDER_TEXTURE]=this._cache.renderTexture;this._pendingCount=0;this.onReady=new n.Signal;this._addImages()};n.Cache.CANVAS=1;n.Cache.IMAGE=2;n.Cache.TEXTURE=3;n.Cache.SOUND=4;n.Cache.TEXT=5;n.Cache.PHYSICS=6;n.Cache.TILEMAP=7;n.Cache.BINARY=8;n.Cache.BITMAPDATA=9;n.Cache.BITMAPFONT=10;n.Cache.JSON=11;n.Cache.XML=12;n.Cache.VIDEO=13;n.Cache.SHADER=14;n.Cache.RENDER_TEXTURE=15;n.Cache.DEFAULT=null;n.Cache.DEFAULT_KEY="__default";n.Cache.DEFAULT_SRC="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==";n.Cache.MISSING=null;n.Cache.MISSING_KEY="__missing";n.Cache.MISSING_SRC="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==";n.Cache.READY_TIMEOUT=1e3;n.Cache.prototype={addCompressedTextureMetaData:function(t,i,r,u){this.checkImageKey(t)&&this.removeImage(t);var f=r in n.LoaderParser?n.LoaderParser[r](u):u,e={key:t,url:i,data:f,base:new PIXI.BaseTexture(f,null,this.game.resolution),frame:new n.Frame(0,0,0,f.width,f.height,t),frameData:new n.FrameData,fileFormat:r};return e.frameData.addFrame(new n.Frame(0,0,0,f.width,f.height,i)),this._cache.image[t]=e,this._resolveURL(i,e),e},addCanvas:function(n,t,i){i===undefined&&(i=t.getContext("2d"));this._cache.canvas[n]={canvas:t,context:i}},addImage:function(t,i,r){this.checkImageKey(t)&&this.removeImage(t);r.complete===!1&&console.warn('Phaser.Cache.addImage: Image "%s" is not complete',t);var u={key:t,url:i,data:r,base:new PIXI.BaseTexture(r,null,this.game.resolution),frame:new n.Frame(0,0,0,r.width,r.height,t),frameData:new n.FrameData};return u.frameData.addFrame(new n.Frame(0,0,0,r.width,r.height,i)),this._cache.image[t]=u,this._resolveURL(i,u),t==="__default"?n.Cache.DEFAULT=new PIXI.Texture(u.base):t==="__missing"&&(n.Cache.MISSING=new PIXI.Texture(u.base)),u},addImageAsync:function(n,t,i){var u=this,r=new Image;r.onload=function(){i.call(this,u.addImage(n,null,r));u._removePending();r.onload=null};this._addPending();r.src=t},addDefaultImage:function(){this.addImageAsync(n.Cache.DEFAULT_KEY,n.Cache.DEFAULT_SRC,function(t){t.base.skipRender=!0;n.Cache.DEFAULT=new PIXI.Texture(t.base)})},addMissingImage:function(){this.addImageAsync(n.Cache.MISSING_KEY,n.Cache.MISSING_SRC,function(t){n.Cache.MISSING=new PIXI.Texture(t.base)})},addSound:function(n,t,i,r,u){r===undefined&&(r=!0,u=!1);u===undefined&&(r=!1,u=!0);var f=!1;u&&(f=!0);this._cache.sound[n]={url:t,data:i,isDecoding:!1,decoded:f,webAudio:r,audioTag:u,locked:this.game.sound.touchLocked};this._resolveURL(t,this._cache.sound[n])},addText:function(n,t,i){this._cache.text[n]={url:t,data:i};this._resolveURL(t,this._cache.text[n])},addPhysicsData:function(n,t,i,r){this._cache.physics[n]={url:t,data:i,format:r};this._resolveURL(t,this._cache.physics[n])},addTilemap:function(n,t,i,r){this._cache.tilemap[n]={url:t,data:i,format:r};this._resolveURL(t,this._cache.tilemap[n])},addBinary:function(n,t){this._cache.binary[n]=t},addBitmapData:function(t,i,r){return i.key=t,r===undefined&&(r=new n.FrameData,r.addFrame(i.textureFrame)),this._cache.bitmapData[t]={data:i,frameData:r},i},addBitmapFont:function(t,i,r,u,f,e,o){var s={url:i,data:r,font:null,base:new PIXI.BaseTexture(r,null,this.game.resolution)};e===undefined&&(e=0);o===undefined&&(o=0);s.font=f==="json"?n.LoaderParser.jsonBitmapFont(u,s.base,e,o,!1,this.game.resolution):n.LoaderParser.xmlBitmapFont(u,s.base,e,o,!1,this.game.resolution);this._cache.bitmapFont[t]=s;this._resolveURL(i,s)},addBitmapFontFromAtlas:function(t,i,r,u,f,e,o){var h=this.getFrameByName(i,r),s,c;h&&(s={font:null,base:this.getBaseTexture(i),frame:h},e===undefined&&(e=0),o===undefined&&(o=0),f==="json"?(c=this.getJSON(u),s.font=n.LoaderParser.jsonBitmapFont(c,s.base,e,o,h,this.game.resolution)):(c=this.getXML(u),s.font=n.LoaderParser.xmlBitmapFont(c,s.base,e,o,h,this.game.resolution)),this._cache.bitmapFont[t]=s)},addJSON:function(n,t,i){this._cache.json[n]={url:t,data:i};this._resolveURL(t,this._cache.json[n])},addXML:function(n,t,i){this._cache.xml[n]={url:t,data:i};this._resolveURL(t,this._cache.xml[n])},addVideo:function(n,t,i,r){this._cache.video[n]={url:t,data:i,isBlob:r,locked:!0};this._resolveURL(t,this._cache.video[n])},addShader:function(n,t,i){this._cache.shader[n]={url:t,data:i};this._resolveURL(t,this._cache.shader[n])},addRenderTexture:function(t,i){this._cache.renderTexture[t]={texture:i,frame:new n.Frame(0,0,0,i.width,i.height,"","")}},addSpriteSheet:function(t,i,r,u,f,e,o,s,h){e===undefined&&(e=-1);o===undefined&&(o=0);s===undefined&&(s=0);var c={key:t,url:i,data:r,frameWidth:u,frameHeight:f,margin:o,spacing:s,base:new PIXI.BaseTexture(r,null,this.game.resolution),frameData:n.AnimationParser.spriteSheet(this.game,r,u,f,e,o,s,h)};this._cache.image[t]=c;this._resolveURL(i,c)},addTextureAtlas:function(t,i,r,u,f){var e={key:t,url:i,data:r,base:new PIXI.BaseTexture(r,null,this.game.resolution)};e.frameData=f===n.Loader.TEXTURE_ATLAS_XML_STARLING?n.AnimationParser.XMLData(this.game,u,t):f===n.Loader.TEXTURE_ATLAS_JSON_PYXEL?n.AnimationParser.JSONDataPyxel(this.game,u,t):Array.isArray(u.frames)?n.AnimationParser.JSONData(this.game,u,t):n.AnimationParser.JSONDataHash(this.game,u,t);this._cache.image[t]=e;this._resolveURL(i,e)},reloadSound:function(n){var i=this,t=this.getSound(n);t&&(t.data.src=t.url,t.data.addEventListener("canplaythrough",function(){return i.reloadSoundComplete(n)},!1),t.data.load())},reloadSoundComplete:function(n){var t=this.getSound(n);t&&(t.locked=!1,this.onSoundUnlock.dispatch(n))},updateSound:function(n,t,i){var r=this.getSound(n);r&&(r[t]=i)},decodedSound:function(n,t){var i=this.getSound(n);i.data=t;i.decoded=!0;i.isDecoding=!1},isSoundDecoded:function(t){var i=this.getItem(t,n.Cache.SOUND,"isSoundDecoded");if(i)return i.decoded},isSoundReady:function(t){var i=this.getItem(t,n.Cache.SOUND,"isSoundDecoded");if(i)return i.decoded&&!this.game.sound.touchLocked},checkKey:function(n,t){return this._cacheMap[n][t]?!0:!1},checkURL:function(n){return this._urlMap[this._resolveURL(n)]?!0:!1},checkCanvasKey:function(t){return this.checkKey(n.Cache.CANVAS,t)},checkImageKey:function(t){return this.checkKey(n.Cache.IMAGE,t)},checkTextureKey:function(t){return this.checkKey(n.Cache.TEXTURE,t)},checkSoundKey:function(t){return this.checkKey(n.Cache.SOUND,t)},checkTextKey:function(t){return this.checkKey(n.Cache.TEXT,t)},checkPhysicsKey:function(t){return this.checkKey(n.Cache.PHYSICS,t)},checkTilemapKey:function(t){return this.checkKey(n.Cache.TILEMAP,t)},checkBinaryKey:function(t){return this.checkKey(n.Cache.BINARY,t)},checkBitmapDataKey:function(t){return this.checkKey(n.Cache.BITMAPDATA,t)},checkBitmapFontKey:function(t){return this.checkKey(n.Cache.BITMAPFONT,t)},checkJSONKey:function(t){return this.checkKey(n.Cache.JSON,t)},checkXMLKey:function(t){return this.checkKey(n.Cache.XML,t)},checkVideoKey:function(t){return this.checkKey(n.Cache.VIDEO,t)},checkShaderKey:function(t){return this.checkKey(n.Cache.SHADER,t)},checkRenderTextureKey:function(t){return this.checkKey(n.Cache.RENDER_TEXTURE,t)},getItem:function(n,t,i,r){return this.checkKey(t,n)?r===undefined?this._cacheMap[t][n]:this._cacheMap[t][n][r]:(i&&console.warn("Phaser.Cache."+i+': Key "'+n+'" not found in Cache.'),null)},getCanvas:function(t){return this.getItem(t,n.Cache.CANVAS,"getCanvas","canvas")},getImage:function(t,i){(t===undefined||t===null)&&(t="__default");i===undefined&&(i=!1);var r=this.getItem(t,n.Cache.IMAGE,"getImage");return r===null&&(r=this.getItem("__missing",n.Cache.IMAGE,"getImage")),i?r:r.data},getTextureFrame:function(t){return this.getItem(t,n.Cache.TEXTURE,"getTextureFrame","frame")},getSound:function(t){return this.getItem(t,n.Cache.SOUND,"getSound")},getSoundData:function(t){return this.getItem(t,n.Cache.SOUND,"getSoundData","data")},getText:function(t){return this.getItem(t,n.Cache.TEXT,"getText","data")},getPhysicsData:function(t,i,r){var e=this.getItem(t,n.Cache.PHYSICS,"getPhysicsData","data"),u,f;if(e===null||i===undefined||i===null)return e;if(e[i])if(u=e[i],u&&r){for(f in u)if(f=u[f],f.fixtureKey===r)return f;console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+r+" in "+t+'"')}else return u;else console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+t+" / "+i+'"');return null},getTilemapData:function(t){return this.getItem(t,n.Cache.TILEMAP,"getTilemapData")},getBinary:function(t){return this.getItem(t,n.Cache.BINARY,"getBinary")},getBitmapData:function(t){return this.getItem(t,n.Cache.BITMAPDATA,"getBitmapData","data")},getBitmapFont:function(t){return this.getItem(t,n.Cache.BITMAPFONT,"getBitmapFont")},getJSON:function(t,i){var r=this.getItem(t,n.Cache.JSON,"getJSON","data");return r?i?n.Utils.extend(!0,Array.isArray(r)?[]:{},r):r:null},getXML:function(t){return this.getItem(t,n.Cache.XML,"getXML","data")},getVideo:function(t){return this.getItem(t,n.Cache.VIDEO,"getVideo")},getShader:function(t){return this.getItem(t,n.Cache.SHADER,"getShader","data")},getRenderTexture:function(t){return this.getItem(t,n.Cache.RENDER_TEXTURE,"getRenderTexture")},getBaseTexture:function(t,i){return i===undefined&&(i=n.Cache.IMAGE),this.getItem(t,i,"getBaseTexture","base")},getFrame:function(t,i){return i===undefined&&(i=n.Cache.IMAGE),this.getItem(t,i,"getFrame","frame")},getFrameCount:function(n,t){var i=this.getFrameData(n,t);return i?i.total:0},getFrameData:function(t,i){return i===undefined&&(i=n.Cache.IMAGE),this.getItem(t,i,"getFrameData","frameData")},hasFrameData:function(t,i){return i===undefined&&(i=n.Cache.IMAGE),this.getItem(t,i,"","frameData")!==null},updateFrameData:function(t,i,r){r===undefined&&(r=n.Cache.IMAGE);this._cacheMap[r][t]&&(this._cacheMap[r][t].frameData=i)},getFrameByIndex:function(n,t,i){var r=this.getFrameData(n,i);return r?r.getFrame(t):null},getFrameByName:function(n,t,i){var r=this.getFrameData(n,i);return r?r.getFrameByName(t):null},getURL:function(n){var n=this._resolveURL(n);return n?this._urlMap[n]:(console.warn('Phaser.Cache.getUrl: Invalid url: "'+n+'" or Cache.autoResolveURL was false'),null)},getKeys:function(t){var r,i;if(t===undefined&&(t=n.Cache.IMAGE),r=[],this._cacheMap[t])for(i in this._cacheMap[t])i!=="__default"&&i!=="__missing"&&r.push(i);return r},removeCanvas:function(n){delete this._cache.canvas[n]},removeImage:function(n,t){t===undefined&&(t=!0);var i=this.getImage(n,!0);t&&i.base&&i.base.destroy();delete this._cache.image[n]},removeSound:function(n){delete this._cache.sound[n]},removeText:function(n){delete this._cache.text[n]},removePhysics:function(n){delete this._cache.physics[n]},removeTilemap:function(n){delete this._cache.tilemap[n]},removeBinary:function(n){delete this._cache.binary[n]},removeBitmapData:function(n){delete this._cache.bitmapData[n]},removeBitmapFont:function(n){delete this._cache.bitmapFont[n]},removeJSON:function(n){delete this._cache.json[n]},removeXML:function(n){delete this._cache.xml[n]},removeVideo:function(n){delete this._cache.video[n]},removeShader:function(n){delete this._cache.shader[n]},removeRenderTexture:function(n){delete this._cache.renderTexture[n]},removeSpriteSheet:function(n){delete this._cache.spriteSheet[n]},removeTextureAtlas:function(n){delete this._cache.image[n]},clearGLTextures:function(){for(var n in this._cache.image)this._cache.image[n].base._glTextures=[]},_resolveURL:function(n,t){return this.autoResolveURL?(this._urlResolver.src=this.game.load.baseURL+n,this._urlTemp=this._urlResolver.src,this._urlResolver.src="",t&&(this._urlMap[this._urlTemp]=t),this._urlTemp):null},destroy:function(){for(var i,n,t=0;t<this._cacheMap.length;t++){i=this._cacheMap[t];for(n in i)n!=="__default"&&n!=="__missing"&&(this.destroyItem(i[n]),delete i[n])}this._urlMap=null;this._urlResolver=null;this._urlTemp=null},destroyItem:function(n){n.destroy?n.destroy():(n.base&&n.base.destroy&&n.base.destroy(),n.data&&n.data.destroy&&n.data.destroy(),n.frameData&&n.frameData.destroy&&n.frameData.destroy(),n.texture&&n.texture.destroy&&n.texture.destroy(!0))},_addImages:function(){this._pendingCount=0;this.addDefaultImage();this.addMissingImage();var t=this,i=n.Cache.READY_TIMEOUT;n.Cache.READY_TIMEOUT>0?setTimeout(function(){t.isReady||(console.warn("Phaser.Cache: Still waiting for images after %s ms.",i),t._ready())},n.Cache.READY_TIMEOUT):this._ready()},_addPending:function(){this._pendingCount+=1},_removePending:function(){this._pendingCount-=1;this._checkReady()},_checkReady:function(){this.isReady&&this._ready()},_ready:function(){this._pendingCount=0;this.onReady.dispatch(this)}};n.Cache.prototype.constructor=n.Cache;Object.defineProperty(n.Cache.prototype,"isReady",{get:function(){return this._pendingCount<=0}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Loader=function(t){this.game=t;this.cache=t.cache;this.resetLocked=!1;this.isLoading=!1;this.hasLoaded=!1;this.preloadSprite=null;this.crossOrigin=!1;this.baseURL="";this.path="";this.headers={requestedWith:!1,json:"application/json",xml:"application/xml"};this.onLoadStart=new n.Signal;this.onBeforeLoadComplete=new n.Signal;this.onLoadComplete=new n.Signal;this.onPackComplete=new n.Signal;this.onFileStart=new n.Signal;this.onFileComplete=new n.Signal;this.onFileError=new n.Signal;this.enableParallel=!0;this.maxParallelDownloads=4;this._withSyncPointDepth=0;this._fileList=[];this._flightQueue=[];this._processingHead=0;this._fileLoadStarted=!1;this._totalPackCount=0;this._totalFileCount=0;this._loadedPackCount=0;this._loadedFileCount=0};n.Loader.TEXTURE_ATLAS_JSON_ARRAY=0;n.Loader.TEXTURE_ATLAS_JSON_HASH=1;n.Loader.TEXTURE_ATLAS_XML_STARLING=2;n.Loader.PHYSICS_LIME_CORONA_JSON=3;n.Loader.PHYSICS_PHASER_JSON=4;n.Loader.TEXTURE_ATLAS_JSON_PYXEL=5;n.Loader.prototype={setPreloadSprite:function(t,i){i=i||0;this.preloadSprite={sprite:t,direction:i,width:t.width,height:t.height,rect:null};this.preloadSprite.rect=i===0?new n.Rectangle(0,0,1,t.height):new n.Rectangle(0,0,t.width,1);t.crop(this.preloadSprite.rect);t.visible=!0},resize:function(){this.preloadSprite&&this.preloadSprite.height!==this.preloadSprite.sprite.height&&(this.preloadSprite.rect.height=this.preloadSprite.sprite.height)},checkKeyExists:function(n,t){return this.getAssetIndex(n,t)>-1},getAssetIndex:function(n,t){for(var i,u=-1,r=0;r<this._fileList.length;r++)if(i=this._fileList[r],i.type===n&&i.key===t&&(u=r,!i.loaded&&!i.loading))break;return u},getAsset:function(n,t){var i=this.getAssetIndex(n,t);return i>-1?{index:i,file:this._fileList[i]}:!1},reset:function(n,t){(t===undefined&&(t=!1),this.resetLocked)||(n&&(this.preloadSprite=null),this.isLoading=!1,this._processingHead=0,this._fileList.length=0,this._flightQueue.length=0,this._fileLoadStarted=!1,this._totalFileCount=0,this._totalPackCount=0,this._loadedPackCount=0,this._loadedFileCount=0,t&&(this.onLoadStart.removeAll(),this.onLoadComplete.removeAll(),this.onPackComplete.removeAll(),this.onFileStart.removeAll(),this.onFileComplete.removeAll(),this.onFileError.removeAll()))},addToFileList:function(n,t,i,r,u,f){var e,s,o,h;if(u===undefined&&(u=!1),t===undefined||t==="")return console.warn("Phaser.Loader: Invalid or no key given of type "+n),this;if(i===undefined||i===null)if(f)i=t+f;else return console.warn("Phaser.Loader: No URL given for file type: "+n+" key: "+t),this;if(e={type:n,key:t,path:this.path,url:i,syncPoint:this._withSyncPointDepth>0,data:null,loading:!1,loaded:!1,error:!1},r)for(s in r)e[s]=r[s];return o=this.getAssetIndex(n,t),u&&o>-1?(h=this._fileList[o],h.loading||h.loaded?(this._fileList.push(e),this._totalFileCount++):this._fileList[o]=e):o===-1&&(this._fileList.push(e),this._totalFileCount++),this},replaceInFileList:function(n,t,i,r){return this.addToFileList(n,t,i,r,!0)},pack:function(n,t,i,r){var e,u,f;if(t===undefined&&(t=null),i===undefined&&(i=null),r===undefined&&(r=null),!t&&!i)return console.warn("Phaser.Loader.pack - Both url and data are null. One must be set."),this;for(e={type:"packfile",key:n,url:t,path:this.path,syncPoint:!0,data:null,loading:!1,loaded:!1,error:!1,callbackContext:r},i&&(typeof i=="string"&&(i=JSON.parse(i)),e.data=i||{},e.loaded=!0),u=0;u<this._fileList.length+1;u++)if(f=this._fileList[u],!f||!f.loaded&&!f.loading&&f.type!=="packfile"){this._fileList.splice(u,0,e);this._totalPackCount++;break}return this},image:function(n,t,i){return typeof t=="object"?this.texture(n,t,i):this.addToFileList("image",n,t,undefined,i,".png")},imageFromBitmapData:function(n,t,i){return this.image(n,t.canvas.toDataURL("image/png"),i)},imageFromGrid:function(n,t,i,r,u,f){return this.imageFromBitmapData(n,this.game.create.grid(n,t,i,r,u,f,!1))},imageFromTexture:function(n,t,i,r,u){return this.imageFromBitmapData(n,this.game.create.texture(n,t,i,r,u,!1))},texture:function(t,i,r){if(this.game.renderType===n.WEBGL){var f=this.game.renderer.extensions.compression;for(var u in i)if(u.toUpperCase()in f)return this.addToFileList("texture",t,i[u],undefined,r,".pvr")}return i.truecolor&&this.addToFileList("image",t,i.truecolor,undefined,r,".png"),this},images:function(n,t){var i;if(Array.isArray(t))for(i=0;i<n.length;i++)this.image(n[i],t[i]);else for(i=0;i<n.length;i++)this.image(n[i]);return this},text:function(n,t,i){return this.addToFileList("text",n,t,undefined,i,".txt")},json:function(n,t,i){return this.addToFileList("json",n,t,undefined,i,".json")},shader:function(n,t,i){return this.addToFileList("shader",n,t,undefined,i,".frag")},xml:function(n,t,i){return this.addToFileList("xml",n,t,undefined,i,".xml")},script:function(n,t,i,r){return i===undefined&&(i=!1),i!==!1&&r===undefined&&(r=this),this.addToFileList("script",n,t,{syncPoint:!0,callback:i,callbackContext:r},!1,".js")},binary:function(n,t,i,r){return i===undefined&&(i=!1),i!==!1&&r===undefined&&(r=i),this.addToFileList("binary",n,t,{callback:i,callbackContext:r},!1,".bin")},spritesheet:function(n,t,i,r,u,f,e,o){return u===undefined&&(u=-1),f===undefined&&(f=0),e===undefined&&(e=0),o===undefined&&(o=0),this.addToFileList("spritesheet",n,t,{frameWidth:i,frameHeight:r,frameMax:u,margin:f,spacing:e,skipFrames:o},!1,".png")},audio:function(n,t,i){return this.game.sound.noAudio?this:(i===undefined&&(i=!0),typeof t=="string"&&(t=[t]),this.addToFileList("audio",n,t,{buffer:null,autoDecode:i}))},audioSprite:function(n,t,i,r,u){return this.game.sound.noAudio?this:(i===undefined&&(i=null),r===undefined&&(r=null),u===undefined&&(u=!0),this.audio(n,t,u),i?this.json(n+"-audioatlas",i):r?(typeof r=="string"&&(r=JSON.parse(r)),this.cache.addJSON(n+"-audioatlas","",r)):console.warn("Phaser.Loader.audiosprite - You must specify either a jsonURL or provide a jsonData object"),this)},audiosprite:function(n,t,i,r,u){return this.audioSprite(n,t,i,r,u)},video:function(n,t,i,r){return i===undefined&&(i=this.game.device.firefox?"loadeddata":"canplaythrough"),r===undefined&&(r=!1),typeof t=="string"&&(t=[t]),this.addToFileList("video",n,t,{buffer:null,asBlob:r,loadEvent:i})},tilemap:function(t,i,r,u){if(i===undefined&&(i=null),r===undefined&&(r=null),u===undefined&&(u=n.Tilemap.CSV),i||r||(i=u===n.Tilemap.CSV?t+".csv":t+".json"),r){switch(u){case n.Tilemap.TILED_JSON:typeof r=="string"&&(r=JSON.parse(r))}this.cache.addTilemap(t,null,r,u)}else this.addToFileList("tilemap",t,i,{format:u});return this},tilemapCSV:function(t,i,r){return this.tilemap(t,i,r,n.Tilemap.CSV)},tilemapTiledJSON:function(t,i,r){return this.tilemap(t,i,r,n.Tilemap.TILED_JSON)},physics:function(t,i,r,u){return i===undefined&&(i=null),r===undefined&&(r=null),u===undefined&&(u=n.Physics.LIME_CORONA_JSON),i||r||(i=t+".json"),r?(typeof r=="string"&&(r=JSON.parse(r)),this.cache.addPhysicsData(t,null,r,u)):this.addToFileList("physics",t,i,{format:u}),this},bitmapFont:function(n,t,i,r,u,f){if((t===undefined||t===null)&&(t=n+".png"),i===undefined&&(i=null),r===undefined&&(r=null),i===null&&r===null&&(i=n+".xml"),u===undefined&&(u=0),f===undefined&&(f=0),i)this.addToFileList("bitmapfont",n,t,{atlasURL:i,xSpacing:u,ySpacing:f});else if(typeof r=="string"){var e,o;try{e=JSON.parse(r)}catch(s){o=this.parseXml(r)}if(!o&&!e)throw new Error("Phaser.Loader. Invalid Bitmap Font atlas given");this.addToFileList("bitmapfont",n,t,{atlasURL:null,atlasData:e||o,atlasType:e?"json":"xml",xSpacing:u,ySpacing:f})}return this},atlasJSONArray:function(t,i,r,u){return this.atlas(t,i,r,u,n.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(t,i,r,u){return this.atlas(t,i,r,u,n.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(t,i,r,u){return r===undefined&&(r=null),u===undefined&&(u=null),r||u||(r=t+".xml"),this.atlas(t,i,r,u,n.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(t,i,r,u,f){if((i===undefined||i===null)&&(i=t+".png"),r===undefined&&(r=null),u===undefined&&(u=null),f===undefined&&(f=n.Loader.TEXTURE_ATLAS_JSON_ARRAY),r||u||(r=f===n.Loader.TEXTURE_ATLAS_XML_STARLING?t+".xml":t+".json"),r)this.addToFileList("textureatlas",t,i,{atlasURL:r,format:f});else{switch(f){case n.Loader.TEXTURE_ATLAS_JSON_ARRAY:typeof u=="string"&&(u=JSON.parse(u));break;case n.Loader.TEXTURE_ATLAS_XML_STARLING:if(typeof u=="string"){var e=this.parseXml(u);if(!e)throw new Error("Phaser.Loader. Invalid Texture Atlas XML given");u=e}}this.addToFileList("textureatlas",t,i,{atlasURL:null,atlasData:u,format:f})}return this},withSyncPoint:function(n,t){this._withSyncPointDepth++;try{n.call(t||this,this)}finally{this._withSyncPointDepth--}return this},addSyncPoint:function(n,t){var i=this.getAsset(n,t);return i&&(i.file.syncPoint=!0),this},removeFile:function(n,t){var i=this.getAsset(n,t);i&&(i.loaded||i.loading||this._fileList.splice(i.index,1))},removeAll:function(){this._fileList.length=0;this._flightQueue.length=0},start:function(){this.isLoading||(this.hasLoaded=!1,this.isLoading=!0,this.updateProgress(),this.processLoadQueue())},processLoadQueue:function(){var i,r,t,n,u;if(!this.isLoading){console.warn("Phaser.Loader - active loading canceled / reset");this.finishedLoading(!0);return}for(t=0;t<this._flightQueue.length;t++)n=this._flightQueue[t],(n.loaded||n.error)&&(this._flightQueue.splice(t,1),t--,n.loading=!1,n.requestUrl=null,n.requestObject=null,n.error&&this.onFileError.dispatch(n.key,n),n.type!=="packfile"?(this._loadedFileCount++,this.onFileComplete.dispatch(this.progress,n.key,!n.error,this._loadedFileCount,this._totalFileCount)):n.type==="packfile"&&n.error&&(this._loadedPackCount++,this.onPackComplete.dispatch(n.key,!n.error,this._loadedPackCount,this._totalPackCount)));for(i=!1,r=this.enableParallel?Math.max(1,this.maxParallelDownloads):1,t=this._processingHead;t<this._fileList.length;t++)if(n=this._fileList[t],n.type==="packfile"&&!n.error&&n.loaded&&t===this._processingHead&&(this.processPack(n),this._loadedPackCount++,this.onPackComplete.dispatch(n.key,!n.error,this._loadedPackCount,this._totalPackCount)),n.loaded||n.error?t===this._processingHead&&(this._processingHead=t+1):!n.loading&&this._flightQueue.length<r&&(n.type!=="packfile"||n.data?i||(this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this._flightQueue.push(n),n.loading=!0,this.onFileStart.dispatch(this.progress,n.key,n.url),this.loadFile(n)):(this._flightQueue.push(n),n.loading=!0,this.loadFile(n))),!n.loaded&&n.syncPoint&&(i=!0),this._flightQueue.length>=r||i&&this._loadedPackCount===this._totalPackCount)break;this.updateProgress();this._processingHead>=this._fileList.length?this.finishedLoading():this._flightQueue.length||(console.warn("Phaser.Loader - aborting: processing queue empty, loading may have stalled"),u=this,setTimeout(function(){u.finishedLoading(!0)},2e3))},finishedLoading:function(n){this.hasLoaded||(this.hasLoaded=!0,this.isLoading=!1,n||this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this.game.state.loadUpdate(),this.onBeforeLoadComplete.dispatch(),this.reset(),this.onLoadComplete.dispatch(),this.game.state&&this.game.state.loadComplete())},asyncComplete:function(n,t){t===undefined&&(t="");n.loaded=!0;n.error=!!t;t&&(n.errorMessage=t,console.warn("Phaser.Loader - "+n.type+"["+n.key+"]: "+t));this.processLoadQueue()},processPack:function(t){var u=t.data[t.key],r,i;if(!u){console.warn("Phaser.Loader - "+t.key+": pack has data, but not for pack key");return}for(r=0;r<u.length;r++){i=u[r];switch(i.type){case"image":this.image(i.key,i.url,i.overwrite);break;case"text":this.text(i.key,i.url,i.overwrite);break;case"json":this.json(i.key,i.url,i.overwrite);break;case"xml":this.xml(i.key,i.url,i.overwrite);break;case"script":this.script(i.key,i.url,i.callback,t.callbackContext||this);break;case"binary":this.binary(i.key,i.url,i.callback,t.callbackContext||this);break;case"spritesheet":this.spritesheet(i.key,i.url,i.frameWidth,i.frameHeight,i.frameMax,i.margin,i.spacing,i.skipFrames);break;case"video":this.video(i.key,i.urls);break;case"audio":this.audio(i.key,i.urls,i.autoDecode);break;case"audiosprite":this.audiosprite(i.key,i.urls,i.jsonURL,i.jsonData,i.autoDecode);break;case"tilemap":this.tilemap(i.key,i.url,i.data,n.Tilemap[i.format]);break;case"physics":this.physics(i.key,i.url,i.data,n.Loader[i.format]);break;case"bitmapFont":this.bitmapFont(i.key,i.textureURL,i.atlasURL,i.atlasData,i.xSpacing,i.ySpacing);break;case"atlasJSONArray":this.atlasJSONArray(i.key,i.textureURL,i.atlasURL,i.atlasData);break;case"atlasJSONHash":this.atlasJSONHash(i.key,i.textureURL,i.atlasURL,i.atlasData);break;case"atlasXML":this.atlasXML(i.key,i.textureURL,i.atlasURL,i.atlasData);break;case"atlas":this.atlas(i.key,i.textureURL,i.atlasURL,i.atlasData,n.Loader[i.format]);break;case"shader":this.shader(i.key,i.url,i.overwrite)}}},transformUrl:function(n,t){return n?n.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/)?n:this.baseURL+t.path+n:!1},loadFile:function(t){switch(t.type){case"packfile":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.fileComplete);break;case"image":case"spritesheet":case"textureatlas":case"bitmapfont":this.loadImageTag(t);break;case"audio":t.url=this.getAudioURL(t.url);t.url?this.game.sound.usingWebAudio?this.xhrLoad(t,this.transformUrl(t.url,t),"arraybuffer",this.fileComplete):this.game.sound.usingAudioTag&&this.loadAudioTag(t):this.fileError(t,null,"No supported audio URL specified or device does not have audio playback support");break;case"video":t.url=this.getVideoURL(t.url);t.url?t.asBlob?this.xhrLoad(t,this.transformUrl(t.url,t),"blob",this.fileComplete):this.loadVideoTag(t):this.fileError(t,null,"No supported video URL specified or device does not have video playback support");break;case"json":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.jsonLoadComplete);break;case"xml":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.xmlLoadComplete);break;case"tilemap":t.format===n.Tilemap.TILED_JSON?this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.jsonLoadComplete):t.format===n.Tilemap.CSV?this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.csvLoadComplete):this.asyncComplete(t,"invalid Tilemap format: "+t.format);break;case"text":case"script":case"shader":case"physics":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.fileComplete);break;case"texture":t.key.split("_").pop()==="truecolor"?this.loadImageTag(t):this.xhrLoad(t,this.transformUrl(t.url,t),"arraybuffer",this.fileComplete);break;case"binary":this.xhrLoad(t,this.transformUrl(t.url,t),"arraybuffer",this.fileComplete)}},loadImageTag:function(n){var t=this;n.data=new Image;n.data.name=n.key;this.crossOrigin&&(n.data.crossOrigin=this.crossOrigin);n.data.onload=function(){n.data.onload&&(n.data.onload=null,n.data.onerror=null,t.fileComplete(n))};n.data.onerror=function(){n.data.onload&&(n.data.onload=null,n.data.onerror=null,t.fileError(n))};n.data.src=this.transformUrl(n.url,n);!this.game.device.firefox&&n.data.complete&&n.data.width&&n.data.height&&(n.data.onload=null,n.data.onerror=null,this.fileComplete(n))},loadVideoTag:function(t){var r=this,i;t.data=document.createElement("video");t.data.name=t.key;t.data.controls=!1;t.data.autoplay=!1;t.data.playsInline=!0;i=function(){t.data.removeEventListener(t.loadEvent,i,!1);t.data.onerror=null;t.data.canplay=!0;n.GAMES[r.game.id].load.fileComplete(t)};t.data.onerror=function(){t.data.removeEventListener(t.loadEvent,i,!1);t.data.onerror=null;t.data.canplay=!1;r.fileError(t)};t.data.addEventListener(t.loadEvent,i,!1);t.data.src=this.transformUrl(t.url,t);t.data.load()},loadAudioTag:function(n){var i=this,t;this.game.sound.touchLocked?(n.data=new Audio,n.data.name=n.key,n.data.preload="auto",n.data.src=this.transformUrl(n.url,n),this.fileComplete(n)):(n.data=new Audio,n.data.name=n.key,t=function(){n.data.removeEventListener("canplaythrough",t,!1);n.data.onerror=null;i.fileComplete(n)},n.data.onerror=function(){n.data.removeEventListener("canplaythrough",t,!1);n.data.onerror=null;i.fileError(n)},n.data.preload="auto",n.data.src=this.transformUrl(n.url,n),n.data.addEventListener("canplaythrough",t,!1),n.data.load())},xhrLoad:function(n,t,i,r,u){var f=new XMLHttpRequest,e;f.open("GET",t,!0);f.responseType=i;this.headers.requestedWith!==!1&&f.setRequestHeader("X-Requested-With",this.headers.requestedWith);this.headers[n.type]&&f.setRequestHeader("Accept",this.headers[n.type]);u=u||this.fileError;e=this;f.onload=function(){try{return f.readyState===4&&f.status>=400&&f.status<=599?u.call(e,n,f):r.call(e,n,f)}catch(t){e.hasLoaded?window.console&&console.error(t):e.asyncComplete(n,t.message||"Exception")}};f.onerror=function(){try{return u.call(e,n,f)}catch(t){e.hasLoaded?window.console&&console.error(t):e.asyncComplete(n,t.message||"Exception")}};n.requestObject=f;n.requestUrl=t;f.send()},getVideoURL:function(n){for(var t,r,u,i=0;i<n.length;i++)if(t=n[i],t.uri){if(r=t.type,t=t.uri,this.game.device.canPlayVideo(r))return t}else{if(t.indexOf("blob:")===0||t.indexOf("data:")===0)return t;if(t.indexOf("?")>=0&&(t=t.substr(0,t.indexOf("?"))),u=t.substr((Math.max(0,t.lastIndexOf("."))||Infinity)+1),r=u.toLowerCase(),this.game.device.canPlayVideo(r))return n[i]}return null},getAudioURL:function(n){var i,t,r,u;if(this.game.sound.noAudio)return null;for(i=0;i<n.length;i++)if(t=n[i],t.uri){if(r=t.type,t=t.uri,this.game.device.canPlayAudio(r))return t}else{if(t.indexOf("blob:")===0||t.indexOf("data:")===0)return t;if(t.indexOf("?")>=0&&(t=t.substr(0,t.indexOf("?"))),u=t.substr((Math.max(0,t.lastIndexOf("."))||Infinity)+1),r=u.toLowerCase(),this.game.device.canPlayAudio(r))return n[i]}return null},fileError:function(n,t,i){var u=n.requestUrl||this.transformUrl(n.url,n),r="error loading asset from URL "+u;!i&&t&&(i=t.status);i&&(r=r+" ("+i+")");this.asyncComplete(n,r)},fileComplete:function(t,i){var u=!0,f,r;switch(t.type){case"packfile":r=JSON.parse(i.responseText);t.data=r||{};break;case"texture":f=/\.([^.]+)$/.exec(t.url.split("?",1)[0])[1].toLowerCase();t.data!==null?this.cache.addCompressedTextureMetaData(t.key,t.url,f,t.data):this.cache.addCompressedTextureMetaData(t.key,t.url,f,i.response);break;case"image":this.cache.addImage(t.key,t.url,t.data);break;case"spritesheet":this.cache.addSpriteSheet(t.key,t.url,t.data,t.frameWidth,t.frameHeight,t.frameMax,t.margin,t.spacing,t.skipFrames);break;case"textureatlas":if(t.atlasURL==null)this.cache.addTextureAtlas(t.key,t.url,t.data,t.atlasData,t.format);else if(u=!1,t.format===n.Loader.TEXTURE_ATLAS_JSON_ARRAY||t.format===n.Loader.TEXTURE_ATLAS_JSON_HASH||t.format===n.Loader.TEXTURE_ATLAS_JSON_PYXEL)this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.jsonLoadComplete);else if(t.format===n.Loader.TEXTURE_ATLAS_XML_STARLING)this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.xmlLoadComplete);else throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+t.format);break;case"bitmapfont":t.atlasURL?(u=!1,this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",function(n,t){var i;try{i=JSON.parse(t.responseText)}catch(r){}i?(n.atlasType="json",this.jsonLoadComplete(n,t)):(n.atlasType="xml",this.xmlLoadComplete(n,t))})):this.cache.addBitmapFont(t.key,t.url,t.data,t.atlasData,t.atlasType,t.xSpacing,t.ySpacing);break;case"video":if(t.asBlob)try{t.data=i.response}catch(e){throw new Error("Phaser.Loader. Unable to parse video file as Blob: "+t.key);}this.cache.addVideo(t.key,t.url,t.data,t.asBlob);break;case"audio":this.game.sound.usingWebAudio?(t.data=i.response,this.cache.addSound(t.key,t.url,t.data,!0,!1),t.autoDecode&&this.game.sound.decode(t.key)):this.cache.addSound(t.key,t.url,t.data,!1,!0);break;case"text":t.data=i.responseText;this.cache.addText(t.key,t.url,t.data);break;case"shader":t.data=i.responseText;this.cache.addShader(t.key,t.url,t.data);break;case"physics":r=JSON.parse(i.responseText);this.cache.addPhysicsData(t.key,t.url,r,t.format);break;case"script":t.data=document.createElement("script");t.data.language="javascript";t.data.type="text/javascript";t.data.defer=!1;t.data.text=i.responseText;document.head.appendChild(t.data);t.callback&&(t.data=t.callback.call(t.callbackContext,t.key,i.responseText));break;case"binary":t.data=t.callback?t.callback.call(t.callbackContext,t.key,i.response):i.response;this.cache.addBinary(t.key,t.data)}u&&this.asyncComplete(t)},jsonLoadComplete:function(n,t){var i=JSON.parse(t.responseText);n.type==="tilemap"?this.cache.addTilemap(n.key,n.url,i,n.format):n.type==="bitmapfont"?this.cache.addBitmapFont(n.key,n.url,n.data,i,n.atlasType,n.xSpacing,n.ySpacing):n.type==="json"?this.cache.addJSON(n.key,n.url,i):this.cache.addTextureAtlas(n.key,n.url,n.data,i,n.format);this.asyncComplete(n)},csvLoadComplete:function(n,t){var i=t.responseText;this.cache.addTilemap(n.key,n.url,i,n.format);this.asyncComplete(n)},xmlLoadComplete:function(n,t){var u=t.responseText,i=this.parseXml(u),r;if(!i){r=t.responseType||t.contentType;console.warn("Phaser.Loader - "+n.key+": invalid XML ("+r+")");this.asyncComplete(n,"invalid XML");return}n.type==="bitmapfont"?this.cache.addBitmapFont(n.key,n.url,n.data,i,n.atlasType,n.xSpacing,n.ySpacing):n.type==="textureatlas"?this.cache.addTextureAtlas(n.key,n.url,n.data,i,n.format):n.type==="xml"&&this.cache.addXML(n.key,n.url,i);this.asyncComplete(n)},parseXml:function(n){var t,i;try{window.DOMParser?(i=new DOMParser,t=i.parseFromString(n,"text/xml")):(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(n))}catch(r){t=null}return t&&t.documentElement&&!t.getElementsByTagName("parsererror").length?t:null},updateProgress:function(){this.preloadSprite&&(this.preloadSprite.direction===0?this.preloadSprite.rect.width=Math.floor(this.preloadSprite.width/100*this.progress):this.preloadSprite.rect.height=Math.floor(this.preloadSprite.height/100*this.progress),this.preloadSprite.sprite?this.preloadSprite.sprite.updateCrop():this.preloadSprite=null)},totalLoadedFiles:function(){return this._loadedFileCount},totalQueuedFiles:function(){return this._totalFileCount-this._loadedFileCount},totalLoadedPacks:function(){return this._totalPackCount},totalQueuedPacks:function(){return this._totalPackCount-this._loadedPackCount}};Object.defineProperty(n.Loader.prototype,"progressFloat",{get:function(){var t=this._loadedFileCount/this._totalFileCount*100;return n.Math.clamp(t||0,0,100)}});Object.defineProperty(n.Loader.prototype,"progress",{get:function(){return Math.round(this.progressFloat)}});n.Loader.prototype.constructor=n.Loader;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.LoaderParser={bitmapFont:function(n,t,i,r,u,f){return this.xmlBitmapFont(n,t,i,r,u,f)},xmlBitmapFont:function(n,t,i,r,u,f){var o,v,e,c,l;f==null&&(f=1);var h={},a=n.getElementsByTagName("info")[0],p=n.getElementsByTagName("common")[0];h.font=a.getAttribute("face");h.size=parseInt(a.getAttribute("size"),10);h.lineHeight=parseInt(p.getAttribute("lineHeight"),10)+r;h.chars={};var s=n.getElementsByTagName("char"),w=u?u.x:0,b=u?u.y:0;for(o=0;o<s.length;o++)v=parseInt(s[o].getAttribute("id"),10),e=h.chars[v]={x:parseInt(s[o].getAttribute("x"),10),y:parseInt(s[o].getAttribute("y"),10),width:parseInt(s[o].getAttribute("width"),10),height:parseInt(s[o].getAttribute("height"),10),xOffset:parseInt(s[o].getAttribute("xoffset"),10)/f,yOffset:parseInt(s[o].getAttribute("yoffset"),10)/f,xAdvance:(parseInt(s[o].getAttribute("xadvance"),10)+i)/f,kerning:{}},u&&u.trimmed&&(e.x+e.width>u.spriteSourceSizeX+u.spriteSourceSizeW&&(e.width-=e.x+e.width-u.spriteSourceSizeX-u.spriteSourceSizeW),e.y+e.height>u.spriteSourceSizeY+u.spriteSourceSizeH&&(e.height-=e.y+e.height-u.spriteSourceSizeY-u.spriteSourceSizeH),e.x<u.spriteSourceSizeX&&(c=u.spriteSourceSizeX-e.x,e.x=0,e.width-=c,e.xOffset+=c),e.y<u.spriteSourceSizeY&&(c=u.spriteSourceSizeY-e.y,e.y=0,e.height-=c,e.yOffset+=c)),e.x+=w,e.y+=b;for(l=n.getElementsByTagName("kerning"),o=0;o<l.length;o++){var k=parseInt(l[o].getAttribute("first"),10),y=parseInt(l[o].getAttribute("second"),10),d=parseInt(l[o].getAttribute("amount"),10)/f;h.chars[y]&&(h.chars[y].kerning[k]=d)}return this.finalizeBitmapFont(t,h)},jsonBitmapFont:function(n,t,i,r,u,f){f==null&&(f=1);var e={font:n.font.info._face,size:parseInt(n.font.info._size,10),lineHeight:parseInt(n.font.common._lineHeight,10)+r,chars:{}},o=u?u.x:0,s=u?u.y:0;return n.font.chars.char.forEach(function(n){var h=parseInt(n._id,10),t=e.chars[h]={x:parseInt(n._x,10),y:parseInt(n._y,10),width:parseInt(n._width,10),height:parseInt(n._height,10),xOffset:parseInt(n._xoffset,10)/f,yOffset:parseInt(n._yoffset,10)/f,xAdvance:(parseInt(n._xadvance,10)+i)/f,kerning:{}},r;u&&u.trimmed&&(t.x+t.width>u.spriteSourceSizeX+u.spriteSourceSizeW&&(t.width-=t.x+t.width-u.spriteSourceSizeX-u.spriteSourceSizeW),t.y+t.height>u.spriteSourceSizeY+u.spriteSourceSizeH&&(t.height-=t.y+t.height-u.spriteSourceSizeY-u.spriteSourceSizeH),t.x<u.spriteSourceSizeX&&(r=u.spriteSourceSizeX-t.x,t.x=0,t.width-=r,t.xOffset+=r),t.y<u.spriteSourceSizeY&&(r=u.spriteSourceSizeY-t.y,t.y=0,t.height-=r,t.yOffset+=r));t.x+=o;t.y+=s}),n.font.kernings&&n.font.kernings.kerning&&n.font.kernings.kerning.forEach(function(n){e.chars[n._second]&&(e.chars[n._second].kerning[n._first]=parseInt(n._amount,10)/f)}),this.finalizeBitmapFont(t,e)},finalizeBitmapFont:function(t,i){return Object.keys(i.chars).forEach(function(r){var u=i.chars[r];u.texture=new PIXI.Texture(t,new n.Rectangle(u.x,u.y,u.width,u.height))}),i},pvr:function(n){var t=new Uint32Array(n.slice(0,52)),f=new Uint8Array(n),e=null,r=t[3]<<32|t[2],u,i=0;if(t[0]===55727696&&[0,1,2,3,6,7,9,11].indexOf(r)>=0){r>=0&&r<=3?u="PVRTC":r>=7&&r<=11?u="S3TC":r===6&&(u="ETC1");switch(r){case 0:i=35841;break;case 1:i=35843;break;case 2:i=35840;break;case 3:i=35842;break;case 6:i=36196;break;case 7:i=33777;break;case 9:i=33778;break;case 11:i=33779;break;default:i=-1}e={complete:!0,fileFormat:"PVR",compressionAlgorithm:u,flags:t[1],pixelFormat:r,colorSpace:t[4],channelType:t[5],height:t[6],width:t[7],depth:t[8],numberOfSurfaces:t[9],numberOfFaces:t[10],numberOfMipmaps:t[11],metaDataSize:t[12],textureData:f.subarray(52+t[12],f.byteLength),glExtensionFormat:i}}return e},dds:function(n){var r=new Uint8Array(n),t=new Uint32Array(n),i=null;return r[0]===68&&r[1]===68&&r[2]===83&&r[3]===32&&(i={complete:!0,fileFormat:"DDS",compressionAlgorithm:"S3TC",size:t[1],flags:t[2],height:t[3],width:t[4],pitch:t[5],depth:t[6],mipmapCount:t[7],formatSize:t[19],formatFlag:t[19],formatFourCC:[String.fromCharCode(r[84]),String.fromCharCode(r[85]),String.fromCharCode(r[86]),String.fromCharCode(r[87])].join(""),formatBitCount:t[21],formatRBitMask:t[22],formatGBitMask:t[23],formatBBitMask:t[24],formatABitMask:t[25],caps1:t[26],caps2:t[27],caps3:t[28],caps4:t[29],reserved2:t[30],DXGIFormat:null,resourceDimension:null,miscFlag:null,arraySize:null,textureData:r.subarray(t[1]+4,r.byteLength)},i.formatFourCC==="DX10"?(i.DXGIFormat=t[31],i.resourceDimension=t[32],i.miscFlag=t[33],i.arraySize=t[34],i.miscFlag=t[35]):i.formatFourCC==="DXT5"?i.glExtensionFormat=33779:i.formatFourCC==="DXT3"&&(i.glExtensionFormat=33778)),i},ktx:function(n){var i=new Uint8Array(n),t=new Uint32Array(n),u=null,f=16+t[15]/4|0,e=t[f],o=t[7],r=0;if(i[0]===171&&i[1]===75&&i[2]===84&&i[3]===88&&i[4]===32&&i[5]===49&&i[6]===49&&i[7]===187&&i[8]===13&&i[9]===10&&i[10]===26&&i[11]===10&&[36196,35840,35841,35842,35843,33776,33777,33778,33779].indexOf(o)>=0){switch(o){case 36196:r="ETC1";break;case 35840:case 35841:case 35842:case 35843:r="PVRTC";break;case 33776:case 33777:case 33778:case 33779:r="S3TC"}u={complete:!0,fileFormat:"KTX",compressionAlgorithm:r,endianness:t[3],glType:t[4],glTypeSize:t[5],glFormat:t[6],glInternalFormat:t[7],glBaseInternalFormat:t[8],width:t[9],height:t[10],pixelDepth:t[11],numberOfArrayElements:t[12],numberOfFaces:t[13],numberOfMipmapLevels:t[14],bytesOfKeyValueData:t[15],keyAndValueByteSize:t[16],imageSize:e,textureData:i.subarray((f+1)*4,e+100)}}return u},pkm:function(n){var t=new Uint8Array(n),i=null;return t[0]===80&&t[1]===75&&t[2]===77&&t[3]===32&&(i={complete:!0,fileFormat:"PKM",compressionAlgorithm:"ETC1",format:(t[6]<<8|t[7])&65535,width:(t[8]<<8|t[9])&65535,height:(t[10]<<8|t[11])&65535,originalWidth:(t[12]<<8|t[13])&65535,originalHeight:(t[14]<<8|t[15])&65535,textureData:t.subarray(16,t.length)}),i}};
/**
 * @author       Jeremy Dowell <jeremy@codevinsky.com>
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2016 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
n.AudioSprite=function(n,t){var r,i,u;this.game=n;this.key=t;this.config=this.game.cache.getJSON(t+"-audioatlas");this.autoplayKey=null;this.autoplay=!1;this.sounds={};for(r in this.config.spritemap)i=this.config.spritemap[r],u=this.game.add.sound(this.key),u.addMarker(r,i.start,i.end-i.start,null,i.loop),this.sounds[r]=u;this.config.autoplay&&(this.autoplayKey=this.config.autoplay,this.play(this.autoplayKey),this.autoplay=this.sounds[this.autoplayKey])};n.AudioSprite.prototype={play:function(n,t){return t===undefined&&(t=1),this.sounds[n].play(n,null,t)},stop:function(n){if(n)this.sounds[n].stop();else for(var t in this.sounds)this.sounds[t].stop()},get:function(n){return this.sounds[n]}};n.AudioSprite.prototype.constructor=n.AudioSprite;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Sound=function(t,i,r,u,f){r===undefined&&(r=1);u===undefined&&(u=!1);f===undefined&&(f=t.sound.connectToMaster);this.game=t;this.name=i;this.key=i;this.loop=u;this.markers={};this.context=null;this.autoplay=!1;this.totalDuration=0;this.startTime=0;this.currentTime=0;this.duration=0;this.durationMS=0;this.position=0;this.stopTime=0;this.paused=!1;this.pausedPosition=0;this.pausedTime=0;this.isPlaying=!1;this.currentMarker="";this.fadeTween=null;this.pendingPlayback=!1;this.override=!1;this.allowMultiple=!1;this.playOnce=!1;this.usingWebAudio=this.game.sound.usingWebAudio;this.usingAudioTag=this.game.sound.usingAudioTag;this.externalNode=null;this.masterGainNode=null;this.gainNode=null;this._sound=null;this._globalVolume=1;this._markedToDelete=!1;this._pendingStart=!1;this._removeFromSoundManager=!1;this._sourceId=0;this.usingWebAudio?(this.context=this.game.sound.context,this.masterGainNode=this.game.sound.masterGain,this.gainNode=this.context.createGain===undefined?this.context.createGainNode():this.context.createGain(),this.gainNode.gain.value=r,f&&this.gainNode.connect(this.masterGainNode)):this.usingAudioTag&&(this.game.cache.getSound(i)&&this.game.cache.isSoundReady(i)?(this._sound=this.game.cache.getSoundData(i),this.totalDuration=0,this._sound.duration&&(this.totalDuration=this._sound.duration)):this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this));this.onDecoded=new n.Signal;this.onPlay=new n.Signal;this.onPause=new n.Signal;this.onResume=new n.Signal;this.onLoop=new n.Signal;this.onStop=new n.Signal;this.onMute=new n.Signal;this.onMarkerComplete=new n.Signal;this.onFadeComplete=new n.Signal;this._volume=r;this._buffer=null;this._muted=!1;this._tempMarker=0;this._tempPosition=0;this._tempVolume=0;this._tempPause=0;this._muteVolume=0;this._tempLoop=0;this._paused=!1;this._onDecodedEventDispatched=!1};n.Sound.prototype={soundHasUnlocked:function(n){n===this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this._sound.duration)},addMarker:function(n,t,i,r,u){(i===undefined||i===null)&&(i=1);(r===undefined||r===null)&&(r=1);u===undefined&&(u=!1);this.markers[n]={name:n,start:t,stop:t+i,volume:r,duration:i,durationMS:i*1e3,loop:u}},removeMarker:function(n){delete this.markers[n]},onEndedHandler:function(){this._removeOnEndedHandler();this.isPlaying=!1;this.currentTime=this.durationMS;this.stop();this.playOnce&&(this._markedToDelete=!0,this._removeFromSoundManager=!0);this._markedToDelete&&(this._disconnectSource(),this._removeFromSoundManager?this.game.sound.remove(this):(this.markers={},this.context=null,this._buffer=null,this.externalNode=null,this.onDecoded.dispose(),this.onPlay.dispose(),this.onPause.dispose(),this.onResume.dispose(),this.onLoop.dispose(),this.onStop.dispose(),this.onMute.dispose(),this.onMarkerComplete.dispose()))},update:function(){var n,t;if(!this.game.cache.checkSoundKey(this.key)){this.destroy();return}if(this.isDecoded&&!this._onDecodedEventDispatched&&(this.onDecoded.dispatch(this),this._onDecodedEventDispatched=!0),this.pendingPlayback&&this.game.cache.isSoundReady(this.key)&&(this.pendingPlayback=!1,this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)),n=this.game.time.time,this.isPlaying){if(this._pendingStart)if(t=this._sound.currentTime,t>((this.paused?this._tempPause:0)||this.position||0))this._pendingStart=!1,this.startTime=n-1e3*t,this.stopTime=this.startTime+this.durationMS;else return;this.currentTime=n-this.startTime;this.currentTime>=this.durationMS&&(this.usingWebAudio?this.loop?(this.onLoop.dispatch(this),this.isPlaying=!1,this.currentMarker===""?(this.currentTime=0,this.startTime=n,this.isPlaying=!0):(this.onMarkerComplete.dispatch(this.currentMarker,this),this.play(this.currentMarker,0,this.volume,!0,!0,!1))):this.currentMarker!==""&&this.stop():this.loop?(this.onLoop.dispatch(this),this.currentMarker===""&&(this.currentTime=0,this.startTime=n),this.isPlaying=!1,this.play(this.currentMarker,0,this.volume,!0,!0,!1)):this.stop())}},loopFull:function(n){return this.play(null,0,n,!0)},play:function(n,t,i,r,u,f){if(((n===undefined||n===!1||n===null)&&(n=""),u===undefined&&(u=!0),f===undefined&&(f=!0),this.isPlaying&&!this.allowMultiple&&!u&&!this.override)||(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||u)&&(this.usingWebAudio?this._stopSourceAndDisconnect():this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0),this.isPlaying=!1),n===""&&Object.keys(this.markers).length>0))return this;if(n!=="")if(this.markers[n])this.currentMarker=n,this.position=this.markers[n].start,this.volume=this.markers[n].volume,this.loop=this.markers[n].loop,this.duration=this.markers[n].duration,this.durationMS=this.markers[n].durationMS,typeof i!="undefined"&&(this.volume=i),typeof r!="undefined"&&(this.loop=r),this._tempMarker=n,this._tempPosition=this.position,this._tempVolume=this.volume,this._tempLoop=this.loop;else return console.warn("Phaser.Sound.play: audio marker "+n+" doesn't exist"),this;else t=t||0,i===undefined&&(i=this._volume),r===undefined&&(r=this.loop),this.position=Math.max(0,t),this.volume=i,this.loop=r,this.duration=0,this.durationMS=0,this._tempMarker=n,this._tempPosition=t,this._tempVolume=i,this._tempLoop=r;return this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(this._createSourceAndConnect(),this.loop&&n===""&&(this._sound.loop=!0),this.loop||n!==""||this._addOnEndedHandler(),this.totalDuration=this._sound.buffer.duration,this.duration===0&&(this.duration=this.totalDuration,this.durationMS=Math.ceil(this.totalDuration*1e3)),this.loop&&n===""?this._startSource(0,0):this._startSource(0,this.position,this.duration),this.isPlaying=!0,this.paused=!1,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,f&&this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding===!1&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),this.pendingPlayback=!0):this._sound&&(this.game.device.cocoonJS||this._sound.readyState===4)?(this._sound.play(),this._sound.loop=this.loop,this.totalDuration=this._sound.duration,this.duration===0&&(this.duration=this.totalDuration,this.durationMS=this.totalDuration*1e3),this._globalVolume=this.game.sound.volume,this._sound.currentTime=this.position,this._sound.muted=this._muted,this._sound.volume=this._muted||this.game.sound.mute?0:this._volume*this._globalVolume,this._pendingStart=!this.currentMarker,this.isPlaying=!0,this.paused=!1,this._tempPause=0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,f&&this.onPlay.dispatch(this)):this.pendingPlayback=!0,this.playOnce&&(this.loop&&console.warn("Phaser.Sound.play: audio clip "+this.name+" cannot be deleted while looping."),this._markedToDelete=!0,this._removeFromSoundManager=!0),this},restart:function(n,t,i,r){n=n||"";t=t||0;i=i||1;r===undefined&&(r=!1);this.play(n,t,i,r,!0)},pause:function(){this.isPlaying&&(this.paused=!0,this.pausedPosition=this.currentTime,this.pausedTime=this.game.time.time,this._tempPause=this._sound.currentTime,this.onPause.dispatch(this),this.stop())},resume:function(){var n,t;this.paused&&(this.usingWebAudio?(n=Math.max(0,this.position+this.pausedPosition/1e3),this._createSourceAndConnect(),this.currentMarker===""&&(this.loop?this._sound.loop=!0:this._addOnEndedHandler()),t=this.duration-this.pausedPosition/1e3,this.loop&&this.currentMarker===""?this._startSource(0,n):this._startSource(0,n,t)):(this._pendingStart=!this.currentMarker,this._sound.currentTime=this._tempPause,this._tempPause=0,this._sound.play()),this.isPlaying=!0,this.paused=!1,this.startTime+=this.game.time.time-this.pausedTime,this.onResume.dispatch(this))},stop:function(){if(this.isPlaying&&this._sound&&(this.usingWebAudio?this._stopSourceAndDisconnect():this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0)),this.pendingPlayback=!1,this.isPlaying=!1,!this.paused){var n=this.currentMarker;this.currentMarker!==""&&this.onMarkerComplete.dispatch(this.currentMarker,this);this.currentMarker="";this.fadeTween!==null&&this.fadeTween.stop();this.onStop.dispatch(this,n)}},fadeIn:function(n,t,i){(t===undefined&&(t=!1),i===undefined&&(i=this.currentMarker),this.paused)||(this.play(i,0,0,t),this.fadeTo(n,1))},fadeOut:function(n){this.fadeTo(n,0)},fadeTo:function(t,i){if(this.isPlaying&&!this.paused&&i!==this.volume){if(t===undefined&&(t=1e3),i===undefined){console.warn("Phaser.Sound.fadeTo: No Volume Specified.");return}this.fadeTween=this.game.add.tween(this).to({volume:i},t,n.Easing.Linear.None,!0);this.fadeTween.onComplete.add(this.fadeComplete,this)}},fadeComplete:function(){this.onFadeComplete.dispatch(this,this.volume);this.volume===0&&this.stop()},updateGlobalVolume:function(n){this.usingAudioTag&&this._sound&&(this._globalVolume=n,this._sound.volume=this._globalVolume*this._volume)},destroy:function(n){n===undefined&&(n=!0);this._markedToDelete=!0;this._removeFromSoundManager=n;this.stop();n?this.game.sound.remove(this):(this.markers={},this.context=null,this._buffer=null,this.externalNode=null,this.onDecoded.dispose(),this.onPlay.dispose(),this.onPause.dispose(),this.onResume.dispose(),this.onLoop.dispose(),this.onStop.dispose(),this.onMute.dispose(),this.onMarkerComplete.dispose())},_createSourceAndConnect:function(){this._sound=this.context.createBufferSource();this._sound.connect(this.externalNode||this.gainNode);this._buffer=this.game.cache.getSoundData(this.key);this._sound.buffer=this._buffer;this._sourceId++},_disconnectSource:function(){this._sound.disconnect(this.externalNode||this.gainNode)},_startSource:function(n,t,i){i===undefined?this._sound.start(n||0,t||0):this._sound.start(n||0,t||0,i)},_stopSourceAndDisconnect:function(){this._removeOnEndedHandler();try{this._sound.stop(0)}catch(n){}this._disconnectSource();this._sound=null},_addOnEndedHandler:function(){this._sound.onended=this.onEndedHandler.bind(this)},_removeOnEndedHandler:function(){this._sound.onended=null}};n.Sound.prototype.constructor=n.Sound;Object.defineProperty(n.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}});Object.defineProperty(n.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}});Object.defineProperty(n.Sound.prototype,"mute",{get:function(){return this._muted||this.game.sound.mute},set:function(n){(n=n||!1,n!==this._muted)&&(n?(this._muted=!0,this._muteVolume=this._tempVolume,this.usingWebAudio?this.gainNode.gain.value=0:this.usingAudioTag&&this._sound&&(this._sound.volume=0)):(this._muted=!1,this.usingWebAudio?this.gainNode.gain.value=this._muteVolume:this.usingAudioTag&&this._sound&&(this._sound.volume=this._muteVolume)),this.onMute.dispatch(this))}});Object.defineProperty(n.Sound.prototype,"volume",{get:function(){return this._volume},set:function(n){if(this.usingAudioTag&&(n=this.game.math.clamp(n,0,1)),this._muted){this._muteVolume=n;return}this._tempVolume=n;this._volume=n;this.usingWebAudio?this.gainNode.gain.value=n:this.usingAudioTag&&this._sound&&(this._sound.volume=this._globalVolume*n)}});Object.defineProperty(n.Sound.prototype,"sourceId",{get:function(){return this._sound?this._sourceId:null}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.SoundManager=function(t){this.game=t;this.onSoundDecode=new n.Signal;this.onVolumeChange=new n.Signal;this.onMute=new n.Signal;this.onUnMute=new n.Signal;this.onTouchUnlock=new n.Signal;this.context=null;this.baseLatency=null;this.usingWebAudio=!1;this.usingAudioTag=!1;this.noAudio=!1;this.connectToMaster=!0;this.touchLocked=!1;this.channels=32;this.muteOnPause=!0;this._codeMuted=!1;this._muted=!1;this._unlockSource=null;this._volume=1;this._sounds=[];this._watchList=new n.ArraySet;this._watching=!1;this._watchCallback=null;this._watchContext=null;this._resumeWebAudioOnClick=this._resumeWebAudioOnClick.bind(this)};n.SoundManager.prototype={boot:function(){var t=this.game.device,n=window.PhaserGlobal,i;if(t.iOS&&t.webAudio===!1&&(this.channels=1),n){if(n.disableAudio===!0){this.noAudio=!0;this.touchLocked=!1;return}if(n.disableWebAudio===!0){this.usingAudioTag=!0;this.touchLocked=!1;return}}if(n&&n.audioContext)this.context=n.audioContext;else if(i=window.AudioContext||window.webkitAudioContext,i)try{this.context=new i}catch(r){this.context=null;this.usingWebAudio=!1;this.touchLocked=!1;console.warn(r)}if(this.context===null){if(window.Audio===undefined){this.noAudio=!0;return}this.usingAudioTag=!0}else this.usingWebAudio=!0,this.baseLatency=this.context.baseLatency||256/(this.context.sampleRate||44100),this.masterGain=this.context.createGain===undefined?this.context.createGainNode():this.context.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination),this.context.state==="suspended"&&this.game.canvas.addEventListener("click",this._resumeWebAudioOnClick);this.noAudio||t.needsTouchUnlock()&&this.setTouchLock();this.usingWebAudio&&t.chrome&&t.chromeVersion<=65&&console.log('A "GainNode.gain.value setter smoothing is deprecated" notice in Chrome is normal. <https://github.com/photonstorm/phaser-ce/issues/385>')},setTouchLock:function(){this.noAudio||window.PhaserGlobal&&window.PhaserGlobal.disableAudio===!0||(this.game.input.addTouchLockCallback(this.unlock,this,!0),this.touchLocked=!0)},setTouchUnlock:function(){this.touchLocked=!1;this._unlockSource=null;this.onTouchUnlock.dispatch()},resumeWebAudio:function(){if(this.usingWebAudio&&this.context.state==="suspended")return this.context.resume()},unlock:function(){var t,n;return this.noAudio||!this.touchLocked||this._unlockSource!==null?!0:(this.usingAudioTag?this.setTouchUnlock():this.usingWebAudio&&(t=this.context.createBuffer(1,1,22050),this._unlockSource=this.context.createBufferSource(),this._unlockSource.buffer=t,this._unlockSource.connect(this.context.destination),n=this,this._unlockSource.onended=function(){n.setTouchUnlock();n.resumeWebAudio()},this._unlockSource.start===undefined?this._unlockSource.noteOn(0):this._unlockSource.start(0),this.resumeWebAudio()),!0)},stopAll:function(){if(!this.noAudio)for(var n=0;n<this._sounds.length;n++)this._sounds[n]&&this._sounds[n].stop()},pauseAll:function(){if(!this.noAudio)for(var n=0;n<this._sounds.length;n++)this._sounds[n]&&this._sounds[n].pause()},resumeAll:function(){if(!this.noAudio)for(var n=0;n<this._sounds.length;n++)this._sounds[n]&&this._sounds[n].resume()},decode:function(n,t){var i,r;if(t=t||null,i=this.game.cache.getSoundData(n),i&&this.game.cache.isSoundDecoded(n)===!1){this.game.cache.updateSound(n,"isDecoding",!0);r=this;try{this.context.decodeAudioData(i,function(i){i&&(r.game.cache.decodedSound(n,i),r.onSoundDecode.dispatch(n,t))})}catch(u){}}},setDecodedCallback:function(t,i,r){typeof t=="string"&&(t=[t]);this._watchList.reset();for(var u=0;u<t.length;u++)t[u]instanceof n.Sound?this.game.cache.isSoundDecoded(t[u].key)||this._watchList.add(t[u].key):this.game.cache.isSoundDecoded(t[u])||this._watchList.add(t[u]);this._watchList.total===0?(this._watching=!1,i.call(r)):(this._watching=!0,this._watchCallback=i,this._watchContext=r)},update:function(){var t,n;if(!this.noAudio){for(t=0;t<this._sounds.length;t++)this._sounds[t].update();if(this._watching){for(n=this._watchList.first;n;)this.game.cache.isSoundDecoded(n)&&this._watchList.remove(n),n=this._watchList.next;this._watchList.total===0&&(this._watching=!1,this._watchCallback.call(this._watchContext))}}},add:function(t,i,r,u){i===undefined&&(i=1);r===undefined&&(r=!1);u===undefined&&(u=this.connectToMaster);var f=new n.Sound(this.game,t,i,r,u);return this._sounds.push(f),f},addSprite:function(t){return new n.AudioSprite(this.game,t)},remove:function(n){for(var t=this._sounds.length;t--;)if(this._sounds[t]===n)return this._sounds[t].destroy(!1),this._sounds.splice(t,1),!0;return!1},removeAll:function(){this.stopAll();for(var n=0;n<this._sounds.length;n++)this._sounds[n]&&this._sounds[n].destroy();this._sounds.length=0},removeByKey:function(n){for(var t=this._sounds.length,i=0;t--;)this._sounds[t].key===n&&(this._sounds[t].destroy(!1),this._sounds.splice(t,1),i++);return i},play:function(n,t,i){if(!this.noAudio){var r=this.add(n,t,i);return r.play(),r}},setMute:function(){if(!this._muted){this._muted=!0;this.usingWebAudio&&(this._muteVolume=this.masterGain.gain.value,this.masterGain.gain.value=0);for(var n=0;n<this._sounds.length;n++)this._sounds[n].usingAudioTag&&(this._sounds[n].mute=!0);this.onMute.dispatch()}},unsetMute:function(){if(this._muted&&!this._codeMuted){this._muted=!1;this.usingWebAudio&&(this.masterGain.gain.value=this._muteVolume);for(var n=0;n<this._sounds.length;n++)this._sounds[n].usingAudioTag&&(this._sounds[n].mute=!1);this.onUnMute.dispatch()}},destroy:function(){this.removeAll();this.onSoundDecode.dispose();this.game.canvas.removeEventListener("click",this._resumeWebAudioOnClick);this.context&&(window.PhaserGlobal?window.PhaserGlobal.audioContext=this.context:this.context.close&&this.context.close())},_resumeWebAudioOnClick:function(){this.resumeWebAudio();this.game.canvas.removeEventListener("click",this._resumeWebAudioOnClick)}};n.SoundManager.prototype.constructor=n.SoundManager;Object.defineProperty(n.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(n){if(n=n||!1,n){if(this._muted)return;this._codeMuted=!0;this.setMute()}else{if(!this._muted)return;this._codeMuted=!1;this.unsetMute()}}});Object.defineProperty(n.SoundManager.prototype,"volume",{get:function(){return this._volume},set:function(n){if(n<0?n=0:n>1&&(n=1),this._volume!==n){if(this._volume=n,this.usingWebAudio)this.masterGain.gain.value=n;else for(var t=0;t<this._sounds.length;t++)this._sounds[t].usingAudioTag&&this._sounds[t].updateGlobalVolume(n);this.onVolumeChange.dispatch(n)}}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.ScaleManager=function(t,i,r){this.game=t;this.dom=n.DOM;this.grid=null;this.width=0;this.height=0;this.minWidth=null;this.maxWidth=null;this.minHeight=null;this.maxHeight=null;this.offset=new n.Point;this.forceLandscape=!1;this.forcePortrait=!1;this.incorrectOrientation=!1;this._pageAlignHorizontally=!1;this._pageAlignVertically=!1;this.onOrientationChange=new n.Signal;this.enterIncorrectOrientation=new n.Signal;this.leaveIncorrectOrientation=new n.Signal;this.hasPhaserSetFullScreen=!1;this.fullScreenTarget=null;this._createdFullScreenTarget=null;this.onFullScreenInit=new n.Signal;this.onFullScreenChange=new n.Signal;this.onFullScreenError=new n.Signal;this.screenOrientation=this.dom.getScreenOrientation();this.scaleFactor=new n.Point(1,1);this.scaleFactorInversed=new n.Point(1,1);this.margin={left:0,top:0,right:0,bottom:0,x:0,y:0};this.bounds=new n.Rectangle;this.aspectRatio=0;this.sourceAspectRatio=0;this.event=null;this.windowConstraints={right:"layout",bottom:""};this.compatibility={supportsFullScreen:!1,orientationFallback:null,noMargins:!1,scrollTo:null,forceMinimumDocumentHeight:!1,canExpandParent:!0,clickTrampoline:""};this._scaleMode=n.ScaleManager.NO_SCALE;this._fullScreenScaleMode=n.ScaleManager.NO_SCALE;this.parentIsWindow=!1;this.parentNode=null;this.parentScaleFactor=new n.Point(1,1);this.trackParentInterval=2e3;this.onSizeChange=new n.Signal;this.onResize=null;this.onResizeContext=null;this._pendingScaleMode=null;this._fullScreenRestore=null;this._gameSize=new n.Rectangle;this._userScaleFactor=new n.Point(1,1);this._userScaleTrim=new n.Point(0,0);this._lastUpdate=0;this._updateThrottle=0;this._updateThrottleReset=100;this._parentBounds=new n.Rectangle;this._tempBounds=new n.Rectangle;this._lastReportedCanvasSize=new n.Rectangle;this._lastReportedGameSize=new n.Rectangle;this._booted=!1;t.config&&this.parseConfig(t.config);this.setupScale(i,r)};n.ScaleManager.EXACT_FIT=0;n.ScaleManager.NO_SCALE=1;n.ScaleManager.SHOW_ALL=2;n.ScaleManager.RESIZE=3;n.ScaleManager.USER_SCALE=4;n.ScaleManager.MODES=["EXACT_FIT","NO_SCALE","SHOW_ALL","RESIZE","USER_SCALE"];n.ScaleManager.prototype={boot:function(){var t=this.compatibility,i;t.supportsFullScreen=this.game.device.fullscreen&&!this.game.device.cocoonJS;this.game.device.iPad||this.game.device.webApp||this.game.device.desktop||(t.scrollTo=this.game.device.android&&!this.game.device.chrome?new n.Point(0,1):new n.Point(0,0));this.game.device.desktop?(t.orientationFallback="screen",t.clickTrampoline="when-not-mouse"):(t.orientationFallback="",t.clickTrampoline="");i=this;this._orientationChange=function(n){return i.orientationChange(n)};this._windowResize=function(n){return i.windowResize(n)};window.addEventListener("orientationchange",this._orientationChange,!1);window.addEventListener("resize",this._windowResize,!1);this.compatibility.supportsFullScreen&&(this._fullScreenChange=function(n){return i.fullScreenChange(n)},this._fullScreenError=function(n){return i.fullScreenError(n)},document.addEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.addEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.addEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.addEventListener("fullscreenchange",this._fullScreenChange,!1),document.addEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.addEventListener("mozfullscreenerror",this._fullScreenError,!1),document.addEventListener("MSFullscreenError",this._fullScreenError,!1),document.addEventListener("fullscreenerror",this._fullScreenError,!1));this.game.onResume.add(this._gameResumed,this);this.dom.getOffset(this.game.canvas,this.offset);this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);this.setGameSize(this.game.width,this.game.height);this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);n.FlexGrid&&(this.grid=new n.FlexGrid(this,this.width,this.height));this._booted=!0;this._pendingScaleMode!==null&&(this.scaleMode=this._pendingScaleMode,this._pendingScaleMode=null)},parseConfig:function(n){n.scaleMode!==undefined&&(this._booted?this.scaleMode=n.scaleMode:this._pendingScaleMode=n.scaleMode);n.fullScreenScaleMode!==undefined&&(this.fullScreenScaleMode=n.fullScreenScaleMode);n.fullScreenTarget&&(this.fullScreenTarget=n.fullScreenTarget);this.pageAlignHorizontally=n.alignH||!1;this.pageAlignVertically=n.alignV||!1;n.scaleH&&n.scaleV&&this.setUserScale(n.scaleH,n.scaleV,n.trimH,n.trimV)},setupScale:function(t,i){var e,f=new n.Rectangle,r,u;this.game.parent!==""&&(typeof this.game.parent=="string"?e=document.getElementById(this.game.parent):this.game.parent&&this.game.parent.nodeType===1&&(e=this.game.parent));e?(this.parentNode=e,this.parentIsWindow=!1,this.getParentBounds(this._parentBounds,this.parentNode),f.width=this._parentBounds.width,f.height=this._parentBounds.height,this.offset.set(this._parentBounds.x,this._parentBounds.y)):(this.parentNode=null,this.parentIsWindow=!0,f.width=this.dom.visualBounds.width,f.height=this.dom.visualBounds.height,this.offset.set(0,0));r=0;u=0;typeof t=="number"?r=t:(this.parentScaleFactor.x=parseInt(t,10)/100,r=f.width*this.parentScaleFactor.x);typeof i=="number"?u=i:(this.parentScaleFactor.y=parseInt(i,10)/100,u=f.height*this.parentScaleFactor.y);r=Math.floor(r);u=Math.floor(u);this._gameSize.setTo(0,0,r,u);this.updateDimensions(r,u,!1)},_gameResumed:function(){this.queueUpdate(!0)},setGameSize:function(t,i){this._gameSize.setTo(0,0,t,i);this.currentScaleMode!==n.ScaleManager.RESIZE&&this.updateDimensions(t,i,!0);this.queueUpdate(!0)},setUserScale:function(n,t,i,r,u,f){this._userScaleFactor.setTo(n,t);this._userScaleTrim.setTo(i|0,r|0);u===undefined&&(u=!0);f===undefined&&(f=!0);u&&this.queueUpdate(f)},setResizeCallback:function(n,t){this.onResize=n;this.onResizeContext=t},signalSizeChange:function(){if(!n.Rectangle.sameDimensions(this,this._lastReportedCanvasSize)||!n.Rectangle.sameDimensions(this.game,this._lastReportedGameSize)){var t=this.width,i=this.height;if(this._lastReportedCanvasSize.setTo(0,0,t,i),this._lastReportedGameSize.setTo(0,0,this.game.width,this.game.height),this.grid)this.grid.onResize(t,i);this.onSizeChange.dispatch(this,t,i);this.currentScaleMode===n.ScaleManager.RESIZE&&(this.game.state.resize(t,i),this.game.load.resize(t,i))}},setMinMax:function(n,t,i,r){this.minWidth=n;this.minHeight=t;typeof i!="undefined"&&(this.maxWidth=i);typeof r!="undefined"&&(this.maxHeight=r)},preUpdate:function(){var t,r;if(!(this.game.time.time<this._lastUpdate+this._updateThrottle)){t=this._updateThrottle;this._updateThrottleReset=t>=400?0:100;this.dom.getOffset(this.game.canvas,this.offset);var u=this._parentBounds.width,f=this._parentBounds.height,i=this.getParentBounds(this._parentBounds),e=i.width!==u||i.height!==f,o=this.updateOrientationState();(e||o)&&(this.onResize&&this.onResize.call(this.onResizeContext,this,i),this.updateLayout(),this.signalSizeChange());r=this._updateThrottle*2;this._updateThrottle<t&&(r=Math.min(t,this._updateThrottleReset));this._updateThrottle=n.Math.clamp(r,25,this.trackParentInterval);this._lastUpdate=this.game.time.time}},pauseUpdate:function(){this.preUpdate();this._updateThrottle=this.trackParentInterval},updateDimensions:function(n,t,i){this.width=n*this.parentScaleFactor.x;this.height=t*this.parentScaleFactor.y;this.game.width=this.width;this.game.height=this.height;this.sourceAspectRatio=this.width/this.height;this.updateScalingAndBounds();i&&(this.game.renderer.resize(this.width,this.height),this.game.camera.setSize(this.width,this.height),this.game.world.resize(this.width,this.height))},updateScalingAndBounds:function(){this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height;this.scaleFactorInversed.x=this.width/this.game.width;this.scaleFactorInversed.y=this.height/this.game.height;this.aspectRatio=this.width/this.height;this.game.canvas&&this.dom.getOffset(this.game.canvas,this.offset);this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);this.game.input&&this.game.input.scale&&this.game.input.scale.setTo(this.scaleFactor.x,this.scaleFactor.y)},forceOrientation:function(n,t){if(t===undefined&&(t=!1),n===!0&&t===!0){console.warn("Phaser.ScaleManager: forceLandscape and forcePortrait cannot both be true.");return}this.forceLandscape=n;this.forcePortrait=t;this.queueUpdate(!0)},classifyOrientation:function(n){return n==="portrait-primary"||n==="portrait-secondary"?"portrait":n==="landscape-primary"||n==="landscape-secondary"?"landscape":null},updateOrientationState:function(){var i=this.screenOrientation,r=this.incorrectOrientation,t,n;return this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback),this.incorrectOrientation=this.forceLandscape&&!this.isLandscape||this.forcePortrait&&!this.isPortrait,t=i!==this.screenOrientation,n=r!==this.incorrectOrientation,n&&(this.incorrectOrientation?this.enterIncorrectOrientation.dispatch():this.leaveIncorrectOrientation.dispatch()),(t||n)&&this.onOrientationChange.dispatch(this,i,r),t||n},orientationChange:function(n){this.event=n;this.queueUpdate(!0)},windowResize:function(n){this.event=n;this.queueUpdate(!0)},scrollTop:function(){var n=this.compatibility.scrollTo;n&&window.scrollTo(n.x,n.y)},refresh:function(){this.scrollTop();this.queueUpdate(!0)},updateLayout:function(){var t=this.currentScaleMode,i;if(t===n.ScaleManager.RESIZE){this.reflowGame();return}this.scrollTop();this.compatibility.forceMinimumDocumentHeight&&(document.documentElement.style.minHeight=window.innerHeight+"px");this.incorrectOrientation?this.setMaximum():t===n.ScaleManager.EXACT_FIT?this.setExactFit():t===n.ScaleManager.SHOW_ALL?!this.isFullScreen&&this.boundingParent&&this.compatibility.canExpandParent?(this.setShowAll(!0),this.resetCanvas(),this.setShowAll()):this.setShowAll():t===n.ScaleManager.NO_SCALE?(this.width=this.game.width,this.height=this.game.height):t===n.ScaleManager.USER_SCALE&&(this.width=this.game.width*this._userScaleFactor.x-this._userScaleTrim.x,this.height=this.game.height*this._userScaleFactor.y-this._userScaleTrim.y);this.compatibility.canExpandParent||t!==n.ScaleManager.SHOW_ALL&&t!==n.ScaleManager.USER_SCALE||(i=this.getParentBounds(this._tempBounds),this.width=Math.min(this.width,i.width),this.height=Math.min(this.height,i.height));this.width=this.width|0;this.height=this.height|0;this.reflowCanvas()},getParentBounds:function(t,i){var r=t||new n.Rectangle,u=i||this.boundingParent,o=this.dom.visualBounds,c=this.dom.layoutBounds,f,h,e,s;return u?(f=u.getBoundingClientRect(),h=u.offsetParent?u.offsetParent.getBoundingClientRect():u.getBoundingClientRect(),r.setTo(f.left-h.left,f.top-h.top,f.width,f.height),e=this.windowConstraints,e.right&&(s=e.right==="layout"?c:o,r.right=Math.min(r.right,s.width)),e.bottom&&(s=e.bottom==="layout"?c:o,r.bottom=Math.min(r.bottom,s.height))):r.setTo(0,0,o.width,o.height),r.setTo(Math.round(r.x),Math.round(r.y),Math.round(r.width),Math.round(r.height)),r},align:function(n,t){n!=null&&(this.pageAlignHorizontally=n);t!=null&&(this.pageAlignVertically=t)},alignCanvas:function(n,t){var r=this.getParentBounds(this._tempBounds),f=this.game.canvas,i=this.margin,e,o,u,s;n&&(i.left=i.right=0,e=f.getBoundingClientRect(),this.width<r.width&&!this.incorrectOrientation&&(o=e.left-r.x,u=r.width/2-this.width/2,u=Math.max(u,0),s=u-o,i.left=Math.round(s)),f.style.marginLeft=i.left+"px",i.left!==0&&(i.right=-(r.width-e.width-i.left),f.style.marginRight=i.right+"px"));t&&(i.top=i.bottom=0,e=f.getBoundingClientRect(),this.height<r.height&&!this.incorrectOrientation&&(o=e.top-r.y,u=r.height/2-this.height/2,u=Math.max(u,0),s=u-o,i.top=Math.round(s)),f.style.marginTop=i.top+"px",i.top!==0&&(i.bottom=-(r.height-e.height-i.top),f.style.marginBottom=i.bottom+"px"));i.x=i.left;i.y=i.top},reflowGame:function(){this.resetCanvas("","");var n=this.getParentBounds(this._tempBounds);this.updateDimensions(n.width,n.height,!0)},reflowCanvas:function(){this.incorrectOrientation||(this.width=n.Math.clamp(this.width,this.minWidth||0,this.maxWidth||this.width),this.height=n.Math.clamp(this.height,this.minHeight||0,this.maxHeight||this.height));this.resetCanvas();this.compatibility.noMargins||(this.isFullScreen&&this._createdFullScreenTarget?this.alignCanvas(!0,!0):this.alignCanvas(this.pageAlignHorizontally,this.pageAlignVertically));this.updateScalingAndBounds()},resetCanvas:function(n,t){n===undefined&&(n=this.width+"px");t===undefined&&(t=this.height+"px");var i=this.game.canvas;this.compatibility.noMargins||(i.style.marginLeft="",i.style.marginTop="",i.style.marginRight="",i.style.marginBottom="");i.style.width=n;i.style.height=t},queueUpdate:function(n){n&&(this._parentBounds.width=0,this._parentBounds.height=0);this._updateThrottle=this._updateThrottleReset},reset:function(n){n&&this.grid&&this.grid.reset()},setMaximum:function(){this.width=this.dom.visualBounds.width;this.height=this.dom.visualBounds.height},setShowAll:function(n){var i=this.getParentBounds(this._tempBounds),r=i.width,u=i.height,t;t=n?Math.max(u/this.game.height,r/this.game.width):Math.min(u/this.game.height,r/this.game.width);this.width=Math.round(this.game.width*t);this.height=Math.round(this.game.height*t)},setExactFit:function(){var n=this.getParentBounds(this._tempBounds);(this.width=n.width,this.height=n.height,this.isFullScreen)||(this.maxWidth&&(this.width=Math.min(this.width,this.maxWidth)),this.maxHeight&&(this.height=Math.min(this.height,this.maxHeight)))},createFullScreenTarget:function(){var n=document.createElement("div");return n.style.margin="0",n.style.padding="0",n.style.background="#000",n},startFullScreen:function(t,i,r){var o,f,u,s,e,h;if(this.isFullScreen)return!1;if(!this.compatibility.supportsFullScreen){o=this;setTimeout(function(){o.fullScreenError()},10);return}if(this.compatibility.clickTrampoline==="when-not-mouse"&&(f=this.game.input,f.activePointer&&f.activePointer!==f.mousePointer&&(i||i!==!1))){f.activePointer.addClickTrampoline("startFullScreen",this.startFullScreen,this,[t,!1]);return}return t!==undefined&&this.game.renderType===n.CANVAS&&(this.game.stage.smoothed=t),u=this.fullScreenTarget,u||(this.cleanupCreatedTarget(),this._createdFullScreenTarget=this.createFullScreenTarget(),u=this._createdFullScreenTarget),s={targetElement:u},this.hasPhaserSetFullScreen=!0,this.onFullScreenInit.dispatch(this,s),this._createdFullScreenTarget&&(e=this.game.canvas,h=e.parentNode,h.insertBefore(u,e),u.appendChild(e)),r===undefined&&(r={navigationUI:"hide"}),this.game.device.fullscreenKeyboard?u[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT):u[this.game.device.requestFullscreen](r),!0},stopFullScreen:function(){return!this.isFullScreen||!this.compatibility.supportsFullScreen?!1:(this.hasPhaserSetFullScreen=!1,document[this.game.device.cancelFullscreen](),!0)},cleanupCreatedTarget:function(){var n=this._createdFullScreenTarget,t;n&&n.parentNode&&(t=n.parentNode,t.insertBefore(this.game.canvas,n),t.removeChild(n));this._createdFullScreenTarget=null},prepScreenMode:function(t){var r=!!this._createdFullScreenTarget,i=this._createdFullScreenTarget||this.fullScreenTarget;t?(r||this.fullScreenScaleMode===n.ScaleManager.EXACT_FIT)&&i!==this.game.canvas&&(this._fullScreenRestore={targetWidth:i.style.width,targetHeight:i.style.height},i.style.width="100%",i.style.height="100%"):(this._fullScreenRestore&&(i.style.width=this._fullScreenRestore.targetWidth,i.style.height=this._fullScreenRestore.targetHeight,this._fullScreenRestore=null),this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.resetCanvas())},fullScreenChange:function(n){this.event=n;this.isFullScreen?(this.prepScreenMode(!0),this.updateLayout(),this.queueUpdate(!0)):(this.prepScreenMode(!1),this.cleanupCreatedTarget(),this.updateLayout(),this.queueUpdate(!0));this.onFullScreenChange.dispatch(this,this.width,this.height)},fullScreenError:function(n){this.event=n;this.cleanupCreatedTarget();console.warn("Phaser.ScaleManager: requestFullscreen failed or device does not support the Fullscreen API");this.onFullScreenError.dispatch(this)},scaleSprite:function(n,t,i,r){if((t===undefined&&(t=this.width),i===undefined&&(i=this.height),r===undefined&&(r=!1),!n||!n.scale)||(n.scale.x=1,n.scale.y=1,n.width<=0||n.height<=0||t<=0||i<=0))return n;var e=t,o=n.height*t/n.width,f=n.width*i/n.height,s=i,u=f>t;return u=u?r:!r,u?(n.width=Math.floor(e),n.height=Math.floor(o)):(n.width=Math.floor(f),n.height=Math.floor(s)),n},destroy:function(){this.game.onResume.remove(this._gameResumed,this);window.removeEventListener("orientationchange",this._orientationChange,!1);window.removeEventListener("resize",this._windowResize,!1);this.compatibility.supportsFullScreen&&(document.removeEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.removeEventListener("fullscreenchange",this._fullScreenChange,!1),document.removeEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.removeEventListener("mozfullscreenerror",this._fullScreenError,!1),document.removeEventListener("MSFullscreenError",this._fullScreenError,!1),document.removeEventListener("fullscreenerror",this._fullScreenError,!1))}};n.ScaleManager.prototype.constructor=n.ScaleManager;Object.defineProperty(n.ScaleManager.prototype,"boundingParent",{get:function(){if(this.parentIsWindow||this.isFullScreen&&this.hasPhaserSetFullScreen&&!this._createdFullScreenTarget)return null;var n=this.game.canvas&&this.game.canvas.parentNode;return n||null}});Object.defineProperty(n.ScaleManager.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(n){return n!==this._scaleMode&&(this.isFullScreen||(this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.queueUpdate(!0)),this._scaleMode=n),this._scaleMode}});Object.defineProperty(n.ScaleManager.prototype,"fullScreenScaleMode",{get:function(){return this._fullScreenScaleMode},set:function(n){return n!==this._fullScreenScaleMode&&(this.isFullScreen?(this.prepScreenMode(!1),this._fullScreenScaleMode=n,this.prepScreenMode(!0),this.queueUpdate(!0)):this._fullScreenScaleMode=n),this._fullScreenScaleMode}});Object.defineProperty(n.ScaleManager.prototype,"currentScaleMode",{get:function(){return this.isFullScreen?this._fullScreenScaleMode:this._scaleMode}});Object.defineProperty(n.ScaleManager.prototype,"pageAlignHorizontally",{get:function(){return this._pageAlignHorizontally},set:function(n){n!==this._pageAlignHorizontally&&(this._pageAlignHorizontally=n,this.queueUpdate(!0))}});Object.defineProperty(n.ScaleManager.prototype,"pageAlignVertically",{get:function(){return this._pageAlignVertically},set:function(n){n!==this._pageAlignVertically&&(this._pageAlignVertically=n,this.queueUpdate(!0))}});Object.defineProperty(n.ScaleManager.prototype,"isFullScreen",{get:function(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}});Object.defineProperty(n.ScaleManager.prototype,"isPortrait",{get:function(){return this.classifyOrientation(this.screenOrientation)==="portrait"}});Object.defineProperty(n.ScaleManager.prototype,"isLandscape",{get:function(){return this.classifyOrientation(this.screenOrientation)==="landscape"}});Object.defineProperty(n.ScaleManager.prototype,"isGamePortrait",{get:function(){return this.height>this.width}});Object.defineProperty(n.ScaleManager.prototype,"isGameLandscape",{get:function(){return this.width>this.height}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Utils.Debug=function(n){this.game=n;this.sprite=null;this.bmd=null;this.canvas=null;this.context=null;this.font="14px monospace";this.columnWidth=100;this.lineHeight=16;this.lineWidth=1;this.renderShadow=!0;this.currentColor=null;this.currentX=0;this.currentY=0;this.currentAlpha=1;this.dirty=!1;this.isDisabled=!1;this._line=null;this._rect=null};n.Utils.Debug.GEOM_AUTO=0;n.Utils.Debug.GEOM_RECTANGLE=1;n.Utils.Debug.GEOM_CIRCLE=2;n.Utils.Debug.GEOM_POINT=3;n.Utils.Debug.GEOM_LINE=4;n.Utils.Debug.GEOM_ELLIPSE=5;n.Utils.Debug.prototype={boot:function(){this.game.renderType===n.CANVAS?this.context=this.game.context:(this.bmd=new n.BitmapData(this.game,"__DEBUG",this.game.width,this.game.height,!0),this.sprite=this.game.make.image(0,0,this.bmd),this.game.stage.addChild(this.sprite),this.game.scale.onSizeChange.add(this.resize,this),this.canvas=n.CanvasPool.create(this,this.game.width,this.game.height),this.context=this.canvas.getContext("2d"));this._line=new n.Line;this._rect=new n.Rectangle},resize:function(){this.bmd.resize(this.game.width,this.game.height);this.canvas.width=this.game.width;this.canvas.height=this.game.height},preUpdate:function(){this.dirty&&this.sprite&&(this.bmd.clear(),this.bmd.draw(this.canvas,0,0),this.context.clearRect(0,0,this.game.width,this.game.height),this.dirty=!1)},reset:function(){this.context&&this.context.clearRect(0,0,this.game.width,this.game.height);this.sprite&&this.bmd.clear()},start:function(n,t,i,r){typeof n!="number"&&(n=0);typeof t!="number"&&(t=0);i=i||"rgb(255,255,255)";r===undefined&&(r=0);this.currentX=n;this.currentY=t;this.currentColor=i;this.columnWidth=r;this.dirty=!0;this.context.save();this.context.setTransform(1,0,0,1,0,0);this.context.strokeStyle=i;this.context.fillStyle=i;this.context.font=this.font;this.context.globalAlpha=this.currentAlpha},stop:function(){this.context.restore()},line:function(){for(var t=this.currentX,n=0;n<arguments.length;n++)this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(arguments[n],t+1,this.currentY+1),this.context.fillStyle=this.currentColor),this.context.fillText(arguments[n],t,this.currentY),t+=this.columnWidth;this.currentY+=this.lineHeight},sound:function(n,t,i){var r=this.game.sound;this.start(n,t,i);r.noAudio?this.line("Audio is disabled"):(this.line("Volume: "+r.volume.toFixed(2)+(r.mute?" (Mute)":"")),this.line("Mute on pause: "+r.muteOnPause),this.line("Using: "+(r.usingWebAudio?"Web Audio - "+r.context.state:"Audio Tag")),this.line("Touch locked: "+r.touchLocked),this.line("Sounds: "+r._sounds.length));this.stop()},soundInfo:function(n,t,i,r){if(this.start(t,i,r),this.line("Sound: "+n.key+"  Touch locked: "+n.game.sound.touchLocked),this.line("Is Ready?: "+this.game.cache.isSoundReady(n.key)+"  Pending Playback: "+n.pendingPlayback),this.line("Decoded: "+n.isDecoded+"  Decoding: "+n.isDecoding),this.line("Playing: "+n.isPlaying+"  Loop: "+n.loop),this.line("Time: "+(n.currentTime/1e3).toFixed(3)+"s  Total: "+n.totalDuration.toFixed(3)+"s"),this.line("Volume: "+n.volume.toFixed(2)+(n.mute?" (Mute)":"")),this.line("Using: "+(n.usingWebAudio?"Web Audio":"Audio Tag")),n.usingWebAudio&&this.line("  Source: "+(n.sourceId||"none")),n.usingAudioTag&&n._sound){var u=n._sound;this.line("  currentSrc: "+u.currentSrc);this.line("  currentTime: "+u.currentTime);this.line("  duration: "+u.duration);this.line("  ended: "+u.ended);this.line("  loop: "+u.loop);this.line("  muted: "+u.muted);this.line("  paused: "+u.paused)}n.currentMarker!==""&&(this.line("Marker: "+n.currentMarker+"  Duration: "+n.duration.toFixed(3)+"s ("+n.durationMS+"ms)"),this.line("Start: "+n.markers[n.currentMarker].start.toFixed(3)+"  Stop: "+n.markers[n.currentMarker].stop.toFixed(3)),this.line("Position: "+n.position.toFixed(3)));this.stop()},camera:function(n,t,i){var r=n.deadzone,u=n.target,f=n.view;r&&(this._rect.setTo(f.x+r.x,f.y+r.y,r.width,r.height),this.rectangle(this._rect,t,i));u&&(this._line.setTo(f.centerX,f.centerY,u.x,u.y),this.geom(this._line,t,i),this.geom(u,t,!1,3))},cameraInfo:function(n,t,i,r){var f=n.bounds,u=n.deadzone,o=n.target,e=n.view;this.start(t,i,r);this.line("Camera ("+n.width+" x "+n.height+")");this.line("x: "+n.x+" y: "+n.y);this.line("Bounds: "+(f?"x: "+f.x+" y: "+f.y+" w: "+f.width+" h: "+f.height:"none"));this.line("View: x: "+e.x+" y: "+e.y+" w: "+e.width+" h: "+e.height);this.line("Center: x: "+n.centerX+" y: "+n.centerY);this.line("Deadzone: "+(u?"x: "+u.x+" y: "+u.y+" w: "+u.width+" h: "+u.height:u));this.line("Total in view: "+n.totalInView);this.line("At limit: x: "+n.atLimit.x+" y: "+n.atLimit.y);this.line("Target: "+(o?o.name||o:"none"));this.stop()},timer:function(n,t,i,r){this.start(t,i,r);this.line("Timer (running: "+n.running+" expired: "+n.expired+")");this.line("Next Tick: "+n.next+" Duration: "+n.duration);this.line("Paused: "+n.paused+" Length: "+n.length);this.stop()},pointer:function(n,t,i,r,u,f){if(n!=null&&(t===undefined&&(t=!1),i=i||"rgba(0,255,0,0.5)",r=r||"rgba(255,255,0,0.5)",f=f||"rgba(255,0,0,0.5)",t!==!0||n.isUp!==!0)){this.start(n.x,n.y-150,u);this.context.beginPath();this.context.arc(n.x,n.y,n.circle.radius,0,Math.PI*2);this.context.fillStyle=n.active?n.isDown?i:r:f;this.context.fill();this.context.closePath();this.context.beginPath();this.context.moveTo(n.positionDown.x,n.positionDown.y);this.context.lineTo(n.position.x,n.position.y);this.context.lineWidth=2;this.context.stroke();this.context.closePath();var e=n.movementX,o=n.movementY;(e||o)&&(this.context.beginPath(),this.context.moveTo(e+n.position.x,o+n.position.y),this.context.lineTo(n.position.x,n.position.y),this.context.lineWidth=2,this.context.stroke(),this.context.closePath());this.line("ID: "+n.id+" Active: "+n.active);this.line("World X: "+n.worldX.toFixed(1)+" World Y: "+n.worldY.toFixed(1));this.line("Screen X: "+n.x.toFixed(1)+" Screen Y: "+n.y.toFixed(1)+" In: "+n.withinGame);this.line("Movement: X: "+e+" Y: "+o);this.line("Duration: "+n.duration+" ms");this.line("is Down: "+n.isDown+" is Up: "+n.isUp);n.isMouse&&this.line("Buttons: "+this._pointerButtonIcon(n.leftButton)+" "+this._pointerButtonIcon(n.middleButton)+" "+this._pointerButtonIcon(n.rightButton));this.stop()}},_pointerButtonIcon:function(n){return n.isDown?"x":n.isUp?"o":"-"},spriteInputInfo:function(n,t,i,r){this.start(t,i,r);this.line("Sprite Input: ("+n.width+" x "+n.height+")");this.line("x: "+n.input.pointerX().toFixed(1)+" y: "+n.input.pointerY().toFixed(1));this.line("over: "+n.input.pointerOver()+" duration: "+n.input.overDuration().toFixed(0));this.line("down: "+n.input.pointerDown()+" duration: "+n.input.downDuration().toFixed(0));this.line("just over: "+n.input.justOver()+" just out: "+n.input.justOut());this.stop()},key:function(n,t,i,r){this.start(t,i,r,150);this.line("Key:",n.keyCode,"isDown:",n.isDown);this.line("justDown:",n.justDown,"justUp:",n.justUp);this.line("Time Down:",n.timeDown.toFixed(0),"duration:",n.duration.toFixed(0));this.stop()},inputInfo:function(t,i,r,u){var f=this.game.input,e,o;if(u===undefined&&(u=!0),this.start(t,i,r),this.line("Input"),this.line("X: "+f.x+" Y: "+f.y),this.line("World X: "+f.worldX+" World Y: "+f.worldY),this.line("Scale X: "+f.scale.x.toFixed(2)+" Scale Y: "+f.scale.x.toFixed(2)),this.line("Screen X: "+f.activePointer.screenX.toFixed(1)+" Screen Y: "+f.activePointer.screenY.toFixed(1)),!u){this.stop();return}this.line("Sources:");this.line("  "+this._inputHandler(f.mouse,"mouse"));this.line("  "+this._inputHandler(f.mspointer,"mspointer"));this.line("  "+this._inputHandler(f.touch,"touch"));var h=f.pointers,s=f.mousePointer,c=n.PointerModes;for(this.line("Pointers: (Max: "+f.maxPointers+")"),this.line("  "+(s.isDown?"x":"o")+" "+c[s.pointerMode]+" "+s.identifier),e=0;e<h.length;e++)o=h[e],this.line("  "+(o.active?"+":"-")+" "+c[o.pointerMode]+" "+o.identifier);this.stop()},_inputHandler:function(n,t){return this._inputHandlerStatusIcon(n)+" "+t+" "+this._inputHandlerCaptureIcon(n)},_inputHandlerStatusIcon:function(n){return n.active?n.enabled?"+":"-":" "},_inputHandlerCaptureIcon:function(n){return n.active?n.capture||n.preventDefault?"*":" ":" "},spriteBounds:function(n,t,i){var r=n.getBounds();r.x+=this.game.camera.x;r.y+=this.game.camera.y;this.rectangle(r,t,i)},ropeSegments:function(n,t,i){var r=n.segments,u=this;r.forEach(function(n){u.rectangle(n,t,i)},this)},spriteInfo:function(n,t,i,r){this.start(t,i,r);this.line("Sprite: "+(n.name||"")+" ("+n.width+" x "+n.height+") anchor: "+n.anchor.x+" x "+n.anchor.y);this.line("x: "+n.x.toFixed(1)+" y: "+n.y.toFixed(1));this.line("angle: "+n.angle.toFixed(1)+" rotation: "+n.rotation.toFixed(1));this.line("visible: "+n.visible+" in camera: "+n.inCamera);this.line("bounds x: "+n._bounds.x.toFixed(1)+" y: "+n._bounds.y.toFixed(1)+" w: "+n._bounds.width.toFixed(1)+" h: "+n._bounds.height.toFixed(1));this.line("parent: "+(n.parent?n.parent.name||"(DisplayObject)":"(none)"));this.stop()},spriteCoords:function(n,t,i,r){this.start(t,i,r,100);n.name&&this.line(n.name);this.line("x:",n.x.toFixed(2),"y:",n.y.toFixed(2));this.line("pos x:",n.position.x.toFixed(2),"pos y:",n.position.y.toFixed(2));this.line("world x:",n.world.x.toFixed(2),"world y:",n.world.y.toFixed(2));this.stop()},lineInfo:function(n,t,i,r){this.start(t,i,r,80);this.line("start.x:",n.start.x.toFixed(2),"start.y:",n.start.y.toFixed(2));this.line("end.x:",n.end.x.toFixed(2),"end.y:",n.end.y.toFixed(2));this.line("length:",n.length.toFixed(2),"angle:",n.angle);this.stop()},pixel:function(n,t,i,r){r=r||2;this.start();this.context.fillStyle=i;this.context.fillRect(n,t,r,r);this.stop()},geom:function(t,i,r,u){r===undefined&&(r=!0);u===undefined&&(u=0);i=i||"rgba(0,255,0,0.4)";this.start();this.context.fillStyle=i;this.context.strokeStyle=i;this.context.lineWidth=this.lineWidth;var f=n.Utils.Debug;u===f.GEOM_RECTANGLE||t instanceof n.Rectangle?r?this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height):this.context.strokeRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height):u===f.GEOM_CIRCLE||t instanceof n.Circle?(this.context.beginPath(),this.context.arc(t.x-this.game.camera.x,t.y-this.game.camera.y,t.radius,0,Math.PI*2,!1),this.context.closePath(),r?this.context.fill():this.context.stroke()):u===f.GEOM_POINT||t instanceof n.Point?this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,4,4):u===f.GEOM_LINE||t instanceof n.Line?(this.context.beginPath(),this.context.moveTo(t.start.x+.5-this.game.camera.x,t.start.y+.5-this.game.camera.y),this.context.lineTo(t.end.x+.5-this.game.camera.x,t.end.y+.5-this.game.camera.y),this.context.closePath(),this.context.stroke()):(u===f.GEOM_ELLIPSE||t instanceof n.Ellipse)&&(this.context.beginPath(),this.context.ellipse(t.centerX-this.game.camera.x,t.centerY-this.game.camera.y,t.width/2,t.height/2,0,2*Math.PI,!1),this.context.closePath(),r?this.context.fill():this.context.stroke());this.stop()},rectangle:function(n,t,i){i===undefined&&(i=!0);t=t||"rgba(0, 255, 0, 0.4)";this.start();i?(this.context.fillStyle=t,this.context.fillRect(n.x-this.game.camera.x,n.y-this.game.camera.y,n.width,n.height)):(this.context.lineWidth=this.lineWidth,this.context.strokeStyle=t,this.context.strokeRect(n.x-this.game.camera.x,n.y-this.game.camera.y,n.width,n.height));this.stop()},text:function(n,t,i,r,u){r=r||"rgb(255,255,255)";u=u||this.font;this.start();this.context.font=u;this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(n,t+1,i+1));this.context.fillStyle=r;this.context.fillText(n,t,i);this.stop()},quadTree:function(n,t){var r,i;if(t=t||"rgba(255,0,0,0.3)",this.start(),r=n.bounds,n.nodes.length===0)for(this.context.strokeStyle=t,this.context.strokeRect(r.x,r.y,r.width,r.height),this.text("size: "+n.objects.length,r.x+4,r.y+16,"rgb(0,200,0)","12px Courier"),this.context.strokeStyle="rgb(0,255,0)",i=0;i<n.objects.length;i++)this.context.strokeRect(n.objects[i].x,n.objects[i].y,n.objects[i].width,n.objects[i].height);else for(i=0;i<n.nodes.length;i++)this.quadTree(n.nodes[i]);this.stop()},body:function(t,i,r){t.body&&(this.start(),t.body.type===n.Physics.ARCADE?n.Physics.Arcade.Body.render(this.context,t.body,i,r,this.lineWidth):t.body.type===n.Physics.NINJA?n.Physics.Ninja.Body.render(this.context,t.body,i,r):t.body.type===n.Physics.BOX2D&&n.Physics.Box2D.renderBody(this.context,t.body,i),this.stop())},bodyInfo:function(t,i,r,u){t.body&&(this.start(i,r,u,210),t.body.type===n.Physics.ARCADE?n.Physics.Arcade.Body.renderBodyInfo(this,t.body):t.body.type===n.Physics.BOX2D&&this.game.physics.box2d.renderBodyInfo(this,t.body),this.stop())},box2dWorld:function(){this.start();this.context.translate(-this.game.camera.view.x,-this.game.camera.view.y,0);this.game.physics.box2d.renderDebugDraw(this.context);this.stop()},box2dBody:function(t,i){this.start();n.Physics.Box2D.renderBody(this.context,t,i);this.stop()},displayList:function(n){if(n===undefined&&(n=this.game.world),n.hasOwnProperty("renderOrderID")?console.log("["+n.renderOrderID+"]",n):console.log("[]",n),n.children&&n.children.length>0)for(var t=0;t<n.children.length;t++)this.game.debug.displayList(n.children[t])},renderer:function(n,t,i){var r=this.game.renderer,u=r.renderSession,f;if(this.start(n,t,i),this.line((r.gl?"WebGL":"Canvas")+" Renderer ("+r.width+" x "+r.height+")"),this.line("autoResize: "+r.autoResize),this.line("clearBeforeRender: "+r.clearBeforeRender),this.line("resolution: "+r.resolution),this.line("transparent: "+r.transparent),this.line("renderSession:"),r.gl){for(this.line("  currentBatchedTextures: ("+r.currentBatchedTextures.length+")"),f=0;f<r.currentBatchedTextures.length;f++)this.line("    "+r.currentBatchedTextures[f]);this.line("  drawCount: "+u.drawCount);this.line("  maxTextures: "+r.maxTextures);this.line("  maxTextureSize: "+r.maxTextureSize);this.line("  maxTextureAvailableSpace: "+u.maxTextureAvailableSpace);this.line("  roundPixels: "+u.roundPixels)}else this.line("  roundPixels: "+u.roundPixels),this.line("  scaleMode: "+(u.scaleMode===0?"LINEAR":u.scaleMode===1?"NEAREST":u.scaleMode));this.stop()},canvasPool:function(t,i,r,u){var f=n.CanvasPool;this.start(t,i,r,u||100);this.line("Canvas Pool");this.line("Used:",f.getTotal());this.line("Free:",f.getFree());this.line("Total:",f.length);this.stop()},physicsGroup:function(n,t,i,r){n.forEach(this.body,this,r,t,i)},phaser:function(t,i,r){this.text("Phaser v"+n.VERSION+" "+(this.game.renderType===n.WEBGL?"WebGL":"Canvas")+" "+(this.game.device.webAudio?"WebAudio":"HTML Audio"),t,i,r,this.font)},scale:function(t,i,r){this.start(t,i,r);var u=this.game.scale,e=u.scaleFactorInversed,f=u._parentBounds,t=" x ";this.line("Game: "+this.game.width+t+this.game.height);this.line("Canvas: "+u.width+t+u.height+" ("+e.x.toFixed(2)+t+e.y.toFixed(2)+") ["+u.aspectRatio.toFixed(2)+"]");this.line("Mode: "+n.ScaleManager.MODES[u.currentScaleMode]+(u.currentScaleMode===n.ScaleManager.USER_SCALE?" ("+u._userScaleFactor.x+t+u._userScaleFactor.y+")":""));this.line("Parent: "+(u.parentIsWindow?"window":u.parentNode)+(f.empty?"":" ("+f.width+t+f.height+")"));this.line("Screen: "+u.classifyOrientation(u.screenOrientation)+(u.incorrectOrientation?" (incorrect)":""));this.stop()},loader:function(t,i,r,u){var f=n.Utils.pad;this.start(i,r,u);t.hasLoaded?this.line("Complete"+(t.resetLocked?" [locked]":"")):t.isLoading?this.line("Loading"):this.line("Not started");(!t.hasLoaded||t.resetLocked)&&(this.line("Progress: "+(f(t.progress,3)+"%")),this.line("Files: "+t._loadedFileCount+" of "+t._totalFileCount),this.line("Packs: "+t._loadedPackCount+" of "+t._loadedPackCount));this.stop()},device:function(n,t,i){var r=this.game.device;this.start(n,t,i);this.line("Device");this.line("Pointer Events: "+r.mspointer);this.line("Touch: "+r.touch);this.line("Web Audio: "+r.webAudio);this.line("WebGL: "+r.webGL);this.stop()},destroy:function(){n.CanvasPool.remove(this)}};n.Utils.Debug.prototype.constructor=n.Utils.Debug;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.DOM={getOffset:function(t,i){i=i||new n.Point;var r=t.getBoundingClientRect(),u=n.DOM.scrollY,f=n.DOM.scrollX,e=document.documentElement.clientTop,o=document.documentElement.clientLeft;return i.x=r.left+f-o,i.y=r.top+u-e,i},getBounds:function(n,t){return t===undefined&&(t=0),n=n&&!n.nodeType?n[0]:n,n&&n.nodeType===1?this.calibrate(n.getBoundingClientRect(),t):!1},calibrate:function(n,t){t=+t||0;var i={width:0,height:0,left:0,right:0,top:0,bottom:0};return i.width=(i.right=n.right+t)-(i.left=n.left-t),i.height=(i.bottom=n.bottom+t)-(i.top=n.top-t),i},getAspectRatio:function(n){n=n==null?this.visualBounds:n.nodeType===1?this.getBounds(n):n;var t=n.width,i=n.height;return typeof t=="function"&&(t=t.call(n)),typeof i=="function"&&(i=i.call(n)),t/i},inLayoutViewport:function(n,t){var i=this.getBounds(n,t);return!!i&&i.bottom>=0&&i.right>=0&&i.top<=this.layoutBounds.width&&i.left<=this.layoutBounds.height},getScreenOrientation:function(n){var r=window.screen,u=r.orientation||r.mozOrientation||r.msOrientation,t,i;if(u&&typeof u.type=="string")return u.type;if(typeof u=="string")return u;if(t="portrait-primary",i="landscape-primary",n==="screen")return r.height>r.width?t:i;if(n==="viewport")return this.visualBounds.height>this.visualBounds.width?t:i;if(n==="window.orientation"&&typeof window.orientation=="number")return window.orientation===0||window.orientation===180?t:i;if(window.matchMedia){if(window.matchMedia("(orientation: portrait)").matches)return t;if(window.matchMedia("(orientation: landscape)").matches)return i}return this.visualBounds.height>this.visualBounds.width?t:i},visualBounds:new n.Rectangle,layoutBounds:new n.Rectangle,documentBounds:new n.Rectangle};n.Device.whenReady(function(t){var u=window&&"pageXOffset"in window?function(){return window.pageXOffset}:function(){return document.documentElement.scrollLeft},f=window&&"pageYOffset"in window?function(){return window.pageYOffset}:function(){return document.documentElement.scrollTop},e,i,r;Object.defineProperty(n.DOM,"scrollX",{get:u});Object.defineProperty(n.DOM,"scrollY",{get:f});Object.defineProperty(n.DOM.visualBounds,"x",{get:u});Object.defineProperty(n.DOM.visualBounds,"y",{get:f});Object.defineProperty(n.DOM.layoutBounds,"x",{value:0});Object.defineProperty(n.DOM.layoutBounds,"y",{value:0});e=t.desktop&&document.documentElement.clientWidth<=window.innerWidth&&document.documentElement.clientHeight<=window.innerHeight;e?(i=function(){return Math.max(window.innerWidth,document.documentElement.clientWidth)},r=function(){return Math.max(window.innerHeight,document.documentElement.clientHeight)},Object.defineProperty(n.DOM.visualBounds,"width",{get:i}),Object.defineProperty(n.DOM.visualBounds,"height",{get:r}),Object.defineProperty(n.DOM.layoutBounds,"width",{get:i}),Object.defineProperty(n.DOM.layoutBounds,"height",{get:r})):(Object.defineProperty(n.DOM.visualBounds,"width",{get:function(){return window.innerWidth}}),Object.defineProperty(n.DOM.visualBounds,"height",{get:function(){return window.innerHeight}}),Object.defineProperty(n.DOM.layoutBounds,"width",{get:function(){var n=document.documentElement.clientWidth,t=window.innerWidth;return n<t?t:n}}),Object.defineProperty(n.DOM.layoutBounds,"height",{get:function(){var n=document.documentElement.clientHeight,t=window.innerHeight;return n<t?t:n}}));Object.defineProperty(n.DOM.documentBounds,"x",{value:0});Object.defineProperty(n.DOM.documentBounds,"y",{value:0});Object.defineProperty(n.DOM.documentBounds,"width",{get:function(){var n=document.documentElement;return Math.max(n.clientWidth,n.offsetWidth,n.scrollWidth)}});Object.defineProperty(n.DOM.documentBounds,"height",{get:function(){var n=document.documentElement;return Math.max(n.clientHeight,n.offsetHeight,n.scrollHeight)}})},null,!0);
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.ArraySet=function(n){this.position=0;this.list=n||[]};n.ArraySet.prototype={add:function(n){return this.exists(n)||this.list.push(n),n},getIndex:function(n){return this.list.indexOf(n)},getByKey:function(n,t){for(var i=this.list.length;i--;)if(this.list[i][n]===t)return this.list[i];return null},exists:function(n){return this.list.indexOf(n)>-1},reset:function(){this.list.length=0},remove:function(n){var t=this.list.indexOf(n);if(t>-1)return this.list.splice(t,1),n},setAll:function(n,t){for(var i=this.list.length;i--;)this.list[i]&&(this.list[i][n]=t)},callAll:function(n){for(var i=Array.prototype.slice.call(arguments,1),t=this.list.length;t--;)this.list[t]&&this.list[t][n]&&this.list[t][n].apply(this.list[t],i)},removeAll:function(n){var t,i;for(n===undefined&&(n=!1),t=this.list.length;t--;)this.list[t]&&(i=this.remove(this.list[t]),n&&i.destroy());this.position=0;this.list=[]}};Object.defineProperty(n.ArraySet.prototype,"total",{get:function(){return this.list.length}});Object.defineProperty(n.ArraySet.prototype,"first",{get:function(){return this.position=0,this.list.length>0?this.list[0]:null}});Object.defineProperty(n.ArraySet.prototype,"next",{get:function(){return this.position<this.list.length?(this.position++,this.list[this.position]):null}});n.ArraySet.prototype.constructor=n.ArraySet;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.ArrayUtils={getRandomItem:function(n,t,i){if(n===null)return null;t===undefined&&(t=0);i===undefined&&(i=n.length);var r=t+Math.floor(Math.random()*i);return n[r]===undefined?null:n[r]},removeRandomItem:function(n,t,i){var r,u;return n==null?null:(t===undefined&&(t=0),i===undefined&&(i=n.length),r=t+Math.floor(Math.random()*i),r<n.length?(u=n.splice(r,1),u[0]===undefined?null:u[0]):null)},remove:function(n,t,i){var f=n.length,u,r;if(!(t>=f)&&i!==0){for(i==null&&(i=1),u=f-i,r=t;r<u;++r)n[r]=n[r+i];n.length=u}},shuffle:function(n){for(var i,r,t=n.length-1;t>0;t--)i=Math.floor(Math.random()*(t+1)),r=n[t],n[t]=n[i],n[i]=r;return n},transposeMatrix:function(n){for(var i,u=n.length,f=n[0].length,r=new Array(f),t=0;t<f;t++)for(r[t]=new Array(u),i=u-1;i>-1;i--)r[t][i]=n[i][t];return r},rotateMatrix:function(t,i){if(typeof i!="string"&&(i=(i%360+360)%360),i===90||i===-270||i==="rotateLeft")t=n.ArrayUtils.transposeMatrix(t),t=t.reverse();else if(i===-90||i===270||i==="rotateRight")t=t.reverse(),t=n.ArrayUtils.transposeMatrix(t);else if(Math.abs(i)===180||i==="rotate180"){for(var r=0;r<t.length;r++)t[r].reverse();t=t.reverse()}return t},findClosest:function(n,t){var i,r,u;if(t.length){if(t.length===1||n<t[0])return t[0]}else return NaN;for(i=1;t[i]<n;)i++;return r=t[i-1],u=i<t.length?t[i]:Number.POSITIVE_INFINITY,u-n<=n-r?u:r},rotateRight:function(n){var t=n.pop();return n.unshift(t),t},rotateLeft:function(n){var t=n.shift();return n.push(t),t},numberArray:function(n,t){var r,i;for((t===undefined||t===null)&&(t=n,n=0),r=[],i=n;i<=t;i++)r.push(i);return r},numberArrayStep:function(t,i,r){var u,e,f;for((t===undefined||t===null)&&(t=0),(i===undefined||i===null)&&(i=t,t=0),r===undefined&&(r=1),u=[],e=Math.max(n.Math.roundAwayFromZero((i-t)/(r||1)),0),f=0;f<e;f++)u.push(t),t+=r;return u}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.LinkedList=function(){this.next=null;this.prev=null;this.first=null;this.last=null;this.total=0};n.LinkedList.prototype={add:function(n){return this.total===0&&this.first===null&&this.last===null?(this.first=n,this.last=n,this.next=n,n.prev=this,this.total++,n):(this.last.next=n,n.prev=this.last,this.last=n,this.total++,n)},reset:function(){this.first=null;this.last=null;this.next=null;this.prev=null;this.total=0},remove:function(n){if(this.total===1){this.reset();n.next=n.prev=null;return}n===this.first?this.first=this.first.next:n===this.last&&(this.last=this.last.prev);n.prev&&(n.prev.next=n.next);n.next&&(n.next.prev=n.prev);n.next=n.prev=null;this.first===null&&(this.last=null);this.total--},callAll:function(n){if(this.first&&this.last){var t=this.first;do t&&t[n]&&t[n].call(t),t=t.next;while(t!==this.last.next)}}};n.LinkedList.prototype.constructor=n.LinkedList;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Create=function(n){this.game=n;this.bmd=null;this.canvas=null;this.ctx=null;this.palettes=[{0:"#000",1:"#9D9D9D",2:"#FFF",3:"#BE2633",4:"#E06F8B",5:"#493C2B",6:"#A46422",7:"#EB8931",8:"#F7E26B",9:"#2F484E",A:"#44891A",B:"#A3CE27",C:"#1B2632",D:"#005784",E:"#31A2F2",F:"#B2DCEF"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#f5f4eb"},{0:"#000",1:"#2234d1",2:"#0c7e45",3:"#44aacc",4:"#8a3622",5:"#5c2e78",6:"#aa5c3d",7:"#b5b5b5",8:"#5e606e",9:"#4c81fb",A:"#6cd947",B:"#7be2f9",C:"#eb8a60",D:"#e23d69",E:"#ffd93f",F:"#fff"},{0:"#000",1:"#fff",2:"#8b4131",3:"#7bbdc5",4:"#8b41ac",5:"#6aac41",6:"#3931a4",7:"#d5de73",8:"#945a20",9:"#5a4100",A:"#bd736a",B:"#525252",C:"#838383",D:"#acee8b",E:"#7b73de",F:"#acacac"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#fff"}]};n.Create.PALETTE_ARNE=0;n.Create.PALETTE_JMP=1;n.Create.PALETTE_CGA=2;n.Create.PALETTE_C64=3;n.Create.PALETTE_JAPANESE_MACHINE=4;n.Create.prototype={texture:function(n,t,i,r,u,f,e,o){var a,v,s,l,h,c;for(i===undefined&&(i=8),r===undefined&&(r=i),u===undefined&&(u=0),f===undefined&&(f=!0),a=t[0].length*i,v=t.length*r,this.bmd===null&&(this.bmd=this.game.make.bitmapData(),this.canvas=this.bmd.canvas,this.ctx=this.bmd.context),this.bmd.resize(a,v),this.bmd.clear(),s=0;s<t.length;s++)for(l=t[s],h=0;h<l.length;h++)c=l[h],c!=="."&&c!==" "&&(this.ctx.fillStyle=this.palettes[u][c],this.ctx.fillRect(h*i,s*r,i,r));return f?this.bmd.generateTexture(n,e,o):this.copy()},grid:function(n,t,i,r,u,f,e,o,s){var h,c;for(e===undefined&&(e=!0),this.bmd===null&&(this.bmd=this.game.make.bitmapData(),this.canvas=this.bmd.canvas,this.ctx=this.bmd.context),this.bmd.resize(t,i),this.ctx.fillStyle=f,h=0;h<i;h+=u)this.ctx.fillRect(0,h,t,1);for(c=0;c<t;c+=r)this.ctx.fillRect(c,0,1,i);return e?this.bmd.generateTexture(n,o,s):this.copy()},copy:function(n,t,i,r,u,f,e){return n==null&&(n=this.game.make.bitmapData()),n.resize(this.bmd.width,this.bmd.height),n.draw(this.bmd,t,i,r,u,f,e)}};n.Create.prototype.constructor=n.Create;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.FlexGrid=function(t,i,r){this.game=t.game;this.manager=t;this.width=i;this.height=r;this.boundsCustom=new n.Rectangle(0,0,i,r);this.boundsFluid=new n.Rectangle(0,0,i,r);this.boundsFull=new n.Rectangle(0,0,i,r);this.boundsNone=new n.Rectangle(0,0,i,r);this.positionCustom=new n.Point(0,0);this.positionFluid=new n.Point(0,0);this.positionFull=new n.Point(0,0);this.positionNone=new n.Point(0,0);this.scaleCustom=new n.Point(1,1);this.scaleFluid=new n.Point(1,1);this.scaleFluidInversed=new n.Point(1,1);this.scaleFull=new n.Point(1,1);this.scaleNone=new n.Point(1,1);this.customWidth=0;this.customHeight=0;this.customOffsetX=0;this.customOffsetY=0;this.ratioH=i/r;this.ratioV=r/i;this.multiplier=0;this.layers=[]};n.FlexGrid.prototype={setSize:function(t,i){this.width=t;this.height=i;this.ratioH=t/i;this.ratioV=i/t;this.scaleNone=new n.Point(1,1);this.boundsNone.width=this.width;this.boundsNone.height=this.height;this.refresh()},createCustomLayer:function(t,i,r,u){u===undefined&&(u=!0);this.customWidth=t;this.customHeight=i;this.boundsCustom.width=t;this.boundsCustom.height=i;var f=new n.FlexLayer(this,this.positionCustom,this.boundsCustom,this.scaleCustom);return u&&this.game.world.add(f),this.layers.push(f),r&&f.addMultiple(r),f},createFluidLayer:function(t,i){i===undefined&&(i=!0);var r=new n.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);return i&&this.game.world.add(r),this.layers.push(r),t&&r.addMultiple(t),r},createFullLayer:function(t){var i=new n.FlexLayer(this,this.positionFull,this.boundsFull,this.scaleFluid);return this.game.world.add(i),this.layers.push(i),typeof t!="undefined"&&i.addMultiple(t),i},createFixedLayer:function(t){var i=new n.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);return this.game.world.add(i),this.layers.push(i),typeof t!="undefined"&&i.addMultiple(t),i},reset:function(){for(var n=this.layers.length;n--;)this.layers[n].persist||(this.layers[n].position=null,this.layers[n].scale=null,this.layers.slice(n,1))},onResize:function(n,t){this.ratioH=n/t;this.ratioV=t/n;this.refresh(n,t)},refresh:function(){this.multiplier=Math.min(this.manager.height/this.height,this.manager.width/this.width);this.boundsFluid.width=Math.round(this.width*this.multiplier);this.boundsFluid.height=Math.round(this.height*this.multiplier);this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height);this.scaleFluidInversed.set(this.width/this.boundsFluid.width,this.height/this.boundsFluid.height);this.scaleFull.set(this.boundsFull.width/this.width,this.boundsFull.height/this.height);this.boundsFull.width=Math.round(this.manager.width*this.scaleFluidInversed.x);this.boundsFull.height=Math.round(this.manager.height*this.scaleFluidInversed.y);this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.positionFluid.set(this.boundsFluid.x,this.boundsFluid.y);this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},fitSprite:function(n){this.manager.scaleSprite(n);n.x=this.manager.bounds.centerX;n.y=this.manager.bounds.centerY},debug:function(){this.game.debug.text(this.boundsFluid.width+" x "+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16);this.game.debug.geom(this.boundsFluid,"rgba(255,0,0,0.9",!1)}};n.FlexGrid.prototype.constructor=n.FlexGrid;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.FlexLayer=function(t,i,r,u){n.Group.call(this,t.game,null,"__flexLayer"+t.game.rnd.uuid(),!1);this.manager=t.manager;this.grid=t;this.persist=!1;this.position=i;this.bounds=r;this.scale=u;this.topLeft=r.topLeft;this.topMiddle=new n.Point(r.halfWidth,0);this.topRight=r.topRight;this.bottomLeft=r.bottomLeft;this.bottomMiddle=new n.Point(r.halfWidth,r.bottom);this.bottomRight=r.bottomRight};n.FlexLayer.prototype=Object.create(n.Group.prototype);n.FlexLayer.prototype.constructor=n.FlexLayer;n.FlexLayer.prototype.resize=function(){};n.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+" x "+this.bounds.height,this.bounds.x+4,this.bounds.y+16);this.game.debug.geom(this.bounds,"rgba(0,0,255,0.9",!1);this.game.debug.geom(this.topLeft,"rgba(255,255,255,0.9");this.game.debug.geom(this.topMiddle,"rgba(255,255,255,0.9");this.game.debug.geom(this.topRight,"rgba(255,255,255,0.9")};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Color={RED:16711680,ORANGE:16750848,YELLOW:16776960,GREEN:65280,AQUA:65535,BLUE:255,VIOLET:16711935,WHITE:16777215,BLACK:0,GRAY:6710886,packPixel:function(t,i,r,u){return n.Device.LITTLE_ENDIAN?(u<<24|r<<16|i<<8|t)>>>0:(t<<24|i<<16|r<<8|u)>>>0},unpackPixel:function(t,i,r,u){return(i===undefined||i===null)&&(i=n.Color.createColor()),(r===undefined||r===null)&&(r=!1),(u===undefined||u===null)&&(u=!1),n.Device.LITTLE_ENDIAN?(i.a=(t&4278190080)>>>24,i.b=(t&16711680)>>>16,i.g=(t&65280)>>>8,i.r=t&255):(i.r=(t&4278190080)>>>24,i.g=(t&16711680)>>>16,i.b=(t&65280)>>>8,i.a=t&255),i.color=t,i.rgba="rgba("+i.r+","+i.g+","+i.b+","+i.a/255+")",r&&n.Color.RGBtoHSL(i.r,i.g,i.b,i),u&&n.Color.RGBtoHSV(i.r,i.g,i.b,i),i},fromRGBA:function(t,i){return i||(i=n.Color.createColor()),i.r=(t&4278190080)>>>24,i.g=(t&16711680)>>>16,i.b=(t&65280)>>>8,i.a=t&255,i.rgba="rgba("+i.r+","+i.g+","+i.b+","+i.a+")",i},toRGBA:function(n,t,i,r){return n<<24|t<<16|i<<8|r},toABGR:function(n,t,i,r){return(r<<24|i<<16|t<<8|n)>>>0},hexToRGBArray:function(n){return[(n>>16&255)/255,(n>>8&255)/255,(n&255)/255]},RGBArrayToHex:function(n){return(n[0]*255<<16)+(n[1]*255<<8)+n[2]*255},RGBtoHSL:function(t,i,r,u){var e,f,o;return u||(u=n.Color.createColor(t,i,r,1)),t/=255,i/=255,r/=255,e=Math.min(t,i,r),f=Math.max(t,i,r),u.h=0,u.s=0,u.l=(f+e)/2,f!==e&&(o=f-e,u.s=u.l>.5?o/(2-f-e):o/(f+e),f===t?u.h=(i-r)/o+(i<r?6:0):f===i?u.h=(r-t)/o+2:f===r&&(u.h=(t-i)/o+4),u.h/=6),u},HSLtoRGB:function(t,i,r,u){if(u?(u.r=r,u.g=r,u.b=r):u=n.Color.createColor(r,r,r),i!==0){var f=r<.5?r*(1+i):r+i-r*i,e=2*r-f;u.r=n.Color.hueToColor(e,f,t+1/3);u.g=n.Color.hueToColor(e,f,t);u.b=n.Color.hueToColor(e,f,t-1/3)}return u.r=Math.floor(u.r*255|0),u.g=Math.floor(u.g*255|0),u.b=Math.floor(u.b*255|0),n.Color.updateColor(u),u},RGBtoHSV:function(t,i,r,u){u||(u=n.Color.createColor(t,i,r,255));t/=255;i/=255;r/=255;var o=Math.min(t,i,r),f=Math.max(t,i,r),e=f-o;return u.h=0,u.s=f===0?0:e/f,u.v=f,f!==o&&(f===t?u.h=(i-r)/e+(i<r?6:0):f===i?u.h=(r-t)/e+2:f===r&&(u.h=(t-i)/e+4),u.h/=6),u},HSVtoRGB:function(t,i,r,u){u===undefined&&(u=n.Color.createColor(0,0,0,1,t,i,0,r));var f,e,o,l=Math.floor(t*6),a=t*6-l,s=r*(1-i),h=r*(1-a*i),c=r*(1-(1-a)*i);switch(l%6){case 0:f=r;e=c;o=s;break;case 1:f=h;e=r;o=s;break;case 2:f=s;e=r;o=c;break;case 3:f=s;e=h;o=r;break;case 4:f=c;e=s;o=r;break;case 5:f=r;e=s;o=h}return u.r=Math.floor(f*255),u.g=Math.floor(e*255),u.b=Math.floor(o*255),n.Color.updateColor(u),u},hueToColor:function(n,t,i){return(i<0&&(i+=1),i>1&&(i-=1),i<1/6)?n+(t-n)*6*i:i<1/2?t:i<2/3?n+(t-n)*(2/3-i)*6:n},createColor:function(t,i,r,u,f,e,o,s){var h={r:t||0,g:i||0,b:r||0,a:u||1,h:f||0,s:e||0,l:o||0,v:s||0,color:0,color32:0,rgba:""};return n.Color.updateColor(h)},updateColor:function(t){return t.rgba="rgba("+t.r.toFixed()+","+t.g.toFixed()+","+t.b.toFixed()+","+t.a.toString()+")",t.color=n.Color.getColor(t.r,t.g,t.b),t.color32=n.Color.getColor32(t.a*255,t.r,t.g,t.b),t},getColor32:function(n,t,i,r){return n<<24|t<<16|i<<8|r},getColor:function(n,t,i){return n<<16|t<<8|i},RGBtoString:function(t,i,r,u,f){return u===undefined&&(u=255),f===undefined&&(f="#"),f==="#"?"#"+(16777216+(t<<16)+(i<<8)+r).toString(16).slice(1):"0x"+n.Color.componentToHex(u)+n.Color.componentToHex(t)+n.Color.componentToHex(i)+n.Color.componentToHex(r)},hexToRGB:function(t){var i=n.Color.hexToColor(t);if(i)return n.Color.getColor32(i.a,i.r,i.g,i.b)},hexToColor:function(t,i){var r;if(t=t.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(n,t,i,r){return t+t+i+i+r+r}),r=/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),r){var u=parseInt(r[1],16),f=parseInt(r[2],16),e=parseInt(r[3],16);i?(i.r=u,i.g=f,i.b=e):i=n.Color.createColor(u,f,e)}return i},webToColor:function(t,i){i||(i=n.Color.createColor());var r=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(t);return r&&(i.r=~~Number(r[1]),i.g=~~Number(r[2]),i.b=~~Number(r[3]),i.a=r[4]!==undefined?Number(r[4]):1,n.Color.updateColor(i)),i},valueToColor:function(t,i){if(i||(i=n.Color.createColor()),typeof t=="string")return t.indexOf("rgb")===0?n.Color.webToColor(t,i):(i.a=1,n.Color.hexToColor(t,i));if(typeof t=="number"){var r=n.Color.getRGB(t);return i.r=r.r,i.g=r.g,i.b=r.b,i.a=r.a/255,i}return i},componentToHex:function(n){var t=n.toString(16);return t.length===1?"0"+t:t},HSVColorWheel:function(t,i){var u,r;for(t===undefined&&(t=1),i===undefined&&(i=1),u=[],r=0;r<=359;r++)u.push(n.Color.HSVtoRGB(r/359,t,i));return u},HSLColorWheel:function(t,i){var u,r;for(t===undefined&&(t=.5),i===undefined&&(i=.5),u=[],r=0;r<=359;r++)u.push(n.Color.HSLtoRGB(r/359,t,i));return u},interpolateColor:function(t,i,r,u,f,e){var s,c,y;if(f===undefined&&(f=255),e===undefined&&(e=0),s=n.Color.getRGB(t),c=n.Color.getRGB(i),e===0)var p=(c.red-s.red)*u/r+s.red,w=(c.green-s.green)*u/r+s.green,b=(c.blue-s.blue)*u/r+s.blue;if(e===1){var o=n.Color.RGBtoHSV(s.r,s.g,s.b),h=n.Color.RGBtoHSV(c.r,c.g,c.b),l=h.h-o.h,v;o.h>h.h&&(y=h.h,h.h=o.h,o.h=y,l=-l,u=r-u);l>.5&&(o.h=o.h+1,v=((h.h-o.h)*u/r+o.h)%1);l<=.5&&(v=(h.h-o.h)*u/r+o.h);var k=(h.s-o.s)*u/r+o.s,d=(h.v-o.v)*u/r+o.v,a=n.Color.HSVtoRGB(v,k,d,a),p=a.r,w=a.g,b=a.b}return n.Color.getColor32(f,p,w,b)},interpolateColorWithRGB:function(t,i,r,u,f,e){var o=n.Color.getRGB(t),s=(i-o.red)*e/f+o.red,h=(r-o.green)*e/f+o.green,c=(u-o.blue)*e/f+o.blue;return n.Color.getColor(s,h,c)},interpolateRGB:function(t,i,r,u,f,e,o,s){var h=(u-t)*s/o+t,c=(f-i)*s/o+i,l=(e-r)*s/o+r;return n.Color.getColor(h,c,l)},linear:function(n,t,i){return this.interpolateColor(n,t,1,i)},linearInterpolation:function(t,i){var r=n.Math.linear(0,t.length-1,i),u=t[Math.floor(r)],f=t[Math.ceil(r)];return this.linear(u,f,r%1)},getRandomColor:function(t,i,r){if(t===undefined&&(t=0),i===undefined&&(i=255),r===undefined&&(r=255),i>255||t>i)return n.Color.getColor(255,255,255);var u=t+Math.round(Math.random()*(i-t)),f=t+Math.round(Math.random()*(i-t)),e=t+Math.round(Math.random()*(i-t));return n.Color.getColor32(r,u,f,e)},getRGB:function(n){return n>16777215?{alpha:n>>>24,red:n>>16&255,green:n>>8&255,blue:n&255,a:n>>>24,r:n>>16&255,g:n>>8&255,b:n&255}:{alpha:255,red:n>>16&255,green:n>>8&255,blue:n&255,a:255,r:n>>16&255,g:n>>8&255,b:n&255}},getWebRGB:function(t){if(typeof t=="object")return"rgba("+t.r.toString()+","+t.g.toString()+","+t.b.toString()+","+(t.a/255).toString()+")";var i=n.Color.getRGB(t);return"rgba("+i.r.toString()+","+i.g.toString()+","+i.b.toString()+","+(i.a/255).toString()+")"},getAlpha:function(n){return n>>>24},getAlphaFloat:function(n){return(n>>>24)/255},getRed:function(n){return n>>16&255},getGreen:function(n){return n>>8&255},getBlue:function(n){return n&255},blendNormal:function(n){return n},blendLighten:function(n,t){return t>n?t:n},blendDarken:function(n,t){return t>n?n:t},blendMultiply:function(n,t){return n*t/255},blendAverage:function(n,t){return(n+t)/2},blendAdd:function(n,t){return Math.min(255,n+t)},blendSubtract:function(n,t){return Math.max(0,n+t-255)},blendDifference:function(n,t){return Math.abs(n-t)},blendNegation:function(n,t){return 255-Math.abs(255-n-t)},blendScreen:function(n,t){return 255-((255-n)*(255-t)>>8)},blendExclusion:function(n,t){return n+t-2*n*t/255},blendOverlay:function(n,t){return t<128?2*n*t/255:255-2*(255-n)*(255-t)/255},blendSoftLight:function(n,t){return t<128?2*((n>>1)+64)*(t/255):255-2*(255-((n>>1)+64))*(255-t)/255},blendHardLight:function(t,i){return n.Color.blendOverlay(i,t)},blendColorDodge:function(n,t){return t===255?t:Math.min(255,(n<<8)/(255-t))},blendColorBurn:function(n,t){return t===0?t:Math.max(0,255-(255-n<<8)/t)},blendLinearDodge:function(t,i){return n.Color.blendAdd(t,i)},blendLinearBurn:function(t,i){return n.Color.blendSubtract(t,i)},blendLinearLight:function(t,i){return i<128?n.Color.blendLinearBurn(t,2*i):n.Color.blendLinearDodge(t,2*(i-128))},blendVividLight:function(t,i){return i<128?n.Color.blendColorBurn(t,2*i):n.Color.blendColorDodge(t,2*(i-128))},blendPinLight:function(t,i){return i<128?n.Color.blendDarken(t,2*i):n.Color.blendLighten(t,2*(i-128))},blendHardMix:function(t,i){return n.Color.blendVividLight(t,i)<128?0:255},blendReflect:function(n,t){return t===255?t:Math.min(255,n*n/(255-t))},blendGlow:function(t,i){return n.Color.blendReflect(i,t)},blendPhoenix:function(n,t){return Math.min(n,t)-Math.max(n,t)+255}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics=function(n,t){t=t||{};this.game=n;this.config=t;this.arcade=null;this.p2=null;this.ninja=null;this.box2d=null;this.chipmunk=null;this.matter=null;this.parseConfig()};n.Physics.ARCADE=0;n.Physics.P2JS=1;n.Physics.NINJA=2;n.Physics.BOX2D=3;n.Physics.CHIPMUNK=4;n.Physics.MATTERJS=5;n.Physics.prototype={parseConfig:function(){(!this.config.hasOwnProperty("arcade")||this.config.arcade===!0)&&n.Physics.hasOwnProperty("Arcade")&&(this.arcade=new n.Physics.Arcade(this.game));this.config.hasOwnProperty("ninja")&&this.config.ninja===!0&&n.Physics.hasOwnProperty("Ninja")&&(this.ninja=new n.Physics.Ninja(this.game));this.config.hasOwnProperty("p2")&&this.config.p2===!0&&n.Physics.hasOwnProperty("P2")&&(this.p2=new n.Physics.P2(this.game,this.config));this.config.hasOwnProperty("box2d")&&this.config.box2d===!0&&n.Physics.hasOwnProperty("BOX2D")&&(this.box2d=new n.Physics.Box2D(this.game,this.config));this.config.hasOwnProperty("matter")&&this.config.matter===!0&&n.Physics.hasOwnProperty("Matter")&&(this.matter=new n.Physics.Matter(this.game,this.config))},startSystem:function(t){t===n.Physics.ARCADE?this.arcade=new n.Physics.Arcade(this.game):t===n.Physics.P2JS?this.p2===null?this.p2=new n.Physics.P2(this.game,this.config):this.p2.reset():t===n.Physics.NINJA?this.ninja=new n.Physics.Ninja(this.game):t===n.Physics.BOX2D?this.box2d===null?this.box2d=new n.Physics.Box2D(this.game,this.config):this.box2d.reset():t===n.Physics.MATTERJS&&(this.matter===null?this.matter=new n.Physics.Matter(this.game,this.config):this.matter.reset())},enable:function(t,i,r){i===undefined&&(i=n.Physics.ARCADE);r===undefined&&(r=!1);i===n.Physics.ARCADE?this.arcade.enable(t):i===n.Physics.P2JS&&this.p2?this.p2.enable(t,r):i===n.Physics.NINJA&&this.ninja?this.ninja.enableAABB(t):i===n.Physics.BOX2D&&this.box2d?this.box2d.enable(t):i===n.Physics.MATTERJS&&this.matter?this.matter.enable(t):console.warn(t.key+" is attempting to enable a physics body using an unknown physics system.")},preUpdate:function(){this.p2&&this.p2.preUpdate();this.box2d&&this.box2d.preUpdate();this.matter&&this.matter.preUpdate()},update:function(){this.p2&&this.p2.update();this.box2d&&this.box2d.update();this.matter&&this.matter.update()},setBoundsToWorld:function(){this.arcade&&this.arcade.setBoundsToWorld();this.ninja&&this.ninja.setBoundsToWorld();this.p2&&this.p2.setBoundsToWorld();this.box2d&&this.box2d.setBoundsToWorld();this.matter&&this.matter.setBoundsToWorld()},clear:function(){this.p2&&this.p2.clear();this.box2d&&this.box2d.clear();this.matter&&this.matter.clear()},reset:function(){this.p2&&this.p2.reset();this.box2d&&this.box2d.reset();this.matter&&this.matter.reset()},destroy:function(){this.p2&&this.p2.destroy();this.box2d&&this.box2d.destroy();this.matter&&this.matter.destroy();this.arcade=null;this.ninja=null;this.p2=null;this.box2d=null;this.matter=null}};n.Physics.prototype.constructor=n.Physics;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.Arcade=function(t){this.game=t;this.gravity=new n.Point;this.bounds=new n.Rectangle(0,0,t.world.width,t.world.height);this.checkCollision={up:!0,down:!0,left:!0,right:!0};this.maxObjects=10;this.maxLevels=4;this.OVERLAP_BIAS=4;this.forceX=!1;this.sortDirection=n.Physics.Arcade.LEFT_RIGHT;this.skipQuadTree=!0;this.isPaused=!1;this.quadTree=new n.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this._total=0;this.setBoundsToWorld()};n.Physics.Arcade.prototype.constructor=n.Physics.Arcade;n.Physics.Arcade.SORT_NONE=0;n.Physics.Arcade.LEFT_RIGHT=1;n.Physics.Arcade.RIGHT_LEFT=2;n.Physics.Arcade.TOP_BOTTOM=3;n.Physics.Arcade.BOTTOM_TOP=4;n.Physics.Arcade.prototype={setBounds:function(n,t,i,r){this.bounds.setTo(n,t,i,r)},setBoundsToWorld:function(){this.bounds.copyFrom(this.game.world.bounds)},enable:function(t,i){i===undefined&&(i=!0);var r=1;if(Array.isArray(t))for(r=t.length;r--;)t[r]instanceof n.Group?this.enable(t[r].children,i):(this.enableBody(t[r]),i&&t[r].hasOwnProperty("children")&&t[r].children.length>0&&this.enable(t[r],!0));else t instanceof n.Group?this.enable(t.children,i):(this.enableBody(t),i&&t.hasOwnProperty("children")&&t.children.length>0&&this.enable(t.children,!0))},enableBody:function(t){t.hasOwnProperty("body")&&t.body===null&&(t.body=new n.Physics.Arcade.Body(t),t.parent&&t.parent instanceof n.Group&&t.parent.addToHash(t))},updateMotion:function(n){if(n.allowRotation){var t=this.computeVelocity(0,n,n.angularVelocity,n.angularAcceleration,n.angularDrag,n.maxAngular)-n.angularVelocity;n.angularVelocity+=t;n.rotation+=n.angularVelocity*this.game.time.physicsElapsed}n.velocity.x=this.computeVelocity(1,n,n.velocity.x,n.acceleration.x,n.drag.x,n.maxVelocity.x);n.velocity.y=this.computeVelocity(2,n,n.velocity.y,n.acceleration.y,n.drag.y,n.maxVelocity.y)},computeVelocity:function(n,t,i,r,u,f){return f===undefined&&(f=1e4),n===1&&t.allowGravity?i+=(this.gravity.x+t.gravity.x)*this.game.time.physicsElapsed:n===2&&t.allowGravity&&(i+=(this.gravity.y+t.gravity.y)*this.game.time.physicsElapsed),r?i+=r*this.game.time.physicsElapsed:u&&t.allowDrag&&(u*=this.game.time.physicsElapsed,i-u>0?i-=u:i+u<0?i+=u:i=0),i>f?i=f:i<-f&&(i=-f),i},overlap:function(n,t,i,r,u){return i=i||null,r=r||null,u=u||i,this._total=0,this.collideObjects(n,t,i,r,u,!0),this._total>0},collide:function(n,t,i,r,u){return i=i||null,r=r||null,u=u||i,this._total=0,this.collideObjects(n,t,i,r,u,!1),this._total>0},sortLeftRight:function(n,t){return!n.body||!t.body?0:n.body.x-t.body.x},sortRightLeft:function(n,t){return!n.body||!t.body?0:t.body.x-n.body.x},sortTopBottom:function(n,t){return!n.body||!t.body?0:n.body.y-t.body.y},sortBottomTop:function(n,t){return!n.body||!t.body?0:t.body.y-n.body.y},sort:function(t,i){t.physicsSortDirection!==null?i=t.physicsSortDirection:i===undefined&&(i=this.sortDirection);i===n.Physics.Arcade.LEFT_RIGHT?t.hash.sort(this.sortLeftRight):i===n.Physics.Arcade.RIGHT_LEFT?t.hash.sort(this.sortRightLeft):i===n.Physics.Arcade.TOP_BOTTOM?t.hash.sort(this.sortTopBottom):i===n.Physics.Arcade.BOTTOM_TOP&&t.hash.sort(this.sortBottomTop)},collideObjects:function(n,t,i,r,u,f){var e,o;if(!Array.isArray(n)&&Array.isArray(t))for(e=0;e<t.length;e++)t[e]&&this.collideHandler(n,t[e],i,r,u,f);else if(Array.isArray(n)&&!Array.isArray(t))for(e=0;e<n.length;e++)n[e]&&this.collideHandler(n[e],t,i,r,u,f);else if(Array.isArray(n)&&Array.isArray(t)){for(e=0;e<n.length;e++)if(n[e])for(o=0;o<t.length;o++)t[o]&&this.collideHandler(n[e],t[o],i,r,u,f)}else this.collideHandler(n,t,i,r,u,f)},collideHandler:function(t,i,r,u,f,e){if(i===undefined&&t.physicsType===n.GROUP){this.sort(t);this.collideGroupVsSelf(t,r,u,f,e);return}t&&i&&t.exists&&i.exists&&(this.sortDirection!==n.Physics.Arcade.SORT_NONE&&(t.physicsType===n.GROUP&&this.sort(t),i.physicsType===n.GROUP&&this.sort(i)),t.physicsType===n.SPRITE?i.physicsType===n.SPRITE?this.collideSpriteVsSprite(t,i,r,u,f,e):i.physicsType===n.GROUP?this.collideSpriteVsGroup(t,i,r,u,f,e):i.physicsType===n.TILEMAPLAYER&&this.collideSpriteVsTilemapLayer(t,i,r,u,f,e):t.physicsType===n.GROUP?i.physicsType===n.SPRITE?this.collideSpriteVsGroup(i,t,r,u,f,e):i.physicsType===n.GROUP?this.collideGroupVsGroup(t,i,r,u,f,e):i.physicsType===n.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(t,i,r,u,f,e):t.physicsType===n.TILEMAPLAYER&&(i.physicsType===n.SPRITE?this.collideSpriteVsTilemapLayer(i,t,r,u,f,e):i.physicsType===n.GROUP&&this.collideGroupVsTilemapLayer(i,t,r,u,f,e)))},collideSpriteVsSprite:function(n,t,i,r,u,f){return!n.body||!t.body?!1:(this.separate(n.body,t.body,r,u,f)&&(i&&i.call(u,n,t),this._total++),!0)},collideSpriteVsGroup:function(t,i,r,u,f,e){var o,h,c,s;if(i.length!==0&&t.body)if(this.skipQuadTree||t.body.skipQuadTree){for(o={},s=0;s<i.hash.length;s++)if(h=i.hash[s],h&&h.exists&&h.body){if(o=h.body.getBounds(o),this.sortDirection===n.Physics.Arcade.LEFT_RIGHT){if(t.body.right<o.x)break;else if(o.right<t.body.x)continue}else if(this.sortDirection===n.Physics.Arcade.RIGHT_LEFT){if(t.body.x>o.right)break;else if(o.x>t.body.right)continue}else if(this.sortDirection===n.Physics.Arcade.TOP_BOTTOM){if(t.body.bottom<o.y)break;else if(o.bottom<t.body.y)continue}else if(this.sortDirection===n.Physics.Arcade.BOTTOM_TOP)if(t.body.y>o.bottom)break;else if(o.y>t.body.bottom)continue;this.collideSpriteVsSprite(t,h,r,u,f,e)}}else for(this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(i),c=this.quadTree.retrieve(t),s=0;s<c.length;s++)this.separate(t.body,c[s],u,f,e)&&(r&&r.call(f,t,c[s].sprite),this._total++)},collideGroupVsSelf:function(t,i,r,u,f){var c,o,s,l,e,h;if(t.length!==0)for(c=0;c<t.hash.length;c++)if(o={},s=t.hash[c],s&&s.exists&&s.body)for(o=s.body.getBounds(o),l=c+1;l<t.hash.length;l++)if(e={},h=t.hash[l],h&&h.exists&&h.body){if(e=h.body.getBounds(e),this.sortDirection===n.Physics.Arcade.LEFT_RIGHT){if(o.right<e.x)break;else if(e.right<o.x)continue}else if(this.sortDirection===n.Physics.Arcade.RIGHT_LEFT){if(o.x>e.right)continue;else if(e.x>o.right)break}else if(this.sortDirection===n.Physics.Arcade.TOP_BOTTOM){if(o.bottom<e.y)continue;else if(e.bottom<o.y)break}else if(this.sortDirection===n.Physics.Arcade.BOTTOM_TOP)if(o.y>e.bottom)continue;else if(e.y>s.body.bottom)break;this.collideSpriteVsSprite(s,h,i,r,u,f)}},collideGroupVsGroup:function(t,i,r,u,f,e){if(t.length!==0&&i.length!==0)for(var o=0;o<t.children.length;o++)t.children[o].exists&&(t.children[o].physicsType===n.GROUP?this.collideGroupVsGroup(t.children[o],i,r,u,f,e):this.collideSpriteVsGroup(t.children[o],i,r,u,f,e))},separate:function(n,t,i,r,u){var s,h,c;if(!n.enable||!t.enable||n.checkCollision.none||t.checkCollision.none||!this.intersects(n,t)||i&&i.call(r,n.sprite,t.sprite)===!1)return!1;if(n.isCircle&&t.isCircle)return this.separateCircle(n,t,u);if(n.isCircle!==t.isCircle){var f=n.isCircle?t:n,l=n.isCircle?n:t,e={x:f.x,y:f.y,right:f.right,bottom:f.bottom},o=l.center;if((o.y<e.y||o.y>e.bottom)&&(o.x<e.x||o.x>e.right))return this.separateCircle(n,t,u)}return s=!1,h=!1,this.forceX||Math.abs(this.gravity.y+n.gravity.y)<Math.abs(this.gravity.x+n.gravity.x)?(s=this.separateX(n,t,u),this.intersects(n,t)&&(h=this.separateY(n,t,u))):(h=this.separateY(n,t,u),this.intersects(n,t)&&(s=this.separateX(n,t,u))),c=s||h,c&&(u?(n.onOverlap&&n.onOverlap.dispatch(n.sprite,t.sprite),t.onOverlap&&t.onOverlap.dispatch(t.sprite,n.sprite)):(n.onCollide&&n.onCollide.dispatch(n.sprite,t.sprite),t.onCollide&&t.onCollide.dispatch(t.sprite,n.sprite))),c},intersects:function(t,i){return t===i?!1:t.isCircle?i.isCircle?n.Math.distance(t.center.x,t.center.y,i.center.x,i.center.y)<=t.halfWidth+i.halfWidth:this.circleBodyIntersects(t,i):i.isCircle?this.circleBodyIntersects(i,t):t.right<=i.position.x?!1:t.bottom<=i.position.y?!1:t.position.x>=i.right?!1:t.position.y>=i.bottom?!1:!0},circleBodyIntersects:function(t,i){var r=n.Math.clamp(t.center.x,i.left,i.right),u=n.Math.clamp(t.center.y,i.top,i.bottom),f=(t.center.x-r)*(t.center.x-r),e=(t.center.y-u)*(t.center.y-u);return f+e<=t.halfWidth*t.halfWidth},separateCircle:function(t,i,r){var e,f;this.getOverlapX(t,i);this.getOverlapY(t,i);var a=i.center.x-t.center.x,v=i.center.y-t.center.y,u=Math.atan2(v,a),o=0;if(t.isCircle!==i.isCircle?(e={x:i.isCircle?t.position.x:i.position.x,y:i.isCircle?t.position.y:i.position.y,right:i.isCircle?t.right:i.right,bottom:i.isCircle?t.bottom:i.bottom},f={x:t.isCircle?t.center.x:i.center.x,y:t.isCircle?t.center.y:i.center.y,radius:t.isCircle?t.halfWidth:i.halfWidth},f.y<e.y?f.x<e.x?o=n.Math.distance(f.x,f.y,e.x,e.y)-f.radius:f.x>e.right&&(o=n.Math.distance(f.x,f.y,e.right,e.y)-f.radius):f.y>e.bottom&&(f.x<e.x?o=n.Math.distance(f.x,f.y,e.x,e.bottom)-f.radius:f.x>e.right&&(o=n.Math.distance(f.x,f.y,e.right,e.bottom)-f.radius)),o*=-1):o=t.halfWidth+i.halfWidth-n.Math.distance(t.center.x,t.center.y,i.center.x,i.center.y),r||o===0||t.immovable&&i.immovable||t.customSeparateX||i.customSeparateX)return o!==0&&(t.onOverlap&&t.onOverlap.dispatch(t.sprite,i.sprite),i.onOverlap&&i.onOverlap.dispatch(i.sprite,t.sprite)),o!==0;var s={x:t.velocity.x*Math.cos(u)+t.velocity.y*Math.sin(u),y:-t.velocity.x*Math.sin(u)+t.velocity.y*Math.cos(u)},h={x:i.velocity.x*Math.cos(u)+i.velocity.y*Math.sin(u),y:-i.velocity.x*Math.sin(u)+i.velocity.y*Math.cos(u)},c=((t.mass-i.mass)*s.x+2*i.mass*h.x)/(t.mass+i.mass),l=(2*t.mass*s.x+(i.mass-t.mass)*h.x)/(t.mass+i.mass);return t.immovable||(t.velocity.x=(c*Math.cos(u)-s.y*Math.sin(u))*t.bounce.x,t.velocity.y=(s.y*Math.cos(u)+c*Math.sin(u))*t.bounce.y),i.immovable||(i.velocity.x=(l*Math.cos(u)-h.y*Math.sin(u))*i.bounce.x,i.velocity.y=(h.y*Math.cos(u)+l*Math.sin(u))*i.bounce.y),Math.abs(u)<Math.PI/2?t.velocity.x>0&&!t.immovable&&i.velocity.x>t.velocity.x?t.velocity.x*=-1:i.velocity.x<0&&!i.immovable&&t.velocity.x<i.velocity.x?i.velocity.x*=-1:t.velocity.y>0&&!t.immovable&&i.velocity.y>t.velocity.y?t.velocity.y*=-1:i.velocity.y<0&&!i.immovable&&t.velocity.y<i.velocity.y&&(i.velocity.y*=-1):Math.abs(u)>Math.PI/2&&(t.velocity.x<0&&!t.immovable&&i.velocity.x<t.velocity.x?t.velocity.x*=-1:i.velocity.x>0&&!i.immovable&&t.velocity.x>i.velocity.x?i.velocity.x*=-1:t.velocity.y<0&&!t.immovable&&i.velocity.y<t.velocity.y?t.velocity.y*=-1:i.velocity.y>0&&!i.immovable&&t.velocity.x>i.velocity.y&&(i.velocity.y*=-1)),t.immovable||(t.x+=t.velocity.x*this.game.time.physicsElapsed-o*Math.cos(u),t.y+=t.velocity.y*this.game.time.physicsElapsed-o*Math.sin(u)),i.immovable||(i.x+=i.velocity.x*this.game.time.physicsElapsed+o*Math.cos(u),i.y+=i.velocity.y*this.game.time.physicsElapsed+o*Math.sin(u)),t.onCollide&&t.onCollide.dispatch(t.sprite,i.sprite),i.onCollide&&i.onCollide.dispatch(i.sprite,t.sprite),!0},getOverlapX:function(n,t,i){var r=0,u=n.deltaAbsX()+t.deltaAbsX()+this.OVERLAP_BIAS;return n.deltaX()===0&&t.deltaX()===0?(n.embedded=!0,t.embedded=!0):n.deltaX()>t.deltaX()?(r=n.right-t.x,r>u&&!i||n.checkCollision.right===!1||t.checkCollision.left===!1?r=0:(n.touching.none=!1,n.touching.right=!0,t.touching.none=!1,t.touching.left=!0)):n.deltaX()<t.deltaX()&&(r=n.x-t.width-t.x,-r>u&&!i||n.checkCollision.left===!1||t.checkCollision.right===!1?r=0:(n.touching.none=!1,n.touching.left=!0,t.touching.none=!1,t.touching.right=!0)),n.overlapX=r,t.overlapX=r,r},getOverlapY:function(n,t,i){var r=0,u=n.deltaAbsY()+t.deltaAbsY()+this.OVERLAP_BIAS;return n.deltaY()===0&&t.deltaY()===0?(n.embedded=!0,t.embedded=!0):n.deltaY()>t.deltaY()?(r=n.bottom-t.y,r>u&&!i||n.checkCollision.down===!1||t.checkCollision.up===!1?r=0:(n.touching.none=!1,n.touching.down=!0,t.touching.none=!1,t.touching.up=!0)):n.deltaY()<t.deltaY()&&(r=n.y-t.bottom,-r>u&&!i||n.checkCollision.up===!1||t.checkCollision.down===!1?r=0:(n.touching.none=!1,n.touching.up=!0,t.touching.none=!1,t.touching.down=!0)),n.overlapY=r,t.overlapY=r,r},separateX:function(n,t,i){var r=this.getOverlapX(n,t,i),u,f;if(i||r===0||n.immovable&&t.immovable||n.customSeparateX||t.customSeparateX)return r!==0||n.embedded&&t.embedded;if(u=n.velocity.x,f=t.velocity.x,n.immovable||t.immovable)n.immovable?(t.x+=r,t.velocity.x=u-f*t.bounce.x,n.moves&&(t.y+=(n.y-n.prev.y)*n.friction.y)):(n.x-=r,n.velocity.x=f-u*n.bounce.x,t.moves&&(n.y+=(t.y-t.prev.y)*t.friction.y));else{r*=.5;n.x-=r;t.x+=r;var o=Math.sqrt(f*f*t.mass/n.mass)*(f>0?1:-1),s=Math.sqrt(u*u*n.mass/t.mass)*(u>0?1:-1),e=(o+s)*.5;o-=e;s-=e;n.velocity.x=e+o*n.bounce.x;t.velocity.x=e+s*t.bounce.x}return!0},separateY:function(n,t,i){var r=this.getOverlapY(n,t,i),u,f;if(i||r===0||n.immovable&&t.immovable||n.customSeparateY||t.customSeparateY)return r!==0||n.embedded&&t.embedded;if(u=n.velocity.y,f=t.velocity.y,n.immovable||t.immovable)n.immovable?(t.y+=r,t.velocity.y=u-f*t.bounce.y,n.moves&&(t.x+=(n.x-n.prev.x)*n.friction.x)):(n.y-=r,n.velocity.y=f-u*n.bounce.y,t.moves&&(n.x+=(t.x-t.prev.x)*t.friction.x));else{r*=.5;n.y-=r;t.y+=r;var o=Math.sqrt(f*f*t.mass/n.mass)*(f>0?1:-1),s=Math.sqrt(u*u*n.mass/t.mass)*(u>0?1:-1),e=(o+s)*.5;o-=e;s-=e;n.velocity.y=e+o*n.bounce.y;t.velocity.y=e+s*t.bounce.y}return!0},getObjectsUnderPointer:function(n,t,i,r){if(t.length!==0&&n.exists)return this.getObjectsAtLocation(n.x,n.y,t,i,r,n)},getObjectsAtLocation:function(t,i,r,u,f,e){var o;this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(r);var c=new n.Rectangle(t,i,1,1),h=[],s=this.quadTree.retrieve(c);for(o=0;o<s.length;o++)s[o].hitTest(t,i)&&(u&&u.call(f,e,s[o].sprite),h.push(s[o].sprite));return h},moveToObject:function(t,i,r,u){r===undefined&&(r=60);u===undefined&&(u=0);var f=n.Point.angle(i,t);return u>0&&(r=this.distanceBetween(t,i)/(u/1e3)),t.body.velocity.setToPolar(f,r),f},moveToPointer:function(n,t,i,r){t===undefined&&(t=60);i=i||this.game.input.activePointer;r===undefined&&(r=0);var u=this.angleToPointer(n,i);return r>0&&(t=this.distanceToPointer(n,i)/(r/1e3)),n.body.velocity.setToPolar(u,t),u},moveToXY:function(n,t,i,r,u){r===undefined&&(r=60);u===undefined&&(u=0);var f=Math.atan2(i-n.y,t-n.x);return u>0&&(r=this.distanceToXY(n,t,i)/(u/1e3)),n.body.velocity.setToPolar(f,r),f},velocityFromAngle:function(t,i,r){return i===undefined&&(i=60),r=r||new n.Point,r.setToPolar(t,i,!0)},velocityFromRotation:function(t,i,r){return i===undefined&&(i=60),r=r||new n.Point,r.setToPolar(t,i)},accelerationFromRotation:function(t,i,r){return i===undefined&&(i=60),r=r||new n.Point,r.setToPolar(t,i)},accelerateToObject:function(n,t,i,r,u){i===undefined&&(i=60);r===undefined&&(r=1e3);u===undefined&&(u=1e3);var f=this.angleBetween(n,t);return n.body.acceleration.setToPolar(f,i),n.body.maxVelocity.setTo(r,u),f},accelerateToPointer:function(n,t,i,r,u){i===undefined&&(i=60);t===undefined&&(t=this.game.input.activePointer);r===undefined&&(r=1e3);u===undefined&&(u=1e3);var f=this.angleToPointer(n,t);return n.body.acceleration.setToPolar(f,i),n.body.maxVelocity.setTo(r,u),f},accelerateToXY:function(n,t,i,r,u,f){r===undefined&&(r=60);u===undefined&&(u=1e3);f===undefined&&(f=1e3);var e=this.angleToXY(n,t,i);return n.body.acceleration.setTo(e,r),n.body.maxVelocity.setTo(u,f),e},distanceBetween:function(n,t,i,r){i===undefined&&(i=!1);var u,f;return r?(u=n.centerX-t.centerX,f=n.centerY-t.centerY):i?(u=n.world.x-t.world.x,f=n.world.y-t.world.y):(u=n.x-t.x,f=n.y-t.y),Math.sqrt(u*u+f*f)},distanceToXY:function(n,t,i,r){r===undefined&&(r=!1);var u=r?n.world.x-t:n.x-t,f=r?n.world.y-i:n.y-i;return Math.sqrt(u*u+f*f)},distanceToPointer:function(n,t,i){t===undefined&&(t=this.game.input.activePointer);i===undefined&&(i=!1);var r=i?n.world.x-t.worldX:n.x-t.worldX,u=i?n.world.y-t.worldY:n.y-t.worldY;return Math.sqrt(r*r+u*u)},closest:function(n,t,i,r){for(var f,e,o=Infinity,s=null,u=0,h=t.length;u<h;u++)f=t[u],e=this.distanceBetween(n,f,i,r),e<o&&(s=f,o=e);return s},farthest:function(n,t,i,r){for(var f,e,o=-1,s=null,u=0,h=t.length;u<h;u++)f=t[u],e=this.distanceBetween(n,f,i,r),e>o&&(s=f,o=e);return s},angleBetween:function(t,i,r){return r===undefined&&(r=!1),r?n.Point.angle(i.world,t.world):n.Point.angle(i,t)},angleBetweenCenters:function(n,t){var i=t.centerX-n.centerX,r=t.centerY-n.centerY;return Math.atan2(r,i)},angleToXY:function(n,t,i,r){return r===undefined&&(r=!1),r?Math.atan2(i-n.world.y,t-n.world.x):Math.atan2(i-n.y,t-n.x)},angleToPointer:function(n,t,i){return t===undefined&&(t=this.game.input.activePointer),i===undefined&&(i=!1),i?Math.atan2(t.worldY-n.world.y,t.worldX-n.world.x):Math.atan2(t.worldY-n.y,t.worldX-n.x)},worldAngleToPointer:function(n,t){return this.angleToPointer(n,t,!0)}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.Arcade.Body=function(t){this.sprite=t;this.game=t.game;this.type=n.Physics.ARCADE;this.enable=!0;this.isCircle=!1;this.radius=0;this.offset=new n.Point;this.position=new n.Point(t.x,t.y);this.prev=new n.Point(this.position.x,this.position.y);this.allowRotation=!0;this.rotation=t.angle;this.preRotation=t.angle;this.width=t.width;this.height=t.height;this.sourceWidth=t.width;this.sourceHeight=t.height;t.texture&&(this.sourceWidth=t.texture.frame.width,this.sourceHeight=t.texture.frame.height);this.halfWidth=Math.abs(t.width/2);this.halfHeight=Math.abs(t.height/2);this.center=new n.Point(t.x+this.halfWidth,t.y+this.halfHeight);this.velocity=new n.Point;this.newVelocity=new n.Point;this.deltaMax=new n.Point;this.acceleration=new n.Point;this.allowDrag=!0;this.drag=new n.Point;this.allowGravity=!0;this.gravity=new n.Point;this.bounce=new n.Point;this.worldBounce=null;this.onWorldBounds=null;this.onCollide=null;this.onOverlap=null;this.maxVelocity=new n.Point(1e4,1e4);this.friction=new n.Point(1,0);this.angularVelocity=0;this.angularAcceleration=0;this.angularDrag=0;this.maxAngular=1e3;this.mass=1;this.angle=0;this.speed=0;this.facing=n.NONE;this.immovable=!1;this.moves=!0;this.customSeparateX=!1;this.customSeparateY=!1;this.overlapX=0;this.overlapY=0;this.overlapR=0;this.embedded=!1;this.collideWorldBounds=!1;this.checkCollision={none:!1,up:!0,down:!0,left:!0,right:!0};this.touching={none:!0,up:!1,down:!1,left:!1,right:!1};this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1};this.blocked={none:!0,up:!1,down:!1,left:!1,right:!1};this.tilePadding=new n.Point;this.dirty=!1;this.skipQuadTree=!1;this.syncBounds=!1;this.isMoving=!1;this.stopVelocityOnCollide=!0;this.moveTimer=0;this.moveDistance=0;this.moveDuration=0;this.moveTarget=null;this.moveEnd=null;this.onMoveComplete=new n.Signal;this.movementCallback=null;this.movementCallbackContext=null;this._reset=!0;this._sx=t.scale.x;this._sy=t.scale.y;this._dx=0;this._dy=0};n.Physics.Arcade.Body.prototype={updateBounds:function(){var n,t,i;this.syncBounds?(n=this.sprite.getBounds(),n.ceilAll(),(n.width!==this.width||n.height!==this.height)&&(this.width=n.width,this.height=n.height,this._reset=!0)):(t=Math.abs(this.sprite.scale.x),i=Math.abs(this.sprite.scale.y),(t!==this._sx||i!==this._sy)&&(this.width=this.sourceWidth*t,this.height=this.sourceHeight*i,this._sx=t,this._sy=i,this._reset=!0));this._reset&&(this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.updateCenter())},updateCenter:function(){this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},preUpdate:function(){this.enable&&!this.game.physics.arcade.isPaused&&(this.dirty=!0,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.blocked.none=!0,this.blocked.up=!1,this.blocked.down=!1,this.blocked.left=!1,this.blocked.right=!1,this.overlapR=0,this.overlapX=0,this.overlapY=0,this.embedded=!1,this.updateBounds(),this.position.x=this.sprite.world.x-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x,this.position.x-=this.sprite.scale.x<0?this.width:0,this.position.y=this.sprite.world.y-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y,this.position.y-=this.sprite.scale.y<0?this.height:0,this.updateCenter(),this.rotation=this.sprite.angle,this.preRotation=this.rotation,(this._reset||this.sprite.fresh)&&(this.prev.x=this.position.x,this.prev.y=this.position.y),this.moves&&(this.game.physics.arcade.updateMotion(this),this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed),this.position.x+=this.newVelocity.x,this.position.y+=this.newVelocity.y,this.updateCenter(),(this.position.x!==this.prev.x||this.position.y!==this.prev.y)&&(this.angle=this.velocity.atan()),this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),this.collideWorldBounds&&this.checkWorldBounds()&&this.onWorldBounds&&this.onWorldBounds.dispatch(this.sprite,this.blocked.up,this.blocked.down,this.blocked.left,this.blocked.right)),this._dx=this.deltaX(),this._dy=this.deltaY(),this._reset=!1)},updateMovement:function(){var n=0,i=this.overlapX!==0||this.overlapY!==0,t;return(this.moveDuration>0?(this.moveTimer+=this.game.time.elapsedMS,n=this.moveTimer/this.moveDuration):(this.moveTarget.end.set(this.position.x,this.position.y),n=this.moveTarget.length/this.moveDistance),this.movementCallback&&(t=this.movementCallback.call(this.movementCallbackContext,this,this.velocity,n)),i||n>=1||t!==undefined&&t!==!0)?(this.stopMovement(n>=1||this.stopVelocityOnCollide&&i),!1):!0},stopMovement:function(n){this.isMoving&&(this.isMoving=!1,n&&this.velocity.set(0),this.onMoveComplete.dispatch(this.sprite,this.overlapX!==0||this.overlapY!==0))},postUpdate:function(){this.enable&&this.dirty&&(this.isMoving&&this.updateMovement(),this.dirty=!1,this.deltaX()<0?this.facing=n.LEFT:this.deltaX()>0&&(this.facing=n.RIGHT),this.deltaY()<0?this.facing=n.UP:this.deltaY()>0&&(this.facing=n.DOWN),this.moves&&(this._dx=this.deltaX(),this._dy=this.deltaY(),this.deltaMax.x!==0&&this._dx!==0&&(this._dx<0&&this._dx<-this.deltaMax.x?this._dx=-this.deltaMax.x:this._dx>0&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x)),this.deltaMax.y!==0&&this._dy!==0&&(this._dy<0&&this._dy<-this.deltaMax.y?this._dy=-this.deltaMax.y:this._dy>0&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y)),this.sprite.position.x+=this._dx,this.sprite.position.y+=this._dy,this._reset=!0),this.updateCenter(),this.allowRotation&&(this.sprite.angle+=this.deltaZ()),this.prev.x=this.position.x,this.prev.y=this.position.y)},checkWorldBounds:function(){var t=this.position,n=this.game.physics.arcade.bounds,i=this.game.physics.arcade.checkCollision,r=this.worldBounce?-this.worldBounce.x:-this.bounce.x,u=this.worldBounce?-this.worldBounce.y:-this.bounce.y;return t.x<n.x&&i.left?(t.x=n.x,this.velocity.x*=r,this.blocked.left=!0,this.blocked.none=!1):this.right>n.right&&i.right&&(t.x=n.right-this.width,this.velocity.x*=r,this.blocked.right=!0,this.blocked.none=!1),t.y<n.y&&i.up?(t.y=n.y,this.velocity.y*=u,this.blocked.up=!0,this.blocked.none=!1):this.bottom>n.bottom&&i.down&&(t.y=n.bottom-this.height,this.velocity.y*=u,this.blocked.down=!0,this.blocked.none=!1),!this.blocked.none},moveFrom:function(n,t,i){if(t===undefined&&(t=this.speed),t===0)return!1;var r;return i===undefined?(r=this.angle,i=this.game.math.radToDeg(r)):r=this.game.math.degToRad(i),this.moveTimer=0,this.moveDuration=n,i===0||i===180?this.velocity.set(Math.cos(r)*t,0):i===90||i===270?this.velocity.set(0,Math.sin(r)*t):this.velocity.setToPolar(r,t),this.isMoving=!0,!0},moveTo:function(t,i,r){var f=i/(t/1e3),u;return f===0?!1:(r===undefined?(u=this.angle,r=this.game.math.radToDeg(u)):u=this.game.math.degToRad(r),i=Math.abs(i),this.moveDuration=0,this.moveDistance=i,this.moveTarget===null&&(this.moveTarget=new n.Line,this.moveEnd=new n.Point),this.moveTarget.fromAngle(this.x,this.y,u,i),this.moveEnd.set(this.moveTarget.end.x,this.moveTarget.end.y),this.moveTarget.setTo(this.x,this.y,this.x,this.y),r===0||r===180?this.velocity.set(Math.cos(u)*f,0):r===90||r===270?this.velocity.set(0,Math.sin(u)*f):this.velocity.setToPolar(u,f),this.isMoving=!0,!0)},setSize:function(n,t,i,r){i===undefined&&(i=this.offset.x);r===undefined&&(r=this.offset.y);this.sourceWidth=n;this.sourceHeight=t;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.offset.setTo(i,r);this.updateCenter();this.isCircle=!1;this.radius=0},setCircle:function(n,t,i){t===undefined&&(t=this.offset.x);i===undefined&&(i=this.offset.y);n>0?(this.isCircle=!0,this.radius=n,this.sourceWidth=n*2,this.sourceHeight=n*2,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.setTo(t,i),this.updateCenter()):this.isCircle=!1},reset:function(n,t){this.stop();this.position.x=n-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x;this.position.x-=this.sprite.scale.x<0?this.width:0;this.position.y=t-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y;this.position.y-=this.sprite.scale.y<0?this.height:0;this.prev.x=this.position.x;this.prev.y=this.position.y;this.rotation=this.sprite.angle;this.preRotation=this.rotation;this.updateBounds();this.updateCenter()},stop:function(){this.velocity.set(0);this.acceleration.set(0);this.speed=0;this.angularVelocity=0;this.angularAcceleration=0},getBounds:function(n){return n.x=this.x,n.y=this.y,n.right=this.right,n.bottom=this.bottom,n},hitTest:function(t,i){return this.isCircle?n.Circle.contains(this,t,i):n.Rectangle.contains(this,t,i)},onFloor:function(){return this.blocked.down},onCeiling:function(){return this.blocked.up},onWall:function(){return this.blocked.left||this.blocked.right},deltaAbsX:function(){return this.deltaX()>0?this.deltaX():-this.deltaX()},deltaAbsY:function(){return this.deltaY()>0?this.deltaY():-this.deltaY()},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation},destroy:function(){this.sprite.parent&&this.sprite.parent instanceof n.Group&&this.sprite.parent.removeFromHash(this.sprite);this.sprite.body=null;this.sprite=null}};Object.defineProperty(n.Physics.Arcade.Body.prototype,"left",{get:function(){return this.position.x}});Object.defineProperty(n.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}});Object.defineProperty(n.Physics.Arcade.Body.prototype,"top",{get:function(){return this.position.y}});Object.defineProperty(n.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}});Object.defineProperty(n.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(n){this.position.x=n}});Object.defineProperty(n.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(n){this.position.y=n}});n.Physics.Arcade.Body.render=function(n,t,i,r,u){r===undefined&&(r=!0);i=i||"rgba(0,255,0,0.4)";n.fillStyle=i;n.strokeStyle=i;n.lineWidth=u||1;t.isCircle?(n.beginPath(),n.arc(t.center.x-t.game.camera.x,t.center.y-t.game.camera.y,t.halfWidth,0,2*Math.PI),r?n.fill():n.stroke()):r?n.fillRect(t.position.x-t.game.camera.x,t.position.y-t.game.camera.y,t.width,t.height):n.strokeRect(t.position.x-t.game.camera.x,t.position.y-t.game.camera.y,t.width,t.height)};n.Physics.Arcade.Body.renderBodyInfo=function(n,t){n.line("x: "+t.x.toFixed(2),"y: "+t.y.toFixed(2),"width: "+t.width,"height: "+t.height);n.line("velocity x: "+t.velocity.x.toFixed(2),"y: "+t.velocity.y.toFixed(2),"deltaX: "+t._dx.toFixed(2),"deltaY: "+t._dy.toFixed(2));n.line("acceleration x: "+t.acceleration.x.toFixed(2),"y: "+t.acceleration.y.toFixed(2),"speed: "+t.speed.toFixed(2),"angle: "+t.angle.toFixed(2));n.line("gravity x: "+t.gravity.x,"y: "+t.gravity.y,"bounce x: "+t.bounce.x.toFixed(2),"y: "+t.bounce.y.toFixed(2));n.line("touching left: "+t.touching.left,"right: "+t.touching.right,"up: "+t.touching.up,"down: "+t.touching.down);n.line("blocked left: "+t.blocked.left,"right: "+t.blocked.right,"up: "+t.blocked.up,"down: "+t.blocked.down)};n.Physics.Arcade.Body.prototype.constructor=n.Physics.Arcade.Body;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.Arcade.TilemapCollision=function(){};n.Physics.Arcade.TilemapCollision.prototype={TILE_BIAS:16,collideSpriteVsTilemapLayer:function(n,t,i,r,u,f){var o,e;if(n.body&&(o=t.getTiles(n.body.position.x-n.body.tilePadding.x-t.getTileOffsetX(),n.body.position.y-n.body.tilePadding.y-t.getTileOffsetY(),n.body.width+n.body.tilePadding.x,n.body.height+n.body.tilePadding.y,!1,!1),o.length!==0))for(e=0;e<o.length;e++)r?r.call(u,n,o[e])&&this.separateTile(e,n.body,o[e],t,f)&&(this._total++,i&&i.call(u,n,o[e])):this.separateTile(e,n.body,o[e],t,f)&&(this._total++,i&&i.call(u,n,o[e]))},collideGroupVsTilemapLayer:function(n,t,i,r,u,f){if(n.length!==0)for(var e=0;e<n.children.length;e++)n.children[e].exists&&this.collideSpriteVsTilemapLayer(n.children[e],t,i,r,u,f)},separateTile:function(n,t,i,r,u){var f,e;if(!t.enable)return!1;if(f=r.getTileOffsetX(),e=r.getTileOffsetY(),i.intersects(t.position.x-f,t.position.y-e,t.right-f,t.bottom-e)){if(u)return!0}else return!1;if(i.collisionCallback&&!i.collisionCallback.call(i.collisionCallbackContext,t.sprite,i)||typeof i.layer.callbacks!="undefined"&&i.layer.callbacks[i.index]&&!i.layer.callbacks[i.index].callback.call(i.layer.callbacks[i.index].callbackContext,t.sprite,i)||!i.faceLeft&&!i.faceRight&&!i.faceTop&&!i.faceBottom)return!1;var o=0,s=0,h=0,c=1;if(t.deltaAbsX()>t.deltaAbsY()?h=-1:t.deltaAbsX()<t.deltaAbsY()&&(c=-1),t.deltaX()!==0&&t.deltaY()!==0&&(i.faceLeft||i.faceRight)&&(i.faceTop||i.faceBottom)&&(h=Math.min(Math.abs(t.position.x-f-i.right),Math.abs(t.right-f-i.left)),c=Math.min(Math.abs(t.position.y-e-i.bottom),Math.abs(t.bottom-e-i.top))),h<c){if((i.faceLeft||i.faceRight)&&(o=this.tileCheckX(t,i,r),o!==0&&!i.intersects(t.position.x-f,t.position.y-e,t.right-f,t.bottom-e)))return!0;(i.faceTop||i.faceBottom)&&(s=this.tileCheckY(t,i,r))}else{if((i.faceTop||i.faceBottom)&&(s=this.tileCheckY(t,i,r),s!==0&&!i.intersects(t.position.x-f,t.position.y-e,t.right-f,t.bottom-e)))return!0;(i.faceLeft||i.faceRight)&&(o=this.tileCheckX(t,i,r))}return o!==0||s!==0},tileCheckX:function(n,t,i){var r=0,u=i.getTileOffsetX();return n.deltaX()<0&&!n.blocked.left&&t.collideRight&&n.checkCollision.left?t.faceRight&&n.x-u<t.right&&(r=n.x-u-t.right,r<-this.TILE_BIAS&&(r=0)):n.deltaX()>0&&!n.blocked.right&&t.collideLeft&&n.checkCollision.right&&t.faceLeft&&n.right-u>t.left&&(r=n.right-u-t.left,r>this.TILE_BIAS&&(r=0)),r!==0&&(n.customSeparateX?n.overlapX=r:this.processTileSeparationX(n,r)),r},tileCheckY:function(n,t,i){var r=0,u=i.getTileOffsetY();return n.deltaY()<0&&!n.blocked.up&&t.collideDown&&n.checkCollision.up?t.faceBottom&&n.y-u<t.bottom&&(r=n.y-u-t.bottom,r<-this.TILE_BIAS&&(r=0)):n.deltaY()>0&&!n.blocked.down&&t.collideUp&&n.checkCollision.down&&t.faceTop&&n.bottom-u>t.top&&(r=n.bottom-u-t.top,r>this.TILE_BIAS&&(r=0)),r!==0&&(n.customSeparateY?n.overlapY=r:this.processTileSeparationY(n,r)),r},processTileSeparationX:function(n,t){t<0?(n.blocked.left=!0,n.blocked.none=!1):t>0&&(n.blocked.right=!0,n.blocked.none=!1);n.position.x-=t;n.velocity.x=n.bounce.x===0?0:-n.velocity.x*n.bounce.x},processTileSeparationY:function(n,t){t<0?(n.blocked.up=!0,n.blocked.none=!1):t>0&&(n.blocked.down=!0,n.blocked.none=!1);n.position.y-=t;n.velocity.y=n.bounce.y===0?0:-n.velocity.y*n.bounce.y}};n.Utils.mixinPrototype(n.Physics.Arcade.prototype,n.Physics.Arcade.TilemapCollision.prototype);
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
p2.Body.prototype.parent=null;p2.Spring.prototype.parent=null;n.Physics.P2=function(t,i){this.game=t;i===undefined?i={gravity:[0,0],broadphase:new p2.SAPBroadphase}:(i.hasOwnProperty("gravity")||(i.gravity=[0,0]),i.hasOwnProperty("broadphase")||(i.broadphase=new p2.SAPBroadphase));this.config=i;this.world=new p2.World(this.config);this.frameRate=1/60;this.useElapsedTime=!1;this.paused=!1;this.materials=[];this.gravity=new n.Physics.P2.InversePointProxy(this,this.world.gravity);this.walls={left:null,right:null,top:null,bottom:null};this.onBodyAdded=new n.Signal;this.onBodyRemoved=new n.Signal;this.onSpringAdded=new n.Signal;this.onSpringRemoved=new n.Signal;this.onConstraintAdded=new n.Signal;this.onConstraintRemoved=new n.Signal;this.onContactMaterialAdded=new n.Signal;this.onContactMaterialRemoved=new n.Signal;this.postBroadphaseCallback=null;this.callbackContext=null;this.onBeginContact=new n.Signal;this.onEndContact=new n.Signal;i.hasOwnProperty("mpx")&&i.hasOwnProperty("pxm")&&i.hasOwnProperty("mpxi")&&i.hasOwnProperty("pxmi")&&(this.mpx=i.mpx,this.mpxi=i.mpxi,this.pxm=i.pxm,this.pxmi=i.pxmi);this.world.on("beginContact",this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.collisionGroups=[];this.nothingCollisionGroup=new n.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new n.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new n.Physics.P2.CollisionGroup(2147483648);this.boundsCollidesWith=[];this._toRemove=[];this._collisionGroupID=2;this._boundsLeft=!0;this._boundsRight=!0;this._boundsTop=!0;this._boundsBottom=!0;this._boundsOwnGroup=!1;this.setBoundsToWorld(!0,!0,!0,!0,!1)};n.Physics.P2.prototype={removeBodyNextStep:function(n){this._toRemove.push(n)},preUpdate:function(){for(var n=this._toRemove.length;n--;)this.removeBody(this._toRemove[n]);this._toRemove.length=0},enable:function(t,i,r){i===undefined&&(i=!1);r===undefined&&(r=!0);var u=1;if(Array.isArray(t))for(u=t.length;u--;)t[u]instanceof n.Group?this.enable(t[u].children,i,r):(this.enableBody(t[u],i),r&&t[u].hasOwnProperty("children")&&t[u].children.length>0&&this.enable(t[u],i,!0));else t instanceof n.Group?this.enable(t.children,i,r):(this.enableBody(t,i),r&&t.hasOwnProperty("children")&&t.children.length>0&&this.enable(t.children,i,!0))},enableBody:function(t,i){t.hasOwnProperty("body")&&t.body===null&&(t.body=new n.Physics.P2.Body(this.game,t,t.x,t.y,1),t.body.debug=i,typeof t.anchor!="undefined"&&t.anchor.set(.5))},setImpactEvents:function(n){if(n)this.world.on("impact",this.impactHandler,this);else this.world.off("impact",this.impactHandler,this)},setPostBroadphaseCallback:function(n,t){if(this.postBroadphaseCallback=n,this.callbackContext=t,n!==null)this.world.on("postBroadphase",this.postBroadphaseHandler,this);else this.world.off("postBroadphase",this.postBroadphaseHandler,this)},postBroadphaseHandler:function(n){if(this.postBroadphaseCallback&&n.pairs.length!==0)for(var t=n.pairs.length-2;t>=0;t-=2)n.pairs[t].parent&&n.pairs[t+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,n.pairs[t].parent,n.pairs[t+1].parent)&&n.pairs.splice(t,2)},impactHandler:function(n){if(n.bodyA.parent&&n.bodyB.parent){var t=n.bodyA.parent,i=n.bodyB.parent;t._bodyCallbacks[n.bodyB.id]&&t._bodyCallbacks[n.bodyB.id].call(t._bodyCallbackContext[n.bodyB.id],t,i,n.shapeA,n.shapeB);i._bodyCallbacks[n.bodyA.id]&&i._bodyCallbacks[n.bodyA.id].call(i._bodyCallbackContext[n.bodyA.id],i,t,n.shapeB,n.shapeA);t._groupCallbacks[n.shapeB.collisionGroup]&&t._groupCallbacks[n.shapeB.collisionGroup].call(t._groupCallbackContext[n.shapeB.collisionGroup],t,i,n.shapeA,n.shapeB);i._groupCallbacks[n.shapeA.collisionGroup]&&i._groupCallbacks[n.shapeA.collisionGroup].call(i._groupCallbackContext[n.shapeA.collisionGroup],i,t,n.shapeB,n.shapeA)}},beginContactHandler:function(n){n.bodyA&&n.bodyB&&(this.onBeginContact.dispatch(n.bodyA,n.bodyB,n.shapeA,n.shapeB,n.contactEquations),n.bodyA.parent&&n.bodyA.parent.onBeginContact.dispatch(n.bodyB.parent,n.bodyB,n.shapeA,n.shapeB,n.contactEquations),n.bodyB.parent&&n.bodyB.parent.onBeginContact.dispatch(n.bodyA.parent,n.bodyA,n.shapeB,n.shapeA,n.contactEquations))},endContactHandler:function(n){n.bodyA&&n.bodyB&&(this.onEndContact.dispatch(n.bodyA,n.bodyB,n.shapeA,n.shapeB),n.bodyA.parent&&n.bodyA.parent.onEndContact.dispatch(n.bodyB.parent,n.bodyB,n.shapeA,n.shapeB),n.bodyB.parent&&n.bodyB.parent.onEndContact.dispatch(n.bodyA.parent,n.bodyA,n.shapeB,n.shapeA))},setBoundsToWorld:function(n,t,i,r,u){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,n,t,i,r,u)},setWorldMaterial:function(n,t,i,r,u){t===undefined&&(t=!0);i===undefined&&(i=!0);r===undefined&&(r=!0);u===undefined&&(u=!0);t&&this.walls.left&&(this.walls.left.shapes[0].material=n);i&&this.walls.right&&(this.walls.right.shapes[0].material=n);r&&this.walls.top&&(this.walls.top.shapes[0].material=n);u&&this.walls.bottom&&(this.walls.bottom.shapes[0].material=n)},updateBoundsCollisionGroup:function(n){n===undefined&&(n=!0);var t=n?this.boundsCollisionGroup.mask:this.everythingCollisionGroup.mask;this.walls.left&&(this.walls.left.shapes[0].collisionGroup=t);this.walls.right&&(this.walls.right.shapes[0].collisionGroup=t);this.walls.top&&(this.walls.top.shapes[0].collisionGroup=t);this.walls.bottom&&(this.walls.bottom.shapes[0].collisionGroup=t);this._boundsOwnGroup=n},setBounds:function(n,t,i,r,u,f,e,o,s){u===undefined&&(u=this._boundsLeft);f===undefined&&(f=this._boundsRight);e===undefined&&(e=this._boundsTop);o===undefined&&(o=this._boundsBottom);s===undefined&&(s=this._boundsOwnGroup);this.setupWall(u,"left",n,t,1.5707963267948966,s);this.setupWall(f,"right",n+i,t,-1.5707963267948966,s);this.setupWall(e,"top",n,t,-3.1415926535897931,s);this.setupWall(o,"bottom",n,t+r,0,s);this._boundsLeft=u;this._boundsRight=f;this._boundsTop=e;this._boundsBottom=o;this._boundsOwnGroup=s},setupWall:function(n,t,i,r,u,f){n?(this.walls[t]?this.walls[t].position=[this.pxmi(i),this.pxmi(r)]:(this.walls[t]=new p2.Body({mass:0,position:[this.pxmi(i),this.pxmi(r)],angle:u}),this.walls[t].addShape(new p2.Plane),this.world.addBody(this.walls[t])),f&&(this.walls[t].shapes[0].collisionGroup=this.boundsCollisionGroup.mask)):this.walls[t]&&(this.world.removeBody(this.walls[t]),this.walls[t]=null)},pause:function(){this.paused=!0},resume:function(){this.paused=!1},update:function(){this.paused||(this.useElapsedTime?this.world.step(this.game.time.physicsElapsed):this.world.step(this.frameRate))},reset:function(){this.world.on("beginContact",this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.nothingCollisionGroup=new n.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new n.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new n.Physics.P2.CollisionGroup(2147483648);this._collisionGroupID=2;this.setBoundsToWorld(!0,!0,!0,!0,!1)},clear:function(){var t,i,r,u,n;for(this.world.time=0,this.world.fixedStepTime=0,this.world.solver&&this.world.solver.equations.length&&this.world.solver.removeAllEquations(),t=this.world.constraints,n=t.length-1;n>=0;n--)this.world.removeConstraint(t[n]);for(i=this.world.bodies,n=i.length-1;n>=0;n--)this.world.removeBody(i[n]);for(r=this.world.springs,n=r.length-1;n>=0;n--)this.world.removeSpring(r[n]);for(u=this.world.contactMaterials,n=u.length-1;n>=0;n--)this.world.removeContactMaterial(u[n]);this.world.off("beginContact",this.beginContactHandler,this);this.world.off("endContact",this.endContactHandler,this);this.postBroadphaseCallback=null;this.callbackContext=null;this.impactCallback=null;this.collisionGroups=[];this._toRemove=[];this.boundsCollidesWith=[];this.walls={left:null,right:null,top:null,bottom:null}},destroy:function(){this.clear();this.game=null},addBody:function(n){return n.data.world?!1:(this.world.addBody(n.data),this.onBodyAdded.dispatch(n),!0)},removeBody:function(n){return n.data.world===this.world&&(this.world.removeBody(n.data),this.onBodyRemoved.dispatch(n)),n},addSpring:function(t){return t instanceof n.Physics.P2.Spring||t instanceof n.Physics.P2.RotationalSpring?this.world.addSpring(t.data):this.world.addSpring(t),this.onSpringAdded.dispatch(t),t},removeSpring:function(t){return t instanceof n.Physics.P2.Spring||t instanceof n.Physics.P2.RotationalSpring?this.world.removeSpring(t.data):this.world.removeSpring(t),this.onSpringRemoved.dispatch(t),t},createDistanceConstraint:function(t,i,r,u,f,e){if(t=this.getBody(t),i=this.getBody(i),t&&i)return this.addConstraint(new n.Physics.P2.DistanceConstraint(this,t,i,r,u,f,e));console.warn("Cannot create Constraint, invalid body objects given")},createGearConstraint:function(t,i,r,u){if(t=this.getBody(t),i=this.getBody(i),t&&i)return this.addConstraint(new n.Physics.P2.GearConstraint(this,t,i,r,u));console.warn("Cannot create Constraint, invalid body objects given")},createRevoluteConstraint:function(t,i,r,u,f,e){if(t=this.getBody(t),r=this.getBody(r),t&&r)return this.addConstraint(new n.Physics.P2.RevoluteConstraint(this,t,i,r,u,f,e));console.warn("Cannot create Constraint, invalid body objects given")},createLockConstraint:function(t,i,r,u,f){if(t=this.getBody(t),i=this.getBody(i),t&&i)return this.addConstraint(new n.Physics.P2.LockConstraint(this,t,i,r,u,f));console.warn("Cannot create Constraint, invalid body objects given")},createPrismaticConstraint:function(t,i,r,u,f,e,o){if(t=this.getBody(t),i=this.getBody(i),t&&i)return this.addConstraint(new n.Physics.P2.PrismaticConstraint(this,t,i,r,u,f,e,o));console.warn("Cannot create Constraint, invalid body objects given")},addConstraint:function(n){return this.world.addConstraint(n),this.onConstraintAdded.dispatch(n),n},removeConstraint:function(n){return this.world.removeConstraint(n),this.onConstraintRemoved.dispatch(n),n},addContactMaterial:function(n){return this.world.addContactMaterial(n),this.onContactMaterialAdded.dispatch(n),n},removeContactMaterial:function(n){return this.world.removeContactMaterial(n),this.onContactMaterialRemoved.dispatch(n),n},getContactMaterial:function(n,t){return this.world.getContactMaterial(n,t)},setMaterial:function(n,t){for(var i=t.length;i--;)t[i].setMaterial(n)},createMaterial:function(t,i){t=t||"";var r=new n.Physics.P2.Material(t);return this.materials.push(r),typeof i!="undefined"&&i.setMaterial(r),r},createContactMaterial:function(t,i,r){t===undefined&&(t=this.createMaterial());i===undefined&&(i=this.createMaterial());var u=new n.Physics.P2.ContactMaterial(t,i,r);return this.addContactMaterial(u)},getBodies:function(){for(var n=[],t=this.world.bodies.length;t--;)n.push(this.world.bodies[t].parent);return n},getBody:function(t){return t instanceof p2.Body?t:t instanceof n.Physics.P2.Body?t.data:t.body&&t.body.type===n.Physics.P2JS?t.body.data:null},getSprings:function(){for(var n=[],t=this.world.springs.length;t--;)n.push(this.world.springs[t].parent);return n},getConstraints:function(){for(var n=[],t=this.world.constraints.length;t--;)n.push(this.world.constraints[t]);return n},hitTest:function(t,i,r,u){i===undefined&&(i=this.world.bodies);r===undefined&&(r=5);u===undefined&&(u=!1);for(var o=[this.pxmi(t.x),this.pxmi(t.y)],e=[],f=i.length;f--;)i[f]instanceof n.Physics.P2.Body&&!(u&&i[f].data.type===p2.Body.STATIC)?e.push(i[f].data):i[f]instanceof p2.Body&&i[f].parent&&!(u&&i[f].type===p2.Body.STATIC)?e.push(i[f]):i[f]instanceof n.Sprite&&i[f].hasOwnProperty("body")&&!(u&&i[f].body.data.type===p2.Body.STATIC)&&e.push(i[f].body.data);return this.world.hitTest(o,e,r)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(t){var i=Math.pow(2,this._collisionGroupID),r;return this.walls.left&&(this.walls.left.shapes[0].collisionMask=this.walls.left.shapes[0].collisionMask|i),this.walls.right&&(this.walls.right.shapes[0].collisionMask=this.walls.right.shapes[0].collisionMask|i),this.walls.top&&(this.walls.top.shapes[0].collisionMask=this.walls.top.shapes[0].collisionMask|i),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionMask=this.walls.bottom.shapes[0].collisionMask|i),this._collisionGroupID++,r=new n.Physics.P2.CollisionGroup(i),this.collisionGroups.push(r),t&&this.setCollisionGroup(t,r),r},setCollisionGroup:function(t,i){if(t instanceof n.Group)for(var r=0;r<t.total;r++)t.children[r].body&&t.children[r].body.type===n.Physics.P2JS&&t.children[r].body.setCollisionGroup(i);else t.body.setCollisionGroup(i)},createSpring:function(t,i,r,u,f,e,o,s,h){if(t=this.getBody(t),i=this.getBody(i),t&&i)return this.addSpring(new n.Physics.P2.Spring(this,t,i,r,u,f,e,o,s,h));console.warn("Cannot create Spring, invalid body objects given")},createRotationalSpring:function(t,i,r,u,f){if(t=this.getBody(t),i=this.getBody(i),t&&i)return this.addSpring(new n.Physics.P2.RotationalSpring(this,t,i,r,u,f));console.warn("Cannot create Rotational Spring, invalid body objects given")},createBody:function(t,i,r,u,f,e){var o,s;return(u===undefined&&(u=!1),o=new n.Physics.P2.Body(this.game,null,t,i,r),e&&(s=o.addPolygon(f,e),!s))?!1:(u&&this.world.addBody(o.data),o)},createParticle:function(t,i,r,u,f,e){var o,s;return(u===undefined&&(u=!1),o=new n.Physics.P2.Body(this.game,null,t,i,r),e&&(s=o.addPolygon(f,e),!s))?!1:(u&&this.world.addBody(o.data),o)},convertCollisionObjects:function(n,t,i){var e,f,s,r,o,u;for(i===undefined&&(i=!0),e=[],f=0,s=n.collision[t].length;f<s;f++)r=n.collision[t][f],o=r.polyline||r.polygon,o?u=this.createBody(r.x,r.y,0,i,{},o):r.rectangle&&(u=this.createBody(r.x,r.y,0,i),u.addRectangle(r.width,r.height,r.width/2,r.height/2)),u&&e.push(u);return e},clearTilemapLayerBodies:function(n,t){t=n.getLayer(t);for(var i=n.layers[t].bodies.length;i--;)n.layers[t].bodies[i].destroy();n.layers[t].bodies.length=0},convertTilemap:function(n,t,i,r){var o,a,s,v,u,h,f;t=n.getLayer(t);i===undefined&&(i=!0);r===undefined&&(r=!0);this.clearTilemapLayerBodies(n,t);var e=0,c=0,l=0;for(o=0,a=n.layers[t].height;o<a;o++)for(e=0,s=0,v=n.layers[t].width;s<v;s++)u=n.layers[t].data[o][s],u&&u.index>-1&&u.collides&&(r?(h=n.getTileRight(t,s,o),e===0&&(c=u.x*u.width,l=u.y*u.height,e=u.width),h&&h.collides?e+=u.width:(f=this.createBody(c,l,0,!1),f.addRectangle(e,u.height,e/2,u.height/2,0),i&&this.addBody(f),n.layers[t].bodies.push(f),e=0)):(f=this.createBody(u.x*u.width,u.y*u.height,0,!1),f.addRectangle(u.width,u.height,u.width/2,u.height/2,0),i&&this.addBody(f),n.layers[t].bodies.push(f)));return n.layers[t].bodies},mpx:function(n){return n*20},pxm:function(n){return n*.05},mpxi:function(n){return n*-20},pxmi:function(n){return n*-.05}};Object.defineProperty(n.Physics.P2.prototype,"friction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(n){this.world.defaultContactMaterial.friction=n}});Object.defineProperty(n.Physics.P2.prototype,"restitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(n){this.world.defaultContactMaterial.restitution=n}});Object.defineProperty(n.Physics.P2.prototype,"contactMaterial",{get:function(){return this.world.defaultContactMaterial},set:function(n){this.world.defaultContactMaterial=n}});Object.defineProperty(n.Physics.P2.prototype,"applySpringForces",{get:function(){return this.world.applySpringForces},set:function(n){this.world.applySpringForces=n}});Object.defineProperty(n.Physics.P2.prototype,"applyDamping",{get:function(){return this.world.applyDamping},set:function(n){this.world.applyDamping=n}});Object.defineProperty(n.Physics.P2.prototype,"applyGravity",{get:function(){return this.world.applyGravity},set:function(n){this.world.applyGravity=n}});Object.defineProperty(n.Physics.P2.prototype,"solveConstraints",{get:function(){return this.world.solveConstraints},set:function(n){this.world.solveConstraints=n}});Object.defineProperty(n.Physics.P2.prototype,"time",{get:function(){return this.world.time}});Object.defineProperty(n.Physics.P2.prototype,"emitImpactEvent",{get:function(){return this.world.emitImpactEvent},set:function(n){this.world.emitImpactEvent=n}});Object.defineProperty(n.Physics.P2.prototype,"sleepMode",{get:function(){return this.world.sleepMode},set:function(n){this.world.sleepMode=n}});Object.defineProperty(n.Physics.P2.prototype,"total",{get:function(){return this.world.bodies.length}});
/**
* @author       Georgios Kaleadis https://github.com/georgiee
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.FixtureList=function(n){Array.isArray(n)||(n=[n]);this.rawList=n;this.init();this.parse(this.rawList)};n.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={};this.groupedFixtures=[];this.allFixtures=[]},setCategory:function(n,t){var i=function(t){t.collisionGroup=n};this.getFixtures(t).forEach(i)},setMask:function(n,t){var i=function(t){t.collisionMask=n};this.getFixtures(t).forEach(i)},setSensor:function(n,t){var i=function(t){t.sensor=n};this.getFixtures(t).forEach(i)},setMaterial:function(n,t){var i=function(t){t.material=n};this.getFixtures(t).forEach(i)},getFixtures:function(n){var i=[],t;return n?(n instanceof Array||(n=[n]),t=this,n.forEach(function(n){t.namedFixtures[n]&&i.push(t.namedFixtures[n])}),this.flatten(i)):this.allFixtures},getFixtureByKey:function(n){return this.namedFixtures[n]},getGroup:function(n){return this.groupedFixtures[n]},parse:function(){var n,t,i,r;i=this.rawList;r=[];for(n in i)t=i[n],isNaN(+n)?this.namedFixtures[n]=this.flatten(t):(this.groupedFixtures[n]=this.groupedFixtures[n]||[],this.groupedFixtures[n]=this.groupedFixtures[n].concat(t)),r.push(this.allFixtures=this.flatten(this.groupedFixtures))},flatten:function(n){var t,i;return t=[],i=arguments.callee,n.forEach(function(n){return Array.prototype.push.apply(t,Array.isArray(n)?i(n):[n])}),t}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.PointProxy=function(n,t){this.world=n;this.destination=t};n.Physics.P2.PointProxy.prototype.constructor=n.Physics.P2.PointProxy;Object.defineProperty(n.Physics.P2.PointProxy.prototype,"x",{get:function(){return this.world.mpx(this.destination[0])},set:function(n){this.destination[0]=this.world.pxm(n)}});Object.defineProperty(n.Physics.P2.PointProxy.prototype,"y",{get:function(){return this.world.mpx(this.destination[1])},set:function(n){this.destination[1]=this.world.pxm(n)}});Object.defineProperty(n.Physics.P2.PointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(n){this.destination[0]=n}});Object.defineProperty(n.Physics.P2.PointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(n){this.destination[1]=n}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.InversePointProxy=function(n,t){this.world=n;this.destination=t};n.Physics.P2.InversePointProxy.prototype.constructor=n.Physics.P2.InversePointProxy;Object.defineProperty(n.Physics.P2.InversePointProxy.prototype,"x",{get:function(){return this.world.mpxi(this.destination[0])},set:function(n){this.destination[0]=this.world.pxmi(n)}});Object.defineProperty(n.Physics.P2.InversePointProxy.prototype,"y",{get:function(){return this.world.mpxi(this.destination[1])},set:function(n){this.destination[1]=this.world.pxmi(n)}});Object.defineProperty(n.Physics.P2.InversePointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(n){this.destination[0]=-n}});Object.defineProperty(n.Physics.P2.InversePointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(n){this.destination[1]=-n}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.Body=function(t,i,r,u,f){i=i||null;r=r||0;u=u||0;f===undefined&&(f=1);this.game=t;this.world=t.physics.p2;this.sprite=i;this.type=n.Physics.P2JS;this.offset=new n.Point;this.data=new p2.Body({position:[this.world.pxmi(r),this.world.pxmi(u)],mass:f});this.data.parent=this;this.velocity=new n.Physics.P2.InversePointProxy(this.world,this.data.velocity);this.force=new n.Physics.P2.InversePointProxy(this.world,this.data.force);this.gravity=new n.Point;this.onBeginContact=new n.Signal;this.onEndContact=new n.Signal;this.collidesWith=[];this.removeNextStep=!1;this.debugBody=null;this.dirty=!1;this._collideWorldBounds=!0;this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};this._reset=!1;i&&(this.setRectangleFromSprite(i),i.exists&&this.game.physics.p2.addBody(this))};n.Physics.P2.Body.prototype={createBodyCallback:function(n,t,i){var r=-1;n.id?r=n.id:n.body&&(r=n.body.id);r>-1&&(t===null?(delete this._bodyCallbacks[r],delete this._bodyCallbackContext[r]):(this._bodyCallbacks[r]=t,this._bodyCallbackContext[r]=i))},createGroupCallback:function(n,t,i){t===null?(delete this._groupCallbacks[n.mask],delete this._groupCallbackContext[n.mask]):(this._groupCallbacks[n.mask]=t,this._groupCallbackContext[n.mask]=i)},getCollisionMask:function(){var n=0,t;for(this._collideWorldBounds&&(n=this.game.physics.p2.boundsCollisionGroup.mask),t=0;t<this.collidesWith.length;t++)n=n|this.collidesWith[t].mask;return n},updateCollisionMask:function(n){var i=this.getCollisionMask(),t;if(n===undefined)for(t=this.data.shapes.length-1;t>=0;t--)this.data.shapes[t].collisionMask=i;else n.collisionMask=i},setCollisionGroup:function(n,t){var r=this.getCollisionMask(),i;if(t===undefined)for(i=this.data.shapes.length-1;i>=0;i--)this.data.shapes[i].collisionGroup=n.mask,this.data.shapes[i].collisionMask=r;else t.collisionGroup=n.mask,t.collisionMask=r},clearCollision:function(n,t,i){if(n===undefined&&(n=!0),t===undefined&&(t=!0),i===undefined)for(var r=this.data.shapes.length-1;r>=0;r--)n&&(this.data.shapes[r].collisionGroup=null),t&&(this.data.shapes[r].collisionMask=null);else n&&(i.collisionGroup=null),t&&(i.collisionMask=null);n&&(this.collidesWith.length=0)},removeCollisionGroup:function(n,t,i){var u,f,r;if(t===undefined&&(t=!0),Array.isArray(n))for(r=0;r<n.length;r++)u=this.collidesWith.indexOf(n[r]),u>-1&&(this.collidesWith.splice(u,1),t&&(delete this._groupCallbacks[n.mask],delete this._groupCallbackContext[n.mask]));else u=this.collidesWith.indexOf(n),u>-1&&(this.collidesWith.splice(u,1),t&&(delete this._groupCallbacks[n.mask],delete this._groupCallbackContext[n.mask]));if(f=this.getCollisionMask(),i===undefined)for(r=this.data.shapes.length-1;r>=0;r--)this.data.shapes[r].collisionMask=f;else i.collisionMask=f},collides:function(n,t,i,r){var f,u;if(Array.isArray(n))for(u=0;u<n.length;u++)this.collidesWith.indexOf(n[u])===-1&&(this.collidesWith.push(n[u]),t&&this.createGroupCallback(n[u],t,i));else this.collidesWith.indexOf(n)===-1&&(this.collidesWith.push(n),t&&this.createGroupCallback(n,t,i));if(f=this.getCollisionMask(),r===undefined)for(u=this.data.shapes.length-1;u>=0;u--)this.data.shapes[u].collisionMask=f;else r.collisionMask=f},adjustCenterOfMass:function(){this.data.adjustCenterOfMass();this.shapeChanged()},getVelocityAtPoint:function(n,t){return this.data.getVelocityAtPoint(n,t)},applyDamping:function(n){this.data.applyDamping(n)},applyImpulse:function(n,t,i){this.data.applyImpulse(n,[this.world.pxmi(t),this.world.pxmi(i)])},applyImpulseLocal:function(n,t,i){this.data.applyImpulseLocal(n,[this.world.pxmi(t),this.world.pxmi(i)])},applyForce:function(n,t,i){this.data.applyForce(n,[this.world.pxmi(t),this.world.pxmi(i)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=0},setZeroVelocity:function(){this.data.velocity[0]=0;this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=0;this.data.angularDamping=0},toLocalFrame:function(n,t){return this.data.toLocalFrame(n,t)},toWorldFrame:function(n,t){return this.data.toWorldFrame(n,t)},rotateLeft:function(n){this.data.angularVelocity=this.world.pxm(-n)},rotateRight:function(n){this.data.angularVelocity=this.world.pxm(n)},moveForward:function(n){var t=this.world.pxmi(-n),i=this.data.angle+Math.PI/2;this.data.velocity[0]=t*Math.cos(i);this.data.velocity[1]=t*Math.sin(i)},moveBackward:function(n){var t=this.world.pxmi(-n),i=this.data.angle+Math.PI/2;this.data.velocity[0]=-(t*Math.cos(i));this.data.velocity[1]=-(t*Math.sin(i))},thrust:function(n){var t=this.world.pxmi(-n),i=this.data.angle+Math.PI/2;this.data.force[0]+=t*Math.cos(i);this.data.force[1]+=t*Math.sin(i)},thrustLeft:function(n){var t=this.world.pxmi(-n),i=this.data.angle;this.data.force[0]+=t*Math.cos(i);this.data.force[1]+=t*Math.sin(i)},thrustRight:function(n){var t=this.world.pxmi(-n),i=this.data.angle;this.data.force[0]-=t*Math.cos(i);this.data.force[1]-=t*Math.sin(i)},reverse:function(n){var t=this.world.pxmi(-n),i=this.data.angle+Math.PI/2;this.data.force[0]-=t*Math.cos(i);this.data.force[1]-=t*Math.sin(i)},moveLeft:function(n){this.data.velocity[0]=this.world.pxmi(-n)},moveRight:function(n){this.data.velocity[0]=this.world.pxmi(n)},moveUp:function(n){this.data.velocity[1]=this.world.pxmi(-n)},moveDown:function(n){this.data.velocity[1]=this.world.pxmi(n)},preUpdate:function(){this.dirty=!0;this.removeNextStep&&(this.removeFromWorld(),this.removeNextStep=!1)},postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0])+this.offset.x;this.sprite.y=this.world.mpxi(this.data.position[1])+this.offset.y;this.fixedRotation||(this.sprite.rotation=this.data.angle);this.debugBody&&this.debugBody.updateSpriteTransform();this.dirty=!1},reset:function(n,t,i,r){i===undefined&&(i=!1);r===undefined&&(r=!1);this.setZeroForce();this.setZeroVelocity();this.setZeroRotation();i&&this.setZeroDamping();r&&(this.mass=1);this.x=n;this.y=t},addToWorld:function(){if(this.game.physics.p2._toRemove)for(var n=0;n<this.game.physics.p2._toRemove.length;n++)this.game.physics.p2._toRemove[n]===this&&this.game.physics.p2._toRemove.splice(n,1);this.data.world!==this.game.physics.p2.world&&this.game.physics.p2.addBody(this)},removeFromWorld:function(){this.data.world===this.game.physics.p2.world&&this.game.physics.p2.removeBodyNextStep(this)},destroy:function(){this.removeFromWorld();this.clearShapes();this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};this.debugBody&&this.debugBody.destroy(!0,!0);this.debugBody=null;this.sprite&&(this.sprite.body=null,this.sprite=null)},clearShapes:function(){for(var n=this.data.shapes.length;n--;)this.data.removeShape(this.data.shapes[n]);this.shapeChanged()},addShape:function(n,t,i,r){return t===undefined&&(t=0),i===undefined&&(i=0),r===undefined&&(r=0),this.data.addShape(n,[this.world.pxmi(t),this.world.pxmi(i)],r),this.shapeChanged(),n},addCircle:function(n,t,i,r){var u=new p2.Circle({radius:this.world.pxm(n)});return this.addShape(u,t,i,r)},addRectangle:function(n,t,i,r,u){var f=new p2.Box({width:this.world.pxm(n),height:this.world.pxm(t)});return this.addShape(f,i,r,u)},addPlane:function(n,t,i){var r=new p2.Plane;return this.addShape(r,n,t,i)},addParticle:function(n,t,i){var r=new p2.Particle;return this.addShape(r,n,t,i)},addLine:function(n,t,i,r){var u=new p2.Line({length:this.world.pxm(n)});return this.addShape(u,t,i,r)},addCapsule:function(n,t,i,r,u){var f=new p2.Capsule({length:this.world.pxm(n),radius:this.world.pxm(t)});return this.addShape(f,i,r,u)},addPolygon:function(n,t){var i,u,e,f,r,o;if(n=n||{},Array.isArray(t)||(t=Array.prototype.slice.call(arguments,1)),i=[],t.length===1&&Array.isArray(t[0]))i=t[0].slice(0);else if(Array.isArray(t[0]))i=t.slice();else if(typeof t[0]=="number")for(u=0,e=t.length;u<e;u+=2)i.push([t[u],t[u+1]]);for(f=i.length-1,i[f][0]===i[0][0]&&i[f][1]===i[0][1]&&i.pop(),r=0;r<i.length;r++)i[r][0]=this.world.pxmi(i[r][0]),i[r][1]=this.world.pxmi(i[r][1]);return o=this.data.fromPolygon(i,n),this.shapeChanged(),o},removeShape:function(n){var t=this.data.removeShape(n);return this.shapeChanged(),t},setCircle:function(n,t,i,r){return this.clearShapes(),this.addCircle(n,t,i,r)},setRectangle:function(n,t,i,r,u){return n===undefined&&(n=16),t===undefined&&(t=16),this.clearShapes(),this.addRectangle(n,t,i,r,u)},setRectangleFromSprite:function(n){return n===undefined&&(n=this.sprite),this.clearShapes(),this.addRectangle(n.width,n.height,0,0,n.rotation)},setMaterial:function(n,t){if(t===undefined)for(var i=this.data.shapes.length-1;i>=0;i--)this.data.shapes[i].material=n;else t.material=n},shapeChanged:function(){this.debugBody&&this.debugBody.draw()},addPhaserPolygon:function(n,t){for(var i,f,e=this.game.cache.getPhysicsData(n,t),r=[],u=0;u<e.length;u++)i=e[u],f=this.addFixture(i),r[i.filter.group]=r[i.filter.group]||[],r[i.filter.group]=r[i.filter.group].concat(f),i.fixtureKey&&(r[i.fixtureKey]=f);return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),r},addFixture:function(n){var s=[],u,h,i,f,e,c,r,t,o,l;if(n.circle)t=new p2.Circle({radius:this.world.pxm(n.circle.radius)}),t.collisionGroup=n.filter.categoryBits,t.collisionMask=n.filter.maskBits,t.sensor=n.isSensor,u=p2.vec2.create(),u[0]=this.world.pxmi(n.circle.position[0]-this.sprite.width/2),u[1]=this.world.pxmi(n.circle.position[1]-this.sprite.height/2),this.data.addShape(t,u),s.push(t);else for(h=n.polygons,i=p2.vec2.create(),f=0;f<h.length;f++){for(e=h[f],c=[],r=0;r<e.length;r+=2)c.push([this.world.pxmi(e[r]),this.world.pxmi(e[r+1])]);for(t=new p2.Convex({vertices:c}),o=0;o!==t.vertices.length;o++)l=t.vertices[o],p2.vec2.sub(l,l,t.centerOfMass);p2.vec2.scale(i,t.centerOfMass,1);i[0]-=this.world.pxmi(this.sprite.width/2);i[1]-=this.world.pxmi(this.sprite.height/2);t.updateTriangles();t.updateCenterOfMass();t.updateBoundingRadius();t.collisionGroup=n.filter.categoryBits;t.collisionMask=n.filter.maskBits;t.sensor=n.isSensor;this.data.addShape(t,i);s.push(t)}return s},loadPolygon:function(n,t,i){var f,e,u,h,o,r,s,c;for(f=n===null?t:this.game.cache.getPhysicsData(n,t),typeof i!="number"&&(i=1),e=p2.vec2.create(),u=0;u<f.length;u++){for(h=[],o=0;o<f[u].shape.length;o+=2)h.push([this.world.pxmi(f[u].shape[o]*i),this.world.pxmi(f[u].shape[o+1]*i)]);for(r=new p2.Convex({vertices:h}),s=0;s!==r.vertices.length;s++)c=r.vertices[s],p2.vec2.sub(c,c,r.centerOfMass);p2.vec2.scale(e,r.centerOfMass,1);e[0]-=this.world.pxmi(this.sprite.width/2);e[1]-=this.world.pxmi(this.sprite.height/2);r.updateTriangles();r.updateCenterOfMass();r.updateBoundingRadius();this.data.addShape(r,e)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),!0}};n.Physics.P2.Body.prototype.constructor=n.Physics.P2.Body;n.Physics.P2.Body.DYNAMIC=1;n.Physics.P2.Body.STATIC=2;n.Physics.P2.Body.KINEMATIC=4;Object.defineProperty(n.Physics.P2.Body.prototype,"static",{get:function(){return this.data.type===n.Physics.P2.Body.STATIC},set:function(t){t&&this.data.type!==n.Physics.P2.Body.STATIC?(this.data.type=n.Physics.P2.Body.STATIC,this.mass=0):t||this.data.type!==n.Physics.P2.Body.STATIC||(this.data.type=n.Physics.P2.Body.DYNAMIC,this.mass=1)}});Object.defineProperty(n.Physics.P2.Body.prototype,"dynamic",{get:function(){return this.data.type===n.Physics.P2.Body.DYNAMIC},set:function(t){t&&this.data.type!==n.Physics.P2.Body.DYNAMIC?(this.data.type=n.Physics.P2.Body.DYNAMIC,this.mass=1):t||this.data.type!==n.Physics.P2.Body.DYNAMIC||(this.data.type=n.Physics.P2.Body.STATIC,this.mass=0)}});Object.defineProperty(n.Physics.P2.Body.prototype,"kinematic",{get:function(){return this.data.type===n.Physics.P2.Body.KINEMATIC},set:function(t){t&&this.data.type!==n.Physics.P2.Body.KINEMATIC?(this.data.type=n.Physics.P2.Body.KINEMATIC,this.mass=4):t||this.data.type!==n.Physics.P2.Body.KINEMATIC||(this.data.type=n.Physics.P2.Body.STATIC,this.mass=0)}});Object.defineProperty(n.Physics.P2.Body.prototype,"allowSleep",{get:function(){return this.data.allowSleep},set:function(n){n!==this.data.allowSleep&&(this.data.allowSleep=n)}});Object.defineProperty(n.Physics.P2.Body.prototype,"angle",{get:function(){return n.Math.wrapAngle(n.Math.radToDeg(this.data.angle))},set:function(t){this.data.angle=n.Math.degToRad(n.Math.wrapAngle(t))}});Object.defineProperty(n.Physics.P2.Body.prototype,"angularDamping",{get:function(){return this.data.angularDamping},set:function(n){this.data.angularDamping=n}});Object.defineProperty(n.Physics.P2.Body.prototype,"angularForce",{get:function(){return this.data.angularForce},set:function(n){this.data.angularForce=n}});Object.defineProperty(n.Physics.P2.Body.prototype,"angularVelocity",{get:function(){return this.data.angularVelocity},set:function(n){this.data.angularVelocity=n}});Object.defineProperty(n.Physics.P2.Body.prototype,"damping",{get:function(){return this.data.damping},set:function(n){this.data.damping=n}});Object.defineProperty(n.Physics.P2.Body.prototype,"fixedRotation",{get:function(){return this.data.fixedRotation},set:function(n){n!==this.data.fixedRotation&&(this.data.fixedRotation=n)}});Object.defineProperty(n.Physics.P2.Body.prototype,"inertia",{get:function(){return this.data.inertia},set:function(n){this.data.inertia=n}});Object.defineProperty(n.Physics.P2.Body.prototype,"mass",{get:function(){return this.data.mass},set:function(n){n!==this.data.mass&&(this.data.mass=n,this.data.updateMassProperties())}});Object.defineProperty(n.Physics.P2.Body.prototype,"motionState",{get:function(){return this.data.type},set:function(n){n!==this.data.type&&(this.data.type=n)}});Object.defineProperty(n.Physics.P2.Body.prototype,"rotation",{get:function(){return this.data.angle},set:function(n){this.data.angle=n}});Object.defineProperty(n.Physics.P2.Body.prototype,"sleepSpeedLimit",{get:function(){return this.data.sleepSpeedLimit},set:function(n){this.data.sleepSpeedLimit=n}});Object.defineProperty(n.Physics.P2.Body.prototype,"x",{get:function(){return this.world.mpxi(this.data.position[0])},set:function(n){this.data.position[0]=this.world.pxmi(n)}});Object.defineProperty(n.Physics.P2.Body.prototype,"y",{get:function(){return this.world.mpxi(this.data.position[1])},set:function(n){this.data.position[1]=this.world.pxmi(n)}});Object.defineProperty(n.Physics.P2.Body.prototype,"id",{get:function(){return this.data.id}});Object.defineProperty(n.Physics.P2.Body.prototype,"debug",{get:function(){return this.debugBody!==null},set:function(t){t&&!this.debugBody?this.debugBody=new n.Physics.P2.BodyDebug(this.game,this.data):!t&&this.debugBody&&(this.debugBody.destroy(),this.debugBody=null)}});Object.defineProperty(n.Physics.P2.Body.prototype,"collideWorldBounds",{get:function(){return this._collideWorldBounds},set:function(n){n&&!this._collideWorldBounds?(this._collideWorldBounds=!0,this.updateCollisionMask()):!n&&this._collideWorldBounds&&(this._collideWorldBounds=!1,this.updateCollisionMask())}});
/**
* @author       George https://github.com/georgiee
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.BodyDebug=function(t,i,r){n.Group.call(this,t);var u={pixelsPerLengthUnit:t.physics.p2.mpx(1),debugPolygons:!1,lineWidth:1,alpha:.5};this.settings=Object.assign(u,r);this.ppu=this.settings.pixelsPerLengthUnit;this.ppu=-1*this.ppu;this.body=i;this.canvas=new n.Graphics(t);this.canvas.alpha=this.settings.alpha;this.add(this.canvas);this.draw();this.updateSpriteTransform()};n.Physics.P2.BodyDebug.prototype=Object.create(n.Group.prototype);n.Physics.P2.BodyDebug.prototype.constructor=n.Physics.P2.BodyDebug;Object.assign(n.Physics.P2.BodyDebug.prototype,{updateSpriteTransform:function(){this.position.x=this.body.position[0]*this.ppu;this.position.y=this.body.position[1]*this.ppu;this.rotation=this.body.angle},draw:function(){var u,n,f,c,a,e,i,o,t,r,y,v,l,s,h,p;if(o=this.body,r=this.canvas,r.clear(),f=parseInt(this.randomPastelHex(),16),e=16711680,i=this.lineWidth,o instanceof p2.Body&&o.shapes.length)for(p=o.shapes.length,c=0;c!==p;){if(n=o.shapes[c],t=n.position||0,u=n.angle||0,n instanceof p2.Circle)this.drawCircle(r,t[0]*this.ppu,t[1]*this.ppu,u,n.radius*this.ppu,f,i);else if(n instanceof p2.Capsule)this.drawCapsule(r,t[0]*this.ppu,t[1]*this.ppu,u,n.length*this.ppu,n.radius*this.ppu,e,f,i);else if(n instanceof p2.Plane)this.drawPlane(r,t[0]*this.ppu,-t[1]*this.ppu,f,e,i*5,i*10,i*10,this.ppu*100,u);else if(n instanceof p2.Line)this.drawLine(r,n.length*this.ppu,e,i);else if(n instanceof p2.Box)this.drawRectangle(r,t[0]*this.ppu,t[1]*this.ppu,u,n.width*this.ppu,n.height*this.ppu,e,f,i);else if(n instanceof p2.Convex){for(v=[],l=p2.vec2.create(),a=s=0,h=n.vertices.length;h>=0?s<h:s>h;a=h>=0?++s:--s)y=n.vertices[a],p2.vec2.rotate(l,y,u),v.push([(l[0]+t[0])*this.ppu,-(l[1]+t[1])*this.ppu]);this.drawConvex(r,v,n.triangles,e,f,i,this.settings.debugPolygons,[t[0]*this.ppu,-t[1]*this.ppu])}c++}},drawRectangle:function(n,t,i,r,u,f,e,o,s){s===undefined&&(s=1);e===undefined&&(e=0);n.lineStyle(s,e,1);n.beginFill(o);n.drawRect(t-u/2,i-f/2,u,f)},drawCircle:function(n,t,i,r,u,f,e){e===undefined&&(e=1);f===undefined&&(f=16777215);n.lineStyle(e,0,1);n.beginFill(f,1);n.drawCircle(t,i,-u*2);n.endFill();n.moveTo(t,i);n.lineTo(t+u*Math.cos(-r),i+u*Math.sin(-r))},drawLine:function(n,t,i,r){r===undefined&&(r=1);i===undefined&&(i=0);n.lineStyle(r*5,i,1);n.moveTo(-t/2,0);n.lineTo(t/2,0)},drawConvex:function(n,t,i,r,u,f,e,o){var h,s,c,l,a,v,y,b,p,w,k;if(f===undefined&&(f=1),r===undefined&&(r=0),e){for(h=[16711680,65280,255],s=0;s!==t.length+1;)l=t[s%t.length],a=t[(s+1)%t.length],y=l[0],w=l[1],b=a[0],k=a[1],n.lineStyle(f,h[s%h.length],1),n.moveTo(y,-w),n.lineTo(b,-k),n.drawCircle(y,-w,f*2),s++;return n.lineStyle(f,0,1),n.drawCircle(o[0],o[1],f*2)}for(n.lineStyle(f,r,1),n.beginFill(u),s=0;s!==t.length;)c=t[s],v=c[0],p=c[1],s===0?n.moveTo(v,-p):n.lineTo(v,-p),s++;if(n.endFill(),t.length>2)return n.moveTo(t[t.length-1][0],-t[t.length-1][1]),n.lineTo(t[0][0],-t[0][1])},drawPath:function(n,t,i,r,u){var v,f,s,h,c,l,y,p,w,b,a,e,o;for(u===undefined&&(u=1),i===undefined&&(i=0),n.lineStyle(u,i,1),typeof r=="number"&&n.beginFill(r),s=null,h=null,f=0;f<t.length;)a=t[f],e=a[0],o=a[1],(e!==s||o!==h)&&(f===0?n.moveTo(e,o):(c=s,l=h,y=e,p=o,w=t[(f+1)%t.length][0],b=t[(f+1)%t.length][1],v=(y-c)*(b-l)-(w-c)*(p-l),v!==0&&n.lineTo(e,o)),s=e,h=o),f++;typeof r=="number"&&n.endFill();t.length>2&&typeof r=="number"&&(n.moveTo(t[t.length-1][0],t[t.length-1][1]),n.lineTo(t[0][0],t[0][1]))},drawPlane:function(n,t,i,r,u,f,e,o,s,h){var a,c,l;f===undefined&&(f=1);r===undefined&&(r=16777215);n.lineStyle(f,u,11);n.beginFill(r);a=s;n.moveTo(t,-i);c=t+Math.cos(h)*this.game.width;l=i+Math.sin(h)*this.game.height;n.lineTo(c,-l);n.moveTo(t,-i);c=t+Math.cos(h)*-this.game.width;l=i+Math.sin(h)*-this.game.height;n.lineTo(c,-l)},drawCapsule:function(n,t,i,r,u,f,e,o,s){s===undefined&&(s=1);e===undefined&&(e=0);n.lineStyle(s,e,1);var h=Math.cos(r),c=Math.sin(r);n.beginFill(o,1);n.drawCircle(-u/2*h+t,-u/2*c+i,-f*2);n.drawCircle(u/2*h+t,u/2*c+i,-f*2);n.endFill();n.lineStyle(s,e,0);n.beginFill(o,1);n.moveTo(-u/2*h+f*c+t,-u/2*c+f*h+i);n.lineTo(u/2*h+f*c+t,u/2*c+f*h+i);n.lineTo(u/2*h-f*c+t,u/2*c-f*h+i);n.lineTo(-u/2*h-f*c+t,-u/2*c-f*h+i);n.endFill();n.lineStyle(s,e,1);n.moveTo(-u/2*h+f*c+t,-u/2*c+f*h+i);n.lineTo(u/2*h+f*c+t,u/2*c+f*h+i);n.moveTo(-u/2*h-f*c+t,-u/2*c-f*h+i);n.lineTo(u/2*h-f*c+t,u/2*c-f*h+i)},randomPastelHex:function(){var n,t,i,r;return i=[255,255,255],r=Math.floor(Math.random()*256),t=Math.floor(Math.random()*256),n=Math.floor(Math.random()*256),r=Math.floor((r+3*i[0])/4),t=Math.floor((t+3*i[1])/4),n=Math.floor((n+3*i[2])/4),this.rgbToHex(r,t,n)},rgbToHex:function(n,t,i){return this.componentToHex(n)+this.componentToHex(t)+this.componentToHex(i)},componentToHex:function(n){var t;return t=n.toString(16),t.length===2?t:t+"0"}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.Spring=function(n,t,i,r,u,f,e,o,s,h){this.game=n.game;this.world=n;r===undefined&&(r=1);u===undefined&&(u=100);f===undefined&&(f=1);r=n.pxm(r);var c={restLength:r,stiffness:u,damping:f};typeof e!="undefined"&&e!==null&&(c.worldAnchorA=[n.pxm(e[0]),n.pxm(e[1])]);typeof o!="undefined"&&o!==null&&(c.worldAnchorB=[n.pxm(o[0]),n.pxm(o[1])]);typeof s!="undefined"&&s!==null&&(c.localAnchorA=[n.pxm(s[0]),n.pxm(s[1])]);typeof h!="undefined"&&h!==null&&(c.localAnchorB=[n.pxm(h[0]),n.pxm(h[1])]);this.data=new p2.LinearSpring(t,i,c);this.data.parent=this};n.Physics.P2.Spring.prototype.constructor=n.Physics.P2.Spring;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.RotationalSpring=function(n,t,i,r,u,f){this.game=n.game;this.world=n;r===undefined&&(r=null);u===undefined&&(u=100);f===undefined&&(f=1);r&&(r=n.pxm(r));var e={restAngle:r,stiffness:u,damping:f};this.data=new p2.RotationalSpring(t,i,e);this.data.parent=this};n.Physics.P2.Spring.prototype.constructor=n.Physics.P2.Spring;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.Material=function(n){this.name=n;p2.Material.call(this)};n.Physics.P2.Material.prototype=Object.create(p2.Material.prototype);n.Physics.P2.Material.prototype.constructor=n.Physics.P2.Material;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.ContactMaterial=function(n,t,i){p2.ContactMaterial.call(this,n,t,i)};n.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype);n.Physics.P2.ContactMaterial.prototype.constructor=n.Physics.P2.ContactMaterial;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.CollisionGroup=function(n){this.mask=n};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.DistanceConstraint=function(n,t,i,r,u,f,e){r===undefined&&(r=100);u===undefined&&(u=[0,0]);f===undefined&&(f=[0,0]);e===undefined&&(e=Number.MAX_VALUE);this.game=n.game;this.world=n;r=n.pxm(r);u=[n.pxmi(u[0]),n.pxmi(u[1])];f=[n.pxmi(f[0]),n.pxmi(f[1])];var o={distance:r,localAnchorA:u,localAnchorB:f,maxForce:e};p2.DistanceConstraint.call(this,t,i,o)};n.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype);n.Physics.P2.DistanceConstraint.prototype.constructor=n.Physics.P2.DistanceConstraint;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.GearConstraint=function(n,t,i,r,u){r===undefined&&(r=0);u===undefined&&(u=1);this.game=n.game;this.world=n;var f={angle:r,ratio:u};p2.GearConstraint.call(this,t,i,f)};n.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype);n.Physics.P2.GearConstraint.prototype.constructor=n.Physics.P2.GearConstraint;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.LockConstraint=function(n,t,i,r,u,f){r===undefined&&(r=[0,0]);u===undefined&&(u=0);f===undefined&&(f=Number.MAX_VALUE);this.game=n.game;this.world=n;r=[n.pxm(r[0]),n.pxm(r[1])];var e={localOffsetB:r,localAngleB:u,maxForce:f};p2.LockConstraint.call(this,t,i,e)};n.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype);n.Physics.P2.LockConstraint.prototype.constructor=n.Physics.P2.LockConstraint;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.PrismaticConstraint=function(n,t,i,r,u,f,e,o){r===undefined&&(r=!0);u===undefined&&(u=[0,0]);f===undefined&&(f=[0,0]);e===undefined&&(e=[0,0]);o===undefined&&(o=Number.MAX_VALUE);this.game=n.game;this.world=n;u=[n.pxmi(u[0]),n.pxmi(u[1])];f=[n.pxmi(f[0]),n.pxmi(f[1])];var s={localAnchorA:u,localAnchorB:f,localAxisA:e,maxForce:o,disableRotationalLock:!r};p2.PrismaticConstraint.call(this,t,i,s)};n.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype);n.Physics.P2.PrismaticConstraint.prototype.constructor=n.Physics.P2.PrismaticConstraint;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.P2.RevoluteConstraint=function(n,t,i,r,u,f,e){f===undefined&&(f=Number.MAX_VALUE);e===undefined&&(e=null);this.game=n.game;this.world=n;i=[n.pxmi(i[0]),n.pxmi(i[1])];u=[n.pxmi(u[0]),n.pxmi(u[1])];e&&(e=[n.pxmi(e[0]),n.pxmi(e[1])]);var o={worldPivot:e,localPivotA:i,localPivotB:u,maxForce:f};p2.RevoluteConstraint.call(this,t,r,o)};n.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype);n.Physics.P2.RevoluteConstraint.prototype.constructor=n.Physics.P2.RevoluteConstraint;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.ImageCollection=function(n,t,i,r,u,f,e){(i===undefined||i<=0)&&(i=32);(r===undefined||r<=0)&&(r=32);u===undefined&&(u=0);f===undefined&&(f=0);this.name=n;this.firstgid=t|0;this.imageWidth=i|0;this.imageHeight=r|0;this.imageMargin=u|0;this.imageSpacing=f|0;this.properties=e||{};this.images=[];this.total=0};n.ImageCollection.prototype={containsImageIndex:function(n){return n>=this.firstgid&&n<this.firstgid+this.total},addImage:function(n,t){this.images.push({gid:n,image:t});this.total++}};n.ImageCollection.prototype.constructor=n.ImageCollection;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Tile=function(n,t,i,r,u,f){this.layer=n;this.index=t;this.x=i;this.y=r;this.rotation=0;this.flipped=!1;this.worldX=i*u;this.worldY=r*f;this.width=u;this.height=f;this.centerX=Math.abs(u/2);this.centerY=Math.abs(f/2);this.alpha=1;this.properties={};this.scanned=!1;this.faceTop=!1;this.faceBottom=!1;this.faceLeft=!1;this.faceRight=!1;this.collideLeft=!1;this.collideRight=!1;this.collideUp=!1;this.collideDown=!1;this.collisionCallback=null;this.collisionCallbackContext=this;this.debug=!1};n.Tile.prototype={containsPoint:function(n,t){return!(n<this.worldX||t<this.worldY||n>this.right||t>this.bottom)},intersects:function(n,t,i,r){return i<=this.worldX?!1:r<=this.worldY?!1:n>=this.worldX+this.width?!1:t>=this.worldY+this.height?!1:!0},setCollisionCallback:function(n,t){this.collisionCallback=n;this.collisionCallbackContext=t},destroy:function(){this.collisionCallback=null;this.collisionCallbackContext=null;this.properties=null},setCollision:function(n,t,i,r){this.collideLeft=n;this.collideRight=t;this.collideUp=i;this.collideDown=r;this.faceLeft=n;this.faceRight=t;this.faceTop=i;this.faceBottom=r},resetCollision:function(){this.collideLeft=!1;this.collideRight=!1;this.collideUp=!1;this.collideDown=!1;this.faceTop=!1;this.faceBottom=!1;this.faceLeft=!1;this.faceRight=!1},isInteresting:function(n,t){return n&&t?this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback:n?this.collideLeft||this.collideRight||this.collideUp||this.collideDown:t?this.faceTop||this.faceBottom||this.faceLeft||this.faceRight:!1},copy:function(n){this.index=n.index;this.alpha=n.alpha;this.properties=n.properties;this.collideUp=n.collideUp;this.collideDown=n.collideDown;this.collideLeft=n.collideLeft;this.collideRight=n.collideRight;this.collisionCallback=n.collisionCallback;this.collisionCallbackContext=n.collisionCallbackContext}};n.Tile.prototype.constructor=n.Tile;Object.defineProperty(n.Tile.prototype,"collides",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown}});Object.defineProperty(n.Tile.prototype,"canCollide",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback}});Object.defineProperty(n.Tile.prototype,"left",{get:function(){return this.worldX}});Object.defineProperty(n.Tile.prototype,"right",{get:function(){return this.worldX+this.width}});Object.defineProperty(n.Tile.prototype,"top",{get:function(){return this.worldY}});Object.defineProperty(n.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Tilemap=function(t,i,r,u,f,e){this.game=t;this.key=i;var o=n.TilemapParser.parse(this.game,i,r,u,f,e);o!==null&&(this.width=o.width,this.height=o.height,this.tileWidth=o.tileWidth,this.tileHeight=o.tileHeight,this.orientation=o.orientation,this.format=o.format,this.version=o.version,this.properties=o.properties,this.widthInPixels=o.widthInPixels,this.heightInPixels=o.heightInPixels,this.layers=o.layers,this.tilesets=o.tilesets,this.imagecollections=o.imagecollections,this.tiles=o.tiles,this.objects=o.objects,this.collideIndexes=[],this.collision=o.collision,this.images=o.images,this.enableDebug=!1,this.currentLayer=0,this.debugMap=[],this._results=[],this._tempA=0,this._tempB=0)};n.Tilemap.CSV=0;n.Tilemap.TILED_JSON=1;n.Tilemap.NORTH=0;n.Tilemap.EAST=1;n.Tilemap.SOUTH=2;n.Tilemap.WEST=3;n.Tilemap.prototype={create:function(n,t,i,r,u,f){return f===undefined&&(f=this.game.world),this.width=t,this.height=i,this.setTileSize(r,u),this.layers.length=0,this.createBlankLayer(n,t,i,r,u,f)},setTileSize:function(n,t){this.tileWidth=n;this.tileHeight=t;this.widthInPixels=this.width*n;this.heightInPixels=this.height*t},addTilesetImage:function(t,i,r,u,f,e,o){var h,c,s,l;if(t===undefined)return null;if(r===undefined&&(r=this.tileWidth),u===undefined&&(u=this.tileHeight),f===undefined&&(f=0),e===undefined&&(e=0),o===undefined&&(o=0),r===0&&(r=32),u===0&&(u=32),h=null,(i===undefined||i===null)&&(i=t),i instanceof n.BitmapData)h=i.canvas;else{if(!this.game.cache.checkImageKey(i))return console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+i+'"'),null;h=this.game.cache.getImage(i)}if(c=this.getTilesetIndex(t),c===null&&this.format===n.Tilemap.TILED_JSON)return console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+t+'"'),console.log("Tilesets: ",this.tilesets),null;if(this.tilesets[c])return this.tilesets[c].setImage(h),this.tilesets[c];s=new n.Tileset(t,o,r,u,f,e,{});s.setImage(h);this.tilesets.push(s);var b=this.tilesets.length-1,a=f,y=f,p=0,v=0,w=0;for(l=o;l<o+s.total;l++){if(this.tiles[l]=[a,y,b],a+=r+e,p++,p===s.total)break;if(v++,v===s.columns&&(a=f,y+=u+e,v=0,w++,w===s.rows))break}return s},createFromObjects:function(t,i,r,u,f,e,o,s,h,c){var y,v,l,a,p;if(f===undefined&&(f=!0),e===undefined&&(e=!1),o===undefined&&(o=this.game.world),s===undefined&&(s=n.Sprite),h===undefined&&(h=!0),c===undefined&&(c=!0),!this.objects[t]){console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+t);console.log("Objects: ",this.objects);return}for(y=0;y<this.objects[t].length;y++)if(v=!1,l=this.objects[t][y],l.gid!==undefined&&typeof i=="number"&&l.gid===i?v=!0:l.id!==undefined&&typeof i=="number"&&l.id===i?v=!0:l.name!==undefined&&typeof i=="string"&&l.name===i&&(v=!0),v){a=new s(this.game,parseFloat(l.x),parseFloat(l.y),r,u);a.name=l.name;a.autoCull=e;a.exists=f;a.visible=l.visible;c&&(l.width&&(a.width=l.width),l.height&&(a.height=l.height));l.rotation&&(a.angle=l.rotation);h&&(a.y-=a.height);o.add(a);for(p in l.properties)o.set(a,p,l.properties[p],!1,!1,0,!0)}},createFromTiles:function(t,i,r,u,f,e){var s,h,c,l,o,v,a;if(typeof t=="number"&&(t=[t]),i===undefined||i===null?i=[]:typeof i=="number"&&(i=[i]),u=this.getLayer(u),f===undefined&&(f=this.game.world),e===undefined&&(e={}),e.customClass===undefined&&(e.customClass=n.Sprite),e.adjustY===undefined&&(e.adjustY=!0),s=this.layers[u].width,h=this.layers[u].height,this.copy(0,0,s,h,u),this._results.length<2)return 0;for(c=0,o=1,v=this._results.length;o<v;o++)if(t.indexOf(this._results[o].index)!==-1){l=new e.customClass(this.game,this._results[o].worldX,this._results[o].worldY,r);for(a in e)l[a]=e[a];f.add(l);c++}if(i.length===1)for(o=0;o<t.length;o++)this.replace(t[o],i[0],0,0,s,h,u);else if(i.length>1)for(o=0;o<t.length;o++)this.replace(t[o],i[o],0,0,s,h,u);return c},createLayer:function(t,i,r,u){var f,e;if(i===undefined&&(i=this.game.width),r===undefined&&(r=this.game.height),u===undefined&&(u=this.game.world),f=t,typeof t=="string"&&(f=this.getLayerIndex(t)),f===null||f>this.layers.length){console.warn('Tilemap.createLayer: Invalid layer ID given: "'+t+'"');console.log("Layers: ",this.layers);return}return i===undefined||i<=0?i=Math.min(this.game.width,this.layers[f].widthInPixels):i>this.game.width&&(i=this.game.width),r===undefined||r<=0?r=Math.min(this.game.height,this.layers[f].heightInPixels):r>this.game.height&&(r=this.game.height),this.enableDebug&&(console.group("Tilemap.createLayer"),console.log("Name:",this.layers[f].name),console.log("Size:",i,"x",r),console.log("Tileset:",this.tilesets[0].name,"index:",f)),e=u.add(new n.TilemapLayer(this.game,this,f,i,r)),this.enableDebug&&console.groupEnd(),e},createBlankLayer:function(t,i,r,u,f,e){var o,v,h,c,l,a,s;if(e===undefined&&(e=this.game.world),this.getLayerIndex(t)!==null){console.warn("Tilemap.createBlankLayer: Layer with matching name already exists: "+t);return}for(o={name:t,x:0,y:0,width:i,height:r,widthInPixels:i*u,heightInPixels:r*f,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:null},s=[],h=0;h<r;h++){for(v=[],c=0;c<i;c++)v.push(new n.Tile(o,-1,c,h,u,f));s.push(v)}return o.data=s,this.layers.push(o),this.currentLayer=this.layers.length-1,l=o.widthInPixels,a=o.heightInPixels,l>this.game.width&&(l=this.game.width),a>this.game.height&&(a=this.game.height),s=new n.TilemapLayer(this.game,this,this.layers.length-1,l,a),s.name=t,e.add(s)},getIndex:function(n,t){for(var i=0;i<n.length;i++)if(n[i].name===t)return i;return null},getLayerIndex:function(n){return this.getIndex(this.layers,n)},getTilesetIndex:function(n){return this.getIndex(this.tilesets,n)},getImageIndex:function(n){return this.getIndex(this.images,n)},setTileIndexCallback:function(n,t,i,r){if(r=this.getLayer(r),typeof n=="number")t===null?delete this.layers[r].callbacks[n]:this.layers[r].callbacks[n]={callback:t,callbackContext:i};else for(var u=0,f=n.length;u<f;u++)t===null?delete this.layers[r].callbacks[n[u]]:this.layers[r].callbacks[n[u]]={callback:t,callbackContext:i}},setTileLocationCallback:function(n,t,i,r,u,f,e){if(e=this.getLayer(e),this.copy(n,t,i,r,e),!(this._results.length<2))for(var o=1;o<this._results.length;o++)this._results[o].setCollisionCallback(u,f)},setCollision:function(n,t,i,r){if(t===undefined&&(t=!0),r===undefined&&(r=!0),i=this.getLayer(i),typeof n=="number")return this.setCollisionByIndex(n,t,i,!0);if(Array.isArray(n)){for(var u=0;u<n.length;u++)this.setCollisionByIndex(n[u],t,i,!1);r&&this.calculateFaces(i)}},setCollisionBetween:function(n,t,i,r,u){if(i===undefined&&(i=!0),u===undefined&&(u=!0),r=this.getLayer(r),!(n>t)){for(var f=n;f<=t;f++)this.setCollisionByIndex(f,i,r,!1);u&&this.calculateFaces(r)}},setCollisionByExclusion:function(n,t,i,r){t===undefined&&(t=!0);r===undefined&&(r=!0);i=this.getLayer(i);for(var u=0,f=this.tiles.length;u<f;u++)n.indexOf(u)===-1&&this.setCollisionByIndex(u,t,i,!1);r&&this.calculateFaces(i)},setCollisionByIndex:function(n,t,i,r){var o,f,e,u;for(t===undefined&&(t=!0),i===undefined&&(i=this.currentLayer),r===undefined&&(r=!0),t?this.collideIndexes.push(n):(o=this.collideIndexes.indexOf(n),o>-1&&this.collideIndexes.splice(o,1)),f=0;f<this.layers[i].height;f++)for(e=0;e<this.layers[i].width;e++)u=this.layers[i].data[f][e],u&&u.index===n&&(t?u.setCollision(!0,!0,!0,!0):u.resetCollision(),u.faceTop=t,u.faceBottom=t,u.faceLeft=t,u.faceRight=t);return r&&this.calculateFaces(i),i},getLayer:function(t){if(t===undefined)t=this.currentLayer;else if(typeof t=="string"){var i=t;t=this.getLayerIndex(t);t===null&&console.warn("No such layer name: "+i)}else t instanceof n.TilemapLayer&&(t=t.index);return t},setPreventRecalculate:function(n){if(n===!0&&this.preventingRecalculate!==!0&&(this.preventingRecalculate=!0,this.needToRecalculate={}),n===!1&&this.preventingRecalculate===!0){this.preventingRecalculate=!1;for(var t in this.needToRecalculate)this.calculateFaces(t);this.needToRecalculate=!1}},calculateFaces:function(n){var i,s,r,h,t;if(this.preventingRecalculate){this.needToRecalculate[n]=!0;return}var u=null,f=null,e=null,o=null;for(i=0,s=this.layers[n].height;i<s;i++)for(r=0,h=this.layers[n].width;r<h;r++)t=this.layers[n].data[i][r],t&&(u=this.getTileAbove(n,r,i),f=this.getTileBelow(n,r,i),e=this.getTileLeft(n,r,i),o=this.getTileRight(n,r,i),t.collides&&(t.faceTop=!0,t.faceBottom=!0,t.faceLeft=!0,t.faceRight=!0),u&&u.collides&&(t.faceTop=!1),f&&f.collides&&(t.faceBottom=!1),e&&e.collides&&(t.faceLeft=!1),o&&o.collides&&(t.faceRight=!1))},getTileAbove:function(n,t,i){return i>0?this.layers[n].data[i-1][t]:null},getTileBelow:function(n,t,i){return i<this.layers[n].height-1?this.layers[n].data[i+1][t]:null},getTileLeft:function(n,t,i){return t>0?this.layers[n].data[i][t-1]:null},getTileRight:function(n,t,i){return t<this.layers[n].width-1?this.layers[n].data[i][t+1]:null},setLayer:function(n){n=this.getLayer(n);this.layers[n]&&(this.currentLayer=n)},hasTile:function(n,t,i){return(i=this.getLayer(i),this.layers[i].data[t]===undefined||this.layers[i].data[t][n]===undefined)?!1:this.layers[i].data[t][n].index>-1},removeTile:function(t,i,r){if(r=this.getLayer(r),t>=0&&t<this.layers[r].width&&i>=0&&i<this.layers[r].height&&this.hasTile(t,i,r)){var u=this.layers[r].data[i][t];return this.layers[r].data[i][t]=new n.Tile(this.layers[r],-1,t,i,this.tileWidth,this.tileHeight),this.layers[r].dirty=!0,this.calculateFaces(r),u}},removeTileWorldXY:function(n,t,i,r,u){return u=this.getLayer(u),n=this.game.math.snapToFloor(n,i)/i,t=this.game.math.snapToFloor(t,r)/r,this.removeTile(n,t,u)},putTile:function(t,i,r,u){if(t===null)return this.removeTile(i,r,u);if(u=this.getLayer(u),i>=0&&i<this.layers[u].width&&r>=0&&r<this.layers[u].height){var f;return t instanceof n.Tile?(f=t.index,this.hasTile(i,r,u)?this.layers[u].data[r][i].copy(t):this.layers[u].data[r][i]=new n.Tile(u,f,i,r,t.width,t.height)):(f=t,this.hasTile(i,r,u)?this.layers[u].data[r][i].index=f:this.layers[u].data[r][i]=new n.Tile(this.layers[u],f,i,r,this.tileWidth,this.tileHeight)),this.collideIndexes.indexOf(f)>-1?this.layers[u].data[r][i].setCollision(!0,!0,!0,!0):this.layers[u].data[r][i].resetCollision(),this.layers[u].dirty=!0,this.calculateFaces(u),this.layers[u].data[r][i]}return null},putTileWorldXY:function(n,t,i,r,u,f){return f=this.getLayer(f),t=this.game.math.snapToFloor(t,r)/r,i=this.game.math.snapToFloor(i,u)/u,this.putTile(n,t,i,f)},searchTileIndex:function(n,t,i,r){var e,u,f;if(t===undefined&&(t=0),i===undefined&&(i=!1),r=this.getLayer(r),e=0,i){for(u=this.layers[r].height-1;u>=0;u--)for(f=this.layers[r].width-1;f>=0;f--)if(this.layers[r].data[u][f].index===n){if(e===t)return this.layers[r].data[u][f];e++}}else for(u=0;u<this.layers[r].height;u++)for(f=0;f<this.layers[r].width;f++)if(this.layers[r].data[u][f].index===n){if(e===t)return this.layers[r].data[u][f];e++}return null},getTile:function(n,t,i,r){return r===undefined&&(r=!1),i=this.getLayer(i),n>=0&&n<this.layers[i].width&&t>=0&&t<this.layers[i].height?this.layers[i].data[t][n].index===-1?r?this.layers[i].data[t][n]:null:this.layers[i].data[t][n]:null},getTileWorldXY:function(n,t,i,r,u,f){return i===undefined&&(i=this.tileWidth),r===undefined&&(r=this.tileHeight),u=this.getLayer(u),n=this.game.math.snapToFloor(n,i)/i,t=this.game.math.snapToFloor(t,r)/r,this.getTile(n,t,u,f)},copy:function(n,t,i,r,u){var f,e;if(u=this.getLayer(u),!this.layers[u]){this._results.length=0;return}for(n===undefined&&(n=0),t===undefined&&(t=0),i===undefined&&(i=this.layers[u].width),r===undefined&&(r=this.layers[u].height),n<0&&(n=0),t<0&&(t=0),i>this.layers[u].width&&(i=this.layers[u].width),r>this.layers[u].height&&(r=this.layers[u].height),this._results.length=0,this._results.push({x:n,y:t,width:i,height:r,layer:u}),f=t;f<t+r;f++)for(e=n;e<n+i;e++)this._results.push(this.layers[u].data[f][e]);return this._results},paste:function(n,t,i,r){var f,e,u;if(n===undefined&&(n=0),t===undefined&&(t=0),r=this.getLayer(r),i&&!(i.length<2)){for(f=n-i[1].x,e=t-i[1].y,u=1;u<i.length;u++)this.layers[r].data[e+i[u].y][f+i[u].x].copy(i[u]);this.layers[r].dirty=!0;this.calculateFaces(r)}},swap:function(n,t,i,r,u,f,e){(e=this.getLayer(e),this.copy(i,r,u,f,e),this._results.length<2)||(this._tempA=n,this._tempB=t,this._results.forEach(this.swapHandler,this),this.paste(i,r,this._results,e))},swapHandler:function(n){n.index===this._tempA?n.index=this._tempB:n.index===this._tempB&&(n.index=this._tempA)},forEach:function(n,t,i,r,u,f,e){(e=this.getLayer(e),this.copy(i,r,u,f,e),this._results.length<2)||(this._results.forEach(n,t),this.paste(i,r,this._results,e))},replace:function(n,t,i,r,u,f,e){if(e=this.getLayer(e),this.copy(i,r,u,f,e),!(this._results.length<2)){for(var o=1;o<this._results.length;o++)this._results[o].index===n&&(this._results[o].index=t);this.paste(i,r,this._results,e)}},random:function(n,t,i,r,u){var e,f,s,o;if(u=this.getLayer(u),this.copy(n,t,i,r,u),!(this._results.length<2)){for(e=[],f=1;f<this._results.length;f++)this._results[f].index&&(s=this._results[f].index,e.indexOf(s)===-1&&e.push(s));for(o=1;o<this._results.length;o++)this._results[o].index=this.game.rnd.pick(e);this.paste(n,t,this._results,u)}},shuffle:function(t,i,r,u,f){var s,e,o;if(f=this.getLayer(f),this.copy(t,i,r,u,f),!(this._results.length<2)){for(s=[],e=1;e<this._results.length;e++)this._results[e].index&&s.push(this._results[e].index);for(n.ArrayUtils.shuffle(s),o=1;o<this._results.length;o++)this._results[o].index=s[o-1];this.paste(t,i,this._results,f)}},fill:function(n,t,i,r,u,f){if(f=this.getLayer(f),this.copy(t,i,r,u,f),!(this._results.length<2)){for(var e=1;e<this._results.length;e++)this._results[e].index=n;this.paste(t,i,this._results,f)}},removeAllLayers:function(){this.layers.length=0;this.currentLayer=0},dump:function(){for(var n,r="",t=[""],i=0;i<this.layers[this.currentLayer].height;i++){for(n=0;n<this.layers[this.currentLayer].width;n++)r+="%c  ",this.layers[this.currentLayer].data[i][n]>1?this.debugMap[this.layers[this.currentLayer].data[i][n]]?t.push("background: "+this.debugMap[this.layers[this.currentLayer].data[i][n]]):t.push("background: #ffffff"):t.push("background: rgb(0, 0, 0)");r+="\n"}t[0]=r;console.log.apply(console,t)},destroy:function(){this.removeAllLayers();this.data=[];this.game=null}};n.Tilemap.prototype.constructor=n.Tilemap;Object.defineProperty(n.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(n){n!==this.currentLayer&&this.setLayer(n)}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.TilemapLayer=function(t,i,r,u,f){u|=0;f|=0;n.Sprite.call(this,t,0,0);this.map=i;this.index=r;this.layer=i.layers[r];this.canvas=n.CanvasPool.create(this,u,f);this.context=this.canvas.getContext("2d");this.setTexture(new PIXI.Texture(new PIXI.BaseTexture(this.canvas,null,this.game.resolution)));this.type=n.TILEMAPLAYER;this.physicsType=n.TILEMAPLAYER;this.renderSettings={enableScrollDelta:!0,overdrawRatio:.2,copyCanvas:null};this.debug=!1;this.exists=!0;this.debugSettings={missingImageFill:"rgb(255,255,255)",debuggedTileOverfill:"rgba(0,255,0,0.4)",forceFullRedraw:!0,debugAlpha:.5,facingEdgeStroke:"rgba(0,255,0,1)",collidingTileOverfill:"rgba(0,255,0,0.2)"};this.scrollFactorX=1;this.scrollFactorY=1;this.dirty=!0;this.rayStepRate=4;this._wrap=!1;this._mc={scrollX:0,scrollY:0,renderWidth:0,renderHeight:0,tileWidth:i.tileWidth,tileHeight:i.tileHeight,cw:i.tileWidth,ch:i.tileHeight,tilesets:[]};this._scrollX=0;this._scrollY=0;this.tileOffset=new n.Point(this.layer.offsetX||0,this.layer.offsetY||0);this._results=[];t.device.canvasBitBltShift||(this.renderSettings.copyCanvas=n.TilemapLayer.ensureSharedCopyCanvas());this.fixedToCamera=!0};n.TilemapLayer.prototype=Object.create(n.Sprite.prototype);n.TilemapLayer.prototype.constructor=n.TilemapLayer;n.TilemapLayer.prototype.preUpdateCore=n.Component.Core.preUpdate;n.TilemapLayer.sharedCopyCanvas=null;n.TilemapLayer.ensureSharedCopyCanvas=function(){return this.sharedCopyCanvas||(this.sharedCopyCanvas=n.CanvasPool.create(this,2,2)),this.sharedCopyCanvas};n.TilemapLayer.prototype.preUpdate=function(){return this.preUpdateCore()};n.TilemapLayer.prototype.postUpdate=function(){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);this._scrollX=(this.game.camera.view.x-this.tileOffset.x)*this.scrollFactorX/this.scale.x;this._scrollY=(this.game.camera.view.y-this.tileOffset.y)*this.scrollFactorY/this.scale.y};n.TilemapLayer.prototype._renderCanvas=function(n){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);this._scrollX=(this.game.camera.view.x-this.tileOffset.x)*this.scrollFactorX/this.scale.x;this._scrollY=(this.game.camera.view.y-this.tileOffset.y)*this.scrollFactorY/this.scale.y;this.render();PIXI.Sprite.prototype._renderCanvas.call(this,n)};n.TilemapLayer.prototype._renderWebGL=function(n){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);this._scrollX=(this.game.camera.view.x-this.tileOffset.x)*this.scrollFactorX/this.scale.x;this._scrollY=(this.game.camera.view.y-this.tileOffset.y)*this.scrollFactorY/this.scale.y;this.render();PIXI.Sprite.prototype._renderWebGL.call(this,n)};n.TilemapLayer.prototype.destroy=function(){n.CanvasPool.remove(this);n.Component.Destroy.prototype.destroy.call(this)};n.TilemapLayer.prototype.resize=function(n,t){this.canvas.width=n;this.canvas.height=t;this.texture.frame.resize(n,t);this.texture.width=n;this.texture.height=t;this.texture.crop.width=n;this.texture.crop.height=t;this.texture.baseTexture.width=n;this.texture.baseTexture.height=t;this.texture.baseTexture.dirty();this.texture.requiresUpdate=!0;this.texture._updateUvs();this.dirty=!0};n.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels*this.scale.x,this.layer.heightInPixels*this.scale.y)};n.TilemapLayer.prototype.getTileOffsetX=function(){return this.tileOffset.x||(this.fixedToCamera?0:this.position.x)};n.TilemapLayer.prototype.getTileOffsetY=function(){return this.tileOffset.y||(this.fixedToCamera?0:this.position.y)};n.TilemapLayer.prototype._fixX=function(n){return this.scrollFactorX===1||this.scrollFactorX===0&&this.position.x===0?n:this.scrollFactorX===0&&this.position.x!==0?n-this.position.x:this._scrollX+(n-this._scrollX/this.scrollFactorX)};n.TilemapLayer.prototype._unfixX=function(n){return this.scrollFactorX===1?n:this._scrollX/this.scrollFactorX+(n-this._scrollX)};n.TilemapLayer.prototype._fixY=function(n){return this.scrollFactorY===1||this.scrollFactorY===0&&this.position.y===0?n:this.scrollFactorY===0&&this.position.y!==0?n-this.position.y:this._scrollY+(n-this._scrollY/this.scrollFactorY)};n.TilemapLayer.prototype._unfixY=function(n){return this.scrollFactorY===1?n:this._scrollY/this.scrollFactorY+(n-this._scrollY)};n.TilemapLayer.prototype.getTileX=function(n){return Math.floor(this._fixX(n)/this._mc.tileWidth)};n.TilemapLayer.prototype.getTileY=function(n){return Math.floor(this._fixY(n)/this._mc.tileHeight)};n.TilemapLayer.prototype.getTileXY=function(n,t,i){return i.x=this.getTileX(n),i.y=this.getTileY(t),i};n.TilemapLayer.prototype.getRayCastTiles=function(n,t,i,r){var u,o,s,f,e,h,c;if(t||(t=this.rayStepRate),i===undefined&&(i=!1),r===undefined&&(r=!1),u=this.getTiles(n.x,n.y,n.width,n.height,i,r),u.length===0)return[];for(o=n.coordinatesOnLine(t),s=[],f=0;f<u.length;f++)for(e=0;e<o.length;e++)if(h=u[f],c=o[e],h.containsPoint(c[0],c[1])){s.push(h);break}return s};n.TilemapLayer.prototype.getTiles=function(n,t,i,r,u,f){var l,s,e,o;u===undefined&&(u=!1);f===undefined&&(f=!1);l=!(u||f);n=this._fixX(n);t=this._fixY(t);for(var h=Math.floor(n/(this._mc.cw*this.scale.x)),c=Math.floor(t/(this._mc.ch*this.scale.y)),a=Math.ceil((n+i)/(this._mc.cw*this.scale.x))-h,v=Math.ceil((t+r)/(this._mc.ch*this.scale.y))-c;this._results.length;)this._results.pop();for(s=c;s<c+v;s++)for(e=h;e<h+a;e++)o=this.layer.data[s],o&&o[e]&&(l||o[e].isInteresting(u,f))&&this._results.push(o[e]);return this._results.slice()};n.TilemapLayer.prototype.resolveTileset=function(n){var i=this._mc.tilesets,r,t;if(n<2e3)while(i.length<n)i.push(undefined);return i[n]=(r=this.map.tiles[n]&&this.map.tiles[n][2],r!==null&&(t=this.map.tilesets[r],t&&t.containsTileIndex(n)))?t:null};n.TilemapLayer.prototype.resetTilesetCache=function(){for(var n=this._mc.tilesets;n.length;)n.pop()};n.TilemapLayer.prototype.setScale=function(n,t){var r,f,u,i;for(n=n||1,t=t||n,r=0;r<this.layer.data.length;r++)for(f=this.layer.data[r],u=0;u<f.length;u++)i=f[u],i.width=this.map.tileWidth*n,i.height=this.map.tileHeight*t,i.worldX=i.x*i.width,i.worldY=i.y*i.height;this.scale.setTo(n,t)};n.TilemapLayer.prototype.shiftCanvas=function(n,t,i){var e=n.canvas,r=e.width-Math.abs(t),u=e.height-Math.abs(i),h=0,c=0,o=t,s=i,f,l;t<0&&(h=-t,o=0);i<0&&(c=-i,s=0);f=this.renderSettings.copyCanvas;f?((f.width<r||f.height<u)&&(f.width=r,f.height=u),l=f.getContext("2d"),l.clearRect(0,0,r,u),l.drawImage(e,h,c,r,u,0,0,r,u),n.clearRect(o,s,r,u),n.drawImage(f,0,0,r,u,o,s,r,u)):(n.save(),n.globalCompositeOperation="copy",n.drawImage(e,h,c,r,u,o,s,r,u),n.restore())};n.TilemapLayer.prototype.renderRegion=function(n,t,i,r,u,f){var o=this.context,l=this.layer.width,a=this.layer.height,w=this._mc.tileWidth,b=this._mc.tileHeight,tt=this._mc.tilesets,g=NaN,nt,e,p,c;this._wrap||(i<=u&&(i=Math.max(0,i),u=Math.min(l-1,u)),r<=f&&(r=Math.max(0,r),f=Math.min(a-1,f)));var it=i*w-n,rt=r*b-t,ut=(i+1048576*l)%l,ft=(r+1048576*a)%a,s,h,v,y,k,d;for(y=ft,d=f-r,h=rt;d>=0;y++,d--,h+=b)for(y>=a&&(y-=a),nt=this.layer.data[y],v=ut,k=u-i,s=it;k>=0;v++,k--,s+=w)(v>=l&&(v-=l),e=nt[v],!e||e.index<0)||(p=e.index,c=tt[p],c===undefined&&(c=this.resolveTileset(p)),e.alpha===g||this.debug||(o.globalAlpha=e.alpha,g=e.alpha),c?e.rotation||e.flipped?(o.save(),o.translate(s+e.centerX,h+e.centerY),o.rotate(e.rotation),e.flipped&&o.scale(-1,1),c.draw(o,-e.centerX,-e.centerY,p),o.restore()):c.draw(o,s,h,p):this.debugSettings.missingImageFill&&(o.fillStyle=this.debugSettings.missingImageFill,o.fillRect(s,h,w,b)),e.debug&&this.debugSettings.debuggedTileOverfill&&(o.fillStyle=this.debugSettings.debuggedTileOverfill,o.fillRect(s,h,w,b)))};n.TilemapLayer.prototype.renderDeltaScroll=function(n,t){var i=this._mc.scrollX,r=this._mc.scrollY,c=this.canvas.width,l=this.canvas.height,u=this._mc.tileWidth,f=this._mc.tileHeight,e=0,o=-u,s=0,h=-f,a,v,y,p;n<0?(e=c+n,o=c-1):n>0&&(o=n);t<0?(s=l+t,h=l-1):t>0&&(h=t);this.shiftCanvas(this.context,n,t);e=Math.floor((e+i)/u);o=Math.floor((o+i)/u);s=Math.floor((s+r)/f);h=Math.floor((h+r)/f);e<=o&&(this.context.clearRect(e*u-i,0,(o-e+1)*u,l),a=Math.floor((0+r)/f),v=Math.floor((l-1+r)/f),this.renderRegion(i,r,e,a,o,v));s<=h&&(this.context.clearRect(0,s*f-r,c,(h-s+1)*f),y=Math.floor((0+i)/u),p=Math.floor((c-1+i)/u),this.renderRegion(i,r,y,s,p,h))};n.TilemapLayer.prototype.renderFull=function(){var n=this._mc.scrollX,t=this._mc.scrollY,i=this.canvas.width,r=this.canvas.height,u=this._mc.tileWidth,f=this._mc.tileHeight,e=Math.floor(n/u),o=Math.floor((i-1+n)/u),s=Math.floor(t/f),h=Math.floor((r-1+t)/f);this.context.clearRect(0,0,i,r);this.renderRegion(n,t,e,s,o,h)};n.TilemapLayer.prototype.render=function(){var t=!1;if(this.visible){(this.dirty||this.layer.dirty)&&(this.layer.dirty=!1,t=!0);var i=this.canvas.width,r=this.canvas.height,e=this._scrollX|0,o=this._scrollY|0,n=this._mc,u=n.scrollX-e,f=n.scrollY-o;if(t||u!==0||f!==0||n.renderWidth!==i||n.renderHeight!==r)return this.context.save(),n.scrollX=e,n.scrollY=o,(n.renderWidth!==i||n.renderHeight!==r)&&(n.renderWidth=i,n.renderHeight=r),this.debug&&(this.context.globalAlpha=this.debugSettings.debugAlpha,this.debugSettings.forceFullRedraw&&(t=!0)),!t&&this.renderSettings.enableScrollDelta&&Math.abs(u)+Math.abs(f)<Math.min(i,r)?this.renderDeltaScroll(u,f):this.renderFull(),this.debug&&(this.context.globalAlpha=1,this.renderDebug()),this.texture.baseTexture.dirty(),this.dirty=!1,this.context.restore(),!0}};n.TilemapLayer.prototype.renderDebug=function(){var c=this._mc.scrollX,l=this._mc.scrollY,n=this.context,b=this.canvas.width,k=this.canvas.height,e=this.layer.width,o=this.layer.height,s=this._mc.tileWidth,h=this._mc.tileHeight,a=Math.floor(c/s),d=Math.floor((b-1+c)/s),v=Math.floor(l/h),g=Math.floor((k-1+l)/h),nt=a*s-c,tt=v*h-l,it=(a+1048576*e)%e,rt=(v+1048576*o)%o,t,i,u,f,y,p,w,r;for(n.strokeStyle=this.debugSettings.facingEdgeStroke,f=rt,p=g-v,i=tt;p>=0;f++,p--,i+=h)for(f>=o&&(f-=o),w=this.layer.data[f],u=it,y=d-a,t=nt;y>=0;u++,y--,t+=s)(u>=e&&(u-=e),r=w[u],!r||r.index<0||!r.collides)||(this.debugSettings.collidingTileOverfill&&(n.fillStyle=this.debugSettings.collidingTileOverfill,n.fillRect(t,i,this._mc.cw,this._mc.ch)),this.debugSettings.facingEdgeStroke&&(n.beginPath(),r.faceTop&&(n.moveTo(t,i),n.lineTo(t+this._mc.cw,i)),r.faceBottom&&(n.moveTo(t,i+this._mc.ch),n.lineTo(t+this._mc.cw,i+this._mc.ch)),r.faceLeft&&(n.moveTo(t,i),n.lineTo(t,i+this._mc.ch)),r.faceRight&&(n.moveTo(t+this._mc.cw,i),n.lineTo(t+this._mc.cw,i+this._mc.ch)),n.closePath(),n.stroke()))};Object.defineProperty(n.TilemapLayer.prototype,"wrap",{get:function(){return this._wrap},set:function(n){this._wrap=n;this.dirty=!0}});Object.defineProperty(n.TilemapLayer.prototype,"scrollX",{get:function(){return this._scrollX},set:function(n){this._scrollX=n}});Object.defineProperty(n.TilemapLayer.prototype,"scrollY",{get:function(){return this._scrollY},set:function(n){this._scrollY=n}});Object.defineProperty(n.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(n){this._mc.cw=n|0;this.dirty=!0}});Object.defineProperty(n.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(n){this._mc.ch=n|0;this.dirty=!0}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.TilemapParser={INSERT_NULL:!1,parse:function(t,i,r,u,f,e){if(r===undefined&&(r=32),u===undefined&&(u=32),f===undefined&&(f=10),e===undefined&&(e=10),i===undefined)return this.getEmptyData();if(i===null)return this.getEmptyData(r,u,f,e);var o=t.cache.getTilemapData(i);if(o){if(o.format===n.Tilemap.CSV)return this.parseCSV(i,o.data,r,u);if(!o.format||o.format===n.Tilemap.TILED_JSON)return this.parseTiledJSON(o.data)}else console.warn('No map data found for key "%s"',i)},parseCSV:function(t,i,r,u){var f=this.getEmptyData(),e,h,o;i=i.trim();var c=[],l=i.split("\n"),a=l.length,s=0;for(e=0;e<l.length;e++){for(c[e]=[],h=l[e].split(","),o=0;o<h.length;o++)c[e][o]=new n.Tile(f.layers[0],parseInt(h[o],10),o,e,r,u);s===0&&(s=h.length)}return f.format=n.Tilemap.CSV,f.name=t,f.width=s,f.height=a,f.tileWidth=r,f.tileHeight=u,f.widthInPixels=s*r,f.heightInPixels=a*u,f.layers[0].width=s,f.layers[0].height=a,f.layers[0].widthInPixels=f.widthInPixels,f.layers[0].heightInPixels=f.heightInPixels,f.layers[0].data=c,f},getEmptyData:function(n,t,i,r){return{width:i!==undefined&&i!==null?i:0,height:r!==undefined&&r!==null?r:0,tileWidth:n!==undefined&&n!==null?n:0,tileHeight:t!==undefined&&t!==null?t:0,orientation:"orthogonal",version:"1",properties:{},widthInPixels:0,heightInPixels:0,layers:[{name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:[]}],images:[],objects:{},collision:{},tilesets:[],tiles:[]}},_slice:function(n,t){var r={},u,i;for(u in t)i=t[u],typeof n[i]!="undefined"&&(r[i]=n[i]);return r},parseObjectGroup:function(n,t,i,r,u){var r=r||n.name,u=u||{x:0,y:0},h=this._slice,s,c,f,o,e;for(r||console.warn("No name found for objectGroup",n),(u.x===undefined||u.y===undefined)&&console.warn("Malformed xy properties in relativePosition",u),t[r]=t[r]||[],i[r]=i[r]||[],s=0,c=n.objects.length;s<c;s++)if(f=n.objects[s],f.gid)e={gid:f.gid,name:f.name,type:f.type||"",x:f.x+u.x,y:f.y+u.y,width:f.width,height:f.height,visible:f.visible,properties:f.properties},f.rotation&&(e.rotation=f.rotation),t[r].push(e);else if(f.polyline){for(e={name:f.name,type:f.type,x:f.x+u.x,y:f.y+u.y,width:f.width,height:f.height,visible:f.visible,properties:f.properties},f.rotation&&(e.rotation=f.rotation),e.polyline=[],o=0;o<f.polyline.length;o++)e.polyline.push([f.polyline[o].x,f.polyline[o].y]);i[r].push(e);t[r].push(e)}else if(f.polygon){for(e=h(f,["name","type","x","y","visible","rotation","properties"]),e.x+=u.x,e.y+=u.y,e.polygon=[],o=0;o<f.polygon.length;o++)e.polygon.push([f.polygon[o].x,f.polygon[o].y]);i[r].push(e);t[r].push(e)}else f.ellipse?(e=h(f,["name","type","ellipse","x","y","width","height","visible","rotation","properties"]),e.x+=u.x,e.y+=u.y,i[r].push(e),t[r].push(e)):(e=h(f,["name","type","x","y","width","height","visible","rotation","properties"]),e.x+=u.x,e.y+=u.y,e.rectangle=!0,i[r].push(e),t[r].push(e));return{objectsCollection:t,collisionCollection:i}},parseTiledJSON:function(t){var f,ft,u,nt,et,a,it,ct,g,s,k,lt,rt,p,h,e,kt,i,r,o,ut,c;if(t.orientation!=="orthogonal")return console.warn('Phaser CE supports only orthogonal maps. This map\'s orientation is "%s".',t.orientation),null;for(t.version>1.1&&console.warn('Some features in this Tiled JSON map (version %s) may not work in Phaser CE. Enable the json1 plugin and reexport the map in "Tiled 1.1" format. https://github.com/photonstorm/phaser-ce/issues/623',t.version),f={width:t.width,height:t.height,tileWidth:t.tilewidth,tileHeight:t.tileheight,orientation:t.orientation,format:n.Tilemap.TILED_JSON,version:t.version,properties:t.properties,widthInPixels:t.width*t.tilewidth,heightInPixels:t.height*t.tileheight},ft=[],r=0;r<t.layers.length;r++)if(t.layers[r].type==="tilelayer"){if(u=t.layers[r],!u.compression&&u.encoding&&u.encoding==="base64"){var d=window.atob(u.data),nt=d.length,vt=new Array(nt);for(o=0;o<nt;o+=4)vt[o/4]=(d.charCodeAt(o)|d.charCodeAt(o+1)<<8|d.charCodeAt(o+2)<<16|d.charCodeAt(o+3)<<24)>>>0;u.data=vt;delete u.encoding}else if(u.compression){console.warn('Layer compression is unsupported, skipping layer "%s".',u.name);continue}h={name:u.name,x:u.x,y:u.y,width:u.width,height:u.height,widthInPixels:u.width*t.tilewidth,heightInPixels:u.height*t.tileheight,alpha:u.opacity,offsetX:u.offsetx,offsetY:u.offsety,visible:u.visible,properties:{},indexes:[],callbacks:[],bodies:[]};u.properties&&(h.properties=u.properties);var v=0,y=[],tt=[],l,b,w,s;for(p=0,nt=u.data.length;p<nt;p++){if(l=0,b=!1,s=u.data[p],w=0,s>536870912){s>2147483648&&(s-=2147483648,w+=4);s>1073741824&&(s-=1073741824,w+=2);s>536870912&&(s-=536870912,w+=1);switch(w){case 5:l=Math.PI/2;break;case 6:l=Math.PI;break;case 3:l=3*Math.PI/2;break;case 4:l=0;b=!0;break;case 7:l=Math.PI/2;b=!0;break;case 2:l=Math.PI;b=!0;break;case 1:l=3*Math.PI/2;b=!0}}s>0?(e=new n.Tile(h,s,v,tt.length,t.tilewidth,t.tileheight),e.rotation=l,e.flipped=b,w!==0&&(e.flippedVal=w),y.push(e)):n.TilemapParser.INSERT_NULL?y.push(null):y.push(new n.Tile(h,-1,v,tt.length,t.tilewidth,t.tileheight));v++;v===u.width&&(tt.push(y),v=0,y=[])}h.data=tt;ft.push(h)}for(f.layers=ft,et=[],r=0;r<t.layers.length;r++)t.layers[r].type==="imagelayer"&&(a=t.layers[r],g={name:a.name,image:a.image,x:a.x,y:a.y,alpha:a.opacity,visible:a.visible,properties:{}},a.properties&&(g.properties=a.properties),et.push(g));f.images=et;var ot=[],yt={},st=[],ht=null;for(r=0;r<t.tilesets.length;r++){if(i=t.tilesets[r],i.source)console.warn("Phaser CE can't load external tilesets (%s). Embed the tileset and then export the map again. https://github.com/photonstorm/phaser-ce/issues/273",i.source);else if(i.image)it=new n.Tileset(i.name,i.firstgid,i.tilewidth,i.tileheight,i.margin,i.spacing,i.properties),i.tileproperties&&(it.tileProperties=i.tileproperties),it.updateTileData(i.imagewidth,i.imageheight),ot.push(it);else if(i.tiles){ct=new n.ImageCollection(i.name,i.firstgid,i.tilewidth,i.tileheight,i.margin,i.spacing,i.properties);for(k in i.tiles)g=i.tiles[k].image,s=i.firstgid+parseInt(k,10),ct.addImage(s,g);st.push(ct)}else throw new Error("Tileset "+i.name+" has no `image` or `tiles` property.");for(k in i.tiles)(c=i.tiles[k].objectgroup,c)&&(yt[parseInt(k,10)+i.firstgid]=c);ht&&(ht.lastgid=i.firstgid-1);ht=i}if(ot.length===0&&st.length===0)throw new Error("This tilemap has no tilesets.");for(f.tilesets=ot,f.imagecollections=st,lt={},rt={},r=0;r<t.layers.length;r++)t.layers[r].type==="objectgroup"&&(c=t.layers[r],this.parseObjectGroup(c,lt,rt));for(f.objects=lt,f.collision=rt,f.tiles=[],r=0;r<f.tilesets.length;r++){var i=f.tilesets[r],v=i.tileMargin,pt=i.tileMargin,wt=0,at=0,bt=0;for(p=i.firstgid;p<i.firstgid+i.total;p++){if(f.tiles[p]=[v,pt,r],v+=i.tileWidth+i.tileSpacing,wt++,wt===i.total)break;if(at++,at===i.columns&&(v=i.tileMargin,pt+=i.tileHeight+i.tileSpacing,at=0,bt++,bt===i.rows))break}}for(r=0;r<f.layers.length;r++)for(h=f.layers[r],rt[h.name]=[],i=null,o=0;o<h.data.length;o++)for(y=h.data[o],ut=0;ut<y.length;ut++)(e=y[ut],e===null||e.index<0)||(kt=f.tiles[e.index][2],i=f.tilesets[kt],i.tileProperties&&i.tileProperties[e.index-i.firstgid]&&(e.properties=n.Utils.mixin(i.tileProperties[e.index-i.firstgid],e.properties)),c=yt[e.index],c&&this.parseObjectGroup(c,f.objects,f.collision,e.layer.name,{x:e.worldX+c.x,y:e.worldY+c.y}));return f}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Tileset=function(n,t,i,r,u,f,e){(i===undefined||i<=0)&&(i=32);(r===undefined||r<=0)&&(r=32);u===undefined&&(u=0);f===undefined&&(f=0);this.name=n;this.firstgid=t|0;this.tileWidth=i|0;this.tileHeight=r|0;this.tileMargin=u|0;this.tileSpacing=f|0;this.properties=e||{};this.image=null;this.rows=0;this.columns=0;this.total=0;this.drawCoords=[]};n.Tileset.prototype={draw:function(n,t,i,r){var u=r-this.firstgid<<1;u>=0&&u+1<this.drawCoords.length&&n.drawImage(this.image,this.drawCoords[u],this.drawCoords[u+1],this.tileWidth,this.tileHeight,t,i,this.tileWidth,this.tileHeight)},containsTileIndex:function(n){return n>=this.firstgid&&n<this.firstgid+this.total},setImage:function(n){this.image=n;this.updateTileData(n.width,n.height)},setSpacing:function(n,t){this.tileMargin=n|0;this.tileSpacing=t|0;this.image&&this.updateTileData(this.image.width,this.image.height)},updateTileData:function(n,t){var i=(t-this.tileMargin*2+this.tileSpacing)/(this.tileHeight+this.tileSpacing),r=(n-this.tileMargin*2+this.tileSpacing)/(this.tileWidth+this.tileSpacing),u,f,e,o;for((i%1!=0||r%1!=0)&&console.warn("Phaser.Tileset - '%s' image tile area (%s x %s) is not a whole multiple of tile size (%s x %s + %s + %s)",this.name,n,t,this.tileWidth,this.tileHeight,this.tileMargin,this.tileSpacing),i=Math.floor(i),r=Math.floor(r),(this.rows&&this.rows!==i||this.columns&&this.columns!==r)&&console.warn("Phaser.Tileset - Tile layout from image '%s' (%s rows by %s columns) differs from tileset '%s' (%s rows by %s columns)",this.image.name,r,i,this.name,this.columns,this.rows),this.rows=i,this.columns=r,this.total=i*r,this.drawCoords.length=0,u=this.tileMargin,f=this.tileMargin,e=0;e<this.rows;e++){for(o=0;o<this.columns;o++)this.drawCoords.push(u),this.drawCoords.push(f),u+=this.tileWidth+this.tileSpacing;u=this.tileMargin;f+=this.tileHeight+this.tileSpacing}}};n.Tileset.prototype.constructor=n.Tileset;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Particle=function(t,i,r,u,f){n.Sprite.call(this,t,i,r,u,f);this.autoScale=!1;this.scaleData=null;this._s=0;this.autoAlpha=!1;this.alphaData=null;this._a=0};n.Particle.prototype=Object.create(n.Sprite.prototype);n.Particle.prototype.constructor=n.Particle;n.Particle.prototype.update=function(){this.autoScale&&(this._s--,this._s?this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y):this.autoScale=!1);this.autoAlpha&&(this._a--,this._a?this.alpha=this.alphaData[this._a].v:this.autoAlpha=!1)};n.Particle.prototype.onEmit=function(){};n.Particle.prototype.setAlphaData=function(n){this.alphaData=n;this._a=n.length-1;this.alpha=this.alphaData[this._a].v;this.autoAlpha=!0};n.Particle.prototype.setScaleData=function(n){this.scaleData=n;this._s=n.length-1;this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y);this.autoScale=!0};n.Particle.prototype.reset=function(t,i,r){return n.Component.Reset.prototype.reset.call(this,t,i,r),this.alpha=1,this.scale.set(1),this.autoScale=!1,this.autoAlpha=!1,this};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Particles=function(n){this.game=n;this.emitters={};this.ID=0};n.Particles.prototype={add:function(n){return this.emitters[n.id]=n,n},remove:function(n){delete this.emitters[n.id]}};n.Particles.prototype.constructor=n.Particles;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Particles.Arcade={};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Particles.Arcade.Emitter=function(t,i,r,u){this.maxParticles=u||50;n.Group.call(this,t);this._id=this.game.particles.ID++;this.name="emitter"+this.id;this.type=n.EMITTER;this.physicsType=n.GROUP;this.area=new n.Rectangle(i,r,1,1);this.minAngle=null;this.maxAngle=null;this.minSpeed=0;this.maxSpeed=100;this.minParticleSpeed=new n.Point(-100,-100);this.maxParticleSpeed=new n.Point(100,100);this.minParticleScale=1;this.maxParticleScale=1;this.scaleData=null;this.minRotation=-360;this.maxRotation=360;this.minParticleAlpha=1;this.maxParticleAlpha=1;this.alphaData=null;this.particleClass=n.Particle;this.particleDrag=new n.Point;this.angularDrag=0;this.frequency=100;this.lifespan=2e3;this.bounce=new n.Point;this.on=!1;this.particleAnchor=new n.Point(.5,.5);this.blendMode=n.blendModes.NORMAL;this.emitX=i;this.emitY=r;this.autoScale=!1;this.autoAlpha=!1;this.particleBringToTop=!1;this.particleSendToBack=!1;this.counts={emitted:0,failed:0,totalEmitted:0,totalFailed:0};this._gravity=new n.Point(0,100);this._minParticleScale=new n.Point(1,1);this._maxParticleScale=new n.Point(1,1);this._total=0;this._timer=0;this._counter=0;this._flowQuantity=0;this._flowTotal=0;this._explode=!0;this._frames=null};n.Particles.Arcade.Emitter.prototype=Object.create(n.Group.prototype);n.Particles.Arcade.Emitter.prototype.constructor=n.Particles.Arcade.Emitter;n.Particles.Arcade.Emitter.prototype.update=function(){var n;if(this.counts.emitted=0,this.counts.failed=0,this.on&&this.game.time.time>=this._timer)if(this._timer=this.game.time.time+this.frequency*this.game.time.slowMotion,this._flowTotal!==0)if(this._flowQuantity>0){for(n=0;n<this._flowQuantity;n++)if(this.emitParticle()&&(this._counter++,this._flowTotal!==-1&&this._counter>=this._flowTotal)){this.on=!1;break}}else this.emitParticle()&&(this._counter++,this._flowTotal!==-1&&this._counter>=this._flowTotal&&(this.on=!1));else this.emitParticle()&&(this._counter++,this._total>0&&this._counter>=this._total&&(this.on=!1));for(n=this.children.length;n--;)this.children[n].exists&&this.children[n].update()};n.Particles.Arcade.Emitter.prototype.makeParticles=function(n,t,i,r,u,f){t===undefined&&(t=0);i===undefined&&(i=this.maxParticles);r===undefined&&(r=!1);u===undefined&&(u=!1);f===undefined&&(f=null);var e,o=0,s=n,h=t;for(this._frames=t,i>this.maxParticles&&(this.maxParticles=i);o<i;)Array.isArray(n)&&(s=this.game.rnd.pick(n)),Array.isArray(t)&&(h=this.game.rnd.pick(t)),e=new this.particleClass(this.game,0,0,s,h,f),this.game.physics.arcade.enable(e,!1),e.body.checkCollision.none=!r,e.body.collideWorldBounds=u,e.body.skipQuadTree=!0,e.exists=!1,e.visible=!1,e.anchor.copyFrom(this.particleAnchor),this.add(e),o++;return this};n.Particles.Arcade.Emitter.prototype.kill=function(){return this.on=!1,this.alive=!1,this.exists=!1,this};n.Particles.Arcade.Emitter.prototype.revive=function(){return this.alive=!0,this.exists=!0,this};n.Particles.Arcade.Emitter.prototype.explode=function(n,t){return t===undefined&&(t=this.maxParticles),this._flowTotal=0,this.start(!0,n,0,t,!1),this};n.Particles.Arcade.Emitter.prototype.flow=function(n,t,i,r,u){return(t===undefined||t===null)&&(t=250),(i===undefined||i===0)&&(i=1),r===undefined&&(r=-1),u===undefined&&(u=!0),i>this.maxParticles&&(i=this.maxParticles),this._counter=0,this._flowQuantity=i,this._flowTotal=r,u?(this.start(!0,n,t,i),this._counter+=i,this.on=!0,this._timer=this.game.time.time+t*this.game.time.slowMotion):this.start(!1,n,t,i),this};n.Particles.Arcade.Emitter.prototype.start=function(n,t,i,r,u){if(n===undefined&&(n=!0),t===undefined&&(t=0),(i===undefined||i===null)&&(i=250),r===undefined&&(r=0),u===undefined&&(u=!1),r>this.maxParticles&&(r=this.maxParticles),this.revive(),this.visible=!0,this.lifespan=t,this.frequency=i,n||u)for(var f=0;f<r;f++)this.emitParticle();else this.on=!0,this._total=r,this._counter=0,this._timer=this.game.time.time+i*this.game.time.slowMotion;return this};n.Particles.Arcade.Emitter.prototype.emitParticle=function(n,t,i,r){var u,f,e,o;return(n===undefined&&(n=null),t===undefined&&(t=null),u=this.getNextParticle(),u===null)?(this.counts.failed++,this.counts.totalFailed++,!1):(this.counts.emitted++,this.counts.totalEmitted++,f=this.game.rnd,i!==undefined&&r!==undefined?u.loadTexture(i,r):i!==undefined&&(u.loadTexture(i),u.frame=Array.isArray(this._frames)?f.pick(this._frames):this._frames),e=this.emitX,o=this.emitY,n!==null?e=n:this.width>1&&(e=f.between(this.left,this.right)),t!==null?o=t:this.height>1&&(o=f.between(this.top,this.bottom)),this.resetParticle(u,e,o),!0)};n.Particles.Arcade.Emitter.prototype.getNextParticle=function(){for(var t=this.length,n;t--;)if(n=this.next(),!n.exists)return n;return null};n.Particles.Arcade.Emitter.prototype.resetParticle=function(n,t,i){var u=this.game.rnd,r;n.reset(t,i);n.angle=0;n.lifespan=this.lifespan;this.particleBringToTop?this.bringToTop(n):this.particleSendToBack&&this.sendToBack(n);this.autoScale?n.setScaleData(this.scaleData):this.minParticleScale!==1||this.maxParticleScale!==1?n.scale.set(u.realInRange(this.minParticleScale,this.maxParticleScale)):this._minParticleScale.x!==this._maxParticleScale.x||this._minParticleScale.y!==this._maxParticleScale.y?n.scale.set(u.realInRange(this._minParticleScale.x,this._maxParticleScale.x),u.realInRange(this._minParticleScale.y,this._maxParticleScale.y)):n.scale.set(this._minParticleScale.x,this._minParticleScale.y);this.autoAlpha?n.setAlphaData(this.alphaData):n.alpha=u.realInRange(this.minParticleAlpha,this.maxParticleAlpha);n.blendMode=this.blendMode;r=n.body;r.updateBounds();r.bounce.copyFrom(this.bounce);r.drag.copyFrom(this.particleDrag);this.minAngle!=null&&this.maxAngle!=null?this.game.physics.arcade.velocityFromAngle(this.minAngle===this.maxAngle?this.minAngle:u.between(this.minAngle,this.maxAngle),this.minSpeed===this.maxSpeed?this.minSpeed:u.between(this.minSpeed,this.maxSpeed),r.velocity):(r.velocity.x=u.between(this.minParticleSpeed.x,this.maxParticleSpeed.x),r.velocity.y=u.between(this.minParticleSpeed.y,this.maxParticleSpeed.y));r.angularVelocity=u.between(this.minRotation,this.maxRotation);r.gravity.copyFrom(this.gravity);r.angularDrag=this.angularDrag;n.onEmit()};n.Particles.Arcade.Emitter.prototype.destroy=function(){this.game.particles.remove(this);n.Group.prototype.destroy.call(this,!0,!1)};n.Particles.Arcade.Emitter.prototype.setSize=function(n,t){return this.area.width=n,this.area.height=t,this};n.Particles.Arcade.Emitter.prototype.setXSpeed=function(n,t){return n=n||0,t=t||0,this.minParticleSpeed.x=n,this.maxParticleSpeed.x=t,this};n.Particles.Arcade.Emitter.prototype.setYSpeed=function(n,t){return n=n||0,t=t||0,this.minParticleSpeed.y=n,this.maxParticleSpeed.y=t,this};n.Particles.Arcade.Emitter.prototype.setRotation=function(n,t){return n=n||0,t=t||0,this.minRotation=n,this.maxRotation=t,this};n.Particles.Arcade.Emitter.prototype.setAlpha=function(t,i,r,u,f){if(t===undefined&&(t=1),i===undefined&&(i=1),r===undefined&&(r=0),u===undefined&&(u=n.Easing.Linear.None),f===undefined&&(f=!1),this.minParticleAlpha=t,this.maxParticleAlpha=i,this.autoAlpha=!1,r>0&&t!==i){var o={v:t},e=this.game.make.tween(o).to({v:i},r,u);e.yoyo(f);this.alphaData=e.generateData(60);this.alphaData.reverse();this.autoAlpha=!0}return this};n.Particles.Arcade.Emitter.prototype.setScale=function(t,i,r,u,f,e,o){if(t===undefined&&(t=1),i===undefined&&(i=1),r===undefined&&(r=1),u===undefined&&(u=1),f===undefined&&(f=0),e===undefined&&(e=n.Easing.Linear.None),o===undefined&&(o=!1),this.minParticleScale=1,this.maxParticleScale=1,this._minParticleScale.set(t,r),this._maxParticleScale.set(i,u),this.autoScale=!1,f>0&&(t!==i||r!==u)){var h={x:t,y:r},s=this.game.make.tween(h).to({x:i,y:u},f,e);s.yoyo(o);this.scaleData=s.generateData(60);this.scaleData.reverse();this.autoScale=!0}return this};n.Particles.Arcade.Emitter.prototype.setAngle=function(n,t,i,r){return this.minAngle=n,this.maxAngle=t,i!=null&&(this.minSpeed=i),r!=null&&(this.maxSpeed=r),this};n.Particles.Arcade.Emitter.prototype.at=function(n){return n.center?(this.emitX=n.center.x,this.emitY=n.center.y):(this.emitX=n.world.x+n.anchor.x*n.width,this.emitY=n.world.y+n.anchor.y*n.height),this};Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"gravity",{get:function(){return this._gravity},set:function(n){typeof n=="number"?this._gravity.y=n:this._gravity=n}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"id",{get:function(){return this._id}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(n){this.area.width=n}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(n){this.area.height=n}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(n){this.emitX=n}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(n){this.emitY=n}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-this.area.width/2)}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+this.area.width/2)}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-this.area.height/2)}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+this.area.height/2)}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"output",{get:function(){return 1e3*this._flowQuantity/this.frequency}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"lifespanOutput",{get:function(){return(this.lifespan===0?Infinity:this.lifespan)*this._flowQuantity/this.frequency}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"remainder",{get:function(){return this.maxParticles-this.lifespanOutput}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Weapon=function(t,i){n.Plugin.call(this,t,i);this.bullets=null;this.autoExpandBulletsGroup=!1;this.autofire=!1;this.shots=0;this.fireLimit=0;this.fireRate=100;this.fireRateVariance=0;this.fireFrom=new n.Rectangle(0,0,1,1);this.fireAngle=n.ANGLE_UP;this.bulletInheritSpriteSpeed=!1;this.bulletAnimation="";this.bulletFrameRandom=!1;this.bulletFrameCycle=!1;this.bulletWorldWrap=!1;this.bulletWorldWrapPadding=0;this.bulletAngleOffset=0;this.bulletAngleVariance=0;this.bulletSpeed=200;this.bulletSpeedVariance=0;this.bulletLifespan=0;this.bulletKillDistance=0;this.bulletGravity=new n.Point(0,0);this.bulletRotateToVelocity=!1;this.bulletKey="";this.bulletFrame="";this._bulletClass=n.Bullet;this._bulletCollideWorldBounds=!1;this._bulletKillType=n.Weapon.KILL_WORLD_BOUNDS;this._data={customBody:!1,width:0,height:0,offsetX:0,offsetY:0};this.bounds=new n.Rectangle;this.bulletBounds=t.world.bounds;this.bulletFrames=[];this.bulletFrameIndex=0;this.anims={};this.onFire=new n.Signal;this.onKill=new n.Signal;this.onFireLimit=new n.Signal;this.trackedSprite=null;this.trackedPointer=null;this.multiFire=!1;this._hasFired=!1;this.trackRotation=!1;this.trackOffset=new n.Point;this._nextFire=0;this._tempNextFire=0;this._rotatedPoint=new n.Point};n.Weapon.prototype=Object.create(n.Plugin.prototype);n.Weapon.prototype.constructor=n.Weapon;n.Weapon.KILL_NEVER=0;n.Weapon.KILL_LIFESPAN=1;n.Weapon.KILL_DISTANCE=2;n.Weapon.KILL_WEAPON_BOUNDS=3;n.Weapon.KILL_CAMERA_BOUNDS=4;n.Weapon.KILL_WORLD_BOUNDS=5;n.Weapon.KILL_STATIC_BOUNDS=6;n.Weapon.prototype.createBullets=function(t,i,r,u){return t===undefined&&(t=1),u===undefined&&(u=this.game.world),this.bullets&&!this.bullets.game&&(this.bullets=null),this.bullets||(this.bullets=this.game.add.physicsGroup(n.Physics.ARCADE,u),this.bullets.classType=this._bulletClass),t!==0&&(t===-1&&(this.autoExpandBulletsGroup=!0,t=1),this.bullets.createMultiple(t,i,r),this.bullets.setAll("data.bulletManager",this),this.bulletKey=i,this.bulletFrame=r),this};n.Weapon.prototype.forEach=function(n,t){return this.bullets.forEachExists(n,t,arguments),this};n.Weapon.prototype.pauseAll=function(){return this.bullets.setAll("body.enable",!1),this};n.Weapon.prototype.resumeAll=function(){return this.bullets.setAll("body.enable",!0),this};n.Weapon.prototype.killAll=function(){return this.bullets.callAllExists("kill",!0),this.bullets.setAll("body.enable",!0),this};n.Weapon.prototype.resetShots=function(n){return this.shots=0,n!==undefined&&(this.fireLimit=n),this};n.Weapon.prototype.destroy=function(){this.parent.remove(this,!1);this.bullets.destroy();this.game=null;this.parent=null;this.active=!1;this.visible=!1};n.Weapon.prototype.update=function(){this._bulletKillType===n.Weapon.KILL_WEAPON_BOUNDS&&(this.trackedSprite?(this.trackedSprite.updateTransform(),this.bounds.centerOn(this.trackedSprite.worldPosition.x,this.trackedSprite.worldPosition.y)):this.trackedPointer&&this.bounds.centerOn(this.trackedPointer.worldX,this.trackedPointer.worldY));this.autofire&&this.fire()};n.Weapon.prototype.postRender=function(){this.multiFire&&this._hasFired&&(this._hasFired=!1,this._nextFire=this._tempNextFire)};n.Weapon.prototype.trackSprite=function(n,t,i,r){return t===undefined&&(t=0),i===undefined&&(i=0),r===undefined&&(r=!1),this.trackedPointer=null,this.trackedSprite=n,this.trackRotation=r,this.trackOffset.set(t,i),this};n.Weapon.prototype.trackPointer=function(n,t,i){return n===undefined&&(n=this.game.input.activePointer),t===undefined&&(t=0),i===undefined&&(i=0),this.trackedPointer=n,this.trackedSprite=null,this.trackRotation=!1,this.trackOffset.set(t,i),this};n.Weapon.prototype.fireMany=function(n,t){this.multiFire=!0;var i=[],r=this;return t||this.trackedSprite||this.trackedPointer?n.forEach(function(n){i.push(r.fire(t,null,null,n.x,n.y))}):n.forEach(function(n){i.push(r.fire(n))}),i};n.Weapon.prototype.fireOffset=function(n,t){return n===undefined&&(n=0),t===undefined&&(t=0),this.fire(null,null,null,n,t)};n.Weapon.prototype.fire=function(t,i,r,u,f){var s,y,p,e,h,c,l;if(i===undefined&&(i=null),r===undefined&&(r=null),this.game.time.now<this._nextFire||this.fireLimit>0&&this.shots===this.fireLimit)return null;s=this.bulletSpeed;this.bulletSpeedVariance!==0&&(s+=n.Math.between(-this.bulletSpeedVariance,this.bulletSpeedVariance));t?this.fireFrom.width>1?this.fireFrom.centerOn(t.x,t.y):(this.fireFrom.x=t.x,this.fireFrom.y=t.y):this.trackedSprite?(this.trackRotation?(this._rotatedPoint.set(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y),this._rotatedPoint.rotate(this.trackedSprite.world.x,this.trackedSprite.world.y,this.trackedSprite.worldRotation),this.fireFrom.width>1?this.fireFrom.centerOn(this._rotatedPoint.x,this._rotatedPoint.y):(this.fireFrom.x=this._rotatedPoint.x,this.fireFrom.y=this._rotatedPoint.y)):this.fireFrom.width>1?this.fireFrom.centerOn(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y):(this.fireFrom.x=this.trackedSprite.world.x+this.trackOffset.x,this.fireFrom.y=this.trackedSprite.world.y+this.trackOffset.y),this.bulletInheritSpriteSpeed&&(s+=this.trackedSprite.body.speed)):this.trackedPointer&&(this.fireFrom.width>1?this.fireFrom.centerOn(this.trackedPointer.world.x+this.trackOffset.x,this.trackedPointer.world.y+this.trackOffset.y):(this.fireFrom.x=this.trackedPointer.world.x+this.trackOffset.x,this.fireFrom.y=this.trackedPointer.world.y+this.trackOffset.y));u!==undefined&&(this.fireFrom.x+=u);f!==undefined&&(this.fireFrom.y+=f);var a=this.fireFrom.width>1?this.fireFrom.randomX:this.fireFrom.x,v=this.fireFrom.height>1?this.fireFrom.randomY:this.fireFrom.y,o=this.trackRotation?this.trackedSprite.angle:this.fireAngle;return i!==null&&r!==null&&(o=this.game.math.radToDeg(Math.atan2(r-v,i-a))),this.bulletAngleVariance!==0&&(o+=n.Math.between(-this.bulletAngleVariance,this.bulletAngleVariance)),y=0,p=0,o===0||o===180?y=Math.cos(this.game.math.degToRad(o))*s:o===90||o===270?p=Math.sin(this.game.math.degToRad(o))*s:(y=Math.cos(this.game.math.degToRad(o))*s,p=Math.sin(this.game.math.degToRad(o))*s),e=null,this.autoExpandBulletsGroup?(e=this.bullets.getFirstExists(!1,!0,a,v,this.bulletKey,this.bulletFrame),e.data.bulletManager=this):e=this.bullets.getFirstExists(!1),e&&(e.reset(a,v),e.data.fromX=a,e.data.fromY=v,e.data.killType=this.bulletKillType,e.data.killDistance=this.bulletKillDistance,e.data.rotateToVelocity=this.bulletRotateToVelocity,this.bulletKillType===n.Weapon.KILL_LIFESPAN&&(e.lifespan=this.bulletLifespan),e.angle=o+this.bulletAngleOffset,this.bulletAnimation!==""?(e.animations.getAnimation(this.bulletAnimation)===null&&(h=this.anims[this.bulletAnimation],e.animations.add(h.name,h.frames,h.frameRate,h.loop,h.useNumericIndex)),e.animations.play(this.bulletAnimation)):this.bulletFrameCycle?(e.frame=this.bulletFrames[this.bulletFrameIndex],this.bulletFrameIndex++,this.bulletFrameIndex>=this.bulletFrames.length&&(this.bulletFrameIndex=0)):this.bulletFrameRandom&&(e.frame=this.bulletFrames[Math.floor(Math.random()*this.bulletFrames.length)]),e.data.bodyDirty&&(this._data.customBody&&e.body.setSize(this._data.width,this._data.height,this._data.offsetX,this._data.offsetY),e.body.collideWorldBounds=this.bulletCollideWorldBounds,e.data.bodyDirty=!1),e.body.velocity.set(y,p),e.body.gravity.set(this.bulletGravity.x,this.bulletGravity.y),c=0,this.bulletSpeedVariance!==0?(l=this.fireRate,l+=n.Math.between(-this.fireRateVariance,this.fireRateVariance),l<0&&(l=0),c=this.game.time.now+l):c=this.game.time.now+this.fireRate,this.multiFire?this._hasFired||(this._hasFired=!0,this._tempNextFire=c,this.shots++):(this._nextFire=c,this.shots++),this.onFire.dispatch(e,this,s),this.fireLimit>0&&this.shots===this.fireLimit&&this.onFireLimit.dispatch(this,this.fireLimit)),e};n.Weapon.prototype.fireAtPointer=function(n){return n===undefined&&(n=this.game.input.activePointer),this.fire(null,n.worldX,n.worldY)};n.Weapon.prototype.fireAtSprite=function(n){return this.fire(null,n.world.x,n.world.y)};n.Weapon.prototype.fireAtXY=function(n,t){return this.fire(null,n,t)};n.Weapon.prototype.setBulletBodyOffset=function(n,t,i,r){return i===undefined&&(i=0),r===undefined&&(r=0),this._data.customBody=!0,this._data.width=n,this._data.height=t,this._data.offsetX=i,this._data.offsetY=r,this.bullets.callAll("body.setSize","body",n,t,i,r),this.bullets.setAll("data.bodyDirty",!1),this};n.Weapon.prototype.setBulletFrames=function(t,i,r,u){return r===undefined&&(r=!0),u===undefined&&(u=!1),this.bulletFrames=n.ArrayUtils.numberArray(t,i),this.bulletFrameIndex=0,this.bulletFrameCycle=r,this.bulletFrameRandom=u,this};n.Weapon.prototype.addBulletAnimation=function(n,t,i,r,u){return this.anims[n]={name:n,frames:t,frameRate:i,loop:r,useNumericIndex:u},this.bullets.callAll("animations.add","animations",n,t,i,r,u),this.bulletAnimation=n,this};n.Weapon.prototype.debug=function(n,t,i){n===undefined&&(n=16);t===undefined&&(t=32);i===undefined&&(i=!1);this.game.debug.text("Weapon Plugin",n,t);this.game.debug.text("Bullets Alive: "+this.bullets.total+" - Total: "+this.bullets.length,n,t+24);i&&this.bullets.forEachExists(this.game.debug.body,this.game.debug,"rgba(255, 0, 255, 0.8)")};Object.defineProperty(n.Weapon.prototype,"bulletClass",{get:function(){return this._bulletClass},set:function(n){this._bulletClass=n;this.bullets&&(this.bullets.classType=this._bulletClass)}});Object.defineProperty(n.Weapon.prototype,"bulletKillType",{get:function(){return this._bulletKillType},set:function(t){switch(t){case n.Weapon.KILL_STATIC_BOUNDS:case n.Weapon.KILL_WEAPON_BOUNDS:this.bulletBounds=this.bounds;break;case n.Weapon.KILL_CAMERA_BOUNDS:this.bulletBounds=this.game.camera.view;break;case n.Weapon.KILL_WORLD_BOUNDS:this.bulletBounds=this.game.world.bounds}this._bulletKillType=t}});Object.defineProperty(n.Weapon.prototype,"bulletCollideWorldBounds",{get:function(){return this._bulletCollideWorldBounds},set:function(n){this._bulletCollideWorldBounds=n;this.bullets.setAll("body.collideWorldBounds",n);this.bullets.setAll("data.bodyDirty",!1)}});Object.defineProperty(n.Weapon.prototype,"x",{get:function(){return this.fireFrom.x},set:function(n){this.fireFrom.x=n}});Object.defineProperty(n.Weapon.prototype,"y",{get:function(){return this.fireFrom.y},set:function(n){this.fireFrom.y=n}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Bullet=function(t,i,r,u,f){n.Sprite.call(this,t,i,r,u,f);this.anchor.set(.5);this.data={bulletManager:null,fromX:0,fromY:0,bodyDirty:!0,rotateToVelocity:!1,killType:0,killDistance:0}};n.Bullet.prototype=Object.create(n.Sprite.prototype);n.Bullet.prototype.constructor=n.Bullet;n.Bullet.prototype.kill=function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.data.bulletManager.onKill.dispatch(this),this};n.Bullet.prototype.update=function(){this.exists&&(this.data.killType>n.Weapon.KILL_LIFESPAN&&(this.data.killType===n.Weapon.KILL_DISTANCE?this.game.physics.arcade.distanceToXY(this,this.data.fromX,this.data.fromY,!0)>this.data.killDistance&&this.kill():this.data.bulletManager.bulletBounds.intersects(this)||this.kill()),this.data.rotateToVelocity&&(this.rotation=this.body.velocity.atan()),this.data.bulletManager.bulletWorldWrap&&this.game.world.wrap(this,this.data.bulletManager.bulletWorldWrapPadding))};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Video=function(t,i,r){if(i===undefined&&(i=null),r===undefined&&(r=null),this.game=t,this.key=i,this.width=0,this.height=0,this.type=n.VIDEO,this.disableTextureUpload=!1,this.touchLocked=!1,this.onPlay=new n.Signal,this.onChangeSource=new n.Signal,this.onComplete=new n.Signal,this.onAccess=new n.Signal,this.onError=new n.Signal,this.onTimeout=new n.Signal,this.onTouchUnlock=new n.Signal,this.playWhenUnlocked=!0,this.timeout=15e3,this._timeOutID=null,this.video=null,this.videoStream=null,this.isStreaming=!1,this.retryLimit=20,this.retry=0,this.retryInterval=500,this._retryID=null,this._codeMuted=!1,this._muted=!1,this._codePaused=!1,this._paused=!1,this._pending=!1,this._pendingChangeSource=!1,this._autoplay=!1,this._endCallback=null,this._playCallback=null,i&&this.game.cache.checkVideoKey(i)){var u=this.game.cache.getVideo(i);u.isBlob?this.createVideoFromBlob(u.data):this.video=u.data;this.width=this.video.videoWidth;this.height=this.video.videoHeight}else r&&this.createVideoFromURL(r,!1);this.video&&!r?(this.baseTexture=new PIXI.BaseTexture(this.video,null,this.game.resolution),this.baseTexture.forceLoaded(this.width,this.height)):(this.baseTexture=new PIXI.BaseTexture(n.Cache.DEFAULT.baseTexture.source,null,this.game.resolution),this.baseTexture.forceLoaded(this.width,this.height));this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new n.Frame(0,0,0,this.width,this.height,"video");this.texture.setFrame(this.textureFrame);this.texture.valid=!1;i!==null&&this.video&&(this.texture.valid=this.video.canplay);this.snapshot=null;n.BitmapData&&(this.snapshot=new n.BitmapData(this.game,"",this.width,this.height));this.game.device.needsTouchUnlock()?this.setTouchLock():u&&(u.locked=!1)};n.Video.prototype={connectToMediaStream:function(n,t){return n&&t&&(this.video=n,this.videoStream=t,this.isStreaming=!0,this.baseTexture.source=this.video,this.updateTexture(null,this.video.videoWidth,this.video.videoHeight),this.onAccess.dispatch(this)),this},startMediaStream:function(n,t,i){if(n===undefined&&(n=!1),t===undefined&&(t=null),i===undefined&&(i=null),!this.game.device.getUserMedia)return this.onError.dispatch(this,"No getUserMedia"),!1;this.videoStream!==null&&(this.videoStream.active?this.videoStream.active=!1:this.videoStream.stop());this.removeVideoElement();this.video=document.createElement("video");this.video.setAttribute("autoplay","autoplay");this.video.setAttribute("playsinline","playsinline");t!==null&&(this.video.width=t);i!==null&&(this.video.height=i);this._timeOutID=window.setTimeout(this.getUserMediaTimeout.bind(this),this.timeout);try{navigator.getUserMedia({audio:n,video:!0},this.getUserMediaSuccess.bind(this),this.getUserMediaError.bind(this))}catch(r){this.getUserMediaError(r)}return this},getUserMediaTimeout:function(){clearTimeout(this._timeOutID);this.onTimeout.dispatch(this)},getUserMediaError:function(n){clearTimeout(this._timeOutID);this.onError.dispatch(this,n)},getUserMediaSuccess:function(n){clearTimeout(this._timeOutID);this.videoStream=n;this.video.mozSrcObject!==undefined?this.video.mozSrcObject=n:this.video.srcObject!==undefined?this.video.srcObject=n:this.video.src=window.URL&&window.URL.createObjectURL(n)||n;var t=this;this.video.onloadeddata=function(){function i(){if(n>0)if(t.video.videoWidth>0){var r=t.video.videoWidth,u=t.video.videoHeight;isNaN(t.video.videoHeight)&&(u=r/(4/3));t.video.play();t.isStreaming=!0;t.baseTexture.source=t.video;t.updateTexture(null,r,u);t.onAccess.dispatch(t)}else window.setTimeout(i,500);else console.warn("Unable to connect to video stream. Webcam error?");n--}var n=10;i()}},createVideoFromBlob:function(n){var t=this;return this.video=document.createElement("video"),this.video.controls=!1,this.video.setAttribute("autoplay","autoplay"),this.video.setAttribute("playsinline","playsinline"),this.video.addEventListener("loadeddata",function(n){t.updateTexture(n)},!0),this.video.src=window.URL.createObjectURL(n),this.video.canplay=!0,this},createVideoFromURL:function(n,t){return t===undefined&&(t=!1),this.texture&&(this.texture.valid=!1),this.video=document.createElement("video"),this.video.controls=!1,t&&this.video.setAttribute("autoplay","autoplay"),this.video.setAttribute("playsinline","playsinline"),this.video.src=n,this.video.canplay=!0,this.video.load(),this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval),this.key=n,this},updateTexture:function(n,t,i){var r=!1;(t===undefined||t===null)&&(t=this.video.videoWidth,r=!0);(i===undefined||i===null)&&(i=this.video.videoHeight);this.width=t;this.height=i;this.baseTexture.source!==this.video&&(this.baseTexture.source=this.video);this.baseTexture.forceLoaded(t,i);this.texture.frame.resize(t,i);this.texture.width=t;this.texture.height=i;this.texture.valid=!0;this.snapshot&&this.snapshot.resize(t,i);r&&this.key!==null&&(this.onChangeSource.dispatch(this,t,i),this._autoplay&&(this.video.play(),this.onPlay.dispatch(this,this.loop,this.playbackRate)))},complete:function(){this.onComplete.dispatch(this)},play:function(n,t){return this._pendingChangeSource?this:(n===undefined&&(n=!1),t===undefined&&(t=1),this.game.sound.onMute&&(this.game.sound.onMute.add(this.setMute,this),this.game.sound.onUnMute.add(this.unsetMute,this),this.game.sound.mute&&this.setMute()),this.game.onPause.add(this.setPause,this),this.game.onResume.add(this.setResume,this),this._endCallback=this.complete.bind(this),this.video.addEventListener("ended",this._endCallback,!0),this.video.addEventListener("webkitendfullscreen",this._endCallback,!0),this.video.loop=n?"loop":"",this.video.playbackRate=t,this.touchLocked?this._pending=!0:(this._pending=!1,this.key!==null&&(this.video.readyState!==4?(this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval)):(this._playCallback=this.playHandler.bind(this),this.video.addEventListener("playing",this._playCallback,!0))),this.video.play(),this.onPlay.dispatch(this,n,t)),this)},playHandler:function(){this.video.removeEventListener("playing",this._playCallback,!0);this.updateTexture()},stop:function(){return this.game.sound.onMute&&(this.game.sound.onMute.remove(this.setMute,this),this.game.sound.onUnMute.remove(this.unsetMute,this)),this.game.onPause.remove(this.setPause,this),this.game.onResume.remove(this.setResume,this),this.isStreaming?(this.video.mozSrcObject?(this.video.mozSrcObject.stop(),this.video.src=null):this.video.srcObject?(this.video.srcObject.stop(),this.video.src=null):(this.video.src="",this.videoStream.active?this.videoStream.active=!1:this.videoStream.getTracks?this.videoStream.getTracks().forEach(function(n){n.stop()}):this.videoStream.stop()),this.videoStream=null,this.isStreaming=!1):(this.video.removeEventListener("ended",this._endCallback,!0),this.video.removeEventListener("webkitendfullscreen",this._endCallback,!0),this.video.removeEventListener("playing",this._playCallback,!0),this.touchLocked?this._pending=!1:this.video.pause()),this},add:function(n){if(Array.isArray(n))for(var t=0;t<n.length;t++)n[t].loadTexture&&n[t].loadTexture(this);else n.loadTexture(this);return this},addToWorld:function(n,t,i,r,u,f){u=u||1;f=f||1;var e=this.game.add.image(n,t,this);return e.anchor.set(i,r),e.scale.set(u,f),e},render:function(){!this.disableTextureUpload&&this.playing&&this.baseTexture.dirty()},setMute:function(){this._muted||(this._muted=!0,this.video.muted=!0)},unsetMute:function(){this._muted&&!this._codeMuted&&(this._muted=!1,this.video.muted=!1)},setPause:function(){this._paused||this.touchLocked||(this._paused=!0,this.video.pause())},setResume:function(){!this._paused||this._codePaused||this.touchLocked||(this._paused=!1,this.video.ended||this.video.play())},changeSource:function(n,t){return t===undefined&&(t=!0),this.texture.valid=!1,this.video.pause(),this._pendingChangeSource=!0,this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval),this.video.src=n,this.video.load(),this._autoplay=t,t||(this.paused=!0),this},checkVideoProgress:function(){this.video.readyState===4?(this._pendingChangeSource=!1,this.updateTexture()):(this.retry--,this.retry>0?this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval):console.warn("Phaser.Video: Unable to start downloading video in time",this.isStreaming))},setTouchLock:function(){this.game.input.addTouchLockCallback(this.unlock,this,!0);this.touchLocked=!0},unlock:function(){if(this.touchLocked=!1,this.playWhenUnlocked&&(this.video.play(),this.onPlay.dispatch(this,this.loop,this.playbackRate)),this.key){var n=this.game.cache.getVideo(this.key);n&&!n.isBlob&&(n.locked=!1)}return this.onTouchUnlock.dispatch(this),!0},grab:function(n,t,i){if(n===undefined&&(n=!1),t===undefined&&(t=1),i===undefined&&(i=null),this.snapshot===null){console.warn("Video.grab cannot run because Phaser.BitmapData is unavailable");return}return n&&this.snapshot.cls(),this.snapshot.copy(this.video,0,0,this.width,this.height,0,0,this.width,this.height,0,0,0,1,1,t,i),this.snapshot},removeVideoElement:function(){if(this.video){for(this.video.parentNode&&this.video.parentNode.removeChild(this.video);this.video.hasChildNodes();)this.video.removeChild(this.video.firstChild);this.video.removeAttribute("autoplay");this.video.removeAttribute("src");this.video=null}},destroy:function(){this.stop();this.removeVideoElement();this.touchLocked&&this.game.input.removeTouchLockCallback(this.unlock,this);this._retryID&&window.clearTimeout(this._retryID)}};Object.defineProperty(n.Video.prototype,"currentTime",{get:function(){return this.video?this.video.currentTime:0},set:function(n){this.video.currentTime=n}});Object.defineProperty(n.Video.prototype,"duration",{get:function(){return this.video?this.video.duration:0}});Object.defineProperty(n.Video.prototype,"progress",{get:function(){return this.video?this.video.currentTime/this.video.duration:0}});Object.defineProperty(n.Video.prototype,"mute",{get:function(){return this._muted},set:function(n){if(n=n||null,n){if(this._muted)return;this._codeMuted=!0;this.setMute()}else{if(!this._muted)return;this._codeMuted=!1;this.unsetMute()}}});Object.defineProperty(n.Video.prototype,"paused",{get:function(){return this._paused},set:function(n){if(n=n||null,!this.touchLocked)if(n){if(this._paused)return;this._codePaused=!0;this.setPause()}else{if(!this._paused)return;this._codePaused=!1;this.setResume()}}});Object.defineProperty(n.Video.prototype,"volume",{get:function(){return this.video?this.video.volume:1},set:function(n){n<0?n=0:n>1&&(n=1);this.video&&(this.video.volume=n)}});Object.defineProperty(n.Video.prototype,"playbackRate",{get:function(){return this.video?this.video.playbackRate:1},set:function(n){this.video&&(this.video.playbackRate=n)}});Object.defineProperty(n.Video.prototype,"loop",{get:function(){return this.video?this.video.loop:!1},set:function(n){n&&this.video?this.video.loop="loop":this.video&&(this.video.loop="")}});Object.defineProperty(n.Video.prototype,"playing",{get:function(){return this.video?!(this.video.paused&&this.video.ended):!1}});n.Video.prototype.constructor=n.Video;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
PIXI.blendModes===undefined&&(PIXI.blendModes=n.blendModes);PIXI.scaleModes===undefined&&(PIXI.scaleModes=n.scaleModes);PIXI.Texture.emptyTexture===undefined&&(PIXI.Texture.emptyTexture=new PIXI.Texture(new PIXI.BaseTexture));PIXI.DisplayObject._tempMatrix===undefined&&(PIXI.DisplayObject._tempMatrix=new n.Matrix);PIXI.TextureSilentFail=!0;PIXI.canUseNewCanvasBlendModes=function(){return n.Device.canUseMultiply};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
return typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=n),exports.Phaser=n):typeof define!="undefined"&&define.amd?define("Phaser",function(){return s.Phaser=n}()):s.Phaser=n,n}).call(this);